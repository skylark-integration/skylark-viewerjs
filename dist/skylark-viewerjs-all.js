/**
 * skylark-viewerjs - A version of viewerjs that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(factory,globals){var define=globals.define,require=globals.require,isAmd="function"==typeof define&&define.amd,isCmd=!isAmd&&"undefined"!=typeof exports;if(!isAmd&&!define){var map={};define=globals.define=function(e,t,n){"function"==typeof n?(map[e]={factory:n,deps:t.map(function(t){return function(e,t){if("."!==e[0])return e;var n=t.split("/"),r=e.split("/");n.pop();for(var i=0;i<r.length;i++)"."!=r[i]&&(".."==r[i]?n.pop():n.push(r[i]));return n.join("/")}(t,e)}),resolved:!1,exports:null},require(e)):map[e]={factory:null,resolved:!0,exports:n}},require=globals.require=function(e){if(!map.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var module=map[e];if(!module.resolved){var t=[];module.deps.forEach(function(e){t.push(require(e))}),module.exports=module.factory.apply(globals,t)||null,module.resolved=!0}return module.exports}}if(!define)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(define,require){define("skylark-langx-ns/_attach",[],function(){return function(e,t,n){"string"==typeof t&&(t=t.split("."));for(var r=t.length,i=e,o=0,s=t[o++];o<r;)i=i[s]=i[s]||{},s=t[o++];return i[s]=n||{},i[s]}}),define("skylark-langx-ns/ns",["./_attach"],function(e){var t={attach:function(n,r){return e(t,n,r)}};return t}),define("skylark-langx-ns/main",["./ns"],function(e){return e}),define("skylark-langx-ns",["skylark-langx-ns/main"],function(e){return e}),define("skylark-viewerjs/viewerjs",["skylark-langx-ns"],function(e){return e.attach("intg.viewerjs")}),define("skylark-viewerjs/viewer",["./viewerjs"],function(e){return e.Viewer=function(e,t){"use strict";var n,r,i,o,s,a,l=this,c=40,u=.25,d=4,h="auto",p=!1,f=!1,m=!1,g=document.getElementById("viewer"),b=document.getElementById("canvasContainer"),y=document.getElementById("overlayNavigator"),v=document.getElementById("titlebar"),S=document.getElementById("toolbarContainer"),C=document.getElementById("toolbarLeft"),x=document.getElementById("toolbarMiddleContainer"),A=document.getElementById("scaleSelect"),w=document.getElementById("dialogOverlay"),_=document.getElementById("toolbarRight"),N=[],E=5e3;function T(){return"block"===blanked.style.display}function k(){var t,n,i,o,s,a,l;l="undefined"!==String(typeof ViewerJS_version)?ViewerJS_version:"From Source",e&&(o=e.getPluginName(),s=e.getPluginVersion(),a=e.getPluginURL()),(t=document.createElement("div")).id="aboutDialogCentererTable",(n=document.createElement("div")).id="aboutDialogCentererCell",(r=document.createElement("div")).id="aboutDialog",r.innerHTML='<h1>ViewerJS</h1><p>Open Source document viewer for webpages, built with HTML and JavaScript.</p><p>Learn more and get your own copy on the <a href="http://viewerjs.org/" target="_blank">ViewerJS website</a>.</p>'+(e?'<p>Using the <a href = "'+a+'" target="_blank">'+o+'</a> (<span id = "pluginVersion">'+s+"</span>) plugin to show you this document.</p>":"")+"<p>Version "+l+'</p><p>Supported by <a href="https://nlnet.nl" target="_blank"><br><img src="images/nlnet.png" width="160" height="60" alt="NLnet Foundation"></a></p><p>Made by <a href="http://kogmbh.com" target="_blank"><br><img src="images/kogmbh.png" width="172" height="40" alt="KO GmbH"></a></p><button id = "aboutDialogCloseButton" class = "toolbarButton textButton">Close</button>',w.appendChild(t),t.appendChild(n),n.appendChild(r),(i=document.createElement("button")).id="about",i.className="toolbarButton textButton about",i.title="About",i.innerHTML="ViewerJS",_.appendChild(i),i.addEventListener("click",function(){w.style.display="block"}),document.getElementById("aboutDialogCloseButton").addEventListener("click",function(){w.style.display="none"})}function P(e){var t,n,r=A.options,i=!1;for(n=0;n<r.length;n+=1)(t=r[n]).value===e?(t.selected=!0,i=!0):t.selected=!1;return i}function R(e,t){if(e!==l.getZoomLevel()){l.setZoomLevel(e);var n=document.createEvent("UIEvents");n.initUIEvent("scalechange",!1,!1,window,0),n.scale=e,n.resetAutoSettings=t,window.dispatchEvent(n)}}function O(){var t;e.onScroll&&e.onScroll(),e.getPageInView&&(t=e.getPageInView())&&(i=t,document.getElementById("pageNumber").value=t)}function D(e){window.clearTimeout(o),o=window.setTimeout(function(){O()},e)}function I(t,n){var r,i,o;if(r="custom"===t?parseFloat(document.getElementById("customScaleOption").textContent)/100:parseFloat(t))return R(r,!0),void D(300);switch(i=b.clientWidth-c,o=b.clientHeight-c,t){case"page-actual":R(1,n);break;case"page-width":e.fitToWidth(i);break;case"page-height":e.fitToHeight(o);break;case"page-fit":e.fitToPage(i,o);break;case"auto":e.isSlideshow()?e.fitToPage(i+c,o+c):e.fitSmart(i)}P(t),D(300)}function F(){f=!f,p&&!f&&l.togglePresentationMode()}function M(){(p||e.isSlideshow())&&(y.className="viewer-touched",window.clearTimeout(s),s=window.setTimeout(function(){y.className=""},E))}function L(){v.classList.add("viewer-touched"),S.classList.add("viewer-touched"),window.clearTimeout(a),a=window.setTimeout(function(){B()},E)}function B(){v.classList.remove("viewer-touched"),S.classList.remove("viewer-touched")}function U(){v.classList.contains("viewer-touched")?B():L()}function z(e){blanked.style.display="block",blanked.style.backgroundColor=e,B()}function j(){blanked.style.display="none",U()}function W(e,t){var n=document.getElementById(e);n.addEventListener("click",function(){t(),n.blur()})}this.initialize=function(){var r;r=function(e){var t;if(-1!==["auto","page-actual","page-width"].indexOf(e))return e;if((t=parseFloat(e))&&u<=t&&t<=d)return e;return h}(t.zoom),n=t.documentUrl,document.title=t.title;var i=document.getElementById("documentName");i.innerHTML="",i.appendChild(i.ownerDocument.createTextNode(t.title)),e.onLoad=function(){var n,i;document.getElementById("pluginVersion").innerHTML=e.getPluginVersion(),e.isSlideshow()?(b.classList.add("slideshow"),C.style.visibility="visible"):(x.style.visibility="visible",e.getPageInView&&(C.style.visibility="visible")),m=!0,N=e.getPages(),document.getElementById("numPages").innerHTML="of "+N.length,I(r),l.showPage((n=t.startpage,i=parseInt(n,10),isNaN(i)?1:i)),b.onscroll=O,D()},e.initialize(b,n)},this.showPage=function(t){t<=0?t=1:t>N.length&&(t=N.length),e.showPage(t),i=t,document.getElementById("pageNumber").value=i},this.showNextPage=function(){l.showPage(i+1)},this.showPreviousPage=function(){l.showPage(i-1)},this.download=function(){var e=n.split("#")[0];e+="#viewer.action=download",window.open(e,"_parent")},this.toggleFullScreen=function(){var e=g;f?document.exitFullscreen?document.exitFullscreen():document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):e.msRequestFullscreen&&e.msRequestFullscreen()},this.togglePresentationMode=function(){var e=document.getElementById("overlayCloseButton");p?(T()&&j(),v.style.display=S.style.display="block",e.style.display="none",b.classList.remove("presentationMode"),b.onmouseup=function(){},b.oncontextmenu=function(){},b.onmousedown=function(){},I("auto")):(v.style.display=S.style.display="none",e.style.display="block",b.classList.add("presentationMode"),b.onmousedown=function(e){e.preventDefault()},b.oncontextmenu=function(e){e.preventDefault()},b.onmouseup=function(e){e.preventDefault(),1===e.which?l.showNextPage():l.showPreviousPage()},I("page-fit")),p=!p},this.getZoomLevel=function(){return e.getZoomLevel()},this.setZoomLevel=function(t){e.setZoomLevel(t)},this.zoomOut=function(){var e=(l.getZoomLevel()/1.1).toFixed(2);I(e=Math.max(u,e),!0)},this.zoomIn=function(){var e=(1.1*l.getZoomLevel()).toFixed(2);I(e=Math.min(d,e),!0)},k(),e&&(l.initialize(),document.exitFullscreen||document.cancelFullScreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.webkitCancelFullScreen||document.msExitFullscreen||(document.getElementById("fullscreen").style.visibility="hidden",document.getElementById("presentation").style.visibility="hidden"),W("overlayCloseButton",l.toggleFullScreen),W("fullscreen",l.toggleFullScreen),W("presentation",function(){f||l.toggleFullScreen(),l.togglePresentationMode()}),document.addEventListener("fullscreenchange",F),document.addEventListener("webkitfullscreenchange",F),document.addEventListener("mozfullscreenchange",F),document.addEventListener("MSFullscreenChange",F),W("download",l.download),W("zoomOut",l.zoomOut),W("zoomIn",l.zoomIn),W("previous",l.showPreviousPage),W("next",l.showNextPage),W("previousPage",l.showPreviousPage),W("nextPage",l.showNextPage),document.getElementById("pageNumber").addEventListener("change",function(){l.showPage(this.value)}),document.getElementById("scaleSelect").addEventListener("change",function(){I(this.value)}),b.addEventListener("click",M),y.addEventListener("click",M),b.addEventListener("click",U),v.addEventListener("click",L),S.addEventListener("click",L),window.addEventListener("scalechange",function(e){var t=document.getElementById("customScaleOption"),n=P(String(e.scale));t.selected=!1,n||(t.textContent=Math.round(1e4*e.scale)/100+"%",t.selected=!0)},!0),window.addEventListener("resize",function(e){m&&(document.getElementById("pageWidthOption").selected||document.getElementById("pageAutoOption").selected)&&I(document.getElementById("scaleSelect").value),M()}),window.addEventListener("keydown",function(e){var t=e.keyCode,n=e.shiftKey;if(T())switch(t){case 16:case 17:case 18:case 91:case 93:case 224:case 225:break;default:j()}else switch(t){case 8:case 33:case 37:case 38:case 80:l.showPreviousPage();break;case 13:case 34:case 39:case 40:case 78:l.showNextPage();break;case 32:n?l.showPreviousPage():l.showNextPage();break;case 66:case 190:p&&z("#000");break;case 87:case 188:p&&z("#FFF");break;case 36:l.showPage(1);break;case 35:l.showPage(N.length)}}))}}),define("skylark-webodf/webodf",[],function(){var webodf_version="0.5.9";function Runtime(){}Runtime.prototype.getVariable=function(e){},Runtime.prototype.toJson=function(e){},Runtime.prototype.fromJson=function(e){},Runtime.prototype.byteArrayFromString=function(e,t){},Runtime.prototype.byteArrayToString=function(e,t){},Runtime.prototype.read=function(e,t,n,r){},Runtime.prototype.readFile=function(e,t,n){},Runtime.prototype.readFileSync=function(e,t){},Runtime.prototype.loadXML=function(e,t){},Runtime.prototype.writeFile=function(e,t,n){},Runtime.prototype.deleteFile=function(e,t){},Runtime.prototype.log=function(e,t){},Runtime.prototype.setTimeout=function(e,t){},Runtime.prototype.clearTimeout=function(e){},Runtime.prototype.libraryPaths=function(){},Runtime.prototype.currentDirectory=function(){},Runtime.prototype.setCurrentDirectory=function(e){},Runtime.prototype.type=function(){},Runtime.prototype.getDOMImplementation=function(){},Runtime.prototype.parseXML=function(e){},Runtime.prototype.exit=function(e){},Runtime.prototype.getWindow=function(){},Runtime.prototype.requestAnimationFrame=function(e){},Runtime.prototype.cancelAnimationFrame=function(e){},Runtime.prototype.assert=function(e,t){};var IS_COMPILED_CODE=!0;function BrowserRuntime(){function e(e){var t,n,r=e.length,i=0;for(t=0;t<r;t+=1)n=e.charCodeAt(t),i+=1+(128<n)+(2048<n),55040<n&&57344>n&&(i+=1,t+=1);return i}function t(e,t,n){var r,i,o=e.length;for(t=new Uint8Array(new ArrayBuffer(t)),n?(t[0]=239,t[1]=187,t[2]=191,i=3):i=0,n=0;n<o;n+=1)128>(r=e.charCodeAt(n))?(t[i]=r,i+=1):2048>r?(t[i]=192|r>>>6,t[i+1]=128|63&r,i+=2):55040>=r||57344<=r?(t[i]=224|r>>>12&15,t[i+1]=128|r>>>6&63,t[i+2]=128|63&r,i+=3):(n+=1,r=65536+(r-55296<<10|e.charCodeAt(n)-56320),t[i]=240|r>>>18&7,t[i+1]=128|r>>>12&63,t[i+2]=128|r>>>6&63,t[i+3]=128|63&r,i+=4);return t}function n(e){var t,n=e.length,r=new Uint8Array(new ArrayBuffer(n));for(t=0;t<n;t+=1)r[t]=255&e.charCodeAt(t);return r}function r(e,t){var n;void 0!==t?n=e:t=e,console.log(t),a.enableAlerts&&"alert"===n&&alert(t)}function i(r,i,o){if(0!==o.status||o.responseText)if(200===o.status||0===o.status){if(o.response&&"string"!=typeof o.response)"binary"===i?(o=o.response,o=new Uint8Array(o)):o=String(o.response);else if("binary"===i)if(null!==o.responseBody&&"undefined"!==String(typeof VBArray)){var s=(o=new VBArray(o.responseBody).toArray()).length;for(i=new Uint8Array(new ArrayBuffer(s)),r=0;r<s;r+=1)i[r]=o[r];o=i}else{if((r=o.getResponseHeader("Content-Length"))&&(r=parseInt(r,10)),r&&r!==o.responseText.length)e:{s=o.responseText,i=!1;var a=e(s);if("number"==typeof r){if(r!==a&&r!==a+3){s=void 0;break e}i=a+3===r,a=r}s=t(s,a,i)}void 0===s&&(s=n(o.responseText)),o=s}else o=o.responseText;o={err:null,data:o}}else o={err:o.responseText||o.statusText,data:null};else o={err:"File "+r+" is empty.",data:null};return o}function o(e,t,n){var r=new XMLHttpRequest;return r.open("GET",e,n),r.overrideMimeType&&("binary"!==t?r.overrideMimeType("text/plain; charset="+t):r.overrideMimeType("text/plain; charset=x-user-defined")),r}function s(e,t,n){var r=o(e,t,!0);r.onreadystatechange=function(){var o;4===r.readyState&&(o=i(e,t,r),n(o.err,o.data))};try{r.send(null)}catch(e){n(e.message,null)}}var a=this;this.byteArrayFromString=function(r,i){var o;return"utf8"===i?o=t(r,e(r),!1):("binary"!==i&&a.log("unknown encoding: "+i),o=n(r)),o},this.byteArrayToString=Runtime.byteArrayToString,this.getVariable=Runtime.getVariable,this.fromJson=Runtime.fromJson,this.toJson=Runtime.toJson,this.readFile=s,this.read=function(e,t,n,r){s(e,"binary",function(e,i){var o=null;if(i){if("string"==typeof i)throw"This should not happen.";o=i.subarray(t,t+n)}r(e,o)})},this.readFileSync=function(e,t){var n,r=o(e,t,!1);try{if(r.send(null),(n=i(e,t,r)).err)throw n.err;if(null===n.data)throw"No data read from "+e+"."}catch(e){throw e}return n.data},this.writeFile=function(e,t,n){var r,i=new XMLHttpRequest;i.open("PUT",e,!0),i.onreadystatechange=function(){4===i.readyState&&(0!==i.status||i.responseText?200<=i.status&&300>i.status||0===i.status?n(null):n("Status "+String(i.status)+": "+i.responseText||i.statusText):n("File "+e+" is empty."))},r=t.buffer&&!i.sendAsBinary?t.buffer:a.byteArrayToString(t,"binary");try{i.sendAsBinary?i.sendAsBinary(r):i.send(r)}catch(e){a.log("HUH? "+e+" "+t),n(e.message)}},this.deleteFile=function(e,t){var n=new XMLHttpRequest;n.open("DELETE",e,!0),n.onreadystatechange=function(){4===n.readyState&&(200>n.status&&300<=n.status?t(n.responseText):t(null))},n.send(null)},this.loadXML=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.overrideMimeType&&n.overrideMimeType("text/xml"),n.onreadystatechange=function(){4===n.readyState&&(0!==n.status||n.responseText?200===n.status||0===n.status?t(null,n.responseXML):t(n.responseText,null):t("File "+e+" is empty.",null))};try{n.send(null)}catch(e){t(e.message,null)}},this.log=r,this.enableAlerts=!0,this.assert=Runtime.assert,this.setTimeout=function(e,t){return setTimeout(function(){e()},t)},this.clearTimeout=function(e){clearTimeout(e)},this.libraryPaths=function(){return["lib"]},this.setCurrentDirectory=function(){},this.currentDirectory=function(){return""},this.type=function(){return"BrowserRuntime"},this.getDOMImplementation=function(){return window.document.implementation},this.parseXML=function(e){return(new DOMParser).parseFromString(e,"text/xml")},this.exit=function(e){r("Calling exit with code "+String(e)+", but exit() is not implemented.")},this.getWindow=function(){return window},this.requestAnimationFrame=function(e){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame;return t?(t.bind(window),t(e)):setTimeout(e,15)},this.cancelAnimationFrame=function(e){var t=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame;t?(t.bind(window),t(e)):clearTimeout(e)}}function NodeJSRuntime(){function e(e){var t,n=e.length,r=new Uint8Array(new ArrayBuffer(n));for(t=0;t<n;t+=1)r[t]=e[t];return r}function t(t,n,r){function i(n,i){return n?r(n,null):i?"string"==typeof i?r(n,i):void r(n,e(i)):r("No data for "+t+".",null)}t=s.resolve(a,t),"binary"!==n?o.readFile(t,n,i):o.readFile(t,null,i)}var n,r,i=this,o=require("fs"),s=require("path"),a="";this.byteArrayFromString=function(e,t){var n,r=new Buffer(e,t),i=r.length,o=new Uint8Array(new ArrayBuffer(i));for(n=0;n<i;n+=1)o[n]=r[n];return o},this.byteArrayToString=Runtime.byteArrayToString,this.getVariable=Runtime.getVariable,this.fromJson=Runtime.fromJson,this.toJson=Runtime.toJson,this.readFile=t,this.loadXML=function(e,n){t(e,"utf-8",function(t,r){return t?n(t,null):r?void n(null,i.parseXML(r)):n("No data for "+e+".",null)})},this.writeFile=function(e,t,n){t=new Buffer(t),e=s.resolve(a,e),o.writeFile(e,t,"binary",function(e){n(e||null)})},this.deleteFile=function(e,t){e=s.resolve(a,e),o.unlink(e,t)},this.read=function(t,n,r,i){t=s.resolve(a,t),o.open(t,"r+",666,function(t,s){if(t)i(t,null);else{var a=new Buffer(r);o.read(s,a,0,r,n,function(t){o.close(s),i(t,e(a))})}})},this.readFileSync=function(t,n){var r;if(null===(r=o.readFileSync(t,"binary"===n?null:n)))throw"File "+t+" could not be read.";return"binary"===n&&(r=e(r)),r},this.log=function(e,t){var n;void 0!==t?n=e:t=e,"alert"===n&&process.stderr.write("\n!!!!! ALERT !!!!!\n"),process.stderr.write(t+"\n"),"alert"===n&&process.stderr.write("!!!!! ALERT !!!!!\n")},this.assert=Runtime.assert,this.setTimeout=function(e,t){return setTimeout(function(){e()},t)},this.clearTimeout=function(e){clearTimeout(e)},this.libraryPaths=function(){return[__dirname]},this.setCurrentDirectory=function(e){a=e},this.currentDirectory=function(){return a},this.type=function(){return"NodeJSRuntime"},this.getDOMImplementation=function(){return r},this.parseXML=function(e){return n.parseFromString(e,"text/xml")},this.exit=process.exit,this.getWindow=function(){return null},this.requestAnimationFrame=function(e){return setTimeout(e,15)},this.cancelAnimationFrame=function(e){clearTimeout(e)},n=new(require("xmldom").DOMParser),r=i.parseXML("<a/>").implementation}function RhinoRuntime(){var e,t,n=this,r={},i=r.javax.xml.parsers.DocumentBuilderFactory.newInstance(),o="";i.setValidating(!1),i.setNamespaceAware(!0),i.setExpandEntityReferences(!1),i.setSchema(null),t=r.org.xml.sax.EntityResolver({resolveEntity:function(e,t){var n=new r.java.io.FileReader(t);return new r.org.xml.sax.InputSource(n)}}),(e=i.newDocumentBuilder()).setEntityResolver(t),this.byteArrayFromString=function(e,t){var n,r=e.length,i=new Uint8Array(new ArrayBuffer(r));for(n=0;n<r;n+=1)i[n]=255&e.charCodeAt(n);return i},this.byteArrayToString=Runtime.byteArrayToString,this.getVariable=Runtime.getVariable,this.fromJson=Runtime.fromJson,this.toJson=Runtime.toJson,this.loadXML=function(t,n){var i=new r.java.io.File(t),o=null;try{o=e.parse(i)}catch(e){return print(e),n(e,null)}n(null,o)},this.readFile=function(e,t,i){o&&(e=o+"/"+e);var s=new r.java.io.File(e),a="binary"===t?"latin1":t;s.isFile()?((e=readFile(e,a))&&"binary"===t&&(e=n.byteArrayFromString(e,"binary")),i(null,e)):i(e+" is not a file.",null)},this.writeFile=function(e,t,n){o&&(e=o+"/"+e),e=new r.java.io.FileOutputStream(e);var i,s=t.length;for(i=0;i<s;i+=1)e.write(t[i]);e.close(),n(null)},this.deleteFile=function(e,t){o&&(e=o+"/"+e);var n=new r.java.io.File(e),i=e+Math.random(),i=new r.java.io.File(i);n.rename(i)?(i.deleteOnExit(),t(null)):t("Could not delete "+e)},this.read=function(e,t,n,i){var s;o&&(e=o+"/"+e),s=e;var a="binary";new r.java.io.File(s).isFile()?("binary"===a&&(a="latin1"),s=readFile(s,a)):s=null,s?i(null,this.byteArrayFromString(s.substring(t,t+n),"binary")):i("Cannot read "+e,null)},this.readFileSync=function(e,t){if(!t)return"";var n=readFile(e,t);if(null===n)throw"File could not be read.";return n},this.log=function(e,t){var n;void 0!==t?n=e:t=e,"alert"===n&&print("\n!!!!! ALERT !!!!!"),print(t),"alert"===n&&print("!!!!! ALERT !!!!!")},this.assert=Runtime.assert,this.setTimeout=function(e){return e(),0},this.clearTimeout=function(){},this.libraryPaths=function(){return["lib"]},this.setCurrentDirectory=function(e){o=e},this.currentDirectory=function(){return o},this.type=function(){return"RhinoRuntime"},this.getDOMImplementation=function(){return e.getDOMImplementation()},this.parseXML=function(t){return t=new r.java.io.StringReader(t),t=new r.org.xml.sax.InputSource(t),e.parse(t)},this.exit=quit,this.getWindow=function(){return null},this.requestAnimationFrame=function(e){return e(),0},this.cancelAnimationFrame=function(){}}Runtime.byteArrayToString=function(e,t){var n;return"utf8"===t?n=function(e){var t,n,r,i,o,s="",a=e.length,l=[];for(t=3<=a&&239===e[0]&&187===e[1]&&191===e[2]?3:0;t<a;t+=1)128>(n=e[t])?l.push(n):(r=e[t+=1],194<=n&&224>n?l.push((31&n)<<6|63&r):(i=e[t+=1],224<=n&&240>n?l.push((15&n)<<12|(63&r)<<6|63&i):(o=e[t+=1],240<=n&&245>n&&(n=(7&n)<<18|(63&r)<<12|(63&i)<<6|63&o,n-=65536,l.push(55296+(n>>10),56320+(1023&n)))))),1e3<=l.length&&(s+=String.fromCharCode.apply(null,l),l.length=0);return s+String.fromCharCode.apply(null,l)}(e):("binary"!==t&&this.log("Unsupported encoding: "+t),n=function(e){var t,n="",r=e.length;for(t=0;t<r;t+=1)n+=String.fromCharCode(255&e[t]);return n}(e)),n},Runtime.getVariable=function(g){try{return eval(g)}catch(e){}},Runtime.toJson=function(e){return JSON.stringify(e)},Runtime.fromJson=function(e){return JSON.parse(e)},Runtime.getFunctionName=function(e){return void 0===e.name?(e=/function\s+(\w+)/.exec(e))&&e[1]:e.name},Runtime.assert=function(e,t){if(!e)throw this.log("alert","ASSERTION FAILED:\n"+t),Error(t)},Runtime.create=function(){return"undefined"!==String(typeof window)?new BrowserRuntime:"undefined"!==String(typeof require)?new NodeJSRuntime:new RhinoRuntime};var runtime=Runtime.create(),core={},gui={},xmldom={},odf={},ops={},webodf={},g;function makeBase64(){function e(e){var t,n=e.length,r=new Uint8Array(new ArrayBuffer(n));for(t=0;t<n;t+=1)r[t]=255&e.charCodeAt(t);return r}function t(e){var t,n,r="",i=e.length-2;for(n=0;n<i;n+=3)t=e[n]<<16|e[n+1]<<8|e[n+2],r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t>>>18],r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t>>>12&63],r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t>>>6&63],r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t];return n===i+1?(t=e[n]<<4,r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t>>>6],r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t],r+="=="):n===i&&(t=e[n]<<10|e[n+1]<<2,r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t>>>12],r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t>>>6&63],r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t],r+="="),r}function n(e){var t,n,r=(e=e.replace(/[^A-Za-z0-9+\/]+/g,"")).length,i=new Uint8Array(new ArrayBuffer(3*r)),o=e.length%4,s=0;for(t=0;t<r;t+=4)n=(y[e.charAt(t)]||0)<<18|(y[e.charAt(t+1)]||0)<<12|(y[e.charAt(t+2)]||0)<<6|(y[e.charAt(t+3)]||0),i[s]=n>>16,i[s+1]=n>>8&255,i[s+2]=255&n,s+=3;return r=3*r-[0,0,2,1][o],i.subarray(0,r)}function r(e){var t,n,r=e.length,i=0,o=new Uint8Array(new ArrayBuffer(3*r));for(t=0;t<r;t+=1)128>(n=e[t])?o[i++]=n:(2048>n?o[i++]=192|n>>>6:(o[i++]=224|n>>>12&15,o[i++]=128|n>>>6&63),o[i++]=128|63&n);return o.subarray(0,i)}function i(e){var t,n,r,i,o=e.length,s=new Uint8Array(new ArrayBuffer(o)),a=0;for(t=0;t<o;t+=1)128>(n=e[t])?s[a++]=n:(r=e[t+=1],224>n?s[a++]=(31&n)<<6|63&r:(i=e[t+=1],s[a++]=(15&n)<<12|(63&r)<<6|63&i));return s.subarray(0,a)}function o(n){return t(e(n))}function s(e){return String.fromCharCode.apply(String,n(e))}function a(t){return i(e(t))}function l(e){e=i(e);for(var t="",n=0;n<e.length;)t+=String.fromCharCode.apply(String,e.subarray(n,n+45e3)),n+=45e3;return t}function c(e,t,n){var r,i,o,s="";for(o=t;o<n;o+=1)128>(t=255&e.charCodeAt(o))?s+=String.fromCharCode(t):(o+=1,r=255&e.charCodeAt(o),224>t?s+=String.fromCharCode((31&t)<<6|63&r):(o+=1,i=255&e.charCodeAt(o),s+=String.fromCharCode((15&t)<<12|(63&r)<<6|63&i)));return s}function u(e,t){var n="",r=0;1e5>e.length?t(c(e,0,e.length),!0):("string"!=typeof e&&(e=e.slice()),function i(){var o=r+1e5;o>e.length&&(o=e.length);n+=c(e,r,o);r=o;o=r===e.length;t(n,o)&&!o&&runtime.setTimeout(i,0)}())}function d(t){return r(e(t))}function h(e){return String.fromCharCode.apply(String,r(e))}function p(t){return String.fromCharCode.apply(String,r(e(t)))}var f,m,g,b,y=function(e){var t,n,r={};for(t=0,n=e.length;t<n;t+=1)r[e.charAt(t)]=t;return r}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),v=runtime.getWindow();return v&&v.btoa?(g=v.btoa,f=function(e){return g(p(e))}):(g=o,f=function(e){return t(d(e))}),v&&v.atob?(b=v.atob,m=function(e){return c(e=b(e),0,e.length)}):(b=s,m=function(e){return l(n(e))}),core.Base64=function(){return this.convertByteArrayToBase64=this.convertUTF8ArrayToBase64=t,this.convertBase64ToByteArray=this.convertBase64ToUTF8Array=n,this.convertUTF16ArrayToByteArray=this.convertUTF16ArrayToUTF8Array=r,this.convertByteArrayToUTF16Array=this.convertUTF8ArrayToUTF16Array=i,this.convertUTF8StringToBase64=o,this.convertBase64ToUTF8String=s,this.convertUTF8StringToUTF16Array=a,this.convertByteArrayToUTF16String=this.convertUTF8ArrayToUTF16String=l,this.convertUTF8StringToUTF16String=u,this.convertUTF16StringToByteArray=this.convertUTF16StringToUTF8Array=d,this.convertUTF16ArrayToUTF8String=h,this.convertUTF16StringToUTF8String=p,this.convertUTF16StringToBase64=f,this.convertBase64ToUTF16String=m,this.fromBase64=s,this.toBase64=o,this.atob=b,this.btoa=g,this.utob=p,this.btou=u,this.encode=f,this.encodeURI=function(e){return f(e).replace(/[+\/]/g,function(e){return"+"===e?"-":"_"}).replace(/\\=+$/,"")},this.decode=function(e){return m(e.replace(/[\-_]/g,function(e){return"-"===e?"+":"/"}))},this},core.Base64}function createXPathSingleton(){function e(e,t,n){return-1!==e&&(e<t||-1===t)&&(e<n||-1===n)}function t(t){for(var n,r=[],i=0,o=t.length;i<o;){var s=t,a=o,l=r,u="",d=[],h=s.indexOf("[",i),p=s.indexOf("/",i),f=s.indexOf("=",i);if(e(p,h,f)?(u=s.substring(i,p),i=p+1):e(h,p,f)?(u=s.substring(i,h),i=c(s,h,d)):e(f,p,h)?(u=s.substring(i,f),i=f):(u=s.substring(i,a),i=a),l.push({location:u,predicates:d}),i<o&&"="===t[i]){if(2<(n=t.substring(i+1,o)).length&&("'"===n[0]||'"'===n[0]))n=n.slice(1,n.length-1);else try{n=parseInt(n,10)}catch(e){}i=o}}return{steps:r,value:n}}function n(){var e=null,t=!1;this.setNode=function(t){e=t},this.reset=function(){t=!1},this.next=function(){var n=t?null:e;return t=!0,n}}function r(e,t,n){this.reset=function(){e.reset()},this.next=function(){for(var r=e.next();r&&(r.nodeType===Node.ELEMENT_NODE&&(r=r.getAttributeNodeNS(t,n)),!r);)r=e.next();return r}}function i(e,t){var n=e.next(),r=null;this.reset=function(){e.reset(),n=e.next(),r=null},this.next=function(){for(;n;){if(r)if(t&&r.firstChild)r=r.firstChild;else{for(;!r.nextSibling&&r!==n;)r=r.parentNode;r===n?n=e.next():r=r.nextSibling}else do{(r=n.firstChild)||(n=e.next())}while(n&&!r);if(r&&r.nodeType===Node.ELEMENT_NODE)return r}return null}}function o(e,t){this.reset=function(){e.reset()},this.next=function(){for(var n=e.next();n&&!t(n);)n=e.next();return n}}function s(e,t,n){t=t.split(":",2);var r=n(t[0]),i=t[1];return new o(e,function(e){return e.localName===i&&e.namespaceURI===r})}function a(e,t,r){var i=new n,s=l(i,t,r),a=t.value;return new o(e,void 0===a?function(e){return i.setNode(e),s.reset(),null!==s.next()}:function(e){return i.setNode(e),s.reset(),!!(e=s.next())&&e.nodeValue===a})}var l,c;return c=function(e,n,r){for(var i=n,o=e.length,s=0;i<o;)"]"===e[i]?0>=--s&&r.push(t(e.substring(n,i))):"["===e[i]&&(0>=s&&(n=i+1),s+=1),i+=1;return i},l=function(e,t,n){var o,l,c,u;for(o=0;o<t.steps.length;o+=1){if(c=t.steps[o],""===(l=c.location))e=new i(e,!1);else if("@"===l[0]){if(l=l.substr(1).split(":",2),!(u=n(l[0])))throw"No namespace associated with the prefix "+l[0];e=new r(e,u,l[1])}else"."!==l&&(e=new i(e,!1),-1!==l.indexOf(":")&&(e=s(e,l,n)));for(l=0;l<c.predicates.length;l+=1)u=c.predicates[l],e=a(e,u,n)}return e},{getODFElementsWithXPath:function(e,r,i){var o=e.ownerDocument,s=[],a=null;if(o&&"function"==typeof o.evaluate)for(i=o.evaluate(r,e,i,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null),a=i.iterateNext();null!==a;)a.nodeType===Node.ELEMENT_NODE&&s.push(a),a=i.iterateNext();else{for((s=new n).setNode(e),e=t(r),s=l(s,e,i),e=[],i=s.next();i;)e.push(i),i=s.next();s=e}return s}}}function RootFilter(e,t,n){var r=core.PositionFilter.FilterResult.FILTER_ACCEPT,i=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(o){var s;return o=o.container(),s="string"==typeof e?t[e].getNode():e,n(o)===n(s)?r:i}}webodf.Version="undefined"!==String(typeof webodf_version)?webodf_version:"From Source",function(){function g(e,t,n){var r,i,o=e+"/manifest.json";runtime.log("Loading manifest: "+o);try{r=runtime.readFileSync(o,"utf-8")}catch(e){if(!n)throw console.log(String(e)),e;return void runtime.log("No loadable manifest found.")}for(i in n=JSON.parse(r))n.hasOwnProperty(i)&&(t[i]={dir:e,deps:n[i]})}function k(e,t,n){var r=[],i={},o={};return e.forEach(function e(s){if(!o[s]&&!n(s)){if(i[s])throw"Circular dependency detected for "+s+".";if(i[s]=!0,!t[s])throw"Missing dependency information for class "+s+".";var a,l=t[s],c=l.deps,u=c.length;for(a=0;a<u;a+=1)e(c[a]);i[s]=!1,o[s]=!0,r.push(l.dir+"/"+s.replace(".","/")+".js")}}),r}function d(e,t){return t+"\n//# sourceURL="+e}function b(b){var f,e;for(f=0;f<b.length;f+=1)e=runtime.readFileSync(b[f],"utf-8"),e=d(b[f],e),eval(e)}function f(e){e=e.split(".");var t,n=p,r=e.length;for(t=0;t<r;t+=1){if(!n.hasOwnProperty(e[t]))return!1;n=n[e[t]]}return!0}var n,p={core:core,gui:gui,xmldom:xmldom,odf:odf,ops:ops};runtime.loadClasses=function(e,t){if(IS_COMPILED_CODE||0===e.length)return t&&t();var r;if(!(r=n)){r=[];var i,o=runtime.libraryPaths();for(runtime.currentDirectory()&&-1===o.indexOf(runtime.currentDirectory())&&g(runtime.currentDirectory(),r,!0),i=0;i<o.length;i+=1)g(o[i],r)}if(0===(e=k(e,n=r,f)).length)return t&&t();if("BrowserRuntime"===runtime.type()&&t){var s,a;for(r=e,o=document.currentScript||document.documentElement.lastChild,i=document.createDocumentFragment(),a=0;a<r.length;a+=1)(s=document.createElement("script")).type="text/javascript",s.charset="utf-8",s.async=!1,s.setAttribute("src",r[a]),i.appendChild(s);t&&(s.onload=t),o.parentNode.insertBefore(i,o)}else b(e),t&&t()},runtime.loadClass=function(e,t){runtime.loadClasses([e],t)}}(),g=function(e){return e},runtime.getTranslator=function(){return g},runtime.setTranslator=function(e){g=e},runtime.tr=function(e){var t=g(e);return t&&"string"===String(typeof t)?t:e},function(g){function k(d){if(d.length){var b=d[0];runtime.readFile(b,"utf8",function(f,n){function g(){var b;(b=eval(k))&&runtime.exit(b)}var r="",r=b.lastIndexOf("/"),k=n,r=-1!==r?b.substring(0,r):".";runtime.setCurrentDirectory(r),f?(runtime.log(f),runtime.exit(1)):null===k?(runtime.log("No code found for "+b),runtime.exit(1)):g.apply(null,d)})}}g=g?Array.prototype.slice.call(g):[],"NodeJSRuntime"===runtime.type()?k(process.argv.slice(2)):"RhinoRuntime"===runtime.type()?k(g):k(g.slice(1))}("undefined"!==String(typeof arguments)&&arguments),core.Async={forEach:function(e,t,n){function r(e){s!==o&&(e?(s=o,n(e)):(s+=1)===o&&n(null))}var i,o=e.length,s=0;for(i=0;i<o;i+=1)t(e[i],r)},destroyAll:function(e,t){!function n(r,i){i?t(i):r<e.length?e[r](function(e){n(r+1,e)}):t()}(0,void 0)}},core.Base64=makeBase64(),core.CSSUnits=function(){var e=this,t={in:1,cm:2.54,mm:25.4,pt:72,pc:12,px:96};this.convert=function(e,n,r){return e*t[r]/t[n]},this.convertMeasure=function(t,n){var r,i;return t&&n&&(r=parseFloat(t),i=t.replace(r.toString(),""),r=e.convert(r,i,n)),r},this.getUnits=function(e){return e.substr(e.length-2,e.length)}},function(){function e(){var e,t,r,i,o,s,a,l,c;return void 0===n&&(t=(e=runtime.getWindow())&&e.document,s=t.documentElement,a=t.body,n={rangeBCRIgnoresElementBCR:!1,unscaledRangeClientRects:!1,elementBCRIgnoresBodyScroll:!1},t&&((i=t.createElement("div")).style.position="absolute",i.style.left="-99999px",i.style.transform="scale(2)",i.style["-webkit-transform"]="scale(2)",o=t.createElement("div"),i.appendChild(o),a.appendChild(i),(e=t.createRange()).selectNode(o),n.rangeBCRIgnoresElementBCR=0===e.getClientRects().length,o.appendChild(t.createTextNode("Rect transform test")),t=o.getBoundingClientRect(),r=e.getBoundingClientRect(),n.unscaledRangeClientRects=2<Math.abs(t.height-r.height),i.style.transform="",i.style["-webkit-transform"]="",t=s.style.overflow,r=a.style.overflow,l=a.style.height,c=a.scrollTop,s.style.overflow="visible",a.style.overflow="visible",a.style.height="200%",a.scrollTop=a.scrollHeight,n.elementBCRIgnoresBodyScroll=e.getBoundingClientRect().top!==o.getBoundingClientRect().top,a.scrollTop=c,a.style.height=l,a.style.overflow=r,s.style.overflow=t,e.detach(),a.removeChild(i),e=Object.keys(n).map(function(e){return e+":"+String(n[e])}).join(", "),runtime.log("Detected browser quirks - "+e))),n}function t(e,t,n){for(e=e?e.firstElementChild:null;e;){if(e.localName===n&&e.namespaceURI===t)return e;e=e.nextElementSibling}return null}var n;core.DomUtilsImpl=function(){function n(e,t){for(var n,r=0;e.parentNode!==t;)runtime.assert(null!==e.parentNode,"parent is null"),e=e.parentNode;for(n=t.firstChild;n!==e;)r+=1,n=n.nextSibling;return r}function r(e,t){return 0>=e.compareBoundaryPoints(Range.START_TO_START,t)&&0<=e.compareBoundaryPoints(Range.END_TO_END,t)}function i(e,t){return 0>=e.compareBoundaryPoints(Range.END_TO_START,t)&&0<=e.compareBoundaryPoints(Range.START_TO_END,t)}function o(e,t){var n=null;return e.nodeType===Node.TEXT_NODE&&(0===e.length?(e.parentNode.removeChild(e),t.nodeType===Node.TEXT_NODE&&(n=t)):(t.nodeType===Node.TEXT_NODE&&(e.appendData(t.data),t.parentNode.removeChild(t)),n=e)),n}function s(e){for(var t=e.parentNode;e.firstChild;)t.insertBefore(e.firstChild,e);return t.removeChild(e),t}function a(e,t){return e===t||Boolean(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)}function l(t,n){return e().unscaledRangeClientRects?t:t/n}var c=null;this.splitBoundaries=function(e){var t,r,i,o,s=[];if(e.startContainer.nodeType===Node.TEXT_NODE||e.endContainer.nodeType===Node.TEXT_NODE){if(r=e.endContainer,i=e.endContainer.nodeType!==Node.TEXT_NODE&&e.endOffset===e.endContainer.childNodes.length,o=e.endOffset,t=e.endContainer,o<t.childNodes.length)for(t=t.childNodes.item(o),o=0;t.firstChild;)t=t.firstChild;else for(;t.lastChild;)t=t.lastChild,o=t.nodeType===Node.TEXT_NODE?t.textContent.length:t.childNodes.length;if(t===r&&(r=null),e.setEnd(t,o),o=e.endContainer,0!==e.endOffset&&o.nodeType===Node.TEXT_NODE&&(t=o,e.endOffset!==t.length&&(s.push(t.splitText(e.endOffset)),s.push(t))),o=e.startContainer,0!==e.startOffset&&o.nodeType===Node.TEXT_NODE&&(t=o,e.startOffset!==t.length&&(o=t.splitText(e.startOffset),s.push(t),s.push(o),e.setStart(o,0))),null!==r){for(o=e.endContainer;o.parentNode&&o.parentNode!==r;)o=o.parentNode;i=i?r.childNodes.length:n(o,r),e.setEnd(r,i)}}return s},this.containsRange=r,this.rangesIntersect=i,this.rangeIntersection=function(e,t){var n;return i(e,t)&&(n=e.cloneRange(),-1===e.compareBoundaryPoints(Range.START_TO_START,t)&&n.setStart(t.startContainer,t.startOffset),1===e.compareBoundaryPoints(Range.END_TO_END,t)&&n.setEnd(t.endContainer,t.endOffset)),n},this.getNodesInRange=function(e,t,n){var r,i,o=[],s=e.commonAncestorContainer,s=s.nodeType===Node.TEXT_NODE?s.parentNode:s;if(n=e.startContainer.ownerDocument.createTreeWalker(s,n,t,!1),e.endContainer.childNodes[e.endOffset-1]?(r=e.endContainer.childNodes[e.endOffset-1],i=Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINED_BY):(r=e.endContainer,i=Node.DOCUMENT_POSITION_PRECEDING),e.startContainer.childNodes[e.startOffset])e=e.startContainer.childNodes[e.startOffset],n.currentNode=e;else{var a=e.startContainer;e.startOffset===(a.nodeType===Node.TEXT_NODE?a.length:a.childNodes.length)?(e=e.startContainer,n.currentNode=e,n.lastChild(),e=n.nextNode()):(e=e.startContainer,n.currentNode=e)}if(e){if((e=n.currentNode)!==s)for(e=e.parentNode;e&&e!==s;)t(e)===NodeFilter.FILTER_REJECT&&(n.currentNode=e),e=e.parentNode;switch(e=n.currentNode,t(e)){case NodeFilter.FILTER_REJECT:for(e=n.nextSibling();!e&&n.parentNode();)e=n.nextSibling();break;case NodeFilter.FILTER_SKIP:e=n.nextNode()}for(;e&&(0===(t=r.compareDocumentPosition(e))||0!=(t&i));)o.push(e),e=n.nextNode()}return o},this.normalizeTextNodes=function(e){e&&e.nextSibling&&(e=o(e,e.nextSibling)),e&&e.previousSibling&&o(e.previousSibling,e)},this.rangeContainsNode=function(e,t){var n,i=t.ownerDocument.createRange(),o=t.ownerDocument.createRange();return i.setStart(e.startContainer,e.startOffset),i.setEnd(e.endContainer,e.endOffset),o.selectNodeContents(t),n=r(i,o),i.detach(),o.detach(),n},this.mergeIntoParent=s,this.removeUnwantedNodes=function e(t,n){var r,i=t.parentNode,o=t.firstChild,a=n(t);if(a===NodeFilter.FILTER_SKIP)return i;for(;o;)r=o.nextSibling,e(o,n),o=r;i&&a===NodeFilter.FILTER_REJECT&&s(t);return i},this.removeAllChildNodes=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},this.getElementsByTagNameNS=function(e,t,n){var r=[];for(e=e.getElementsByTagNameNS(t,n),r.length=n=e.length,t=0;t<n;t+=1)r[t]=e.item(t);return r},this.getElementsByTagName=function(e,t){var n,r,i,o=[];for(n=e.getElementsByTagName(t),o.length=i=n.length,r=0;r<i;r+=1)o[r]=n.item(r);return o},this.containsNode=function(e,t){return e===t||e.contains(t)},this.comparePoints=function(e,t,r,i){if(e===r)return i-t;var o=e.compareDocumentPosition(r);return 2===o?o=-1:4===o?o=1:10===o?(t=n(e,r),o=t<i?1:-1):(i=n(r,e),o=i<t?-1:1),o},this.adaptRangeDifferenceToZoomLevel=l,this.translateRect=function(e,t,n){return{top:l(e.top-t.top,n),left:l(e.left-t.left,n),bottom:l(e.bottom-t.top,n),right:l(e.right-t.left,n),width:l(e.width,n),height:l(e.height,n)}},this.getBoundingClientRect=function(t){var n,r=t.ownerDocument,i=e(),o=r.body;return!1!==i.unscaledRangeClientRects&&!i.rangeBCRIgnoresElementBCR||t.nodeType!==Node.ELEMENT_NODE?(c?n=c:c=n=r.createRange(),(i=n).selectNode(t),i.getBoundingClientRect()):(t=t.getBoundingClientRect(),i.elementBCRIgnoresBodyScroll?{left:t.left+o.scrollLeft,right:t.right+o.scrollLeft,top:t.top+o.scrollTop,bottom:t.bottom+o.scrollTop,width:t.width,height:t.height}:t)},this.mapKeyValObjOntoNode=function(e,t,n){Object.keys(t).forEach(function(r){var i=r.split(":"),o=i[1],i=n(i[0]),s=t[r];i?((o=e.getElementsByTagNameNS(i,o)[0])||(o=e.ownerDocument.createElementNS(i,r),e.appendChild(o)),o.textContent=s):runtime.log("Key ignored: "+r)})},this.removeKeyElementsFromNode=function(e,t,n){t.forEach(function(t){var r=t.split(":"),i=r[1];(r=n(r[0]))?(i=e.getElementsByTagNameNS(r,i)[0])?i.parentNode.removeChild(i):runtime.log("Element for "+t+" not found."):runtime.log("Property Name ignored: "+t)})},this.getKeyValRepresentationOfNode=function(e,t){for(var n,r={},i=e.firstElementChild;i;)(n=t(i.namespaceURI))&&(r[n+":"+i.localName]=i.textContent),i=i.nextElementSibling;return r},this.mapObjOntoNode=function e(t,n,r){Object.keys(n).forEach(function(i){var o=i.split(":"),s=o[1],a=r(o[0]),o=n[i],l=typeof o;"object"===l?Object.keys(o).length&&(i=a?t.getElementsByTagNameNS(a,s)[0]||t.ownerDocument.createElementNS(a,i):t.getElementsByTagName(s)[0]||t.ownerDocument.createElement(i),t.appendChild(i),e(i,o,r)):a&&(runtime.assert("number"===l||"string"===l,"attempting to map unsupported type '"+l+"' (key: "+i+")"),t.setAttributeNS(a,i,String(o)))})},this.cloneEvent=function(e){var t=Object.create(null);return Object.keys(e.constructor.prototype).forEach(function(n){t[n]=e[n]}),t.prototype=e.constructor.prototype,t},this.getDirectChild=t,function(e){var t,n;null!==(n=runtime.getWindow())&&(t=n.navigator.appVersion.toLowerCase(),n=-1===t.indexOf("chrome")&&(-1!==t.indexOf("applewebkit")||-1!==t.indexOf("safari")),t=-1!==t.indexOf("msie")||-1!==t.indexOf("trident"),n||t)&&(e.containsNode=a)}(this)},core.DomUtils=new core.DomUtilsImpl}(),core.Cursor=function(e,t){function n(e){e.parentNode&&(l.push(e.previousSibling),l.push(e.nextSibling),e.parentNode.removeChild(e))}function r(e,t,n){if(t.nodeType===Node.TEXT_NODE){runtime.assert(Boolean(t),"putCursorIntoTextNode: invalid container");var r=t.parentNode;runtime.assert(Boolean(r),"putCursorIntoTextNode: container without parent"),runtime.assert(0<=n&&n<=t.length,"putCursorIntoTextNode: offset is out of bounds"),0===n?r.insertBefore(e,t):(n!==t.length&&t.splitText(n),r.insertBefore(e,t.nextSibling))}else t.nodeType===Node.ELEMENT_NODE&&t.insertBefore(e,t.childNodes.item(n));l.push(e.previousSibling),l.push(e.nextSibling)}var i,o,s=e.createElementNS("urn:webodf:names:cursor","cursor"),a=e.createElementNS("urn:webodf:names:cursor","anchor"),l=[],c=e.createRange(),u=core.DomUtils;this.getNode=function(){return s},this.getAnchorNode=function(){return a.parentNode?a:s},this.getSelectedRange=function(){return o?(c.setStartBefore(s),c.collapse(!0)):(c.setStartAfter(i?a:s),c.setEndBefore(i?s:a)),c},this.setSelectedRange=function(e,t){c&&c!==e&&c.detach(),c=e,i=!1!==t,(o=e.collapsed)?(n(a),n(s),r(s,e.startContainer,e.startOffset)):(n(a),n(s),r(i?s:a,e.endContainer,e.endOffset),r(i?a:s,e.startContainer,e.startOffset)),l.forEach(u.normalizeTextNodes),l.length=0},this.hasForwardSelection=function(){return i},this.remove=function(){n(s),l.forEach(u.normalizeTextNodes),l.length=0},s.setAttributeNS("urn:webodf:names:cursor","memberId",t),a.setAttributeNS("urn:webodf:names:cursor","memberId",t)},core.Destroyable=function(){},core.Destroyable.prototype.destroy=function(e){},core.EventSource=function(){},core.EventSource.prototype.subscribe=function(e,t){},core.EventSource.prototype.unsubscribe=function(e,t){},core.EventNotifier=function(e){function t(e){runtime.assert(!n.hasOwnProperty(e),'Duplicated event ids: "'+e+'" registered more than once.'),n[e]=[]}var n={};this.emit=function(e,t){var r,i;for(runtime.assert(n.hasOwnProperty(e),'unknown event fired "'+e+'"'),i=n[e],r=0;r<i.length;r+=1)i[r](t)},this.subscribe=function(e,t){runtime.assert(n.hasOwnProperty(e),'tried to subscribe to unknown event "'+e+'"'),n[e].push(t)},this.unsubscribe=function(e,t){var r;runtime.assert(n.hasOwnProperty(e),'tried to unsubscribe from unknown event "'+e+'"'),r=n[e].indexOf(t),runtime.assert(-1!==r,'tried to unsubscribe unknown callback from event "'+e+'"'),-1!==r&&n[e].splice(r,1)},this.register=t,e&&e.forEach(t)},core.ScheduledTask=function(e,t,n){function r(){s&&(n(o),s=!1)}function i(){r(),e.apply(void 0,a),a=null}var o,s=!1,a=[],l=!1;this.trigger=function(){runtime.assert(!1===l,"Can't trigger destroyed ScheduledTask instance"),a=Array.prototype.slice.call(arguments),s||(s=!0,o=t(i))},this.triggerImmediate=function(){runtime.assert(!1===l,"Can't trigger destroyed ScheduledTask instance"),a=Array.prototype.slice.call(arguments),i()},this.processRequests=function(){s&&i()},this.cancel=r,this.restart=function(){runtime.assert(!1===l,"Can't trigger destroyed ScheduledTask instance"),r(),s=!0,o=t(i)},this.destroy=function(e){r(),l=!0,e()}},function(){var e;core.Task={},core.Task.SUPPRESS_MANUAL_PROCESSING=!1,core.Task.processTasks=function(){core.Task.SUPPRESS_MANUAL_PROCESSING||e.performRedraw()},core.Task.createRedrawTask=function(t){return new core.ScheduledTask(t,e.requestRedrawTask,e.cancelRedrawTask)},core.Task.createTimeoutTask=function(e,t){return new core.ScheduledTask(e,function(e){return runtime.setTimeout(e,t)},runtime.clearTimeout)},e=new function(){var e={};this.requestRedrawTask=function(t){var n=runtime.requestAnimationFrame(function(){t(),delete e[n]});return e[n]=t,n},this.performRedraw=function(){Object.keys(e).forEach(function(t){e[t](),runtime.cancelAnimationFrame(parseInt(t,10))}),e={}},this.cancelRedrawTask=function(t){runtime.cancelAnimationFrame(t),delete e[t]}}}(),core.EventSubscriptions=function(){function e(e,t,r){e.subscribe(t,r),n.push({eventSource:e,eventid:t,callback:r})}function t(){var e=[];n.forEach(function(e){e.eventSource.unsubscribe(e.eventid,e.callback)}),n.length=0,Object.keys(i).forEach(function(t){i[t].forEach(function(t){e.push(t.task.destroy)}),delete i[t]}),core.Async.destroyAll(e,function(){}),r=new core.EventNotifier}var n=[],r=new core.EventNotifier,i={},o=0;this.addSubscription=e,this.addFrameSubscription=function(t,n,s){var a,l,c,u;for(i.hasOwnProperty(n)||(i[n]=[]),c=i[n],u=0;u<c.length;u+=1)if(c[u].eventSource===t){a=c[u];break}a||(l="s"+o,o+=1,r.register(l),a={frameEventId:l,eventSource:t,task:core.Task.createRedrawTask(function(){r.emit(l,void 0)})},c.push(a),e(t,n,a.task.trigger)),r.subscribe(a.frameEventId,s)},this.unsubscribeAll=t,this.destroy=function(e){t(),e()}},core.LazyProperty=function(e){var t,n=!1;this.value=function(){return n||(t=e(),n=!0),t},this.reset=function(){n=!1}},core.LoopWatchDog=function(e,t){var n=Date.now(),r=0;this.check=function(){if(e&&Date.now()-n>e)throw runtime.log("alert","watchdog timeout"),"timeout!";if(0<t&&(r+=1)>t)throw runtime.log("alert","watchdog loop overflow"),"loop overflow"}},core.NodeFilterChain=function(e){var t=NodeFilter.FILTER_REJECT,n=NodeFilter.FILTER_ACCEPT;this.acceptNode=function(r){var i;for(i=0;i<e.length;i+=1)if(e[i].acceptNode(r)===t)return t;return n}},core.PositionIterator=function(e,t,n,r){function i(){var e=a.currentNode,t=e.nodeType;l=t===d?e.length-1:t===h?1:0}function o(){if(null===a.previousSibling()){if(!a.parentNode()||a.currentNode===e)return a.firstChild(),!1;l=0}else i();return!0}function s(){var t,n=a.currentNode;if(t=c(n),n!==e)for(n=n.parentNode;n&&n!==e;)c(n)===f&&(a.currentNode=n,t=f),n=n.parentNode;return t===f?(l=a.currentNode.nodeType===d?n.length:1,n=u.nextPosition()):n=t===p||u.nextPosition(),n&&runtime.assert(c(a.currentNode)===p,"moveToAcceptedNode did not result in walker being on an accepted node"),n}var a,l,c,u=this,d=Node.TEXT_NODE,h=Node.ELEMENT_NODE,p=NodeFilter.FILTER_ACCEPT,f=NodeFilter.FILTER_REJECT;this.nextPosition=function(){var t=a.currentNode,n=t.nodeType;if(t===e)return!1;if(0===l&&n===h)null===a.firstChild()&&(l=1);else if(n===d&&l+1<t.length)l+=1;else if(null!==a.nextSibling())l=0;else{if(!a.parentNode())return!1;l=1}return!0},this.previousPosition=function(){var t=!0,n=a.currentNode;return 0===l?t=o():n.nodeType===d?--l:null!==a.lastChild()?i():n===e?t=!1:l=0,t},this.previousNode=o,this.container=function(){var e=a.currentNode,t=e.nodeType;return 0===l&&t!==d&&(e=e.parentNode),e},this.rightNode=function(){var e=a.currentNode,t=e.nodeType;if(t===d&&l===e.length)for(e=e.nextSibling;e&&c(e)!==p;)e=e.nextSibling;else t===h&&1===l&&(e=null);return e},this.leftNode=function(){var e=a.currentNode;if(0===l)for(e=e.previousSibling;e&&c(e)!==p;)e=e.previousSibling;else if(e.nodeType===h)for(e=e.lastChild;e&&c(e)!==p;)e=e.previousSibling;return e},this.getCurrentNode=function(){return a.currentNode},this.unfilteredDomOffset=function(){if(a.currentNode.nodeType===d)return l;for(var e=0,t=a.currentNode,t=1===l?t.lastChild:t.previousSibling;t;)e+=1,t=t.previousSibling;return e},this.getPreviousSibling=function(){var e=a.currentNode,t=a.previousSibling();return a.currentNode=e,t},this.getNextSibling=function(){var e=a.currentNode,t=a.nextSibling();return a.currentNode=e,t},this.setPositionBeforeElement=function(e){return runtime.assert(Boolean(e),"setPositionBeforeElement called without element"),a.currentNode=e,l=0,s()},this.setUnfilteredPosition=function(e,t){return runtime.assert(Boolean(e),"PositionIterator.setUnfilteredPosition called without container"),a.currentNode=e,e.nodeType===d?(l=t,runtime.assert(t<=e.length,"Error in setPosition: "+t+" > "+e.length),runtime.assert(0<=t,"Error in setPosition: "+t+" < 0"),t===e.length&&(a.nextSibling()?l=0:a.parentNode()?l=1:runtime.assert(!1,"Error in setUnfilteredPosition: position not valid."))):t<e.childNodes.length?(a.currentNode=e.childNodes.item(t),l=0):l=1,s()},this.moveToEnd=function(){a.currentNode=e,l=1},this.moveToEndOfNode=function(e){e.nodeType===d?u.setUnfilteredPosition(e,e.length):(a.currentNode=e,l=1)},this.isBeforeNode=function(){return 0===l},this.getNodeFilter=function(){return c},(c=(n?new function(e){this.acceptNode=function(t){return!t||t.nodeType===d&&0===t.length?f:e.acceptNode(t)}}(n):new function(){this.acceptNode=function(e){return!e||e.nodeType===d&&0===e.length?f:p}}).acceptNode).acceptNode=c,t=t||NodeFilter.SHOW_ALL,runtime.assert(e.nodeType!==Node.TEXT_NODE,"Internet Explorer doesn't allow tree walker roots to be text nodes"),a=e.ownerDocument.createTreeWalker(e,t,c,r),l=0,null===a.firstChild()&&(l=1)},core.PositionFilter=function(){},core.PositionFilter.FilterResult={FILTER_ACCEPT:1,FILTER_REJECT:2,FILTER_SKIP:3},core.PositionFilter.prototype.acceptPosition=function(e){},core.PositionFilterChain=function(){var e=[],t=core.PositionFilter.FilterResult.FILTER_ACCEPT,n=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(r){var i;for(i=0;i<e.length;i+=1)if(e[i].acceptPosition(r)===n)return n;return t},this.addFilter=function(t){e.push(t)}},core.StepDirection={PREVIOUS:1,NEXT:2},core.StepIterator=function(e,t){function n(){c=null,d=u=void 0}function r(){return void 0===d&&(d=e.acceptPosition(t)===h),d}function i(e,r){return n(),t.setUnfilteredPosition(e,r)}function o(){return c||(c=t.container()),c}function s(){return void 0===u&&(u=t.unfilteredDomOffset()),u}function a(){for(n();t.nextPosition();)if(n(),r())return!0;return!1}function l(){for(n();t.previousPosition();)if(n(),r())return!0;return!1}var c,u,d,h=core.PositionFilter.FilterResult.FILTER_ACCEPT,p=core.StepDirection.NEXT;this.isStep=r,this.setPosition=i,this.container=o,this.offset=s,this.nextStep=a,this.previousStep=l,this.advanceStep=function(e){return e===p?a():l()},this.roundToClosestStep=function(){var e,t,n=r();return n||(e=o(),t=s(),(n=l())||(i(e,t),n=a())),n},this.roundToPreviousStep=function(){var e=r();return e||(e=l()),e},this.roundToNextStep=function(){var e=r();return e||(e=a()),e},this.leftNode=function(){return t.leftNode()},this.snapshot=function(){return new core.StepIterator.StepSnapshot(o(),s())},this.restore=function(e){i(e.container,e.offset)}},core.StepIterator.StepSnapshot=function(e,t){this.container=e,this.offset=t},core.Utils=function(){this.hashString=function(e){var t,n,r=0;for(t=0,n=e.length;t<n;t+=1)r=(r<<5)-r+e.charCodeAt(t),r|=0;return r},this.mergeObjects=function(e,t){return Object.keys(t).forEach(function(n){e[n]=function e(t,n){if(n&&Array.isArray(n)){if(t=t||[],!Array.isArray(t))throw"Destination is not an array.";t=t.concat(n.map(function(t){return e(null,t)}))}else if(n&&"object"==typeof n){if("object"!=typeof(t=t||{}))throw"Destination is not an object.";Object.keys(n).forEach(function(r){t[r]=e(t[r],n[r])})}else t=n;return t}(e[n],t[n])}),e}},core.Zip=function(e,t){function n(e,t){var n=s.file(e);n?t(null,n.asUint8Array()):t(e+" not found.",null)}function r(e,t){n(e,function(e,n){if(e||null===n)return t(e,null);var r=runtime.byteArrayToString(n,"utf8");t(null,r)})}function i(e,t){try{e(s.generate({type:"uint8array",compression:"STORE"}))}catch(e){t(e.message)}}function o(e,t){i(function(n){runtime.writeFile(e,n,t)},t)}var s,a=this,l=new core.Base64;this.load=n,this.save=function(e,t,n,r){s.file(e,t,{date:r,compression:n?"DEFLATE":"STORE"})},this.remove=function(e){var t=null!==s.file(e);return s.remove(e),t},this.write=function(t){o(e,t)},this.writeAs=o,this.createByteArray=i,this.loadContentXmlAsFragments=function(e,t){r(e,function(e,n){if(e)return t.rootElementReady(e);t.rootElementReady(null,n,!0)})},this.loadAsString=r,this.loadAsDOM=function(e,t){r(e,function(e,n){if(e||null===n)t(e,null);else{var r=(new DOMParser).parseFromString(n,"text/xml");t(null,r)}})},this.loadAsDataURL=function(e,t,r){n(e,function(e,n){if(e||!n)return r(e,null);var i,o=0;for(t||(t=80===n[1]&&78===n[2]&&71===n[3]?"image/png":255===n[0]&&216===n[1]&&255===n[2]?"image/jpeg":71===n[0]&&73===n[1]&&70===n[2]?"image/gif":""),i="data:"+t+";base64,";o<n.length;)i+=l.convertUTF8ArrayToBase64(n.subarray(o,Math.min(o+45e3,n.length))),o+=45e3;r(null,i)})},this.getEntries=function(){return Object.keys(s.files).map(function(e){return{filename:e,date:s.files[e].date}})},s=new externs.JSZip,null!==t&&runtime.readFile(e,"binary",function(n,r){if("string"==typeof r&&(n="file was read as a string. Should be Uint8Array."),n||!r||0===r.length)t("File '"+e+"' cannot be read. Err: "+(n||"[none]"),a);else try{s.load(r,{checkCRC32:!1}),t(null,a)}catch(e){t(e.message,a)}})},core.SimpleClientRect=null,gui.CommonConstraints={EDIT:{ANNOTATIONS:{ONLY_DELETE_OWN:"onlyDeleteOwn"},REVIEW_MODE:"reviewMode"}},gui.SessionConstraints=function(){function e(e){t.hasOwnProperty(e)||(t[e]=!1,n.register(e))}var t={},n=new core.EventNotifier;this.registerConstraint=e,this.subscribe=function(t,r){e(t),n.subscribe(t,r)},this.unsubscribe=function(e,t){n.unsubscribe(e,t)},this.setState=function(e,r){runtime.assert(!0===t.hasOwnProperty(e),"No such constraint"),t[e]!==r&&(t[e]=r,n.emit(e,r))},this.getState=function(e){return runtime.assert(!0===t.hasOwnProperty(e),"No such constraint"),t[e]}},gui.BlacklistNamespaceNodeFilter=function(e){var t={},n=NodeFilter.FILTER_REJECT,r=NodeFilter.FILTER_ACCEPT;this.acceptNode=function(e){return!e||t.hasOwnProperty(e.namespaceURI)?n:r},e.forEach(function(e){t[e]=!0})},odf.Namespaces={namespaceMap:{config:"urn:oasis:names:tc:opendocument:xmlns:config:1.0",db:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dc:"http://purl.org/dc/elements/1.1/",dr3d:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",draw:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chart:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fo:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",form:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",math:"http://www.w3.org/1998/Math/MathML",meta:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",number:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",office:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentation:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",style:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svg:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",table:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",text:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xforms:"http://www.w3.org/2002/xforms",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},prefixMap:{},configns:"urn:oasis:names:tc:opendocument:xmlns:config:1.0",dbns:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dcns:"http://purl.org/dc/elements/1.1/",dr3dns:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",drawns:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chartns:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fons:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",formns:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",mathns:"http://www.w3.org/1998/Math/MathML",metans:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",numberns:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",officens:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentationns:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",stylens:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svgns:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",tablens:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",textns:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xformsns:"http://www.w3.org/2002/xforms",xlinkns:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/XML/1998/namespace"},function(){var e,t=odf.Namespaces.namespaceMap,n=odf.Namespaces.prefixMap;for(e in t)t.hasOwnProperty(e)&&(n[t[e]]=e)}(),odf.Namespaces.forEachPrefix=function(e){var t,n=odf.Namespaces.namespaceMap;for(t in n)n.hasOwnProperty(t)&&e(t,n[t])},odf.Namespaces.lookupNamespaceURI=function(e){var t=null;return odf.Namespaces.namespaceMap.hasOwnProperty(e)&&(t=odf.Namespaces.namespaceMap[e]),t},odf.Namespaces.lookupPrefix=function(e){var t=odf.Namespaces.prefixMap;return t.hasOwnProperty(e)?t[e]:null},odf.Namespaces.lookupNamespaceURI.lookupNamespaceURI=odf.Namespaces.lookupNamespaceURI,odf.OdfSchemaImpl=function(){var e=[["config:config-item","uncategorized"],["form:item","object"],["form:option","uncategorized"],["math:math","field"],["meta:user-defined","uncategorized"],["number:currency-symbol","uncategorized"],["number:embedded-text","uncategorized"],["number:text","uncategorized"],["presentation:date-time-decl","uncategorized"],["presentation:footer-decl","uncategorized"],["presentation:header-decl","uncategorized"],["svg:desc","text"],["svg:title","text"],["table:desc","uncategorized"],["table:title","uncategorized"],["text:a","text"],["text:author-initials","field"],["text:author-name","field"],["text:bibliography-mark","field"],["text:bookmark-ref","field"],["text:chapter","field"],["text:character-count","field"],["text:conditional-text","field"],["text:creation-date","field"],["text:creation-time","field"],["text:creator","field"],["text:database-display","field"],["text:database-name","field"],["text:database-row-number","field"],["text:date","field"],["text:dde-connection","field"],["text:description","field"],["text:editing-cycles","field"],["text:editing-duration","field"],["text:execute-macro","uncategorized"],["text:expression","uncategorized"],["text:file-name","field"],["text:h","text"],["text:hidden-paragraph","text"],["text:hidden-text","text"],["text:image-count","field"],["text:index-entry-span","uncategorized"],["text:index-title-template","uncategorized"],["text:initial-creator","field"],["text:keywords","field"],["text:linenumbering-separator","style"],["text:measure","uncategorized"],["text:meta","uncategorized"],["text:meta-field","uncategorized"],["text:modification-date","field"],["text:modification-time","field"],["text:note-citation","field"],["text:note-continuation-notice-backward","style"],["text:note-continuation-notice-forward","style"],["text:note-ref","field"],["text:object-count","field"],["text:p","text"],["text:page-continuation","uncategorized"],["text:page-count","field"],["text:page-number","field"],["text:page-variable-get","field"],["text:page-variable-set","field"],["text:paragraph-count","field"],["text:placeholder","field"],["text:print-date","field"],["text:print-time","field"],["text:printed-by","field"],["text:reference-ref","field"],["text:ruby-base","text"],["text:ruby-text","text"],["text:script","text"],["text:sender-city","field"],["text:sender-company","field"],["text:sender-country","field"],["text:sender-email","field"],["text:sender-fax","field"],["text:sender-firstname","field"],["text:sender-initials","field"],["text:sender-lastname","field"],["text:sender-phone-private","field"],["text:sender-phone-work","field"],["text:sender-position","field"],["text:sender-postal-code","field"],["text:sender-state-or-province","field"],["text:sender-street","field"],["text:sender-title","field"],["text:sequence","uncategorized"],["text:sequence-ref","uncategorized"],["text:sheet-name","uncategorized"],["text:span","text"],["text:subject","field"],["text:table-count","field"],["text:table-formula","deprecated"],["text:template-name","uncategorized"],["text:text-input","field"],["text:time","field"],["text:title","field"],["text:user-defined","field"],["text:user-field-get","field"],["text:user-field-input","field"],["text:variable-get","field"],["text:variable-input","field"],["text:variable-set","field"],["text:word-count","field"],["xforms:model","uncategorized"]],t={};this.isTextContainer=function(e,n){return"text"===t[e+":"+n]},this.isField=function(e,n){return"field"===t[e+":"+n]},this.getFields=function(){return e.filter(function(e){return"field"===e[1]}).map(function(e){return e[0]})},e.forEach(function(e){var n=e[1],r=e[0].split(":");e=r[0];var r=r[1],i=odf.Namespaces.lookupNamespaceURI(e);i?t[i+":"+r]=n:runtime.log("DEBUG: OdfSchema - unknown prefix '"+e+"'")})},odf.OdfSchema=new odf.OdfSchemaImpl,odf.OdfUtilsImpl=function(){function e(e){return"image"===(e&&e.localName)&&e.namespaceURI===R}function t(e){return null!==e&&e.nodeType===Node.ELEMENT_NODE&&"frame"===e.localName&&e.namespaceURI===R&&"as-char"===e.getAttributeNS(P,"anchor-type")}function n(e){var t;return(t="annotation"===(e&&e.localName)&&e.namespaceURI===odf.Namespaces.officens)||(t="div"===(e&&e.localName)&&"annotationWrapper"===e.className),t}function r(e){return"a"===(e&&e.localName)&&e.namespaceURI===P}function i(e){var t=e&&e.localName;return("p"===t||"h"===t)&&e.namespaceURI===P}function o(e,t){for(e&&void 0!==t&&!i(e)&&e.childNodes.item(t)&&(e=e.childNodes.item(t));e&&!i(e);)e=e.parentNode;return e}function s(e,t){for(;e&&e!==t;){if(e.namespaceURI===odf.Namespaces.officens&&"annotation"===e.localName)return e;e=e.parentNode}return null}function a(e){return/^[ \t\r\n]+$/.test(e)}function l(e){if(null===e||e.nodeType!==Node.ELEMENT_NODE)return!1;var t=e.localName;return F.isTextContainer(e.namespaceURI,t)||"span"===t&&"webodf-annotationHighlight"===e.className}function c(e){return null!==e&&e.nodeType===Node.ELEMENT_NODE&&F.isField(e.namespaceURI,e.localName)}function u(e){var t=e&&e.localName,n=!1;return t&&((e=e.namespaceURI)===P&&(n="s"===t||"tab"===t||"line-break"===t)),n}function d(e){return u(e)||c(e)||t(e)||n(e)}function h(e){var t=e&&e.localName,n=!1;return t&&((e=e.namespaceURI)===P&&(n="s"===t)),n}function p(e){return-1!==I.indexOf(e.namespaceURI)}function f(e){for(;null!==e.firstChild&&l(e);)e=e.firstChild;return e}function m(e){for(;null!==e.lastChild&&l(e);)e=e.lastChild;return e}function g(e){for(;!i(e)&&null===e.previousSibling;)e=e.parentNode;return i(e)?null:m(e.previousSibling)}function b(e){for(;!i(e)&&null===e.nextSibling;)e=e.parentNode;return i(e)?null:f(e.nextSibling)}function y(e){for(var t=!1;e;)if(e.nodeType===Node.TEXT_NODE){if(0!==e.length)return!a(e.data.substr(e.length-1,1));e=g(e)}else d(e)?(t=!1===h(e),e=null):e=g(e);return t}function v(e){var t=!1;for(e=e&&f(e);e;){if(0<(e.nodeType===Node.TEXT_NODE?e.length:0)&&!a(e.data)){t=!0;break}if(d(e)){t=!0;break}e=b(e)}return t}function S(e,t){return!!a(e.data.substr(t))&&!v(b(e))}function C(e,t){var n,r=e.data;return!(!a(r[t])||d(e.parentNode))&&(0<t?a(r[t-1])||(n=!0):y(g(e))&&(n=!0),!0===n&&!S(e,t))}function x(e){return(e=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px)|(%))/.exec(e))?{value:parseFloat(e[1]),unit:e[3]}:null}function A(e){return(e=x(e))&&(0>e.value||"%"===e.unit)?null:e}function w(e){return(e=x(e))&&"%"!==e.unit?null:e}function _(e){switch(e.namespaceURI){case odf.Namespaces.drawns:case odf.Namespaces.svgns:case odf.Namespaces.dr3dns:return!1;case odf.Namespaces.textns:switch(e.localName){case"note-body":case"ruby-text":return!1}break;case odf.Namespaces.officens:switch(e.localName){case"annotation":case"binary-data":case"event-listeners":return!1}break;default:switch(e.localName){case"cursor":case"editinfo":return!1}}return!0}function N(e){return Boolean(o(e)&&(!a(e.textContent)||C(e,0)))}function E(e,t){for(;0<t.length&&!D.rangeContainsNode(e,t[0]);)t.shift();for(;0<t.length&&!D.rangeContainsNode(e,t[t.length-1]);)t.pop()}function T(e,t,r){var i;return i=D.getNodesInRange(e,function(e){var t=NodeFilter.FILTER_REJECT;return u(e.parentNode)||c(e.parentNode)||n(e)?t=NodeFilter.FILTER_REJECT:e.nodeType===Node.TEXT_NODE?(r||N(e))&&(t=NodeFilter.FILTER_ACCEPT):d(e)?t=NodeFilter.FILTER_ACCEPT:(_(e)||l(e))&&(t=NodeFilter.FILTER_SKIP),t},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT),t||E(e,i),i}function k(e,t,r){for(;e;){if(r(e)){t[0]!==e&&t.unshift(e);break}if(n(e))break;e=e.parentNode}}var P=odf.Namespaces.textns,R=odf.Namespaces.drawns,O=odf.Namespaces.xlinkns,D=core.DomUtils,I=[odf.Namespaces.dbns,odf.Namespaces.dcns,odf.Namespaces.dr3dns,odf.Namespaces.drawns,odf.Namespaces.chartns,odf.Namespaces.formns,odf.Namespaces.numberns,odf.Namespaces.officens,odf.Namespaces.presentationns,odf.Namespaces.stylens,odf.Namespaces.svgns,odf.Namespaces.tablens,odf.Namespaces.textns],F=odf.OdfSchema;this.isImage=e,this.isCharacterFrame=t,this.isInlineRoot=n,this.isTextSpan=function(e){return"span"===(e&&e.localName)&&e.namespaceURI===P},this.isHyperlink=r,this.getHyperlinkTarget=function(e){return e.getAttributeNS(O,"href")||""},this.isParagraph=i,this.getParagraphElement=o,this.getParentAnnotation=s,this.isWithinAnnotation=function(e,t){return Boolean(s(e,t))},this.getAnnotationCreator=function(e){return e.getElementsByTagNameNS(odf.Namespaces.dcns,"creator")[0].textContent},this.isListItem=function(e){return"list-item"===(e&&e.localName)&&e.namespaceURI===P},this.isLineBreak=function(e){return"line-break"===(e&&e.localName)&&e.namespaceURI===P},this.isODFWhitespace=a,this.isGroupingElement=l,this.isFieldElement=c,this.isCharacterElement=u,this.isAnchoredAsCharacterElement=d,this.isSpaceElement=h,this.isODFNode=p,this.hasNoODFContent=function e(t){if(u(t)||c(t))return!1;if(l(t.parentNode)&&t.nodeType===Node.TEXT_NODE)return 0===t.textContent.length;for(t=t.firstChild;t;){if(p(t)||!e(t))return!1;t=t.nextSibling}return!0},this.firstChild=f,this.lastChild=m,this.previousNode=g,this.nextNode=b,this.scanLeftForNonSpace=y,this.lookLeftForCharacter=function(e){var t,n=t=0;return e.nodeType===Node.TEXT_NODE&&(n=e.length),0<n?t=a((t=e.data).substr(n-1,1))?1===n?y(g(e))?2:0:a(t.substr(n-2,1))?0:2:1:d(e)&&(t=1),t},this.lookRightForCharacter=function(e){var t=!1,n=0;return e&&e.nodeType===Node.TEXT_NODE&&(n=e.length),0<n?t=!a(e.data.substr(0,1)):d(e)&&(t=!0),t},this.scanLeftForAnyCharacter=function(e){var t=!1;for(e=e&&m(e);e;){if(0<(e.nodeType===Node.TEXT_NODE?e.length:0)&&!a(e.data)){t=!0;break}if(d(e)){t=!0;break}e=g(e)}return t},this.scanRightForAnyCharacter=v,this.isTrailingWhitespace=S,this.isSignificantWhitespace=C,this.isDowngradableSpaceElement=function(e){return!!h(e)&&(y(g(e))&&v(b(e)))},this.parseLength=x,this.parseNonNegativeLength=A,this.parseFoFontSize=function(e){var t;return(t=(t=x(e))&&(0>=t.value||"%"===t.unit)?null:t)||w(e)},this.parseFoLineHeight=function(e){return A(e)||w(e)},this.isTextContentContainingNode=_,this.getTextNodes=function(e,t){var n;return n=D.getNodesInRange(e,function(e){var t=NodeFilter.FILTER_REJECT;return e.nodeType===Node.TEXT_NODE?N(e)&&(t=NodeFilter.FILTER_ACCEPT):_(e)&&(t=NodeFilter.FILTER_SKIP),t},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT),t||E(e,n),n},this.getTextElements=T,this.getParagraphElements=function(e){var t;return t=D.getNodesInRange(e,function(e){var t=NodeFilter.FILTER_REJECT;return i(e)?t=NodeFilter.FILTER_ACCEPT:(_(e)||l(e))&&(t=NodeFilter.FILTER_SKIP),t},NodeFilter.SHOW_ELEMENT),k(e.startContainer,t,i),t},this.getImageElements=function(t){var n;return n=D.getNodesInRange(t,function(t){var n=NodeFilter.FILTER_SKIP;return e(t)&&(n=NodeFilter.FILTER_ACCEPT),n},NodeFilter.SHOW_ELEMENT),k(t.startContainer,n,e),n},this.getHyperlinkElements=function(e){var t=[],n=e.cloneRange();return e.collapsed&&e.endContainer.nodeType===Node.ELEMENT_NODE&&((e=function(e,t){var n=e;if(t<n.childNodes.length-1)n=n.childNodes[t+1];else{for(;!n.nextSibling;)n=n.parentNode;n=n.nextSibling}for(;n.firstChild;)n=n.firstChild;return n}(e.endContainer,e.endOffset)).nodeType===Node.TEXT_NODE&&n.setEnd(e,1)),T(n,!0,!1).forEach(function(e){for(e=e.parentNode;!i(e);){if(r(e)&&-1===t.indexOf(e)){t.push(e);break}e=e.parentNode}}),n.detach(),t},this.getNormalizedFontFamilyName=function(e){return/^(["'])(?:.|[\n\r])*?\1$/.test(e)||(e=e.replace(/^[ \t\r\n\f]*((?:.|[\n\r])*?)[ \t\r\n\f]*$/,"$1"),/[ \t\r\n\f]/.test(e)&&(e="'"+e.replace(/[ \t\r\n\f]+/g," ")+"'")),e}},odf.OdfUtils=new odf.OdfUtilsImpl,gui.OdfTextBodyNodeFilter=function(){var e=odf.OdfUtils,t=Node.TEXT_NODE,n=NodeFilter.FILTER_REJECT,r=NodeFilter.FILTER_ACCEPT,i=odf.Namespaces.textns;this.acceptNode=function(o){if(o.nodeType===t){if(!e.isGroupingElement(o.parentNode))return n}else if(o.namespaceURI===i&&"tracked-changes"===o.localName)return n;return r}},xmldom.LSSerializerFilter=function(){},xmldom.LSSerializerFilter.prototype.acceptNode=function(e){},odf.OdfNodeFilter=function(){this.acceptNode=function(e){return"http://www.w3.org/1999/xhtml"===e.namespaceURI?NodeFilter.FILTER_SKIP:e.namespaceURI&&e.namespaceURI.match(/^urn:webodf:/)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}},xmldom.XPathIterator=function(){},xmldom.XPathIterator.prototype.next=function(){},xmldom.XPathIterator.prototype.reset=function(){},xmldom.XPath=createXPathSingleton(),odf.StyleInfo=function(){function e(t,n){var r,i,o,a,l,c=0;for((r=s[t.localName])&&(o=r[t.namespaceURI])&&(c=o.length),r=0;r<c;r+=1)i=o[r],a=i.ns,l=i.localname,(i=t.getAttributeNS(a,l))&&t.setAttributeNS(a,y[a]+l,n+i);for(o=t.firstElementChild;o;)e(o,n),o=o.nextElementSibling}function t(e,n){var r,i,o,a,l,c=0;for((r=s[e.localName])&&(o=r[e.namespaceURI])&&(c=o.length),r=0;r<c;r+=1)i=o[r],a=i.ns,l=i.localname,(i=e.getAttributeNS(a,l))&&(i=i.replace(n,""),e.setAttributeNS(a,y[a]+l,i));for(o=e.firstElementChild;o;)t(o,n),o=o.nextElementSibling}function n(e,t){var n,r,i,o,a,l=0;for((n=s[e.localName])&&(i=n[e.namespaceURI])&&(l=i.length),n=0;n<l;n+=1)o=i[n],r=o.ns,a=o.localname,(r=e.getAttributeNS(r,a))&&(t=t||{},o=o.keyname,t.hasOwnProperty(o)?t[o][r]=1:((a={})[r]=1,t[o]=a));return t}function r(e,t){var i;for(n(e,t),i=e.firstChild;i;)i.nodeType===Node.ELEMENT_NODE&&r(i,t),i=i.nextSibling}function i(e,t,n){var r=e+'"'+t,i=n[r];return i||(i=n[r]=new function(e,t,n){this.key=e,this.name=t,this.family=n,this.requires={}}(r,e,t)),i}function o(e,t){var n=function e(t,n,r){var o,a,l,c,u,d=0;o=t.getAttributeNS(m,"name");c=t.getAttributeNS(m,"family");o&&c&&(n=i(o,c,r));if(n)for((o=s[t.localName])&&(l=o[t.namespaceURI])&&(d=l.length),o=0;o<d;o+=1)c=l[o],a=c.ns,u=c.localname,(a=t.getAttributeNS(a,u))&&(c=c.keyname,c=i(a,c,r),n.requires[c.key]=c);for(t=t.firstElementChild;t;)e(t,n,r),t=t.nextElementSibling;return r}(e,null,{});Object.keys(n).forEach(function(e){e=n[e];var r=t[e.family];r&&r.hasOwnProperty(e.name)&&function e(t,n){var r=n[t.family];r||(r=n[t.family]={});r[t.name]=1;Object.keys(t.requires).forEach(function(r){e(t.requires[r],n)})}(e,t)})}var s,a=odf.Namespaces.chartns,l=odf.Namespaces.dbns,c=odf.Namespaces.dr3dns,u=odf.Namespaces.drawns,d=odf.Namespaces.formns,h=odf.Namespaces.numberns,p=odf.Namespaces.officens,f=odf.Namespaces.presentationns,m=odf.Namespaces.stylens,g=odf.Namespaces.tablens,b=odf.Namespaces.textns,y={"urn:oasis:names:tc:opendocument:xmlns:chart:1.0":"chart:","urn:oasis:names:tc:opendocument:xmlns:database:1.0":"db:","urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0":"dr3d:","urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":"draw:","urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":"fo:","urn:oasis:names:tc:opendocument:xmlns:form:1.0":"form:","urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":"number:","urn:oasis:names:tc:opendocument:xmlns:office:1.0":"office:","urn:oasis:names:tc:opendocument:xmlns:presentation:1.0":"presentation:","urn:oasis:names:tc:opendocument:xmlns:style:1.0":"style:","urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0":"svg:","urn:oasis:names:tc:opendocument:xmlns:table:1.0":"table:","urn:oasis:names:tc:opendocument:xmlns:text:1.0":"chart:","http://www.w3.org/XML/1998/namespace":"xml:"},v={text:[{ens:m,en:"tab-stop",ans:m,a:"leader-text-style"},{ens:m,en:"drop-cap",ans:m,a:"style-name"},{ens:b,en:"notes-configuration",ans:b,a:"citation-body-style-name"},{ens:b,en:"notes-configuration",ans:b,a:"citation-style-name"},{ens:b,en:"a",ans:b,a:"style-name"},{ens:b,en:"alphabetical-index",ans:b,a:"style-name"},{ens:b,en:"linenumbering-configuration",ans:b,a:"style-name"},{ens:b,en:"list-level-style-number",ans:b,a:"style-name"},{ens:b,en:"ruby-text",ans:b,a:"style-name"},{ens:b,en:"span",ans:b,a:"style-name"},{ens:b,en:"a",ans:b,a:"visited-style-name"},{ens:m,en:"text-properties",ans:m,a:"text-line-through-text-style"},{ens:b,en:"alphabetical-index-source",ans:b,a:"main-entry-style-name"},{ens:b,en:"index-entry-bibliography",ans:b,a:"style-name"},{ens:b,en:"index-entry-chapter",ans:b,a:"style-name"},{ens:b,en:"index-entry-link-end",ans:b,a:"style-name"},{ens:b,en:"index-entry-link-start",ans:b,a:"style-name"},{ens:b,en:"index-entry-page-number",ans:b,a:"style-name"},{ens:b,en:"index-entry-span",ans:b,a:"style-name"},{ens:b,en:"index-entry-tab-stop",ans:b,a:"style-name"},{ens:b,en:"index-entry-text",ans:b,a:"style-name"},{ens:b,en:"index-title-template",ans:b,a:"style-name"},{ens:b,en:"list-level-style-bullet",ans:b,a:"style-name"},{ens:b,en:"outline-level-style",ans:b,a:"style-name"}],paragraph:[{ens:u,en:"caption",ans:u,a:"text-style-name"},{ens:u,en:"circle",ans:u,a:"text-style-name"},{ens:u,en:"connector",ans:u,a:"text-style-name"},{ens:u,en:"control",ans:u,a:"text-style-name"},{ens:u,en:"custom-shape",ans:u,a:"text-style-name"},{ens:u,en:"ellipse",ans:u,a:"text-style-name"},{ens:u,en:"frame",ans:u,a:"text-style-name"},{ens:u,en:"line",ans:u,a:"text-style-name"},{ens:u,en:"measure",ans:u,a:"text-style-name"},{ens:u,en:"path",ans:u,a:"text-style-name"},{ens:u,en:"polygon",ans:u,a:"text-style-name"},{ens:u,en:"polyline",ans:u,a:"text-style-name"},{ens:u,en:"rect",ans:u,a:"text-style-name"},{ens:u,en:"regular-polygon",ans:u,a:"text-style-name"},{ens:p,en:"annotation",ans:u,a:"text-style-name"},{ens:d,en:"column",ans:d,a:"text-style-name"},{ens:m,en:"style",ans:m,a:"next-style-name"},{ens:g,en:"body",ans:g,a:"paragraph-style-name"},{ens:g,en:"even-columns",ans:g,a:"paragraph-style-name"},{ens:g,en:"even-rows",ans:g,a:"paragraph-style-name"},{ens:g,en:"first-column",ans:g,a:"paragraph-style-name"},{ens:g,en:"first-row",ans:g,a:"paragraph-style-name"},{ens:g,en:"last-column",ans:g,a:"paragraph-style-name"},{ens:g,en:"last-row",ans:g,a:"paragraph-style-name"},{ens:g,en:"odd-columns",ans:g,a:"paragraph-style-name"},{ens:g,en:"odd-rows",ans:g,a:"paragraph-style-name"},{ens:b,en:"notes-configuration",ans:b,a:"default-style-name"},{ens:b,en:"alphabetical-index-entry-template",ans:b,a:"style-name"},{ens:b,en:"bibliography-entry-template",ans:b,a:"style-name"},{ens:b,en:"h",ans:b,a:"style-name"},{ens:b,en:"illustration-index-entry-template",ans:b,a:"style-name"},{ens:b,en:"index-source-style",ans:b,a:"style-name"},{ens:b,en:"object-index-entry-template",ans:b,a:"style-name"},{ens:b,en:"p",ans:b,a:"style-name"},{ens:b,en:"table-index-entry-template",ans:b,a:"style-name"},{ens:b,en:"table-of-content-entry-template",ans:b,a:"style-name"},{ens:b,en:"table-index-entry-template",ans:b,a:"style-name"},{ens:b,en:"user-index-entry-template",ans:b,a:"style-name"},{ens:m,en:"page-layout-properties",ans:m,a:"register-truth-ref-style-name"}],chart:[{ens:a,en:"axis",ans:a,a:"style-name"},{ens:a,en:"chart",ans:a,a:"style-name"},{ens:a,en:"data-label",ans:a,a:"style-name"},{ens:a,en:"data-point",ans:a,a:"style-name"},{ens:a,en:"equation",ans:a,a:"style-name"},{ens:a,en:"error-indicator",ans:a,a:"style-name"},{ens:a,en:"floor",ans:a,a:"style-name"},{ens:a,en:"footer",ans:a,a:"style-name"},{ens:a,en:"grid",ans:a,a:"style-name"},{ens:a,en:"legend",ans:a,a:"style-name"},{ens:a,en:"mean-value",ans:a,a:"style-name"},{ens:a,en:"plot-area",ans:a,a:"style-name"},{ens:a,en:"regression-curve",ans:a,a:"style-name"},{ens:a,en:"series",ans:a,a:"style-name"},{ens:a,en:"stock-gain-marker",ans:a,a:"style-name"},{ens:a,en:"stock-loss-marker",ans:a,a:"style-name"},{ens:a,en:"stock-range-line",ans:a,a:"style-name"},{ens:a,en:"subtitle",ans:a,a:"style-name"},{ens:a,en:"title",ans:a,a:"style-name"},{ens:a,en:"wall",ans:a,a:"style-name"}],section:[{ens:b,en:"alphabetical-index",ans:b,a:"style-name"},{ens:b,en:"bibliography",ans:b,a:"style-name"},{ens:b,en:"illustration-index",ans:b,a:"style-name"},{ens:b,en:"index-title",ans:b,a:"style-name"},{ens:b,en:"object-index",ans:b,a:"style-name"},{ens:b,en:"section",ans:b,a:"style-name"},{ens:b,en:"table-of-content",ans:b,a:"style-name"},{ens:b,en:"table-index",ans:b,a:"style-name"},{ens:b,en:"user-index",ans:b,a:"style-name"}],ruby:[{ens:b,en:"ruby",ans:b,a:"style-name"}],table:[{ens:l,en:"query",ans:l,a:"style-name"},{ens:l,en:"table-representation",ans:l,a:"style-name"},{ens:g,en:"background",ans:g,a:"style-name"},{ens:g,en:"table",ans:g,a:"style-name"}],"table-column":[{ens:l,en:"column",ans:l,a:"style-name"},{ens:g,en:"table-column",ans:g,a:"style-name"}],"table-row":[{ens:l,en:"query",ans:l,a:"default-row-style-name"},{ens:l,en:"table-representation",ans:l,a:"default-row-style-name"},{ens:g,en:"table-row",ans:g,a:"style-name"}],"table-cell":[{ens:l,en:"column",ans:l,a:"default-cell-style-name"},{ens:g,en:"table-column",ans:g,a:"default-cell-style-name"},{ens:g,en:"table-row",ans:g,a:"default-cell-style-name"},{ens:g,en:"body",ans:g,a:"style-name"},{ens:g,en:"covered-table-cell",ans:g,a:"style-name"},{ens:g,en:"even-columns",ans:g,a:"style-name"},{ens:g,en:"covered-table-cell",ans:g,a:"style-name"},{ens:g,en:"even-columns",ans:g,a:"style-name"},{ens:g,en:"even-rows",ans:g,a:"style-name"},{ens:g,en:"first-column",ans:g,a:"style-name"},{ens:g,en:"first-row",ans:g,a:"style-name"},{ens:g,en:"last-column",ans:g,a:"style-name"},{ens:g,en:"last-row",ans:g,a:"style-name"},{ens:g,en:"odd-columns",ans:g,a:"style-name"},{ens:g,en:"odd-rows",ans:g,a:"style-name"},{ens:g,en:"table-cell",ans:g,a:"style-name"}],graphic:[{ens:c,en:"cube",ans:u,a:"style-name"},{ens:c,en:"extrude",ans:u,a:"style-name"},{ens:c,en:"rotate",ans:u,a:"style-name"},{ens:c,en:"scene",ans:u,a:"style-name"},{ens:c,en:"sphere",ans:u,a:"style-name"},{ens:u,en:"caption",ans:u,a:"style-name"},{ens:u,en:"circle",ans:u,a:"style-name"},{ens:u,en:"connector",ans:u,a:"style-name"},{ens:u,en:"control",ans:u,a:"style-name"},{ens:u,en:"custom-shape",ans:u,a:"style-name"},{ens:u,en:"ellipse",ans:u,a:"style-name"},{ens:u,en:"frame",ans:u,a:"style-name"},{ens:u,en:"g",ans:u,a:"style-name"},{ens:u,en:"line",ans:u,a:"style-name"},{ens:u,en:"measure",ans:u,a:"style-name"},{ens:u,en:"page-thumbnail",ans:u,a:"style-name"},{ens:u,en:"path",ans:u,a:"style-name"},{ens:u,en:"polygon",ans:u,a:"style-name"},{ens:u,en:"polyline",ans:u,a:"style-name"},{ens:u,en:"rect",ans:u,a:"style-name"},{ens:u,en:"regular-polygon",ans:u,a:"style-name"},{ens:p,en:"annotation",ans:u,a:"style-name"}],presentation:[{ens:c,en:"cube",ans:f,a:"style-name"},{ens:c,en:"extrude",ans:f,a:"style-name"},{ens:c,en:"rotate",ans:f,a:"style-name"},{ens:c,en:"scene",ans:f,a:"style-name"},{ens:c,en:"sphere",ans:f,a:"style-name"},{ens:u,en:"caption",ans:f,a:"style-name"},{ens:u,en:"circle",ans:f,a:"style-name"},{ens:u,en:"connector",ans:f,a:"style-name"},{ens:u,en:"control",ans:f,a:"style-name"},{ens:u,en:"custom-shape",ans:f,a:"style-name"},{ens:u,en:"ellipse",ans:f,a:"style-name"},{ens:u,en:"frame",ans:f,a:"style-name"},{ens:u,en:"g",ans:f,a:"style-name"},{ens:u,en:"line",ans:f,a:"style-name"},{ens:u,en:"measure",ans:f,a:"style-name"},{ens:u,en:"page-thumbnail",ans:f,a:"style-name"},{ens:u,en:"path",ans:f,a:"style-name"},{ens:u,en:"polygon",ans:f,a:"style-name"},{ens:u,en:"polyline",ans:f,a:"style-name"},{ens:u,en:"rect",ans:f,a:"style-name"},{ens:u,en:"regular-polygon",ans:f,a:"style-name"},{ens:p,en:"annotation",ans:f,a:"style-name"}],"drawing-page":[{ens:u,en:"page",ans:u,a:"style-name"},{ens:f,en:"notes",ans:u,a:"style-name"},{ens:m,en:"handout-master",ans:u,a:"style-name"},{ens:m,en:"master-page",ans:u,a:"style-name"}],"list-style":[{ens:b,en:"list",ans:b,a:"style-name"},{ens:b,en:"numbered-paragraph",ans:b,a:"style-name"},{ens:b,en:"list-item",ans:b,a:"style-override"},{ens:m,en:"style",ans:m,a:"list-style-name"}],data:[{ens:m,en:"style",ans:m,a:"data-style-name"},{ens:m,en:"style",ans:m,a:"percentage-data-style-name"},{ens:f,en:"date-time-decl",ans:m,a:"data-style-name"},{ens:b,en:"creation-date",ans:m,a:"data-style-name"},{ens:b,en:"creation-time",ans:m,a:"data-style-name"},{ens:b,en:"database-display",ans:m,a:"data-style-name"},{ens:b,en:"date",ans:m,a:"data-style-name"},{ens:b,en:"editing-duration",ans:m,a:"data-style-name"},{ens:b,en:"expression",ans:m,a:"data-style-name"},{ens:b,en:"meta-field",ans:m,a:"data-style-name"},{ens:b,en:"modification-date",ans:m,a:"data-style-name"},{ens:b,en:"modification-time",ans:m,a:"data-style-name"},{ens:b,en:"print-date",ans:m,a:"data-style-name"},{ens:b,en:"print-time",ans:m,a:"data-style-name"},{ens:b,en:"table-formula",ans:m,a:"data-style-name"},{ens:b,en:"time",ans:m,a:"data-style-name"},{ens:b,en:"user-defined",ans:m,a:"data-style-name"},{ens:b,en:"user-field-get",ans:m,a:"data-style-name"},{ens:b,en:"user-field-input",ans:m,a:"data-style-name"},{ens:b,en:"variable-get",ans:m,a:"data-style-name"},{ens:b,en:"variable-input",ans:m,a:"data-style-name"},{ens:b,en:"variable-set",ans:m,a:"data-style-name"}],"page-layout":[{ens:f,en:"notes",ans:m,a:"page-layout-name"},{ens:m,en:"handout-master",ans:m,a:"page-layout-name"},{ens:m,en:"master-page",ans:m,a:"page-layout-name"}]},S=xmldom.XPath;this.collectUsedFontFaces=function e(t,n){function r(e){(e=o.getAttributeNS(m,e))&&(t[e]=!0)}var i,o,s=["font-name","font-name-asian","font-name-complex"];for(i=n&&n.firstElementChild;i;)o=i,s.forEach(r),e(t,o),i=i.nextElementSibling},this.changeFontFaceNames=function e(t,n){function r(e){var t=o.getAttributeNS(m,e);t&&n.hasOwnProperty(t)&&o.setAttributeNS(m,"style:"+e,n[t])}var i,o,s=["font-name","font-name-asian","font-name-complex"];for(i=t&&t.firstElementChild;i;)o=i,s.forEach(r),e(o,n),i=i.nextElementSibling},this.UsedStyleList=function(e,t){var n={};this.uses=function(e){var t=e.localName,r=e.getAttributeNS(u,"name")||e.getAttributeNS(m,"name");return e="style"===t?e.getAttributeNS(m,"family"):e.namespaceURI===h?"data":t,!!(e=n[e])&&0<e[r]},r(e,n),t&&o(t,n)},this.getStyleName=function(e,t){var n,r,i=s[t.localName];if(i&&(i=i[t.namespaceURI]))for(r=0;r<i.length;r+=1)if(i[r].keyname===e&&(i=i[r],t.hasAttributeNS(i.ns,i.localname))){n=t.getAttributeNS(i.ns,i.localname);break}return n},this.hasDerivedStyles=function(e,t,n){var r=n.getAttributeNS(m,"name");return n=n.getAttributeNS(m,"family"),!!S.getODFElementsWithXPath(e,'//style:*[@style:parent-style-name="'+r+'"][@style:family="'+n+'"]',t).length},this.prefixStyleNames=function(t,n,r){var i;if(t){for(i=t.firstChild;i;){if(i.nodeType===Node.ELEMENT_NODE){var o=i,s=n,a=o.getAttributeNS(u,"name"),l=void 0;a?l=u:(a=o.getAttributeNS(m,"name"))&&(l=m),l&&o.setAttributeNS(l,y[l]+"name",s+a)}i=i.nextSibling}e(t,n),r&&e(r,n)}},this.removePrefixFromStyleNames=function(e,n,r){var i=new RegExp("^"+n);if(e){for(n=e.firstChild;n;){if(n.nodeType===Node.ELEMENT_NODE){var o=n,s=i,a=o.getAttributeNS(u,"name"),l=void 0;a?l=u:(a=o.getAttributeNS(m,"name"))&&(l=m),l&&(a=a.replace(s,""),o.setAttributeNS(l,y[l]+"name",a))}n=n.nextSibling}t(e,i),r&&t(r,i)}},this.determineStylesForNode=n,s=function(){var e,t,n,r,i,o,s,a,l,c={};for(n in v)if(v.hasOwnProperty(n))for(r=v[n],t=r.length,e=0;e<t;e+=1)i=r[e],a=i.en,l=i.ens,c.hasOwnProperty(a)?o=c[a]:c[a]=o={},o.hasOwnProperty(l)?s=o[l]:o[l]=s=[],s.push({ns:i.ans,localname:i.a,keyname:n});return c}()},"function"!=typeof Object.create&&(Object.create=function(e){var t=function(){};return t.prototype=e,new t}),xmldom.LSSerializer=function(){function e(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")}function t(r,i){var o,s="",a=n.filter?n.filter.acceptNode(i):NodeFilter.FILTER_ACCEPT;if(a===NodeFilter.FILTER_ACCEPT&&i.nodeType===Node.ELEMENT_NODE){r.push(),o=r.getQName(i);var l,c,u,d,h,p=i.attributes,f="";for(l="<"+o,c=p.length,u=0;u<c;u+=1)"http://www.w3.org/2000/xmlns/"!==(d=p.item(u)).namespaceURI&&((h=n.filter?n.filter.acceptNode(d):NodeFilter.FILTER_ACCEPT)===NodeFilter.FILTER_ACCEPT&&(h=r.getQName(d),d="string"==typeof d.value?e(d.value):d.value,f+=" "+h+'="'+d+'"'));for(u in c=r.getLocalNamespaceDefinitions())c.hasOwnProperty(u)&&((p=c[u])?"xmlns"!==p&&(l+=" xmlns:"+c[u]+'="'+u+'"'):l+=' xmlns="'+u+'"');s+=l+(f+">")}if(a===NodeFilter.FILTER_ACCEPT||a===NodeFilter.FILTER_SKIP){for(a=i.firstChild;a;)s+=t(r,a),a=a.nextSibling;i.nodeValue&&(s+=e(i.nodeValue))}return o&&(s+="</"+o+">",r.pop()),s}var n=this;this.filter=null,this.writeToString=function(e,n){if(!e)return"";var r=new function(e){var t=e||{},n=function(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[e[t]]=t);return n}(e),r=[t],i=[n],o=0;this.push=function(){t=r[o+=1]=Object.create(t),n=i[o]=Object.create(n)},this.pop=function(){r.pop(),i.pop(),t=r[--o],n=i[o]},this.getLocalNamespaceDefinitions=function(){return n},this.getQName=function(e){var r,i=e.namespaceURI,o=0;if(!i)return e.localName;if(r=n[i])return r+":"+e.localName;do{if(r||!e.prefix?(r="ns"+o,o+=1):r=e.prefix,t[r]===i)break;if(!t[r]){t[r]=i,n[i]=r;break}r=null}while(null===r);return r+":"+e.localName}}(n);return t(r,e)}},function(){function e(e){var t,n=s.length;for(t=0;t<n;t+=1)if("urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI&&e.localName===s[t])return t;return-1}function t(e,t){var n=new r.UsedStyleList(e,t),i=new odf.OdfNodeFilter;this.acceptNode=function(e){var r=i.acceptNode(e);return r===NodeFilter.FILTER_ACCEPT&&e.parentNode===t&&e.nodeType===Node.ELEMENT_NODE&&(r=n.uses(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT),r}}function n(t,n){if(n){var r,i=e(n),o=t.firstChild;if(-1!==i){for(;o&&!(-1!==(r=e(o))&&r>i);)o=o.nextSibling;t.insertBefore(n,o)}}}var r=new odf.StyleInfo,i=core.DomUtils,o=odf.Namespaces.stylens,s="meta settings scripts font-face-decls styles automatic-styles master-styles body".split(" "),a=Date.now()+"_webodf_",l=new core.Base64;odf.ODFElement=function(){},odf.ODFDocumentElement=function(){},odf.ODFDocumentElement.prototype=new odf.ODFElement,odf.ODFDocumentElement.prototype.constructor=odf.ODFDocumentElement,odf.ODFDocumentElement.prototype.fontFaceDecls=null,odf.ODFDocumentElement.prototype.manifest=null,odf.ODFDocumentElement.prototype.settings=null,odf.ODFDocumentElement.namespaceURI="urn:oasis:names:tc:opendocument:xmlns:office:1.0",odf.ODFDocumentElement.localName="document",odf.AnnotationElement=function(){},odf.OdfPart=function(e,t,n,r){var i=this;this.size=0,this.type=null,this.name=e,this.container=n,this.url=null,this.mimetype=t,this.onstatereadychange=this.document=null,this.EMPTY=0,this.LOADING=1,this.DONE=2,this.state=this.EMPTY,this.data="",this.load=function(){null!==r&&(this.mimetype=t,r.loadAsDataURL(e,t,function(e,t){e&&runtime.log(e),i.url=t,i.onchange&&i.onchange(i),i.onstatereadychange&&i.onstatereadychange(i)}))}},odf.OdfPart.prototype.load=function(){},odf.OdfPart.prototype.getUrl=function(){return this.data?"data:;base64,"+l.toBase64(this.data):null},odf.OdfContainer=function e(s,c){function u(e){var t,n,r={},i=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_ELEMENT,null,!1);for(e=i.nextNode();e;)"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI&&("annotation"===e.localName?(t=e.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))&&(r.hasOwnProperty(t)?runtime.log("Warning: annotation name used more than once with <office:annotation/>: '"+t+"'"):r[t]=e):"annotation-end"===e.localName&&((t=e.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))?r.hasOwnProperty(t)?(n=r[t]).annotationEndElement?runtime.log("Warning: annotation name used more than once with <office:annotation-end/>: '"+t+"'"):n.annotationEndElement=e:runtime.log("Warning: annotation end without an annotation start, name: '"+t+"'"):runtime.log("Warning: annotation end without a name found"))),e=i.nextNode()}function d(e,t){for(var n=e&&e.firstChild;n;)n.nodeType===Node.ELEMENT_NODE&&n.setAttributeNS("urn:webodf:names:scope","scope",t),n=n.nextSibling}function h(e,t){for(var n=M.rootElement.meta,n=n&&n.firstChild;n&&(n.namespaceURI!==e||n.localName!==t);)n=n.nextSibling;for(n=n&&n.firstChild;n&&n.nodeType!==Node.TEXT_NODE;)n=n.nextSibling;return n?n.data:null}function p(e){var t,n={};for(e=e.firstChild;e;)e.nodeType===Node.ELEMENT_NODE&&e.namespaceURI===o&&"font-face"===e.localName&&(t=e.getAttributeNS(o,"name"),n[t]=e),e=e.nextSibling;return n}function f(e,t){var n,r,i,o=null;if(e)for(o=e.cloneNode(!0),n=o.firstElementChild;n;)r=n.nextElementSibling,(i=n.getAttributeNS("urn:webodf:names:scope","scope"))&&i!==t&&o.removeChild(n),n=r;return o}function m(e,t){var n,i,s,a=null,l={};if(e)for(t.forEach(function(e){r.collectUsedFontFaces(l,e)}),a=e.cloneNode(!0),n=a.firstElementChild;n;)i=n.nextElementSibling,s=n.getAttributeNS(o,"name"),l[s]||a.removeChild(n),n=i;return a}function g(e){var t,n=M.rootElement.ownerDocument;if(e){!function e(t){for(var n,r=t.firstChild;r;)n=r.nextSibling,r.nodeType===Node.ELEMENT_NODE?e(r):r.nodeType===Node.PROCESSING_INSTRUCTION_NODE&&t.removeChild(r),r=n}(e.documentElement);try{t=n.importNode(e.documentElement,!0)}catch(e){}}return t}function b(e){M.state=e,M.onchange&&M.onchange(M),M.onstatereadychange&&M.onstatereadychange(M)}function y(e){F=null,M.rootElement=e,e.fontFaceDecls=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls"),e.styles=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),e.automaticStyles=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),e.masterStyles=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),e.body=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body"),e.meta=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),e.settings=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings"),e.scripts=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","scripts"),u(e)}function v(t){var o,s=g(t),l=M.rootElement;s&&"document-styles"===s.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===s.namespaceURI?(l.fontFaceDecls=i.getDirectChild(s,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls"),n(l,l.fontFaceDecls),o=i.getDirectChild(s,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),l.styles=o||t.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),n(l,l.styles),o=i.getDirectChild(s,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),l.automaticStyles=o||t.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),d(l.automaticStyles,"document-styles"),n(l,l.automaticStyles),s=i.getDirectChild(s,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),l.masterStyles=s||t.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),n(l,l.masterStyles),r.prefixStyleNames(l.automaticStyles,a,l.masterStyles)):b(e.INVALID)}function S(t){var s,a,l,c;if((t=g(t))&&"document-content"===t.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===t.namespaceURI){if(s=M.rootElement,l=i.getDirectChild(t,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls"),s.fontFaceDecls&&l){c=s.fontFaceDecls;var u,h,f,m,y={};for(a=p(c),m=p(l),l=l.firstElementChild;l;){if(u=l.nextElementSibling,l.namespaceURI===o&&"font-face"===l.localName)if(h=l.getAttributeNS(o,"name"),a.hasOwnProperty(h)){if(!l.isEqualNode(a[h])){for(var v=a,S=m,C=0,x=void 0,x=f=(f=h).replace(/\d+$/,"");v.hasOwnProperty(x)||S.hasOwnProperty(x);)x=f+(C+=1);f=x,l.setAttributeNS(o,"style:name",f),c.appendChild(l),a[f]=l,delete m[h],y[h]=f}}else c.appendChild(l),a[h]=l,delete m[h];l=u}c=y}else l&&(s.fontFaceDecls=l,n(s,l));if(d(a=i.getDirectChild(t,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),"document-content"),c&&r.changeFontFaceNames(a,c),s.automaticStyles&&a)for(c=a.firstChild;c;)s.automaticStyles.appendChild(c),c=a.firstChild;else a&&(s.automaticStyles=a,n(s,a));if(null===(t=i.getDirectChild(t,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body")))throw"<office:body/> tag is mising.";s.body=t,n(s,s.body)}else b(e.INVALID)}function C(e){var t;(e=g(e))&&"document-meta"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI&&((t=M.rootElement).meta=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),n(t,t.meta))}function x(e){var t;(e=g(e))&&"document-settings"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI&&((t=M.rootElement).settings=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings"),n(t,t.settings))}function A(e){var t;if((e=g(e))&&"manifest"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===e.namespaceURI)for((t=M.rootElement).manifest=e,e=t.manifest.firstElementChild;e;)"file-entry"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===e.namespaceURI&&(L[e.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","full-path")]=e.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","media-type")),e=e.nextElementSibling}function w(e,t,n){var r;for(e=i.getElementsByTagName(e,t),r=0;r<e.length;r+=1)t=e[r],n.hasOwnProperty(t.namespaceURI)||t.parentNode.removeChild(t)}function _(e){w(e,"script",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:office:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:table:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:text:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":!0}),w(e,"style",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:style:1.0":!0})}function N(e){var t,n,r,i=e.firstElementChild,o=[],s=e.attributes,a=s.length;for(t=0;t<a;t+=1)r=s.item(t),n=r.localName.substr(0,2).toLowerCase(),null===r.namespaceURI&&"on"===n&&o.push(r);for(a=o.length,t=0;t<a;t+=1)e.removeAttributeNode(o[t]);for(;i;)N(i),i=i.nextElementSibling}function E(e){var t="";return odf.Namespaces.forEachPrefix(function(e,n){t+=" xmlns:"+e+'="'+n+'"'}),'<?xml version="1.0" encoding="UTF-8"?><office:'+e+" "+t+' office:version="1.2">'}function T(e,t){var n=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:file-entry");return n.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:full-path",e),n.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:media-type",t),n}function k(){var e,n,r=odf.Namespaces.namespaceMap,i=new xmldom.LSSerializer,o=E("document-content");return n=f(M.rootElement.automaticStyles,"document-content"),e=m(M.rootElement.fontFaceDecls,[n]),i.filter=new function(e,n){var r=new t(e,n);this.acceptNode=function(e){var t=r.acceptNode(e);return t!==NodeFilter.FILTER_ACCEPT||!e.parentNode||e.parentNode.namespaceURI!==odf.Namespaces.textns||"s"!==e.parentNode.localName&&"tab"!==e.parentNode.localName||(t=NodeFilter.FILTER_REJECT),t}}(M.rootElement.body,n),o+=i.writeToString(e,r),o+=i.writeToString(n,r),(o+=i.writeToString(M.rootElement.body,r))+"</office:document-content>"}function P(e,t){var r,o=(r=M.rootElement).meta;o||(r.meta=o=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),n(r,o)),r=o,e&&i.mapKeyValObjOntoNode(r,e,odf.Namespaces.lookupNamespaceURI),t&&i.removeKeyElementsFromNode(r,t,odf.Namespaces.lookupNamespaceURI)}function R(t,n){function r(e,t){var n;t||(t=e),n=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",t),a[e]=n,a.appendChild(n)}var i=new core.Zip("",null),o="application/vnd.oasis.opendocument."+t+(!0===n?"-template":""),s=runtime.byteArrayFromString(o,"utf8"),a=M.rootElement,l=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",t);return i.save("mimetype",s,!1,new Date),r("meta"),r("settings"),r("scripts"),r("fontFaceDecls","font-face-decls"),r("styles"),r("automaticStyles","automatic-styles"),r("masterStyles","master-styles"),r("body"),a.body.appendChild(l),L["/"]=o,L["settings.xml"]="text/xml",L["meta.xml"]="text/xml",L["styles.xml"]="text/xml",L["content.xml"]="text/xml",b(e.DONE),i}function O(){var e,n=new Date,i="";M.rootElement.settings&&M.rootElement.settings.firstElementChild&&(e=new xmldom.LSSerializer,i=E("document-settings"),e.filter=new odf.OdfNodeFilter,i+=e.writeToString(M.rootElement.settings,odf.Namespaces.namespaceMap),i+="</office:document-settings>"),(e=i)?(e=runtime.byteArrayFromString(e,"utf8"),I.save("settings.xml",e,!0,n)):I.remove("settings.xml"),i=runtime.getWindow(),e="WebODF/"+webodf.Version,i&&(e=e+" "+i.navigator.userAgent),P({"meta:generator":e},null),e=runtime.byteArrayFromString(function(){var e=new xmldom.LSSerializer,t=E("document-meta");return e.filter=new odf.OdfNodeFilter,(t+=e.writeToString(M.rootElement.meta,odf.Namespaces.namespaceMap))+"</office:document-meta>"}(),"utf8"),I.save("meta.xml",e,!0,n),e=runtime.byteArrayFromString(function(){var e,n,i,o=odf.Namespaces.namespaceMap,s=new xmldom.LSSerializer,l=E("document-styles");return n=f(M.rootElement.automaticStyles,"document-styles"),i=M.rootElement.masterStyles.cloneNode(!0),e=m(M.rootElement.fontFaceDecls,[i,M.rootElement.styles,n]),r.removePrefixFromStyleNames(n,a,i),s.filter=new t(i,n),l+=s.writeToString(e,o),l+=s.writeToString(M.rootElement.styles,o),l+=s.writeToString(n,o),(l+=s.writeToString(i,o))+"</office:document-styles>"}(),"utf8"),I.save("styles.xml",e,!0,n),e=runtime.byteArrayFromString(k(),"utf8"),I.save("content.xml",e,!0,n),e=runtime.byteArrayFromString(function(){var e,t=runtime.parseXML('<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2"></manifest:manifest>'),n=t.documentElement,r=new xmldom.LSSerializer;for(e in L)L.hasOwnProperty(e)&&n.appendChild(T(e,L[e]));return r.filter=new odf.OdfNodeFilter,'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n'+r.writeToString(t,odf.Namespaces.namespaceMap)}(),"utf8"),I.save("META-INF/manifest.xml",e,!0,n)}function D(e,t){O(),I.writeAs(e,function(e){t(e)})}var I,F,M=this,L={},B="";this.onstatereadychange=c,this.state=this.onchange=null,this.getMetadata=h,this.setRootElement=y,this.getContentElement=function(){var e;if(F||(e=M.rootElement.body,F=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","text")||i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","presentation")||i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","spreadsheet")),!F)throw"Could not find content element in <office:body/>.";return F},this.getDocumentType=function(){var e=M.getContentElement();return e&&e.localName},this.isTemplate=function(){return"-template"===L["/"].substr(-9)},this.setIsTemplate=function(e){var t=L["/"],n="-template"===t.substr(-9);e!==n&&(t=e?t+"-template":t.substr(0,t.length-9),L["/"]=t,e=runtime.byteArrayFromString(t,"utf8"),I.save("mimetype",e,!1,new Date))},this.getPart=function(e){return new odf.OdfPart(e,L[e],M,I)},this.getPartData=function(e,t){I.load(e,t)},this.setMetadata=P,this.incrementEditingCycles=function(){var e=h(odf.Namespaces.metans,"editing-cycles"),e=e?parseInt(e,10):0;return isNaN(e)&&(e=0),P({"meta:editing-cycles":e+1},null),e+1},this.createByteArray=function(e,t){O(),I.createByteArray(e,t)},this.saveAs=D,this.save=function(e){D(B,e)},this.getUrl=function(){return B},this.setBlob=function(e,t,n){n=l.convertBase64ToByteArray(n),I.save(e,n,!1,new Date),L.hasOwnProperty(e)&&runtime.log(e+" has been overwritten."),L[e]=t},this.removeBlob=function(e){var t=I.remove(e);runtime.assert(t,"file is not found: "+e),delete L[e]},this.state=e.LOADING,this.rootElement=function(e){var t,n=document.createElementNS(e.namespaceURI,e.localName);for(t in e=new e.Type)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}({Type:odf.ODFDocumentElement,namespaceURI:odf.ODFDocumentElement.namespaceURI,localName:odf.ODFDocumentElement.localName}),s===odf.OdfContainer.DocumentType.TEXT?I=R("text"):s===odf.OdfContainer.DocumentType.TEXT_TEMPLATE?I=R("text",!0):s===odf.OdfContainer.DocumentType.PRESENTATION?I=R("presentation"):s===odf.OdfContainer.DocumentType.PRESENTATION_TEMPLATE?I=R("presentation",!0):s===odf.OdfContainer.DocumentType.SPREADSHEET?I=R("spreadsheet"):s===odf.OdfContainer.DocumentType.SPREADSHEET_TEMPLATE?I=R("spreadsheet",!0):(B=s,I=new core.Zip(B,function(t,n){I=n,t?function(t,n){runtime.loadXML(t,function(t,r){if(t)n(t);else if(r){_(r),N(r.documentElement);var i=g(r);i&&"document"===i.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===i.namespaceURI?(y(i),b(e.DONE)):b(e.INVALID)}else n("No DOM was loaded.")})}(B,function(n){t&&(I.error=t+"\n"+n,b(e.INVALID))}):function t(n){var r=n.shift();r?I.loadAsDOM(r.path,function(i,o){o&&(_(o),N(o.documentElement)),r.handler(o),M.state===e.INVALID?i?runtime.log("ERROR: Unable to load "+r.path+" - "+i):runtime.log("ERROR: Unable to load "+r.path):(i&&runtime.log("DEBUG: Unable to load "+r.path+" - "+i),t(n))}):(u(M.rootElement),b(e.DONE))}([{path:"styles.xml",handler:v},{path:"content.xml",handler:S},{path:"meta.xml",handler:C},{path:"settings.xml",handler:x},{path:"META-INF/manifest.xml",handler:A}])}))},odf.OdfContainer.EMPTY=0,odf.OdfContainer.LOADING=1,odf.OdfContainer.DONE=2,odf.OdfContainer.INVALID=3,odf.OdfContainer.SAVING=4,odf.OdfContainer.MODIFIED=5,odf.OdfContainer.getContainer=function(e){return new odf.OdfContainer(e,null)}}(),odf.OdfContainer.DocumentType={TEXT:1,TEXT_TEMPLATE:2,PRESENTATION:3,PRESENTATION_TEMPLATE:4,SPREADSHEET:5,SPREADSHEET_TEMPLATE:6},gui.AnnotatableCanvas=function(){},gui.AnnotatableCanvas.prototype.refreshSize=function(){},gui.AnnotatableCanvas.prototype.getZoomLevel=function(){},gui.AnnotatableCanvas.prototype.getSizer=function(){},gui.AnnotationViewManager=function(e,t,n,r){function i(e){var t=e.annotationEndElement,n=c.createRange(),r=e.getAttributeNS(odf.Namespaces.officens,"name");t&&(n.setStart(e,e.childNodes.length),n.setEnd(t,0),(e=u.getTextNodes(n,!1)).forEach(function(e){var t;e:{for(t=e.parentNode;t.namespaceURI!==odf.Namespaces.officens||"body"!==t.localName;){if("http://www.w3.org/1999/xhtml"===t.namespaceURI&&"webodf-annotationHighlight"===t.className&&t.getAttribute("annotation")===r){t=!0;break e}t=t.parentNode}t=!1}t||((t=c.createElement("span")).className="webodf-annotationHighlight",t.setAttribute("annotation",r),e.parentNode.replaceChild(t,e),t.appendChild(e))})),n.detach()}function o(t){var r=e.getSizer();t?(n.style.display="inline-block",r.style.paddingRight=d.getComputedStyle(n).width):(n.style.display="none",r.style.paddingRight=0),e.refreshSize()}function s(){var t;for(t=0;t<l.length;t+=1){var r=l[t],i=r.parentNode,o=i.nextElementSibling,s=o.nextElementSibling,a=i.parentNode,c=0,c=l[l.indexOf(r)-1],u=void 0,r=e.getZoomLevel();i.style.left=(n.getBoundingClientRect().left-a.getBoundingClientRect().left)/r+"px",i.style.width=n.getBoundingClientRect().width/r+"px",o.style.width=parseFloat(i.style.left)-30+"px",c?(u=c.parentNode.getBoundingClientRect(),20>=(a.getBoundingClientRect().top-u.bottom)/r?i.style.top=Math.abs(a.getBoundingClientRect().top-u.bottom)/r+20+"px":i.style.top="0px"):i.style.top="0px",s.style.left=o.getBoundingClientRect().width/r+"px";var o=s.style,a=s.getBoundingClientRect().left/r,c=s.getBoundingClientRect().top/r,u=i.getBoundingClientRect().left/r,d=i.getBoundingClientRect().top/r,h=0,p=0,h=u-a,h=h*h,p=d-c,p=p*p,a=Math.sqrt(h+p);o.width=a+"px",c=Math.asin((i.getBoundingClientRect().top-s.getBoundingClientRect().top)/(r*parseFloat(s.style.width))),s.style.transform="rotate("+c+"rad)",s.style.MozTransform="rotate("+c+"rad)",s.style.WebkitTransform="rotate("+c+"rad)",s.style.msTransform="rotate("+c+"rad)"}}function a(e){var t=l.indexOf(e),n=e.parentNode.parentNode;"div"===n.localName&&(n.parentNode.insertBefore(e,n),n.parentNode.removeChild(n)),e=e.getAttributeNS(odf.Namespaces.officens,"name"),e=c.querySelectorAll('span.webodf-annotationHighlight[annotation="'+e+'"]');for(var r,n=0;n<e.length;n+=1){for(r=e.item(n);r.firstChild;)r.parentNode.insertBefore(r.firstChild,r);r.parentNode.removeChild(r)}-1!==t&&l.splice(t,1),0===l.length&&o(!1)}var l=[],c=t.ownerDocument,u=odf.OdfUtils,d=runtime.getWindow();runtime.assert(Boolean(d),"Expected to be run in an environment which has a global window, like a browser."),this.rerenderAnnotations=s,this.rehighlightAnnotations=function(){l.forEach(function(e){i(e)})},this.getMinimumHeightForAnnotationPane=function(){return"none"!==n.style.display&&0<l.length?(l[l.length-1].parentNode.getBoundingClientRect().bottom-n.getBoundingClientRect().top)/e.getZoomLevel()+"px":null},this.addAnnotations=function(e){0!==e.length&&(o(!0),e.forEach(function(e){l.push(e);var t,n=c.createElement("div"),o=c.createElement("div"),s=c.createElement("div"),a=c.createElement("div");n.className="annotationWrapper",n.setAttribute("creator",u.getAnnotationCreator(e)),e.parentNode.insertBefore(n,e),o.className="annotationNote",o.appendChild(e),r&&((t=c.createElement("div")).className="annotationRemoveButton",o.appendChild(t)),s.className="annotationConnector horizontal",a.className="annotationConnector angular",n.appendChild(o),n.appendChild(s),n.appendChild(a),e.annotationEndElement&&i(e)}),l.sort(function(e,t){return 0!=(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING)?-1:1}),s())},this.forgetAnnotation=a,this.forgetAnnotations=function(){for(;l.length;)a(l[0])}},gui.Viewport=function(){},gui.Viewport.prototype.scrollIntoView=function(e,t){},gui.SingleScrollViewport=function(e){this.scrollIntoView=function(t,n){var r,i,o,s;s=e.offsetHeight-e.clientHeight,o=e.offsetWidth-e.clientWidth;var a=e.getBoundingClientRect();t&&a&&(r=a.left+5,i=a.top+5,o=a.right-(o+5),s=a.bottom-(s+5),n||t.top<i?e.scrollTop-=i-t.top:(t.top>s||t.bottom>s)&&(e.scrollTop=t.bottom-t.top<=s-i?e.scrollTop+(t.bottom-s):e.scrollTop+(t.top-i)),t.left<r?e.scrollLeft-=r-t.left:t.right>o&&(e.scrollLeft=t.right-t.left<=o-r?e.scrollLeft+(t.right-o):e.scrollLeft-(r-t.left)))}},function(){function e(t,n,i,o,s){var a,l,c=0;for(l in t)if(t.hasOwnProperty(l)){if(c===i){a=l;break}c+=1}a?n.getPartData(t[a].href,function(l,c){if(l)runtime.log(l);else if(c){var u="@font-face { font-family: "+(t[a].family||a)+"; src: url(data:application/x-font-ttf;charset=binary;base64,"+r.convertUTF8ArrayToBase64(c)+') format("truetype"); }';try{o.insertRule(u,o.cssRules.length)}catch(e){runtime.log("Problem inserting rule in CSS: "+runtime.toJson(e)+"\nRule: "+u)}}else runtime.log("missing font data for "+t[a].href);e(t,n,i+1,o,s)}):s&&s()}var t=xmldom.XPath,n=odf.OdfUtils,r=new core.Base64;odf.FontLoader=function(){this.loadFonts=function(r,i){for(var o=r.rootElement.fontFaceDecls;i.cssRules.length;)i.deleteRule(i.cssRules.length-1);if(o){var s,a,l,c,u={};if(o)for(o=t.getODFElementsWithXPath(o,"style:font-face[svg:font-face-src]",odf.Namespaces.lookupNamespaceURI),s=0;s<o.length;s+=1)a=o[s],l=a.getAttributeNS(odf.Namespaces.stylens,"name"),c=n.getNormalizedFontFamilyName(a.getAttributeNS(odf.Namespaces.svgns,"font-family")),0<(a=t.getODFElementsWithXPath(a,"svg:font-face-src/svg:font-face-uri",odf.Namespaces.lookupNamespaceURI)).length&&(a=a[0].getAttributeNS(odf.Namespaces.xlinkns,"href"),u[l]={href:a,family:c});e(u,r,0,i)}}}}(),odf.Formatting=function(){function e(e){return(e=x[e])?S.mergeObjects({},e):{}}function t(){for(var e,t,n=d.rootElement.fontFaceDecls,r={},n=n&&n.firstElementChild;n;)(e=n.getAttributeNS(f,"name"))&&((t=n.getAttributeNS(p,"font-family"))||0<n.getElementsByTagNameNS(p,"font-face-uri").length)&&(r[e]=t),n=n.nextElementSibling;return r}function n(e){for(var t=d.rootElement.styles.firstElementChild;t;){if(t.namespaceURI===f&&"default-style"===t.localName&&t.getAttributeNS(f,"family")===e)return t;t=t.nextElementSibling}return null}function r(e,t,n){var r,i,o;for(n=n||[d.rootElement.automaticStyles,d.rootElement.styles],o=0;o<n.length;o+=1)for(r=(r=n[o]).firstElementChild;r;){if(i=r.getAttributeNS(f,"name"),r.namespaceURI===f&&"style"===r.localName&&r.getAttributeNS(f,"family")===t&&i===e||"list-style"===t&&r.namespaceURI===m&&"list-style"===r.localName&&i===e||"data"===t&&r.namespaceURI===g&&i===e)return r;r=r.nextElementSibling}return null}function i(e){for(var t,n,r,i,o={},s=e.firstElementChild;s;){if(s.namespaceURI===f)for(r=o[s.nodeName]={},n=s.attributes,t=0;t<n.length;t+=1)i=n.item(t),r[i.name]=i.value;s=s.nextElementSibling}for(n=e.attributes,t=0;t<n.length;t+=1)i=n.item(t),o[i.name]=i.value;return o}function o(t,o){for(var s,a=d.rootElement.styles,l={},c=t.getAttributeNS(f,"family"),u=t;u;)s=i(u),l=S.mergeObjects(s,l),u=(s=u.getAttributeNS(f,"parent-style-name"))?r(s,c,[a]):null;return(u=n(c))&&(s=i(u),l=S.mergeObjects(s,l)),!1!==o&&(s=e(c),l=S.mergeObjects(s,l)),l}function s(e,t){for(var n,r=e.nodeType===Node.TEXT_NODE?e.parentNode:e,i=[],o="",s=!1;r&&!y.isInlineRoot(r)&&r.parentNode!==d.rootElement;)!s&&y.isGroupingElement(r)&&(s=!0),(n=h.determineStylesForNode(r))&&i.push(n),r=r.parentNode;return s&&(i.forEach(function(e){Object.keys(e).forEach(function(t){Object.keys(e[t]).forEach(function(e){o+="|"+t+":"+e+"|"})})}),t&&(t[o]=i)),s?i:void 0}function a(e){var t={orderedStyles:[],styleProperties:{}};return e.forEach(function(e){Object.keys(e).forEach(function(n){var i,s=Object.keys(e[n])[0],a={name:s,family:n,displayName:void 0,isCommonStyle:!1};(i=r(s,n))?(n=o(i),t.styleProperties=S.mergeObjects(n,t.styleProperties),a.displayName=i.getAttributeNS(f,"display-name")||void 0,a.isCommonStyle=i.parentNode===d.rootElement.styles):runtime.log("No style element found for '"+s+"' of family '"+n+"'"),t.orderedStyles.push(a)})}),t}function l(e,t){var n={},r=[];return t||(t={}),e.forEach(function(e){s(e,n)}),Object.keys(n).forEach(function(e){t[e]||(t[e]=a(n[e])),r.push(t[e])}),r}function c(e){for(var t=d.rootElement.masterStyles.firstElementChild;t&&(t.namespaceURI!==f||"master-page"!==t.localName||t.getAttributeNS(f,"name")!==e);)t=t.nextElementSibling;return t}function u(e,t){var n;return e&&(n=C.convertMeasure(e,"px")),void 0===n&&t&&(n=C.convertMeasure(t,"px")),n}var d,h=new odf.StyleInfo,p=odf.Namespaces.svgns,f=odf.Namespaces.stylens,m=odf.Namespaces.textns,g=odf.Namespaces.numberns,b=odf.Namespaces.fons,y=odf.OdfUtils,v=core.DomUtils,S=new core.Utils,C=new core.CSSUnits,x={paragraph:{"style:paragraph-properties":{"fo:text-align":"left"}}};this.getSystemDefaultStyleAttributes=e,this.setOdfContainer=function(e){d=e},this.getFontMap=t,this.getAvailableParagraphStyles=function(){for(var e,t,n=d.rootElement.styles,r=[],n=n&&n.firstElementChild;n;)"style"===n.localName&&n.namespaceURI===f&&("paragraph"===(e=n.getAttributeNS(f,"family"))&&(e=n.getAttributeNS(f,"name"),t=n.getAttributeNS(f,"display-name")||e,e&&t&&r.push({name:e,displayName:t}))),n=n.nextElementSibling;return r},this.isStyleUsed=function(e){var t,n=d.rootElement;return t=h.hasDerivedStyles(n,odf.Namespaces.lookupNamespaceURI,e),e=new h.UsedStyleList(n.styles).uses(e)||new h.UsedStyleList(n.automaticStyles).uses(e)||new h.UsedStyleList(n.body).uses(e),t||e},this.getDefaultStyleElement=n,this.getStyleElement=r,this.getStyleAttributes=i,this.getInheritedStyleAttributes=o,this.getFirstCommonParentStyleNameOrSelf=function(e){var t,n=d.rootElement.styles;return(t=r(e,"paragraph",[d.rootElement.automaticStyles]))&&!(e=t.getAttributeNS(f,"parent-style-name"))?null:(t=r(e,"paragraph",[n]))?e:null},this.hasParagraphStyle=function(e){return Boolean(r(e,"paragraph"))},this.getAppliedStyles=l,this.getAppliedStylesForElement=function(e,t){return l([e],t)[0]},this.updateStyle=function(e,n){var r,i;v.mapObjOntoNode(e,n,odf.Namespaces.lookupNamespaceURI),(r=(r=n["style:text-properties"])&&r["style:font-name"])&&!t().hasOwnProperty(r)&&((i=e.ownerDocument.createElementNS(f,"style:font-face")).setAttributeNS(f,"style:name",r),i.setAttributeNS(p,"svg:font-family",r),d.rootElement.fontFaceDecls.appendChild(i))},this.createDerivedStyleObject=function(e,t,n){var o=r(e,t);return runtime.assert(Boolean(o),"No style element found for '"+e+"' of family '"+t+"'"),(e=o.parentNode===d.rootElement.styles?{"style:parent-style-name":e}:i(o))["style:family"]=t,S.mergeObjects(e,n),e},this.getDefaultTabStopDistance=function(){for(var e,t=n("paragraph"),t=t&&t.firstElementChild;t;)t.namespaceURI===f&&"paragraph-properties"===t.localName&&(e=t.getAttributeNS(f,"tab-stop-distance")),t=t.nextElementSibling;return e||(e="1.25cm"),y.parseNonNegativeLength(e)},this.getMasterPageElement=c,this.getContentSize=function(e,t){var n,i,o,s,a,l,h,p,m,g;e:{if(i=r(e,t),runtime.assert("paragraph"===t||"table"===t,"styleFamily must be either paragraph or table"),i&&((i=i.getAttributeNS(f,"master-page-name"))&&((n=c(i))||runtime.log("WARN: No master page definition found for "+i)),n||(n=c("Standard")),n||(n=d.rootElement.masterStyles.getElementsByTagNameNS(f,"master-page")[0])||runtime.log("WARN: Document has no master pages defined"),n))for(i=n.getAttributeNS(f,"page-layout-name"),o=d.rootElement.automaticStyles.getElementsByTagNameNS(f,"page-layout"),s=0;s<o.length;s+=1)if((n=o.item(s)).getAttributeNS(f,"name")===i)break e;n=null}return n||(n=v.getDirectChild(d.rootElement.styles,f,"default-page-layout")),(n=v.getDirectChild(n,f,"page-layout-properties"))?("landscape"===n.getAttributeNS(f,"print-orientation")?(i="29.7cm",o="21.001cm"):(i="21.001cm",o="29.7cm"),i=u(n.getAttributeNS(b,"page-width"),i),o=u(n.getAttributeNS(b,"page-height"),o),void 0===(s=u(n.getAttributeNS(b,"margin")))?(s=u(n.getAttributeNS(b,"margin-left"),"2cm"),a=u(n.getAttributeNS(b,"margin-right"),"2cm"),l=u(n.getAttributeNS(b,"margin-top"),"2cm"),h=u(n.getAttributeNS(b,"margin-bottom"),"2cm")):s=a=l=h=s,void 0===(p=u(n.getAttributeNS(b,"padding")))?(p=u(n.getAttributeNS(b,"padding-left"),"0cm"),m=u(n.getAttributeNS(b,"padding-right"),"0cm"),g=u(n.getAttributeNS(b,"padding-top"),"0cm"),n=u(n.getAttributeNS(b,"padding-bottom"),"0cm")):p=m=g=n=p):(i=u("21.001cm"),o=u("29.7cm"),s=a=l=h=s=u("2cm"),p=m=g=n=p=u("0cm")),{width:i-s-a-p-m,height:o-l-h-g-n}}},function(){var e=odf.Namespaces.stylens,t=odf.Namespaces.textns,n={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"};odf.StyleTreeNode=function(e){this.derivedStyles={},this.element=e},odf.StyleTree=function(r,i){function o(n){var r,i,o,s={};if(!n)return s;for(n=n.firstElementChild;n;)(i=n.namespaceURI!==e||"style"!==n.localName&&"default-style"!==n.localName?n.namespaceURI===t&&"list-style"===n.localName?"list":n.namespaceURI!==e||"page-layout"!==n.localName&&"default-page-layout"!==n.localName?void 0:"page":n.getAttributeNS(e,"family"))&&((r=n.getAttributeNS(e,"name"))||(r=""),s.hasOwnProperty(i)?o=s[i]:s[i]=o={},o[r]=n),n=n.nextElementSibling;return s}function s(t,n,r){var i,o,a;return n.hasOwnProperty(t)?(i=new odf.StyleTreeNode(n[t]),o=i.element.getAttributeNS(e,"parent-style-name"),a=null,o&&(a=function e(t,n){if(t.hasOwnProperty(n))return t[n];var r,i=null,o=Object.keys(t);for(r=0;r<o.length&&!(i=e(t[o[r]].derivedStyles,n));r+=1);return i}(r,o)||s(o,n,r)),a?a.derivedStyles[t]=i:r[t]=i,delete n[t],i):null}function a(e,t){e&&Object.keys(e).forEach(function(n){s(n,e,t)})}var l,c,u,d={};this.getStyleTree=function(){return d},c=o(r),u=o(i),Object.keys(n).forEach(function(e){l=d[e]={},a(c[e],l),a(u[e],l)})}}(),function(){function e(e,t){try{e.insertRule(t,e.cssRules.length)}catch(e){runtime.log("cannot load rule: "+t+" - "+e)}}function t(t){function n(r,o,a,l){var c=o.namespaceURI===i&&"list"===o.localName,u=o.namespaceURI===i&&"list-item"===o.localName;if(c||u){if(c){var d,h,p,c=a+=1;for(l.listCounterCount+=1,u=r+"-level"+c+"-"+l.listCounterCount,o.setAttributeNS("urn:webodf:names:helper","counter-id",u),(d=l.continuedCounterIdStack.shift())||(s+=u+" 1 ",h='text|list[webodfhelper|counter-id="'+u+'"] > text|list-item:first-child > :not(text|list):first-child:before',h+="{",h+="counter-increment: "+(d=u)+" 0;",e(t,h+="}"));l.counterIdStack.length>=c;)l.counterIdStack.pop();for(l.counterIdStack.push(d),p=l.contentRules[c.toString()]||"",h=1;h<=c;h+=1)p=p.replace(h+"webodf-listLevel",l.counterIdStack[h-1]);h='text|list[webodfhelper|counter-id="'+u+'"] > text|list-item > :not(text|list):first-child:before',h+="{",h+=p,h+="counter-increment: "+d+";",e(t,h+="}")}for(o=o.firstElementChild;o;)n(r,o,a,l),o=o.nextElementSibling}else l.continuedCounterIdStack=[]}var r=0,s="",a={};this.createCounterRules=function(e,t,i){var s=t.getAttributeNS(o,"id"),l=[];i&&(i=i.getAttributeNS("urn:webodf:names:helper","counter-id"),l=a[i].slice(0)),e=new function(e,t){this.listCounterCount=0,this.contentRules=e,this.counterIdStack=[],this.continuedCounterIdStack=t}(e,l),s?s="Y"+s:s="X"+(r+=1),n(s,t,0,e),a[s+"-level1-1"]=e.counterIdStack},this.initialiseCreatedCounters=function(){var n;n="office|document{counter-reset: "+s+";",e(t,n+="}")}}var n=odf.Namespaces.fons,r=odf.Namespaces.stylens,i=odf.Namespaces.textns,o=odf.Namespaces.xmlns,s={1:"decimal",a:"lower-latin",A:"upper-latin",i:"lower-roman",I:"upper-roman"};odf.ListStyleToCss=function(){function a(e){var t=h.parseLength(e);return t?d.convert(t.value,t.unit,"px"):(runtime.log("Could not parse value '"+e+"'."),0)}function l(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function c(e,t){var n;return e&&(n=e.getAttributeNS(i,"style-name")),n===t}function u(e,n,a){n=n.getElementsByTagNameNS(i,"list"),e=new t(e);var u,d,h,p,f,m,g,b={};for(g=0;g<n.length;g+=1)if(u=n.item(g),m=u.getAttributeNS(i,"style-name")){h=u.getAttributeNS(i,"continue-numbering"),p=u.getAttributeNS(i,"continue-list"),(f=u.getAttributeNS(o,"id"))&&(b[f]=u),f=a[m].element.firstElementChild;for(var y=void 0,v={};f;){var y=(y=f.getAttributeNS(i,"level"))&&parseInt(y,10),S=f,C="",x=void 0,A=void 0,w=x=void 0;if("list-level-style-number"===S.localName){var _=S,C=_.getAttributeNS(r,"num-format"),x=_.getAttributeNS(r,"num-suffix")||"",A=_.getAttributeNS(r,"num-prefix")||"",N="",E=_.getAttributeNS(i,"level"),_=_.getAttributeNS(i,"display-levels");if(A&&(N+='"'+l(A)+'"\n'),s.hasOwnProperty(C))for(E=E?parseInt(E,10):1,_=_?parseInt(_,10):1;0<_;)N+=" counter("+(E-_+1)+"webodf-listLevel,"+s[C]+")",1<_&&(N+='"."'),--_;else N=C?N+' "'+C+'"':N+' ""';C="content:"+N+' "'+l(x)+'"'}else"list-level-style-image"===S.localName?C="content: none":"list-level-style-bullet"===S.localName&&(C='content: "'+l(C=S.getAttributeNS(i,"bullet-char"))+'"');(x=S.getElementsByTagNameNS(r,"list-level-properties")[0])&&("label-alignment"===(A=x.getAttributeNS(i,"list-level-position-and-space-mode"))&&((x=x.getElementsByTagNameNS(r,"list-level-label-alignment")[0])&&(w=x.getAttributeNS(i,"label-followed-by")),"space"===w&&(C+=' "\\a0"'))),v[y]="\n"+C+";\n",f=f.nextElementSibling}f=v,h&&!p&&c(d,m)?e.createCounterRules(f,u,d):p&&c(b[p],m)?e.createCounterRules(f,u,b[p]):e.createCounterRules(f,u),d=u}e.initialiseCreatedCounters()}var d=new core.CSSUnits,h=odf.OdfUtils;this.applyListStyles=function(t,o,s){var l;(l=o.list)&&Object.keys(l).forEach(function(o){for(var s=l[o].element.firstElementChild;s;){if(s.namespaceURI===i){for(var c=t,u=s,d='text|list[text|style-name="'+o+'"]',h=u.getAttributeNS(i,"level"),p=void 0,f=void 0,m=f=void 0,g=void 0,b=void 0,y=p=void 0,v=void 0,S=void 0,C=void 0,g=void 0,m=(f=u.getElementsByTagNameNS(r,"list-level-properties")[0])&&f.getAttributeNS(i,"list-level-position-and-space-mode"),g=f&&f.getElementsByTagNameNS(r,"list-level-label-alignment")[0],p=h=h&&parseInt(h,10);1<p;)d+=" > text|list-item > text|list",--p;switch(p=f&&f.getAttributeNS(n,"text-align")||"left"){case"end":p="right";break;case"start":p="left"}"label-alignment"===m?(b=g&&g.getAttributeNS(n,"margin-left")||"0px",S=g&&g.getAttributeNS(n,"text-indent")||"0px",C=g&&g.getAttributeNS(i,"label-followed-by"),g=a(b)):(b=f&&f.getAttributeNS(i,"space-before")||"0px",y=f&&f.getAttributeNS(i,"min-label-width")||"0px",v=f&&f.getAttributeNS(i,"min-label-distance")||"0px",g=a(b)+a(y)),f=d+" > text|list-item",f+="{",f+="margin-left: "+g+"px;",e(c,f+="}"),f=d+" > text|list-item > text|list",f+="{",f+="margin-left: "+-g+"px;",e(c,f+="}"),f=d+" > text|list-item > :not(text|list):first-child:before",f+="{",f+="text-align: "+p+";",f+="display: inline-block;","label-alignment"===m?(f+="margin-left: "+S+";","listtab"===C&&(f+="padding-right: 0.2cm;")):(f+="min-width: "+y+";",f+="margin-left: "+(0===parseFloat(y)?"":"-")+y+";",f+="padding-right: "+v+";"),e(c,f+="}")}s=s.nextElementSibling}}),u(t,s,l)}}}(),odf.LazyStyleProperties=function(e,t){var n={};this.value=function(r){var i;return n.hasOwnProperty(r)?i=n[r]:(void 0===(i=t[r]())&&e&&(i=e.value(r)),n[r]=i),i},this.reset=function(t){e=t,n={}}},odf.StyleParseUtils=function(){function e(e){var t,n;return e=(e=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px))/.exec(e))?{value:parseFloat(e[1]),unit:e[3]}:null,"px"===(n=e&&e.unit)?t=e.value:"cm"===n?t=e.value/2.54*96:"mm"===n?t=e.value/25.4*96:"in"===n?t=96*e.value:"pt"===n?t=e.value/.75:"pc"===n&&(t=16*e.value),t}var t=odf.Namespaces.stylens;this.parseLength=e,this.parsePositiveLengthOrPercent=function(t,n,r){var i,o;return t&&(i=parseFloat(t.substr(0,t.indexOf("%"))),isNaN(i)&&(i=void 0)),void 0!==i?(r&&(o=r.value(n)),i=void 0===o?void 0:o/100*i):i=e(t),i},this.getPropertiesElement=function(e,n,r){for(n=r?r.nextElementSibling:n.firstElementChild;null!==n&&(n.localName!==e||n.namespaceURI!==t);)n=n.nextElementSibling;return n},this.parseAttributeList=function(e){return e&&(e=e.replace(/^\s*(.*?)\s*$/g,"$1")),e&&0<e.length?e.split(/\s+/):[]}},odf.Style2CSS=function(){function e(t,n,r){var i,o=[];r=r.derivedStyles;var s,a=v[t];for(i in void 0===a?n=null:(s=n?"["+a+'|style-name="'+n+'"]':"","presentation"===a&&(a="draw",s=n?'[presentation|style-name="'+n+'"]':""),n=a+"|"+S[t].join(s+","+a+"|")+s),null!==n&&o.push(n),r)r.hasOwnProperty(i)&&(n=e(t,i,r[i]),o=o.concat(n));return o}function t(e){var t="",n="",t=null;return"default-style"===e.localName?null:(t=e.getAttributeNS(h,"parent-style-name"),n=e.getAttributeNS(h,"family"),t=F.getODFElementsWithXPath(a,t?"//style:*[@style:name='"+t+"'][@style:family='"+n+"']":"//style:default-style[@style:family='"+n+"']",odf.Namespaces.lookupNamespaceURI)[0])}function n(e,n){var r,i,o,s="";for(r=0;r<n.length;r+=1)if(i=n[r],o=e.getAttributeNS(i[0],i[1])){if(o=o.trim(),R.hasOwnProperty(i[1])){var a=o,l=a.indexOf(" "),c=void 0;o=void 0,-1!==l?(c=a.substring(0,l),o=a.substring(l)):(c=a,o=""),(c=I.parseLength(c))&&"pt"===c.unit&&.75>c.value&&(a="0.75pt"+o),o=a}else if(O.hasOwnProperty(i[1])){var a=e,l=i[0],c=i[1],u=I.parseLength(o),d=void 0,p=void 0,f=void 0,m=void 0,f=void 0;if(u&&"%"===u.unit){for(d=u.value/100,p=t(a.parentNode),m="0";p;){if((f=b.getDirectChild(p,h,"paragraph-properties"))&&(f=I.parseLength(f.getAttributeNS(l,c)))){if("%"!==f.unit){m=f.value*d+f.unit;break}d*=f.value/100}p=t(p)}o=m}}i[2]&&(s+=i[2]+":"+o+";")}return s}function r(e,t,n,r){return t+t+n+n+r+r}function i(e,t,n,r){function i(t,n){var r,i=[];t.forEach(function(e){o.forEach(function(t){i.push('draw|page[webodfhelper|page-style-name="'+t+'"] draw|frame[presentation|class="'+e+'"]')})}),0<i.length&&(r=i.join(",")+"{visibility:"+n+";}",e.insertRule(r,e.cssRules.length))}var o=function e(t,n){var r=[t],i=n.derivedStyles;Object.keys(i).forEach(function(t){t=e(t,i[t]),r=r.concat(t)});return r}(t,r),s=[],a=[];["page-number","date-time","header","footer"].forEach(function(e){var t;"true"===(t=n.getAttributeNS(g,"display-"+e))?s.push(e):"false"===t&&a.push(e)}),i(s,"visible"),i(a,"hidden")}function o(a,p,v,S){var R,O;if("page"===p){var F,L,B,U=S.element,z="";if(L=F="",v=b.getDirectChild(U,h,"page-layout-properties"))if(B=U.getAttributeNS(h,"name"),z+=n(v,k),(F=b.getDirectChild(v,h,"background-image"))&&(L=F.getAttributeNS(m,"href"))&&(z=z+"background-image: url('odfkit:"+L+"');"+n(F,x)),"presentation"===s)for(U=(U=b.getDirectChild(U.parentNode.parentNode,d,"master-styles"))&&U.firstElementChild;U;)U.namespaceURI===h&&"master-page"===U.localName&&U.getAttributeNS(h,"page-layout-name")===B&&(L=U.getAttributeNS(h,"name"),F='draw|page[draw|master-page-name="'+L+'"] {'+z+"}",L='office|body, draw|page[draw|master-page-name="'+L+'"] {'+n(v,P)+" }",a.insertRule(F,a.cssRules.length),a.insertRule(L,a.cssRules.length)),U=U.nextElementSibling;else"text"===s&&(F="office|text {"+z+"}",L="office|body {width: "+v.getAttributeNS(u,"page-width")+";}",a.insertRule(F,a.cssRules.length),a.insertRule(L,a.cssRules.length))}else{if(z=e(p,v,S).join(","),B="",U=b.getDirectChild(S.element,h,"text-properties")){var j=U,W=O="";switch(F="",L=1,U=""+n(j,C),"solid"===(R=j.getAttributeNS(h,"text-underline-style"))&&(O+=" underline"),"solid"===(R=j.getAttributeNS(h,"text-line-through-style"))&&(O+=" line-through"),O.length&&(U=U+"text-decoration:"+O+";\ntext-decoration-line:"+O+";\n",U+="-moz-text-decoration-line:"+O+";\n"),R=j.getAttributeNS(h,"text-line-through-type")){case"double":W+=" double";break;case"single":W+=" single"}if(W&&(U+="text-decoration-style:"+W+";\n",U+="-moz-text-decoration-style:"+W+";\n"),(O=j.getAttributeNS(h,"font-name")||j.getAttributeNS(u,"font-family"))&&(R=D[O],U+="font-family: "+(R||O)+";"),(R=j.getAttributeNS(h,"text-position"))&&(O=y.parseAttributeList(R),R=O[0],O=O[1],U+="vertical-align: "+R+"\n; ",O&&(L=parseFloat(O)/100)),j.hasAttributeNS(u,"font-size")||1!==L){for(j=j.parentNode;j;){if(R=(R=b.getDirectChild(j,h,"text-properties"))?I.parseFoFontSize(R.getAttributeNS(u,"font-size")):null){if("%"!==R.unit){F="font-size: "+R.value*L+R.unit+";";break}L*=R.value/100}j=t(j)}F||(F="font-size: "+parseFloat(l)*L+M.getUnits(l)+";")}B+=U+=F}(U=b.getDirectChild(S.element,h,"paragraph-properties"))&&(U=""+n(F=U,A),(L=b.getDirectChild(F,h,"background-image"))&&(j=L.getAttributeNS(m,"href"))&&(U=U+"background-image: url('odfkit:"+j+"');"+n(L,x)),(F=F.getAttributeNS(u,"line-height"))&&"normal"!==F&&(F=I.parseFoLineHeight(F),U="%"!==F.unit?U+"line-height: "+F.value+F.unit+";":U+"line-height: "+F.value/100+";"),B+=U),(U=b.getDirectChild(S.element,h,"graphic-properties"))&&(U=""+n(j=U,w),F=j.getAttributeNS(c,"opacity"),L=j.getAttributeNS(c,"fill"),j=j.getAttributeNS(c,"fill-color"),"solid"===L||"hatch"===L?j&&"none"!==j?(F=isNaN(parseFloat(F))?1:parseFloat(F)/100,L=j.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,r),(j=(L=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(L))?{r:parseInt(L[1],16),g:parseInt(L[2],16),b:parseInt(L[3],16)}:null)&&(U+="background-color: rgba("+j.r+","+j.g+","+j.b+","+F+");")):U+="background: none;":"none"===L&&(U+="background: none;"),B+=U),(U=b.getDirectChild(S.element,h,"drawing-page-properties"))&&(L=""+n(F=U,w),"true"===F.getAttributeNS(g,"background-visible")&&(L+="background: none;"),B+=L,i(a,v,U,S)),(U=b.getDirectChild(S.element,h,"table-cell-properties"))&&(v=B,B=""+n(U,_),B=v+B),(U=b.getDirectChild(S.element,h,"table-row-properties"))&&(v=B,B=""+n(U,E),B=v+B),(U=b.getDirectChild(S.element,h,"table-column-properties"))&&(v=B,B=""+n(U,N),B=v+B),(U=b.getDirectChild(S.element,h,"table-properties"))&&(v=B,B=""+n(U,T),"collapsing"===(U=U.getAttributeNS(f,"border-model"))?B+="border-collapse:collapse;":"separating"===U&&(B+="border-collapse:separate;"),B=v+B),0!==B.length&&a.insertRule(z+"{"+B+"}",a.cssRules.length)}for(var H in S.derivedStyles)S.derivedStyles.hasOwnProperty(H)&&o(a,p,H,S.derivedStyles[H])}var s,a,l,c=odf.Namespaces.drawns,u=odf.Namespaces.fons,d=odf.Namespaces.officens,h=odf.Namespaces.stylens,p=odf.Namespaces.svgns,f=odf.Namespaces.tablens,m=odf.Namespaces.xlinkns,g=odf.Namespaces.presentationns,b=core.DomUtils,y=new odf.StyleParseUtils,v={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"},S={graphic:"circle connected control custom-shape ellipse frame g line measure page page-thumbnail path polygon polyline rect regular-polygon".split(" "),paragraph:"alphabetical-index-entry-template h illustration-index-entry-template index-source-style object-index-entry-template p table-index-entry-template table-of-content-entry-template user-index-entry-template".split(" "),presentation:"caption circle connector control custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),"drawing-page":"caption circle connector control page custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),ruby:["ruby","ruby-text"],section:"alphabetical-index bibliography illustration-index index-title object-index section table-of-content table-index user-index".split(" "),table:["background","table"],"table-cell":"body covered-table-cell even-columns even-rows first-column first-row last-column last-row odd-columns odd-rows table-cell".split(" "),"table-column":["table-column"],"table-row":["table-row"],text:"a index-entry-chapter index-entry-link-end index-entry-link-start index-entry-page-number index-entry-span index-entry-tab-stop index-entry-text index-title-template linenumbering-configuration list-level-style-number list-level-style-bullet outline-level-style span".split(" "),list:["list-item"]},C=[[u,"color","color"],[u,"background-color","background-color"],[u,"font-weight","font-weight"],[u,"font-style","font-style"]],x=[[h,"repeat","background-repeat"]],A=[[u,"background-color","background-color"],[u,"text-align","text-align"],[u,"text-indent","text-indent"],[u,"padding","padding"],[u,"padding-left","padding-left"],[u,"padding-right","padding-right"],[u,"padding-top","padding-top"],[u,"padding-bottom","padding-bottom"],[u,"border-left","border-left"],[u,"border-right","border-right"],[u,"border-top","border-top"],[u,"border-bottom","border-bottom"],[u,"margin","margin"],[u,"margin-left","margin-left"],[u,"margin-right","margin-right"],[u,"margin-top","margin-top"],[u,"margin-bottom","margin-bottom"],[u,"border","border"]],w=[[u,"background-color","background-color"],[u,"min-height","min-height"],[c,"stroke","border"],[p,"stroke-color","border-color"],[p,"stroke-width","border-width"],[u,"border","border"],[u,"border-left","border-left"],[u,"border-right","border-right"],[u,"border-top","border-top"],[u,"border-bottom","border-bottom"]],_=[[u,"background-color","background-color"],[u,"border-left","border-left"],[u,"border-right","border-right"],[u,"border-top","border-top"],[u,"border-bottom","border-bottom"],[u,"border","border"]],N=[[h,"column-width","width"]],E=[[h,"row-height","height"],[u,"keep-together",null]],T=[[h,"width","width"],[u,"margin-left","margin-left"],[u,"margin-right","margin-right"],[u,"margin-top","margin-top"],[u,"margin-bottom","margin-bottom"]],k=[[u,"background-color","background-color"],[u,"padding","padding"],[u,"padding-left","padding-left"],[u,"padding-right","padding-right"],[u,"padding-top","padding-top"],[u,"padding-bottom","padding-bottom"],[u,"border","border"],[u,"border-left","border-left"],[u,"border-right","border-right"],[u,"border-top","border-top"],[u,"border-bottom","border-bottom"],[u,"margin","margin"],[u,"margin-left","margin-left"],[u,"margin-right","margin-right"],[u,"margin-top","margin-top"],[u,"margin-bottom","margin-bottom"]],P=[[u,"page-width","width"],[u,"page-height","height"]],R={border:!0,"border-left":!0,"border-right":!0,"border-top":!0,"border-bottom":!0,"stroke-width":!0},O={margin:!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"margin-bottom":!0},D={},I=odf.OdfUtils,F=xmldom.XPath,M=new core.CSSUnits;this.style2css=function(e,t,n,r,i){function c(e,t){u="@namespace "+e+" url("+t+");";try{n.insertRule(u,n.cssRules.length)}catch(e){}}var u,d,h;for(a=t;n.cssRules.length;)n.deleteRule(n.cssRules.length-1);for(h in odf.Namespaces.forEachPrefix(c),c("webodfhelper","urn:webodf:names:helper"),D=r,s=e,l=runtime.getWindow().getComputedStyle(document.body,null).getPropertyValue("font-size")||"12pt",v)if(v.hasOwnProperty(h))for(d in e=i[h])e.hasOwnProperty(d)&&o(n,h,d,e[d])}},function(){function e(t,n){var r=this;this.getDistance=function(e){var t=r.x-e.x;return e=r.y-e.y,Math.sqrt(t*t+e*e)},this.getCenter=function(t){return new e((r.x+t.x)/2,(r.y+t.y)/2)},r.x=t,r.y=n}gui.ZoomHelper=function(){function t(e,t,n,r){e=r?"translate3d("+e+"px, "+t+"px, 0) scale3d("+n+", "+n+", 1)":"translate("+e+"px, "+t+"px) scale("+n+")",h.style.WebkitTransform=e,h.style.MozTransform=e,h.style.msTransform=e,h.style.OTransform=e,h.style.transform=e}function n(e){e?t(-p.x,-p.y,g,!0):(t(0,0,g,!0),t(0,0,g,!1))}function r(e){if(y&&A){var t=y.style.overflow,n=y.classList.contains("webodf-customScrollbars");e&&n||!e&&!n||(e?(y.classList.add("webodf-customScrollbars"),y.style.overflow="hidden",runtime.requestAnimationFrame(function(){y.style.overflow=t})):y.classList.remove("webodf-customScrollbars"))}}function i(){t(-p.x,-p.y,g,!0),y.scrollLeft=0,y.scrollTop=0,w=v.style.overflow,v.style.overflow="visible",r(!1)}function o(){t(0,0,g,!0),y.scrollLeft=p.x,y.scrollTop=p.y,v.style.overflow=w||"",r(!0)}function s(t){return new e(t.pageX-h.offsetLeft,t.pageY-h.offsetTop)}function a(t){if(f){p.x-=t.x-f.x,p.y-=t.y-f.y;var n=p;p=new e(Math.min(Math.max(n.x,h.offsetLeft),(h.offsetLeft+h.offsetWidth)*g-y.clientWidth),Math.min(Math.max(n.y,h.offsetTop),(h.offsetTop+h.offsetHeight)*g-y.clientHeight))}f=t}function l(e){var t=e.touches.length,n=0<t?s(e.touches[0]):null;e=1<t?s(e.touches[1]):null,n&&e?(m=n.getDistance(e),b=g,f=n.getCenter(e),i(),x=C.PINCH):n&&(f=n,x=C.SCROLL)}function c(e){var t=e.touches.length,r=0<t?s(e.touches[0]):null,t=1<t?s(e.touches[1]):null;if(r&&t)if(e.preventDefault(),x===C.SCROLL)x=C.PINCH,i(),m=r.getDistance(t);else{e=r.getCenter(t),r=r.getDistance(t)/m,a(e);var t=g,l=Math.min(4,h.offsetParent.clientWidth/h.offsetWidth);g=b*r,g=Math.min(Math.max(g,l),4),r=g/t,p.x+=(r-1)*(e.x+p.x),p.y+=(r-1)*(e.y+p.y),n(!0)}else r&&(x===C.PINCH?(x=C.SCROLL,o()):a(r))}function u(){x===C.PINCH&&(S.emit(gui.ZoomHelper.signalZoomChanged,g),o(),n(!1)),x=C.NONE}function d(){y&&(y.removeEventListener("touchstart",l,!1),y.removeEventListener("touchmove",c,!1),y.removeEventListener("touchend",u,!1))}var h,p,f,m,g,b,y,v,S=new core.EventNotifier([gui.ZoomHelper.signalZoomChanged]),C={NONE:0,SCROLL:1,PINCH:2},x=C.NONE,A=runtime.getWindow().hasOwnProperty("ontouchstart"),w="";this.subscribe=function(e,t){S.subscribe(e,t)},this.unsubscribe=function(e,t){S.unsubscribe(e,t)},this.getZoomLevel=function(){return g},this.setZoomLevel=function(e){h&&(g=e,n(!1),S.emit(gui.ZoomHelper.signalZoomChanged,g))},this.destroy=function(e){d(),r(!1),e()},this.setZoomableElement=function(e){d(),y=(h=e).offsetParent,v=h.parentNode,n(!1),y&&(y.addEventListener("touchstart",l,!1),y.addEventListener("touchmove",c,!1),y.addEventListener("touchend",u,!1)),r(!0)},b=g=1,p=new e(0,0)},gui.ZoomHelper.signalZoomChanged="zoomChanged"}(),ops.Canvas=function(){},ops.Canvas.prototype.getZoomLevel=function(){},ops.Canvas.prototype.getElement=function(){},ops.Canvas.prototype.getSizer=function(){},ops.Canvas.prototype.getZoomHelper=function(){},function(){function e(){var e=[],t=!1;this.clearQueue=function(){e.length=0},this.addToQueue=function(n){if(0===e.length&&!t)return function n(r){t=!0;runtime.setTimeout(function(){try{r()}catch(e){runtime.log(String(e)+"\n"+e.stack)}t=!1,0<e.length&&n(e.pop())},10)}(n);e.push(n)}}function t(e){for(var t=(e=e.sheet).cssRules;t.length;)e.deleteRule(t.length-1)}function n(e,t,n){var r=new odf.Style2CSS,i=new odf.ListStyleToCss;n=n.sheet;var o=new odf.StyleTree(e.rootElement.styles,e.rootElement.automaticStyles).getStyleTree();r.style2css(e.getDocumentType(),e.rootElement,n,t.getFontMap(),o),i.applyListStyles(n,o,e.rootElement.body)}function r(e,t,n){var r,i=null;if(e=e.rootElement.body.getElementsByTagNameNS(y,n+"-decl"),(n=t.getAttributeNS(y,"use-"+n+"-name"))&&0<e.length)for(t=0;t<e.length;t+=1)if((r=e[t]).getAttributeNS(y,"name")===n){i=r.textContent;break}return i}function i(e,t,n,r){var i=e.ownerDocument;for(t=S.getElementsByTagNameNS(e,t,n),e=0;e<t.length;e+=1)S.removeAllChildNodes(t[e]),r&&(n=t[e]).appendChild(i.createTextNode(r))}function o(e,t,n){t.setAttributeNS("urn:webodf:names:helper","styleid",e);var r,i=t.getAttributeNS(g,"anchor-type"),o=t.getAttributeNS(f,"x"),s=t.getAttributeNS(f,"y"),a=t.getAttributeNS(f,"width"),l=t.getAttributeNS(f,"height"),c=t.getAttributeNS(d,"min-height"),u=t.getAttributeNS(d,"min-width");"as-char"===i?r="display: inline-block;":i||o||s?r="position: absolute;":(a||l||c||u)&&(r="display: block;"),o&&(r+="left: "+o+";"),s&&(r+="top: "+s+";"),a&&(r+="width: "+a+";"),l&&(r+="height: "+l+";"),c&&(r+="min-height: "+c+";"),u&&(r+="min-width: "+u+";"),r&&(r="draw|"+t.localName+'[webodfhelper|styleid="'+e+'"] {'+r+"}",n.insertRule(r,n.cssRules.length))}function s(e){for(e=e.firstChild;e;){if(e.namespaceURI===h&&"binary-data"===e.localName)return"data:image/png;base64,"+e.textContent.replace(/[\r\n\s]/g,"");e=e.nextSibling}return""}function a(e,t,n,r){function i(t){t&&(t='draw|image[webodfhelper|styleid="'+e+'"] {background-image: url('+t+");}",r.insertRule(t,r.cssRules.length))}n.setAttributeNS("urn:webodf:names:helper","styleid",e);var o,a=n.getAttributeNS(b,"href");if(a)try{(o=t.getPart(a)).onchange=function(e){i(e.url)},o.load()}catch(e){runtime.log("slight problem: "+String(e))}else i(a=s(n))}function l(e,t){function n(e,n){var o=l.documentElement.namespaceURI;"video/"===n.substr(0,6)?((r=l.createElementNS(o,"video")).setAttribute("controls","controls"),i=l.createElementNS(o,"source"),e&&i.setAttribute("src",e),i.setAttribute("type",n),r.appendChild(i),t.parentNode.appendChild(r)):t.innerHtml="Unrecognised Plugin"}var r,i,o,a,l=t.ownerDocument;if(o=t.getAttributeNS(b,"href"))try{(a=e.getPart(o)).onchange=function(e){n(e.url,e.mimetype)},a.load()}catch(e){runtime.log("slight problem: "+String(e))}else runtime.log("using MP4 data fallback"),n(o=s(t),"video/mp4")}function c(e){var t=e.getElementsByTagName("head")[0],n=e.createElementNS(t.namespaceURI,"style"),r="";return n.setAttribute("type","text/css"),n.setAttribute("media","screen, print, handheld, projection"),odf.Namespaces.forEachPrefix(function(e,t){r+="@namespace "+e+" url("+t+");\n"}),r+="@namespace webodfhelper url(urn:webodf:names:helper);\n",n.appendChild(e.createTextNode(r)),t.appendChild(n),n}var u=odf.Namespaces.drawns,d=odf.Namespaces.fons,h=odf.Namespaces.officens,p=odf.Namespaces.stylens,f=odf.Namespaces.svgns,m=odf.Namespaces.tablens,g=odf.Namespaces.textns,b=odf.Namespaces.xlinkns,y=odf.Namespaces.presentationns,v=xmldom.XPath,S=core.DomUtils;odf.OdfCanvas=function(s,d){function f(e,t,n){function r(e,t,n,r){V.addToQueue(function(){a(e,t,n,r)})}var i,o;for(i=t.getElementsByTagNameNS(u,"image"),t=0;t<i.length;t+=1)o=i.item(t),r("image"+String(t),e,o,n)}function b(e,t){function n(e,t){V.addToQueue(function(){l(e,t)})}var r,i,o;for(i=t.getElementsByTagNameNS(u,"plugin"),r=0;r<i.length;r+=1)o=i.item(r),n(e,o)}function C(){var e;e=L.firstChild;var t=G.getZoomLevel();e&&(L.style.WebkitTransformOrigin="0% 0%",L.style.MozTransformOrigin="0% 0%",L.style.msTransformOrigin="0% 0%",L.style.OTransformOrigin="0% 0%",L.style.transformOrigin="0% 0%",j&&((e=j.getMinimumHeightForAnnotationPane())?L.style.minHeight=e:L.style.removeProperty("min-height")),s.style.width=Math.round(t*L.offsetWidth)+"px",s.style.height=Math.round(t*L.offsetHeight)+"px",s.style.display="inline-block")}function x(e,t){var n=P.sheet;S.removeAllChildNodes(s),(L=F.createElementNS(s.namespaceURI,"div")).style.display="inline-block",L.style.background="white",L.style.setProperty("float","left","important"),L.appendChild(t),s.appendChild(L),(B=F.createElementNS(s.namespaceURI,"div")).id="annotationsPane",(R=F.createElementNS(s.namespaceURI,"div")).id="shadowContent",R.style.position="absolute",R.style.top=0,R.style.left=0,e.getContentElement().appendChild(R);var a,l,c=t.body,d=[];for(a=c.firstElementChild;a&&a!==c;)if(a.namespaceURI===u&&(d[d.length]=a),a.firstElementChild)a=a.firstElementChild;else{for(;a&&a!==c&&!a.nextElementSibling;)a=a.parentNode;a&&a.nextElementSibling&&(a=a.nextElementSibling)}for(l=0;l<d.length;l+=1)a=d[l],o("frame"+String(l),a,n);for(d=v.getODFElementsWithXPath(c,".//*[*[@text:anchor-type='paragraph']]",odf.Namespaces.lookupNamespaceURI),a=0;a<d.length;a+=1)(c=d[a]).setAttributeNS&&c.setAttributeNS("urn:webodf:names:helper","containsparagraphanchor",!0);c=M,a=R;var C,x,A,w,_,N=0;if(l=e.rootElement.ownerDocument,(d=t.body.firstElementChild)&&d.namespaceURI===h&&("presentation"===d.localName||"drawing"===d.localName))for(d=d.firstElementChild;d;){if(C=(C=d.getAttributeNS(u,"master-page-name"))?c.getMasterPageElement(C):null){for(x=d.getAttributeNS("urn:webodf:names:helper","styleid"),A=l.createElementNS(u,"draw:page"),_=C.firstElementChild,N=0;_;)"true"!==_.getAttributeNS(y,"placeholder")&&(w=_.cloneNode(!0),A.appendChild(w)),_=_.nextElementSibling,N+=1;_=w=N=void 0;for(var E=S.getElementsByTagNameNS(A,u,"frame"),N=0;N<E.length;N+=1)w=E[N],(_=w.getAttributeNS(y,"class"))&&!/^(date-time|footer|header|page-number)$/.test(_)&&w.parentNode.removeChild(w);for(w=S.getElementsByTagNameNS(A,u,"*"),N=0;N<w.length;N+=1)o(x+"_"+N,w[N],n);a.appendChild(A),N=String(a.getElementsByTagNameNS(u,"page").length),i(A,g,"page-number",N),i(A,y,"header",r(e,d,"header")),i(A,y,"footer",r(e,d,"footer")),o(x,A,n),A.setAttributeNS("urn:webodf:names:helper","page-style-name",d.getAttributeNS(u,"style-name")),A.setAttributeNS(u,"draw:master-page-name",C.getAttributeNS(p,"name"))}d=d.nextElementSibling}for(c=s.namespaceURI,d=S.getElementsByTagNameNS(t.body,m,"table-cell"),a=0;a<d.length;a+=1)(l=d[a]).hasAttributeNS(m,"number-columns-spanned")&&l.setAttributeNS(c,"colspan",l.getAttributeNS(m,"number-columns-spanned")),l.hasAttributeNS(m,"number-rows-spanned")&&l.setAttributeNS(c,"rowspan",l.getAttributeNS(m,"number-rows-spanned"));!function(e){var t=e.ownerDocument;S.getElementsByTagNameNS(e,g,"line-break").forEach(function(e){e.hasChildNodes()||e.appendChild(t.createElement("br"))})}(t.body),function(e){var t=e.ownerDocument;S.getElementsByTagNameNS(e,g,"s").forEach(function(e){var n,r;if(S.removeAllChildNodes(e),e.appendChild(t.createTextNode(" ")),1<(r=parseInt(e.getAttributeNS(g,"c"),10)))for(e.removeAttributeNS(g,"c"),n=1;n<r;n+=1)e.parentNode.insertBefore(e.cloneNode(!0),e)})}(t.body),function(e){S.getElementsByTagNameNS(e,g,"tab").forEach(function(e){e.textContent="\t"})}(t.body),f(e,t.body,n),b(e,t.body),L.insertBefore(R,L.firstChild),G.setZoomableElement(L)}function A(e){U?(B.parentNode||L.appendChild(B),j&&j.forgetAnnotations(),j=new gui.AnnotationViewManager(I,e.body,B,z),e=S.getElementsByTagNameNS(e.body,h,"annotation"),j.addAnnotations(e),C()):B.parentNode&&(L.removeChild(B),j.forgetAnnotations(),C())}function w(e){function r(){t(T),t(k),t(P),S.removeAllChildNodes(s),s.style.display="inline-block";var r=_.rootElement;s.ownerDocument.importNode(r,!0),M.setOdfContainer(_),function(e,t){(new odf.FontLoader).loadFonts(e,t.sheet)}(_,T),n(_,M,k),x(_,r),A(r),e||V.addToQueue(function(){var e=[_];if(W.hasOwnProperty("statereadychange")){var t,n=W.statereadychange;for(t=0;t<n.length;t+=1)n[t].apply(null,e)}})}_.state===odf.OdfContainer.DONE?r():(runtime.log("WARNING: refreshOdf called but ODF was not DONE."),O=runtime.setTimeout(function e(){_.state===odf.OdfContainer.DONE?r():(runtime.log("will be back later..."),O=runtime.setTimeout(e,500))},100))}runtime.assert(null!==s&&void 0!==s,"odf.OdfCanvas constructor needs DOM element"),runtime.assert(null!==s.ownerDocument&&void 0!==s.ownerDocument,"odf.OdfCanvas constructor needs DOM");var _,N,E,T,k,P,R,O,D,I=this,F=s.ownerDocument,M=new odf.Formatting,L=null,B=null,U=!1,z=!1,j=null,W={},H=!1,q=!1,V=new e,G=new gui.ZoomHelper,X=d||new gui.SingleScrollViewport(s.parentNode);this.refreshCSS=function(){H=!0,D.trigger()},this.refreshSize=function(){D.trigger()},this.odfContainer=function(){return _},this.setOdfContainer=function(e,t){_=e,w(!0===t)},this.load=this.load=function(e){V.clearQueue(),S.removeAllChildNodes(s),s.appendChild(s.ownerDocument.createTextNode(runtime.tr("Loading")+e+"...")),s.removeAttribute("style"),_=new odf.OdfContainer(e,function(e){_=e,w(!1)})},this.save=function(e){_.save(e)},this.addListener=function(e,t){switch(e){case"click":var n=e;s.addEventListener?s.addEventListener(n,t,!1):s.attachEvent?s.attachEvent("on"+n,t):s["on"+n]=t;break;default:n=W.hasOwnProperty(e)?W[e]:W[e]=[],t&&-1===n.indexOf(t)&&n.push(t)}},this.getFormatting=function(){return M},this.getAnnotationViewManager=function(){return j},this.refreshAnnotations=function(){A(_.rootElement)},this.rerenderAnnotations=function(){j&&(q=!0,D.trigger())},this.getSizer=function(){return L},this.enableAnnotations=function(e,t){e!==U&&(U=e,z=t,_&&A(_.rootElement))},this.addAnnotation=function(e){j&&(j.addAnnotations([e]),C())},this.forgetAnnotation=function(e){j&&(j.forgetAnnotation(e),C())},this.getZoomHelper=function(){return G},this.setZoomLevel=function(e){G.setZoomLevel(e)},this.getZoomLevel=function(){return G.getZoomLevel()},this.fitToContainingElement=function(e,t){var n=G.getZoomLevel(),r=s.offsetHeight/n,n=e/(s.offsetWidth/n);t/r<n&&(n=t/r),G.setZoomLevel(n)},this.fitToWidth=function(e){var t=s.offsetWidth/G.getZoomLevel();G.setZoomLevel(e/t)},this.fitSmart=function(e,t){var n,r;r=G.getZoomLevel(),n=s.offsetWidth/r,r=s.offsetHeight/r,n=e/n,void 0!==t&&t/r<n&&(n=t/r),G.setZoomLevel(Math.min(1,n))},this.fitToHeight=function(e){var t=s.offsetHeight/G.getZoomLevel();G.setZoomLevel(e/t)},this.showFirstPage=function(){N.showFirstPage()},this.showNextPage=function(){N.showNextPage()},this.showPreviousPage=function(){N.showPreviousPage()},this.showPage=function(e){N.showPage(e),C()},this.getElement=function(){return s},this.getViewport=function(){return X},this.addCssForFrameWithImage=function(e){var t=e.getAttributeNS(u,"name"),n=e.firstElementChild;o(t,e,P.sheet),n&&a(t+"img",_,n,P.sheet)},this.destroy=function(e){var t=F.getElementsByTagName("head")[0],n=[N.destroy,D.destroy];runtime.clearTimeout(O),B&&B.parentNode&&B.parentNode.removeChild(B),G.destroy(function(){L&&(s.removeChild(L),L=null)}),function(e){var t=parseInt(e.getAttribute("webodfcss"),10);1===t?e.parentNode.removeChild(e):e.setAttribute("count",t-1)}(E),t.removeChild(T),t.removeChild(k),t.removeChild(P),core.Async.destroyAll(n,e)},E=function(e){var t,n,r=e.getElementsByTagName("head")[0];for(t=e.styleSheets.length,n=r.firstElementChild;n&&("style"!==n.localName||!n.hasAttribute("webodfcss"));)n=n.nextElementSibling;return n?(t=parseInt(n.getAttribute("webodfcss"),10),n.setAttribute("webodfcss",t+1),n):("string"===String(typeof webodf_css)?t=webodf_css:(n="webodf.css",runtime.currentDirectory&&(0<(n=runtime.currentDirectory()).length&&"/"!==n.substr(-1)&&(n+="/"),n+="../webodf.css"),t=runtime.readFileSync(n,"utf-8")),(n=e.createElementNS(r.namespaceURI,"style")).setAttribute("media","screen, print, handheld, projection"),n.setAttribute("type","text/css"),n.setAttribute("webodfcss","1"),n.appendChild(e.createTextNode(t)),r.appendChild(n),n)}(F),N=new function(e){function t(){for(;0<n.cssRules.length;)n.deleteRule(0);n.insertRule("#shadowContent draw|page {display:none;}",0),n.insertRule("office|presentation draw|page {display:none;}",1),n.insertRule("#shadowContent draw|page:nth-of-type("+r+") {display:block;}",2),n.insertRule("office|presentation draw|page:nth-of-type("+r+") {display:block;}",3)}var n=e.sheet,r=1;this.showFirstPage=function(){r=1,t()},this.showNextPage=function(){r+=1,t()},this.showPreviousPage=function(){1<r&&(--r,t())},this.showPage=function(e){0<e&&(r=e,t())},this.css=e,this.destroy=function(t){e.parentNode.removeChild(e),t()}}(c(F)),T=c(F),k=c(F),P=c(F),D=core.Task.createRedrawTask(function(){H&&(n(_,M,k),H=!1),q&&(j&&j.rerenderAnnotations(),q=!1),C()}),G.subscribe(gui.ZoomHelper.signalZoomChanged,C)}}(),odf.StepUtils=function(){this.getContentBounds=function(e){var t,n,r=e.container();return runtime.assert(e.isStep(),"Step iterator must be on a step"),r.nodeType===Node.TEXT_NODE&&0<e.offset()?t=e.offset():(r=e.leftNode())&&r.nodeType===Node.TEXT_NODE&&(t=r.length),r&&(r.nodeType===Node.TEXT_NODE?(runtime.assert(0<t,"Empty text node found"),n={container:r,startOffset:t-1,endOffset:t}):n={container:r,startOffset:0,endOffset:r.childNodes.length}),n}},ops.MemberProperties=function(){},ops.Member=function(e,t){var n=new ops.MemberProperties;this.getMemberId=function(){return e},this.getProperties=function(){return n},this.setProperties=function(e){Object.keys(e).forEach(function(t){n[t]=e[t]})},this.removeProperties=function(e){Object.keys(e).forEach(function(e){"fullName"!==e&&"color"!==e&&"imageUrl"!==e&&n.hasOwnProperty(e)&&delete n[e]})},runtime.assert(Boolean(e),"No memberId was supplied!"),t.fullName||(t.fullName=runtime.tr("Unknown Author")),t.color||(t.color="black"),t.imageUrl||(t.imageUrl="avatar-joe.png"),n=t},ops.Document=function(){},ops.Document.prototype.getMemberIds=function(){},ops.Document.prototype.removeCursor=function(e){},ops.Document.prototype.getDocumentElement=function(){},ops.Document.prototype.getRootNode=function(){},ops.Document.prototype.getDOMDocument=function(){},ops.Document.prototype.cloneDocumentElement=function(){},ops.Document.prototype.setDocumentElement=function(e){},ops.Document.prototype.subscribe=function(e,t){},ops.Document.prototype.unsubscribe=function(e,t){},ops.Document.prototype.getCanvas=function(){},ops.Document.prototype.createRootFilter=function(e){},ops.Document.prototype.createPositionIterator=function(e){},ops.Document.prototype.hasCursor=function(e){},ops.Document.signalCursorAdded="cursor/added",ops.Document.signalCursorRemoved="cursor/removed",ops.Document.signalCursorMoved="cursor/moved",ops.Document.signalMemberAdded="member/added",ops.Document.signalMemberUpdated="member/updated",ops.Document.signalMemberRemoved="member/removed",ops.OdtCursor=function(e,t){var n,r,i=this,o={},s=new core.EventNotifier([ops.OdtCursor.signalCursorUpdated]);this.removeFromDocument=function(){r.remove()},this.subscribe=function(e,t){s.subscribe(e,t)},this.unsubscribe=function(e,t){s.unsubscribe(e,t)},this.getMemberId=function(){return e},this.getNode=function(){return r.getNode()},this.getAnchorNode=function(){return r.getAnchorNode()},this.getSelectedRange=function(){return r.getSelectedRange()},this.setSelectedRange=function(e,t){r.setSelectedRange(e,t),s.emit(ops.OdtCursor.signalCursorUpdated,i)},this.hasForwardSelection=function(){return r.hasForwardSelection()},this.getDocument=function(){return t},this.getSelectionType=function(){return n},this.setSelectionType=function(e){o.hasOwnProperty(e)?n=e:runtime.log("Invalid selection type: "+e)},this.resetSelectionType=function(){i.setSelectionType(ops.OdtCursor.RangeSelection)},r=new core.Cursor(t.getDOMDocument(),e),o[ops.OdtCursor.RangeSelection]=!0,o[ops.OdtCursor.RegionSelection]=!0,i.resetSelectionType()},ops.OdtCursor.RangeSelection="Range",ops.OdtCursor.RegionSelection="Region",ops.OdtCursor.signalCursorUpdated="cursorUpdated",function(){var e=0;ops.StepsCache=function(t,n,r){function i(e,t){var n=this;this.nodeId=e,this.steps=-1,this.node=t,this.previousBookmark=this.nextBookmark=null,this.setIteratorPosition=function(e){e.setPositionBeforeElement(t),r(n.steps,e)}}function o(e,t){var n="["+e.nodeId;return t&&(n+=" => "+t.nodeId),n+"]"}function s(){if(!0===ops.StepsCache.ENABLE_CACHE_VERIFICATION){for(var e,n,r,i=h,s=new core.LoopWatchDog(0,1e5),a={};i;)s.check(),(e=i.previousBookmark)?runtime.assert(e.nextBookmark===i,"Broken bookmark link to previous @"+o(e,i)):(runtime.assert(i===h,"Broken bookmark link @"+o(i)),runtime.assert(void 0===p||h==h||h.steps<=p,"Base point is damaged @"+o(i))),(n=i.nextBookmark)&&runtime.assert(n.previousBookmark===i,"Broken bookmark link to next @"+o(i,n)),(void 0===p||i===h||i.steps<=p)&&(runtime.assert(g.containsNode(t,i.node),"Disconnected node is being reported as undamaged @"+o(i)),e&&(r=i.node.compareDocumentPosition(e.node),runtime.assert(0===r||0!=(r&y),"Bookmark order with previous does not reflect DOM order @"+o(e,i))),n&&g.containsNode(t,n.node)&&(r=i.node.compareDocumentPosition(n.node),runtime.assert(0===r||0!=(r&b),"Bookmark order with next does not reflect DOM order @"+o(i,n)))),i=i.nextBookmark;Object.keys(f).forEach(function(e){var t=f[e];(void 0===p||e<=p)&&runtime.assert(t.steps<=e,"Bookmark step of "+t.steps+" exceeds cached step lookup for "+e+" @"+o(t)),runtime.assert(!1===a.hasOwnProperty(t.nodeId),"Bookmark "+o(t)+" appears twice in cached step lookup at steps "+a[t.nodeId]+" and "+e),a[t.nodeId]=e})}}function a(e){var t="";return e.nodeType===Node.ELEMENT_NODE&&(t=e.getAttributeNS("urn:webodf:names:steps","nodeId")||""),t}function l(t){var n=e.toString();return t.setAttributeNS("urn:webodf:names:steps","nodeId",n),e+=1,n}function c(e){var t,r,i=new core.LoopWatchDog(0,1e4);for(void 0!==p&&e>p&&(e=p),t=Math.floor(e/n)*n;!r&&0<=t;)r=f[t],t-=n;for(r=r||h;r.nextBookmark&&r.nextBookmark.steps<=e;)i.check(),r=r.nextBookmark;return runtime.assert(-1===e||r.steps<=e,"Bookmark @"+o(r)+" at step "+r.steps+" exceeds requested step of "+e),r}function u(e){e.previousBookmark&&(e.previousBookmark.nextBookmark=e.nextBookmark),e.nextBookmark&&(e.nextBookmark.previousBookmark=e.previousBookmark)}function d(e){for(var n,r=null;!r&&e&&e!==t;)(n=a(e))&&(r=m[n])&&r.node!==e&&(runtime.log("Cloned node detected. Creating new bookmark"),r=null,e.removeAttributeNS("urn:webodf:names:steps","nodeId")),e=e.parentNode;return r}var h,p,f={},m={},g=core.DomUtils,b=Node.DOCUMENT_POSITION_FOLLOWING,y=Node.DOCUMENT_POSITION_PRECEDING;this.updateBookmark=function(e,r){var o,d,y,v,S=Math.ceil(e/n)*n;if(void 0!==p&&p<e){for(d=c(p),y=d.nextBookmark;y&&y.steps<=e;)o=y.nextBookmark,v=Math.ceil(y.steps/n)*n,f[v]===y&&delete f[v],g.containsNode(t,y.node)?y.steps=e+1:(u(y),delete m[y.nodeId]),y=o;p=e}else d=c(e);if(y=a(r)||l(r),(o=m[y])?o.node!==r&&(runtime.log("Cloned node detected. Creating new bookmark"),y=l(r),o=m[y]=new i(y,r)):o=m[y]=new i(y,r),(y=o).steps!==e&&((o=Math.ceil(y.steps/n)*n)!==S&&f[o]===y&&delete f[o],y.steps=e),d!==y&&d.nextBookmark!==y){if(d.steps===y.steps)for(;0!=(y.node.compareDocumentPosition(d.node)&b)&&d!==h;)d=d.previousBookmark;d!==y&&d.nextBookmark!==y&&(u(y),o=d.nextBookmark,y.nextBookmark=d.nextBookmark,y.previousBookmark=d,d.nextBookmark=y,o&&(o.previousBookmark=y))}(!(d=f[S])||y.steps>d.steps)&&(f[S]=y),s()},this.setToClosestStep=function(e,t){var n;return s(),(n=c(e)).setIteratorPosition(t),n.steps},this.setToClosestDomPoint=function(e,n,r){var i,o;if(s(),e===t&&0===n)i=h;else if(e===t&&n===t.childNodes.length)for(o in i=h,f)f.hasOwnProperty(o)&&((e=f[o]).steps>i.steps&&(i=e));else if(!(i=d(e.childNodes.item(n)||e)))for(r.setUnfilteredPosition(e,n);!i&&r.previousNode();)i=d(r.getCurrentNode());return i=i||h,void 0!==p&&i.steps>p&&(i=c(p)),i.setIteratorPosition(r),i.steps},this.damageCacheAfterStep=function(e){0>e&&(e=-1),void 0===p?p=e:e<p&&(p=e),s()},function(){var e=a(t)||l(t);h=new function(e,t,n){var i=this;this.nodeId=e,this.steps=t,this.node=n,this.previousBookmark=this.nextBookmark=null,this.setIteratorPosition=function(e){e.setUnfilteredPosition(n,0),r(i.steps,e)}}(e,0,t)}()},ops.StepsCache.ENABLE_CACHE_VERIFICATION=!1,ops.StepsCache.Bookmark=function(){},ops.StepsCache.Bookmark.prototype.setIteratorPosition=function(e){}}(),ops.OdtStepsTranslator=function(e,t,n,r){function i(e,t,n){var r=t.getCurrentNode();t.isBeforeNode()&&a.isParagraph(r)&&(n||(e+=1),s.updateBookmark(e,r))}function o(e,t){if(!t||n.acceptPosition(e)===c)return!0;for(;e.previousPosition();)if(n.acceptPosition(e)===c){if(t(u,e.container(),e.unfilteredDomOffset()))return!0;break}for(;e.nextPosition();)if(n.acceptPosition(e)===c){if(t(d,e.container(),e.unfilteredDomOffset()))return!0;break}return!1}var s,a=odf.OdfUtils,l=core.DomUtils,c=core.PositionFilter.FilterResult.FILTER_ACCEPT,u=core.StepDirection.PREVIOUS,d=core.StepDirection.NEXT;this.convertStepsToDomPoint=function(e){var r,o;if(isNaN(e))throw new TypeError("Requested steps is not numeric ("+e+")");if(0>e)throw new RangeError("Requested steps is negative ("+e+")");for(r=s.setToClosestStep(e,t);r<e&&t.nextPosition();)(o=n.acceptPosition(t)===c)&&(r+=1),i(r,t,o);if(r!==e)throw new RangeError("Requested steps ("+e+") exceeds available steps ("+r+")");return{node:t.container(),offset:t.unfilteredDomOffset()}},this.convertDomPointToSteps=function(r,a,u){var d;if(l.containsNode(e,r)||(a=0>l.comparePoints(e,0,r,a),r=e,a=a?0:e.childNodes.length),t.setUnfilteredPosition(r,a),o(t,u)||t.setUnfilteredPosition(r,a),u=t.container(),a=t.unfilteredDomOffset(),r=s.setToClosestDomPoint(u,a,t),0>l.comparePoints(t.container(),t.unfilteredDomOffset(),u,a))return 0<r?r-1:r;for(;(t.container()!==u||t.unfilteredDomOffset()!==a)&&t.nextPosition();)(d=n.acceptPosition(t)===c)&&(r+=1),i(r,t,d);return r+0},this.prime=function(){var e,r;for(e=s.setToClosestStep(0,t);t.nextPosition();)(r=n.acceptPosition(t)===c)&&(e+=1),i(e,t,r)},this.handleStepsInserted=function(e){s.damageCacheAfterStep(e.position)},this.handleStepsRemoved=function(e){s.damageCacheAfterStep(e.position-1)},s=new ops.StepsCache(e,r,function(e,t){do{if(n.acceptPosition(t)===c){i(e,t,!0);break}i(e-1,t,!1)}while(t.nextPosition())})},ops.Operation=function(){},ops.Operation.prototype.init=function(e){},ops.Operation.prototype.execute=function(e){},ops.Operation.prototype.spec=function(){},ops.TextPositionFilter=function(){function e(e,n,r,s){var a;if(n){if(t.isInlineRoot(n)&&t.isGroupingElement(r))return o;if(1===(s=t.lookLeftForCharacter(n))||2===s&&(t.scanRightForAnyCharacter(r)||t.scanRightForAnyCharacter(t.nextNode(e))))return i}else if(t.isGroupingElement(e)&&t.isInlineRoot(function(e,t){for(;e&&t(e)!==i;)e=e.previousSibling;return e}(e.previousSibling,s)))return i;return s=null===n&&t.isParagraph(e),a=t.lookRightForCharacter(r),s?a?i:t.scanRightForAnyCharacter(r)?o:i:a?(n=n||t.previousNode(e),t.scanLeftForAnyCharacter(n)?o:i):o}var t=odf.OdfUtils,n=Node.ELEMENT_NODE,r=Node.TEXT_NODE,i=core.PositionFilter.FilterResult.FILTER_ACCEPT,o=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(s){var a,l,c,u=s.container(),d=u.nodeType;if(d!==n&&d!==r)return o;if(d===r){if(d=s.unfilteredDomOffset(),a=u.data,runtime.assert(d!==a.length,"Unexpected offset."),0<d){if(s=a[d-1],!t.isODFWhitespace(s))return i;if(1<d)if(s=a[d-2],t.isODFWhitespace(s)){if(!t.isODFWhitespace(a.substr(0,d)))return o}else c=i;else l=t.previousNode(u),t.scanLeftForNonSpace(l)&&(c=i);return c===i?t.isTrailingWhitespace(u,d)?o:i:(s=a[d],t.isODFWhitespace(s)?o:t.scanLeftForAnyCharacter(t.previousNode(u))?o:i)}l=s.leftNode(),c=u,u=u.parentNode,c=e(u,l,c,s.getNodeFilter())}else t.isGroupingElement(u)?(l=s.leftNode(),c=s.rightNode(),c=e(u,l,c,s.getNodeFilter())):c=o;return c}},ops.OdtDocument=function(e){function t(e){return new core.PositionIterator(e,x,_,!1)}function n(){var t=e.odfContainer().getContentElement(),n=t&&t.localName;return runtime.assert("text"===n,"Unsupported content element type '"+n+"' for OdtDocument"),t}function r(){return m.getDocumentElement().ownerDocument}function i(e){for(;e&&!(e.namespaceURI===odf.Namespaces.officens&&"text"===e.localName||e.namespaceURI===odf.Namespaces.officens&&"annotation"===e.localName);)e=e.parentNode;return e}function o(e,n,r,i){var o;return i=t(i),1===r.length?o=r[0]:(o=new core.PositionFilterChain,r.forEach(o.addFilter)),(r=new core.StepIterator(o,i)).setPosition(e,n),r}function s(e){var r=t(n());return e=p.convertStepsToDomPoint(e),r.setUnfilteredPosition(e.node,e.offset),r}function a(e){return e===C}function l(t){var n=t.spec(),r=n.memberid,i=new Date(n.timestamp).toISOString(),n=e.odfContainer();t.isEdit&&(r=m.getMember(r).getProperties().fullName,n.setMetadata({"dc:creator":r,"dc:date":i},null),r={setProperties:{"dc:creator":r,"dc:date":i},removedProperties:[]},f||(r.setProperties["meta:editing-cycles"]=n.incrementEditingCycles(),n.setMetadata(null,["meta:editing-duration","meta:document-statistic"])),f=t,m.emit(ops.OdtDocument.signalMetadataUpdated,r))}function c(e){var t,n,r=[],i=2;runtime.assert(e.isStep(),"positionIterator is not at a step");do{if((t=d.getContentBounds(e))&&(t=t.container,g.isDowngradableSpaceElement(t))){for(n=t.lastChild;t.firstChild;)r.push(t.firstChild),t.parentNode.insertBefore(t.firstChild,t);t.parentNode.removeChild(t),e.setPosition(n,n.nodeType===Node.TEXT_NODE?n.length:n.childNodes.length),e.roundToPreviousStep()}--i}while(0<i&&e.nextStep());r.forEach(b.normalizeTextNodes)}function u(e,t,n){return e=e.childNodes.item(t)||e,(e=g.getParagraphElement(e))&&b.containsNode(n,e)?e:n}var d,h,p,f,m=this,g=odf.OdfUtils,b=core.DomUtils,y={},v={},S=new core.EventNotifier([ops.Document.signalMemberAdded,ops.Document.signalMemberUpdated,ops.Document.signalMemberRemoved,ops.Document.signalCursorAdded,ops.Document.signalCursorRemoved,ops.Document.signalCursorMoved,ops.OdtDocument.signalParagraphChanged,ops.OdtDocument.signalParagraphStyleModified,ops.OdtDocument.signalCommonStyleCreated,ops.OdtDocument.signalCommonStyleDeleted,ops.OdtDocument.signalTableAdded,ops.OdtDocument.signalOperationStart,ops.OdtDocument.signalOperationEnd,ops.OdtDocument.signalProcessingBatchStart,ops.OdtDocument.signalProcessingBatchEnd,ops.OdtDocument.signalUndoStackChanged,ops.OdtDocument.signalStepsInserted,ops.OdtDocument.signalStepsRemoved,ops.OdtDocument.signalMetadataUpdated,ops.OdtDocument.signalAnnotationAdded]),C=core.StepDirection.NEXT,x=NodeFilter.SHOW_ALL,A=new gui.BlacklistNamespaceNodeFilter(["urn:webodf:names:cursor","urn:webodf:names:editinfo"]),w=new gui.OdfTextBodyNodeFilter,_=new core.NodeFilterChain([A,w]);this.createPositionIterator=t,this.getDocumentElement=function(){return e.odfContainer().rootElement},this.cloneDocumentElement=function(){var t=m.getDocumentElement(),n=e.getAnnotationViewManager();return n&&n.forgetAnnotations(),t=t.cloneNode(!0),e.refreshAnnotations(),m.fixCursorPositions(),t},this.setDocumentElement=function(r){var i=e.odfContainer();S.unsubscribe(ops.OdtDocument.signalStepsInserted,p.handleStepsInserted),S.unsubscribe(ops.OdtDocument.signalStepsRemoved,p.handleStepsRemoved),i.setRootElement(r),e.setOdfContainer(i,!0),e.refreshCSS(),r=n(),p=new ops.OdtStepsTranslator(r,t(r),h,500),S.subscribe(ops.OdtDocument.signalStepsInserted,p.handleStepsInserted),S.subscribe(ops.OdtDocument.signalStepsRemoved,p.handleStepsRemoved)},this.getDOMDocument=r,this.getRootElement=i,this.createStepIterator=o,this.getIteratorAtPosition=s,this.convertCursorStepToDomPoint=function(e){return p.convertStepsToDomPoint(e)},this.convertDomPointToCursorStep=function(e,t,n){var r;return n===C&&(r=a),p.convertDomPointToSteps(e,t,r)},this.convertDomToCursorRange=function(e){var t;return t=p.convertDomPointToSteps(e.anchorNode,e.anchorOffset),e=e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset?t:p.convertDomPointToSteps(e.focusNode,e.focusOffset),{position:t,length:e-t}},this.convertCursorToDomRange=function(e,t){var n,i,o=r().createRange();return n=p.convertStepsToDomPoint(e),t?(i=p.convertStepsToDomPoint(e+t),0<t?(o.setStart(n.node,n.offset),o.setEnd(i.node,i.offset)):(o.setStart(i.node,i.offset),o.setEnd(n.node,n.offset))):o.setStart(n.node,n.offset),o},this.upgradeWhitespacesAtPosition=function(e){var t,n=s(e),n=new core.StepIterator(h,n),r=2;runtime.assert(n.isStep(),"positionIterator is not at a step (requested step: "+e+")");do{if((t=d.getContentBounds(n))&&(e=t.container,t=t.startOffset,e.nodeType===Node.TEXT_NODE&&g.isSignificantWhitespace(e,t))){runtime.assert(" "===e.data[t],"upgradeWhitespaceToElement: textNode.data[offset] should be a literal space");var i=e.ownerDocument.createElementNS(odf.Namespaces.textns,"text:s"),o=e.parentNode,a=e;i.appendChild(e.ownerDocument.createTextNode(" ")),1===e.length?o.replaceChild(i,e):(e.deleteData(t,1),0<t&&(t<e.length&&e.splitText(t),a=e.nextSibling),o.insertBefore(i,a)),e=i,n.setPosition(e,e.childNodes.length),n.roundToPreviousStep()}--r}while(0<r&&n.nextStep())},this.downgradeWhitespaces=c,this.downgradeWhitespacesAtPosition=function(e){e=s(e),c(e=new core.StepIterator(h,e))},this.getTextNodeAtStep=function(e,t){var n,i=s(e),o=i.container(),a=0,l=null;if(o.nodeType===Node.TEXT_NODE?(n=o,a=i.unfilteredDomOffset(),0<n.length&&(0<a&&(n=n.splitText(a)),n.parentNode.insertBefore(r().createTextNode(""),n),n=n.previousSibling,a=0)):(n=r().createTextNode(""),a=0,o.insertBefore(n,i.rightNode())),t){if(y[t]&&m.getCursorPosition(t)===e){for(l=y[t].getNode();l.nextSibling&&"cursor"===l.nextSibling.localName;)l.parentNode.insertBefore(l.nextSibling,l);0<n.length&&n.nextSibling!==l&&(n=r().createTextNode(""),a=0),l.parentNode.insertBefore(n,l)}}else for(;n.nextSibling&&"cursor"===n.nextSibling.localName;)n.parentNode.insertBefore(n.nextSibling,n);for(;n.previousSibling&&n.previousSibling.nodeType===Node.TEXT_NODE;)(i=n.previousSibling).appendData(n.data),a=i.length,(n=i).parentNode.removeChild(n.nextSibling);for(;n.nextSibling&&n.nextSibling.nodeType===Node.TEXT_NODE;)i=n.nextSibling,n.appendData(i.data),n.parentNode.removeChild(i);return{textNode:n,offset:a}},this.fixCursorPositions=function(){Object.keys(y).forEach(function(e){var t,n,r,s=y[e],a=i(s.getNode()),l=m.createRootFilter(a),c=!1;r=s.getSelectedRange(),t=u(r.startContainer,r.startOffset,a),n=o(r.startContainer,r.startOffset,[h,l],t),r.collapsed?a=n:(t=u(r.endContainer,r.endOffset,a),a=o(r.endContainer,r.endOffset,[h,l],t)),n.isStep()&&a.isStep()?n.container()!==a.container()||n.offset()!==a.offset()||r.collapsed&&s.getAnchorNode()===s.getNode()||(c=!0,r.setStart(n.container(),n.offset()),r.collapse(!0)):(c=!0,runtime.assert(n.roundToClosestStep(),"No walkable step found for cursor owned by "+e),r.setStart(n.container(),n.offset()),runtime.assert(a.roundToClosestStep(),"No walkable step found for cursor owned by "+e),r.setEnd(a.container(),a.offset())),c&&(s.setSelectedRange(r,s.hasForwardSelection()),m.emit(ops.Document.signalCursorMoved,s))})},this.getCursorPosition=function(e){return(e=y[e])?p.convertDomPointToSteps(e.getNode(),0):0},this.getCursorSelection=function(e){var t=0,n=0;return(e=y[e])&&(t=p.convertDomPointToSteps(e.getNode(),0),n=p.convertDomPointToSteps(e.getAnchorNode(),0)),{position:n,length:t-n}},this.getPositionFilter=function(){return h},this.getOdfCanvas=function(){return e},this.getCanvas=function(){return e},this.getRootNode=n,this.addMember=function(e){runtime.assert(void 0===v[e.getMemberId()],"This member already exists"),v[e.getMemberId()]=e},this.getMember=function(e){return v.hasOwnProperty(e)?v[e]:null},this.removeMember=function(e){delete v[e]},this.getCursor=function(e){return y[e]},this.hasCursor=function(e){return y.hasOwnProperty(e)},this.getMemberIds=function(){return Object.keys(v)},this.addCursor=function(e){runtime.assert(Boolean(e),"OdtDocument::addCursor without cursor");var t=e.getMemberId(),n=m.convertCursorToDomRange(0,0);runtime.assert("string"==typeof t,"OdtDocument::addCursor has cursor without memberid"),runtime.assert(!y[t],"OdtDocument::addCursor is adding a duplicate cursor with memberid "+t),e.setSelectedRange(n,!0),y[t]=e},this.removeCursor=function(e){var t=y[e];return!!t&&(t.removeFromDocument(),delete y[e],m.emit(ops.Document.signalCursorRemoved,e),!0)},this.moveCursor=function(e,t,n,r){e=y[e],t=m.convertCursorToDomRange(t,n),e&&(e.setSelectedRange(t,0<=n),e.setSelectionType(r||ops.OdtCursor.RangeSelection))},this.getFormatting=function(){return e.getFormatting()},this.emit=function(e,t){S.emit(e,t)},this.subscribe=function(e,t){S.subscribe(e,t)},this.unsubscribe=function(e,t){S.unsubscribe(e,t)},this.createRootFilter=function(e){return new RootFilter(e,y,i)},this.close=function(e){e()},this.destroy=function(e){e()},function(){var e=n();h=new ops.TextPositionFilter,d=new odf.StepUtils,p=new ops.OdtStepsTranslator(e,t(e),h,500),S.subscribe(ops.OdtDocument.signalStepsInserted,p.handleStepsInserted),S.subscribe(ops.OdtDocument.signalStepsRemoved,p.handleStepsRemoved),S.subscribe(ops.OdtDocument.signalOperationEnd,l),S.subscribe(ops.OdtDocument.signalProcessingBatchEnd,core.Task.processTasks)}()},ops.OdtDocument.signalParagraphChanged="paragraph/changed",ops.OdtDocument.signalTableAdded="table/added",ops.OdtDocument.signalCommonStyleCreated="style/created",ops.OdtDocument.signalCommonStyleDeleted="style/deleted",ops.OdtDocument.signalParagraphStyleModified="paragraphstyle/modified",ops.OdtDocument.signalOperationStart="operation/start",ops.OdtDocument.signalOperationEnd="operation/end",ops.OdtDocument.signalProcessingBatchStart="router/batchstart",ops.OdtDocument.signalProcessingBatchEnd="router/batchend",ops.OdtDocument.signalUndoStackChanged="undo/changed",ops.OdtDocument.signalStepsInserted="steps/inserted",ops.OdtDocument.signalStepsRemoved="steps/removed",ops.OdtDocument.signalMetadataUpdated="metadata/updated",ops.OdtDocument.signalAnnotationAdded="annotation/added",ops.OpAddAnnotation=function(){function e(e,n,r){var i=e.getTextNodeAtStep(r,t);i&&(e=i.textNode,r=e.parentNode,i.offset!==e.length&&e.splitText(i.offset),r.insertBefore(n,e.nextSibling),0===e.length&&r.removeChild(e))}var t,n,r,i,o,s;this.init=function(e){t=e.memberid,n=parseInt(e.timestamp,10),r=parseInt(e.position,10),i=void 0!==e.length?parseInt(e.length,10)||0:void 0,o=e.name},this.isEdit=!0,this.group=void 0,this.execute=function(a){var l,c,u=a.getCursor(t);s=a.getDOMDocument();var d,h,p,f=new Date(n);return(d=s.createElementNS(odf.Namespaces.officens,"office:annotation")).setAttributeNS(odf.Namespaces.officens,"office:name",o),(l=s.createElementNS(odf.Namespaces.dcns,"dc:creator")).setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",t),l.textContent=a.getMember(t).getProperties().fullName,(c=s.createElementNS(odf.Namespaces.dcns,"dc:date")).appendChild(s.createTextNode(f.toISOString())),f=s.createElementNS(odf.Namespaces.textns,"text:list"),h=s.createElementNS(odf.Namespaces.textns,"text:list-item"),p=s.createElementNS(odf.Namespaces.textns,"text:p"),h.appendChild(p),f.appendChild(h),d.appendChild(l),d.appendChild(c),d.appendChild(f),void 0!==i&&((l=s.createElementNS(odf.Namespaces.officens,"office:annotation-end")).setAttributeNS(odf.Namespaces.officens,"office:name",o),d.annotationEndElement=l,e(a,l,r+i)),e(a,d,r),a.emit(ops.OdtDocument.signalStepsInserted,{position:r}),u&&(l=s.createRange(),c=d.getElementsByTagNameNS(odf.Namespaces.textns,"p")[0],l.selectNodeContents(c),u.setSelectedRange(l,!1),u.setSelectionType(ops.OdtCursor.RangeSelection),a.emit(ops.Document.signalCursorMoved,u)),a.getOdfCanvas().addAnnotation(d),a.fixCursorPositions(),a.emit(ops.OdtDocument.signalAnnotationAdded,{memberId:t,annotation:d}),!0},this.spec=function(){return{optype:"AddAnnotation",memberid:t,timestamp:n,position:r,length:i,name:o}}},ops.OpAddCursor=function(){var e,t;this.init=function(n){e=n.memberid,t=n.timestamp},this.isEdit=!1,this.group=void 0,this.execute=function(t){var n=t.getCursor(e);return!n&&(n=new ops.OdtCursor(e,t),t.addCursor(n),t.emit(ops.Document.signalCursorAdded,n),!0)},this.spec=function(){return{optype:"AddCursor",memberid:e,timestamp:t}}},ops.OpAddMember=function(){var e,t,n;this.init=function(r){e=r.memberid,t=parseInt(r.timestamp,10),n=r.setProperties},this.isEdit=!1,this.group=void 0,this.execute=function(t){var r;return!t.getMember(e)&&(r=new ops.Member(e,n),t.addMember(r),t.emit(ops.Document.signalMemberAdded,r),!0)},this.spec=function(){return{optype:"AddMember",memberid:e,timestamp:t,setProperties:n}}},ops.OpAddStyle=function(){var e,t,n,r,i,o,s=odf.Namespaces.stylens;this.init=function(s){e=s.memberid,t=s.timestamp,n=s.styleName,r=s.styleFamily,i="true"===s.isAutomaticStyle||!0===s.isAutomaticStyle,o=s.setProperties},this.isEdit=!0,this.group=void 0,this.execute=function(e){var t=e.getOdfCanvas().odfContainer(),a=e.getFormatting(),l=e.getDOMDocument().createElementNS(s,"style:style");return!!l&&(o&&a.updateStyle(l,o),l.setAttributeNS(s,"style:family",r),l.setAttributeNS(s,"style:name",n),i?t.rootElement.automaticStyles.appendChild(l):t.rootElement.styles.appendChild(l),e.getOdfCanvas().refreshCSS(),i||e.emit(ops.OdtDocument.signalCommonStyleCreated,{name:n,family:r}),!0)},this.spec=function(){return{optype:"AddStyle",memberid:e,timestamp:t,styleName:n,styleFamily:r,isAutomaticStyle:i,setProperties:o}}},odf.ObjectNameGenerator=function(e,t){function n(e,t){var n={};this.generateName=function(){var r,i=t(),o=0;do{r=e+o,o+=1}while(n[r]||i[r]);return n[r]=!0,r}}var r=odf.Namespaces.stylens,i=odf.Namespaces.drawns,o=odf.Namespaces.xlinkns,s=(new core.Utils).hashString(t),a=null,l=null,c=null,u={},d={};this.generateStyleName=function(){return null===a&&(a=new n("auto"+s+"_",function(){return t={},[e.rootElement.automaticStyles,e.rootElement.styles].forEach(function(e){for(e=e.firstElementChild;e;)e.namespaceURI===r&&"style"===e.localName&&(t[e.getAttributeNS(r,"name")]=!0),e=e.nextElementSibling}),t;var t})),a.generateName()},this.generateFrameName=function(){var t,r,o;if(null===l){for(r=e.rootElement.body.getElementsByTagNameNS(i,"frame"),t=0;t<r.length;t+=1)o=r.item(t),u[o.getAttributeNS(i,"name")]=!0;l=new n("fr"+s+"_",function(){return u})}return l.generateName()},this.generateImageName=function(){var t,r,a;if(null===c){for(a=e.rootElement.body.getElementsByTagNameNS(i,"image"),t=0;t<a.length;t+=1)r=(r=(r=a.item(t)).getAttributeNS(o,"href")).substring(9,r.lastIndexOf(".")),d[r]=!0;c=new n("img"+s+"_",function(){return d})}return c.generateName()}},odf.TextStyleApplicator=function(e,t,n){function r(e){var n={};this.isStyleApplied=function(r){return r=t.getAppliedStylesForElement(r,n).styleProperties,function e(t,n){return"object"==typeof t&&"object"==typeof n?Object.keys(t).every(function(r){return e(t[r],n[r])}):t===n}(e,r)}}function i(r){var i={};this.applyStyleToContainer=function(o){var s;s=o.getAttributeNS(a,"style-name");var c=o.ownerDocument;if(s=s||"",!i.hasOwnProperty(s)){var u,d=s;u=s?t.createDerivedStyleObject(s,"text",r):r,c=c.createElementNS(l,"style:style"),t.updateStyle(c,u),c.setAttributeNS(l,"style:name",e.generateStyleName()),c.setAttributeNS(l,"style:family","text"),c.setAttributeNS("urn:webodf:names:scope","scope","document-content"),n.appendChild(c),i[d]=c}s=i[s].getAttributeNS(l,"name"),o.setAttributeNS(a,"text:style-name",s)}}function o(e,t){var n,r,i,o=e.ownerDocument,l=e.parentNode,c=new core.LoopWatchDog(1e4);for((r=[]).push(e),i=e.nextSibling;i&&s.rangeContainsNode(t,i);)c.check(),r.push(i),i=i.nextSibling;if("span"!==l.localName||l.namespaceURI!==a?(n=o.createElementNS(a,"text:span"),l.insertBefore(n,e),o=!1):(e.previousSibling&&!s.rangeContainsNode(t,l.firstChild)?(n=l.cloneNode(!1),l.parentNode.insertBefore(n,l.nextSibling)):n=l,o=!0),r.forEach(function(e){e.parentNode!==n&&n.appendChild(e)}),i&&o)for(r=n.cloneNode(!1),n.parentNode.insertBefore(r,n.nextSibling);i;)c.check(),o=i.nextSibling,r.appendChild(i),i=o;return n}var s=core.DomUtils,a=odf.Namespaces.textns,l=odf.Namespaces.stylens;this.applyStyle=function(e,t,n){var s,a,l,c={};runtime.assert(n&&n.hasOwnProperty("style:text-properties"),"applyStyle without any text properties"),c["style:text-properties"]=n["style:text-properties"],a=new i(c),l=new r(c),e.forEach(function(e){!1===l.isStyleApplied(e)&&(s=o(e,t),a.applyStyleToContainer(s))})}},ops.OpApplyDirectStyling=function(){function e(e,n,r){var i=e.getOdfCanvas().odfContainer(),o=a.splitBoundaries(n),l=s.getTextNodes(n,!1);new odf.TextStyleApplicator(new odf.ObjectNameGenerator(i,t),e.getFormatting(),i.rootElement.automaticStyles).applyStyle(l,n,r),o.forEach(a.normalizeTextNodes)}var t,n,r,i,o,s=odf.OdfUtils,a=core.DomUtils;this.init=function(e){t=e.memberid,n=e.timestamp,r=parseInt(e.position,10),i=parseInt(e.length,10),o=e.setProperties},this.isEdit=!0,this.group=void 0,this.execute=function(a){var l=a.convertCursorToDomRange(r,i),c=s.getParagraphElements(l);return e(a,l,o),l.detach(),a.getOdfCanvas().refreshCSS(),a.fixCursorPositions(),c.forEach(function(e){a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:e,memberId:t,timeStamp:n})}),a.getOdfCanvas().rerenderAnnotations(),!0},this.spec=function(){return{optype:"ApplyDirectStyling",memberid:t,timestamp:n,position:r,length:i,setProperties:o}}},ops.OpApplyHyperlink=function(){var e,t,n,r,i,o=core.DomUtils,s=odf.OdfUtils;this.init=function(o){e=o.memberid,t=o.timestamp,n=o.position,r=o.length,i=o.hyperlink},this.isEdit=!0,this.group=void 0,this.execute=function(a){var l=a.getDOMDocument(),c=a.convertCursorToDomRange(n,r),u=o.splitBoundaries(c),d=[],h=s.getTextNodes(c,!1);return 0!==h.length&&(h.forEach(function(e){var t=s.getParagraphElement(e);runtime.assert(!1===function(e){for(;e;){if(s.isHyperlink(e))return!0;e=e.parentNode}return!1}(e),"The given range should not contain any link.");var n=i,r=l.createElementNS(odf.Namespaces.textns,"text:a");r.setAttributeNS(odf.Namespaces.xlinkns,"xlink:type","simple"),r.setAttributeNS(odf.Namespaces.xlinkns,"xlink:href",n),e.parentNode.insertBefore(r,e),r.appendChild(e),-1===d.indexOf(t)&&d.push(t)}),u.forEach(o.normalizeTextNodes),c.detach(),a.fixCursorPositions(),a.getOdfCanvas().refreshSize(),a.getOdfCanvas().rerenderAnnotations(),d.forEach(function(n){a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:n,memberId:e,timeStamp:t})}),!0)},this.spec=function(){return{optype:"ApplyHyperlink",memberid:e,timestamp:t,position:n,length:r,hyperlink:i}}},ops.OpInsertImage=function(){var e,t,n,r,i,o,s,a,l=odf.Namespaces.drawns,c=odf.Namespaces.svgns,u=odf.Namespaces.textns,d=odf.Namespaces.xlinkns,h=odf.OdfUtils;this.init=function(l){e=l.memberid,t=l.timestamp,n=l.position,r=l.filename,i=l.frameWidth,o=l.frameHeight,s=l.frameStyleName,a=l.frameName},this.isEdit=!0,this.group=void 0,this.execute=function(p){var f,m,g=p.getOdfCanvas(),b=p.getTextNodeAtStep(n,e);if(!b)return!1;f=b.textNode,m=h.getParagraphElement(f);var b=b.offset!==f.length?f.splitText(b.offset):f.nextSibling,y=p.getDOMDocument(),v=y.createElementNS(l,"draw:image"),y=y.createElementNS(l,"draw:frame");return v.setAttributeNS(d,"xlink:href",r),v.setAttributeNS(d,"xlink:type","simple"),v.setAttributeNS(d,"xlink:show","embed"),v.setAttributeNS(d,"xlink:actuate","onLoad"),y.setAttributeNS(l,"draw:style-name",s),y.setAttributeNS(l,"draw:name",a),y.setAttributeNS(u,"text:anchor-type","as-char"),y.setAttributeNS(c,"svg:width",i),y.setAttributeNS(c,"svg:height",o),y.appendChild(v),f.parentNode.insertBefore(y,b),p.emit(ops.OdtDocument.signalStepsInserted,{position:n}),0===f.length&&f.parentNode.removeChild(f),g.addCssForFrameWithImage(y),g.refreshCSS(),p.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:m,memberId:e,timeStamp:t}),g.rerenderAnnotations(),!0},this.spec=function(){return{optype:"InsertImage",memberid:e,timestamp:t,filename:r,position:n,frameWidth:i,frameHeight:o,frameStyleName:s,frameName:a}}},ops.OpInsertTable=function(){function e(e,t){var n;if(1===c.length)n=c[0];else if(3===c.length)switch(e){case 0:n=c[0];break;case r-1:n=c[2];break;default:n=c[1]}else n=c[e];if(1===n.length)return n[0];if(3===n.length)switch(t){case 0:return n[0];case i-1:return n[2];default:return n[1]}return n[t]}var t,n,r,i,o,s,a,l,c,u=odf.OdfUtils;this.init=function(e){t=e.memberid,n=e.timestamp,o=e.position,r=e.initialRows,i=e.initialColumns,s=e.tableName,a=e.tableStyleName,l=e.tableColumnStyleName,c=e.tableCellStyleMatrix},this.isEdit=!0,this.group=void 0,this.execute=function(c){var d=c.getTextNodeAtStep(o),h=c.getRootNode();if(d){var p,f,m,g,b=c.getDOMDocument(),y=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table"),v=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-column");for(a&&y.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",a),s&&y.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:name",s),v.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:number-columns-repeated",i),l&&v.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",l),y.appendChild(v),m=0;m<r;m+=1){for(v=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-row"),g=0;g<i;g+=1)p=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-cell"),(f=e(m,g))&&p.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",f),f=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:p"),p.appendChild(f),v.appendChild(p);y.appendChild(v)}return d=u.getParagraphElement(d.textNode),h.insertBefore(y,d.nextSibling),c.emit(ops.OdtDocument.signalStepsInserted,{position:o}),c.getOdfCanvas().refreshSize(),c.emit(ops.OdtDocument.signalTableAdded,{tableElement:y,memberId:t,timeStamp:n}),c.getOdfCanvas().rerenderAnnotations(),!0}return!1},this.spec=function(){return{optype:"InsertTable",memberid:t,timestamp:n,position:o,initialRows:r,initialColumns:i,tableName:s,tableStyleName:a,tableColumnStyleName:l,tableCellStyleMatrix:c}}},ops.OpInsertText=function(){function e(e){return"\t"!==e&&s.isODFWhitespace(e)}var t,n,r,i,o,s=odf.OdfUtils;this.init=function(e){t=e.memberid,n=e.timestamp,r=e.position,o=e.text,i="true"===e.moveCursor||!0===e.moveCursor},this.isEdit=!0,this.group=void 0,this.execute=function(a){var l,c,u,d,h,p,f=null,m=a.getDOMDocument(),g=0,b=a.getCursor(t);if(a.upgradeWhitespacesAtPosition(r),l=a.getTextNodeAtStep(r)){for(c=l.textNode,f=c.nextSibling,u=c.parentNode,d=s.getParagraphElement(c),p=0;p<o.length;p+=1){if(!(h="\t"===o[p])){var y=p;h=e((h=o)[y])&&(0===y||y===h.length-1||e(h[y-1]))}h&&(0===g?(l.offset!==c.length&&(f=c.splitText(l.offset)),0<p&&c.appendData(o.substring(0,p))):g<p&&(g=o.substring(g,p),u.insertBefore(m.createTextNode(g),f)),g=p+1,"\t"===o[p]?(h=m.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:tab")).appendChild(m.createTextNode("\t")):(" "!==o[p]&&runtime.log("WARN: InsertText operation contains non-tab, non-space whitespace character (character code "+o.charCodeAt(p)+")"),(h=m.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:s")).appendChild(m.createTextNode(" "))),u.insertBefore(h,f))}return 0===g?c.insertData(l.offset,o):g<o.length&&(l=o.substring(g),u.insertBefore(m.createTextNode(l),f)),u=c.parentNode,f=c.nextSibling,u.removeChild(c),u.insertBefore(c,f),0===c.length&&c.parentNode.removeChild(c),a.emit(ops.OdtDocument.signalStepsInserted,{position:r}),b&&i&&(a.moveCursor(t,r+o.length,0),a.emit(ops.Document.signalCursorMoved,b)),a.downgradeWhitespacesAtPosition(r),a.downgradeWhitespacesAtPosition(r+o.length),a.getOdfCanvas().refreshSize(),a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:d,memberId:t,timeStamp:n}),a.getOdfCanvas().rerenderAnnotations(),!0}return!1},this.spec=function(){return{optype:"InsertText",memberid:t,timestamp:n,position:r,text:o,moveCursor:i}}},odf.CollapsingRules=function(e){function t(e){return n.isODFNode(e)||"br"===e.localName&&n.isLineBreak(e.parentNode)||e.nodeType===Node.TEXT_NODE&&n.isODFNode(e.parentNode)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}var n=odf.OdfUtils,r=core.DomUtils;this.mergeChildrenIntoParent=function i(o){var s;o.nodeType===Node.TEXT_NODE?(s=o.parentNode,s.removeChild(o)):s=r.removeUnwantedNodes(o,t);(o=s)&&(o=s,o=!n.isParagraph(o)&&o!==e&&n.hasNoODFContent(o));return o?i(s):s}},ops.OpMergeParagraph=function(){function e(e){return odf.OdfUtils.isInlineRoot(e)?NodeFilter.FILTER_SKIP:u.isGroupingElement(e)&&u.hasNoODFContent(e)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}function t(e){if(e.nodeType===Node.TEXT_NODE){if(0===e.length)return runtime.log("WARN: Empty text node found during merge operation"),!0;if(u.isODFWhitespace(e.data)&&!1===u.isSignificantWhitespace(e,0))return!0;e="#text"}else e=(e.prefix?e.prefix+":":"")+e.localName;return runtime.log("WARN: Unexpected text element found near paragraph boundary ["+e+"]"),!1}function n(e){e.collapsed||(d.splitBoundaries(e),(e=u.getTextElements(e,!1,!0).filter(t)).forEach(function(e){e.parentNode.removeChild(e)}))}function r(e,t,n){e=e.convertCursorStepToDomPoint(t);var r=u.getParagraphElement(e.node,e.offset);return runtime.assert(Boolean(r),"Paragraph not found at step "+t),n&&n.setPosition(e.node,e.offset),r}var i,o,s,a,l,c,u=odf.OdfUtils,d=core.DomUtils,h=odf.Namespaces.textns;this.init=function(e){i=e.memberid,o=e.timestamp,s=e.moveCursor,a=e.paragraphStyleName,l=parseInt(e.sourceStartPosition,10),c=parseInt(e.destinationStartPosition,10)},this.isEdit=!0,this.group=void 0,this.execute=function(t){var u,p,f=t.getCursor(i);u=t.getRootNode();var m,g=new odf.CollapsingRules(u),b=t.createStepIterator(u,0,[t.getPositionFilter()],u);runtime.assert(c<l,"Destination paragraph ("+c+") must be before source paragraph ("+l+")"),p=r(t,c),u=r(t,l,b),b.previousStep(),runtime.assert(d.containsNode(p,b.container()),"Destination paragraph must be adjacent to the source paragraph"),m=p.ownerDocument.createRange(),b.setPosition(p,p.childNodes.length),b.roundToPreviousStep(),m.setStart(b.container(),b.offset()),m.setEnd(p,p.childNodes.length),n(m),m=p.childNodes.length;var y=u.ownerDocument.createRange();for(b.setPosition(u,0),b.roundToNextStep(),y.setStart(u,0),y.setEnd(b.container(),b.offset()),n(y),y=u.firstChild;y;)"editinfo"===y.localName?u.removeChild(y):(p.appendChild(y),d.removeUnwantedNodes(y,e)),y=u.firstChild;return runtime.assert(0===u.childNodes.length,"Source paragraph should be empty before it is removed"),g.mergeChildrenIntoParent(u),t.emit(ops.OdtDocument.signalStepsRemoved,{position:l-1}),b.setPosition(p,m),b.roundToClosestStep(),b.previousStep()||b.roundToNextStep(),t.downgradeWhitespaces(b),a?p.setAttributeNS(h,"text:style-name",a):p.removeAttributeNS(h,"style-name"),f&&s&&(t.moveCursor(i,l-1,0),t.emit(ops.Document.signalCursorMoved,f)),t.fixCursorPositions(),t.getOdfCanvas().refreshSize(),t.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:p,memberId:i,timeStamp:o}),t.getOdfCanvas().rerenderAnnotations(),!0},this.spec=function(){return{optype:"MergeParagraph",memberid:i,timestamp:o,moveCursor:s,paragraphStyleName:a,sourceStartPosition:l,destinationStartPosition:c}}},ops.OpMoveCursor=function(){var e,t,n,r,i;this.init=function(o){e=o.memberid,t=o.timestamp,n=o.position,r=o.length||0,i=o.selectionType||ops.OdtCursor.RangeSelection},this.isEdit=!1,this.group=void 0,this.execute=function(t){var o,s=t.getCursor(e);return!!s&&(o=t.convertCursorToDomRange(n,r),s.setSelectedRange(o,0<=r),s.setSelectionType(i),t.emit(ops.Document.signalCursorMoved,s),!0)},this.spec=function(){return{optype:"MoveCursor",memberid:e,timestamp:t,position:n,length:r,selectionType:i}}},ops.OpRemoveAnnotation=function(){var e,t,n,r,i=core.DomUtils;this.init=function(i){e=i.memberid,t=i.timestamp,n=parseInt(i.position,10),r=parseInt(i.length,10)},this.isEdit=!0,this.group=void 0,this.execute=function(e){function t(e){r.parentNode.insertBefore(e,r)}for(var r,o=e.getIteratorAtPosition(n).container();o.namespaceURI!==odf.Namespaces.officens||"annotation"!==o.localName;)o=o.parentNode;return null!==o&&(o=(r=o).annotationEndElement,e.getOdfCanvas().forgetAnnotation(r),i.getElementsByTagNameNS(r,"urn:webodf:names:cursor","cursor").forEach(t),i.getElementsByTagNameNS(r,"urn:webodf:names:cursor","anchor").forEach(t),r.parentNode.removeChild(r),o&&o.parentNode.removeChild(o),e.emit(ops.OdtDocument.signalStepsRemoved,{position:0<n?n-1:n}),e.getOdfCanvas().rerenderAnnotations(),e.fixCursorPositions(),!0)},this.spec=function(){return{optype:"RemoveAnnotation",memberid:e,timestamp:t,position:n,length:r}}},ops.OpRemoveBlob=function(){var e,t,n;this.init=function(r){e=r.memberid,t=r.timestamp,n=r.filename},this.isEdit=!0,this.group=void 0,this.execute=function(e){return e.getOdfCanvas().odfContainer().removeBlob(n),!0},this.spec=function(){return{optype:"RemoveBlob",memberid:e,timestamp:t,filename:n}}},ops.OpRemoveCursor=function(){var e,t;this.init=function(n){e=n.memberid,t=n.timestamp},this.isEdit=!1,this.group=void 0,this.execute=function(t){return!!t.removeCursor(e)},this.spec=function(){return{optype:"RemoveCursor",memberid:e,timestamp:t}}},ops.OpRemoveHyperlink=function(){var e,t,n,r,i=core.DomUtils,o=odf.OdfUtils;this.init=function(i){e=i.memberid,t=i.timestamp,n=i.position,r=i.length},this.isEdit=!0,this.group=void 0,this.execute=function(s){var a=s.convertCursorToDomRange(n,r),l=o.getHyperlinkElements(a);return runtime.assert(1===l.length,"The given range should only contain a single link."),l=i.mergeIntoParent(l[0]),a.detach(),s.fixCursorPositions(),s.getOdfCanvas().refreshSize(),s.getOdfCanvas().rerenderAnnotations(),s.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:o.getParagraphElement(l),memberId:e,timeStamp:t}),!0},this.spec=function(){return{optype:"RemoveHyperlink",memberid:e,timestamp:t,position:n,length:r}}},ops.OpRemoveMember=function(){var e,t;this.init=function(n){e=n.memberid,t=parseInt(n.timestamp,10)},this.isEdit=!1,this.group=void 0,this.execute=function(t){return!!t.getMember(e)&&(t.removeMember(e),t.emit(ops.Document.signalMemberRemoved,e),!0)},this.spec=function(){return{optype:"RemoveMember",memberid:e,timestamp:t}}},ops.OpRemoveStyle=function(){var e,t,n,r;this.init=function(i){e=i.memberid,t=i.timestamp,n=i.styleName,r=i.styleFamily},this.isEdit=!0,this.group=void 0,this.execute=function(e){var t=e.getFormatting().getStyleElement(n,r);return!!t&&(t.parentNode.removeChild(t),e.getOdfCanvas().refreshCSS(),e.emit(ops.OdtDocument.signalCommonStyleDeleted,{name:n,family:r}),!0)},this.spec=function(){return{optype:"RemoveStyle",memberid:e,timestamp:t,styleName:n,styleFamily:r}}},ops.OpRemoveText=function(){var e,t,n,r,i=odf.OdfUtils,o=core.DomUtils;this.init=function(i){runtime.assert(0<=i.length,"OpRemoveText only supports positive lengths"),e=i.memberid,t=i.timestamp,n=parseInt(i.position,10),r=parseInt(i.length,10)},this.isEdit=!0,this.group=void 0,this.execute=function(s){var a,l,c,u=s.getCursor(e),d=new odf.CollapsingRules(s.getRootNode());return s.upgradeWhitespacesAtPosition(n),s.upgradeWhitespacesAtPosition(n+r),a=s.convertCursorToDomRange(n,r),o.splitBoundaries(a),l=i.getTextElements(a,!1,!0),c=i.getParagraphElement(a.startContainer,a.startOffset),runtime.assert(void 0!==c,"Attempting to remove text outside a paragraph element"),a.detach(),l.forEach(function(e){e.parentNode?(runtime.assert(o.containsNode(c,e),"RemoveText only supports removing elements within the same paragraph"),d.mergeChildrenIntoParent(e)):runtime.log("WARN: text element has already been removed from it's container")}),s.emit(ops.OdtDocument.signalStepsRemoved,{position:n}),s.downgradeWhitespacesAtPosition(n),s.fixCursorPositions(),s.getOdfCanvas().refreshSize(),s.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:c,memberId:e,timeStamp:t}),u&&(u.resetSelectionType(),s.emit(ops.Document.signalCursorMoved,u)),s.getOdfCanvas().rerenderAnnotations(),!0},this.spec=function(){return{optype:"RemoveText",memberid:e,timestamp:t,position:n,length:r}}},ops.OpSetBlob=function(){var e,t,n,r,i;this.init=function(o){e=o.memberid,t=o.timestamp,n=o.filename,r=o.mimetype,i=o.content},this.isEdit=!0,this.group=void 0,this.execute=function(e){return e.getOdfCanvas().odfContainer().setBlob(n,r,i),!0},this.spec=function(){return{optype:"SetBlob",memberid:e,timestamp:t,filename:n,mimetype:r,content:i}}},ops.OpSetParagraphStyle=function(){var e,t,n,r,i=odf.OdfUtils;this.init=function(i){e=i.memberid,t=i.timestamp,n=i.position,r=i.styleName},this.isEdit=!0,this.group=void 0,this.execute=function(o){var s,a;return s=o.getIteratorAtPosition(n),!!(a=i.getParagraphElement(s.container()))&&(runtime.assert(function(e,t,n){var r=[e.getPositionFilter()],i=n.container();return n=n.unfilteredDomOffset(),!1===e.createStepIterator(i,n,r,t).previousStep()}(o,a,s),"SetParagraphStyle position should be the first position in the paragraph"),r?a.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:style-name",r):a.removeAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","style-name"),o.getOdfCanvas().refreshSize(),o.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:a,timeStamp:t,memberId:e}),o.getOdfCanvas().rerenderAnnotations(),!0)},this.spec=function(){return{optype:"SetParagraphStyle",memberid:e,timestamp:t,position:n,styleName:r}}},ops.OpSplitParagraph=function(){var e,t,n,r,i,o,s=odf.OdfUtils,a=odf.Namespaces.textns;this.init=function(s){e=s.memberid,t=s.timestamp,r=s.position,n=s.sourceParagraphPosition,o=s.paragraphStyleName,i="true"===s.moveCursor||!0===s.moveCursor},this.isEdit=!0,this.group=void 0,this.execute=function(n){var l,c,u,d,h,p,f,m=n.getCursor(e);if(n.upgradeWhitespacesAtPosition(r),!(l=n.getTextNodeAtStep(r)))return!1;if(!(c=s.getParagraphElement(l.textNode)))return!1;for(u=s.isListItem(c.parentNode)?c.parentNode:c,0===l.offset?(f=l.textNode.previousSibling,p=null):(f=l.textNode,p=l.offset>=l.textNode.length?null:l.textNode.splitText(l.offset)),d=l.textNode;d!==u;){if(d=d.parentNode,h=d.cloneNode(!1),p&&h.appendChild(p),f)for(;f&&f.nextSibling;)h.appendChild(f.nextSibling);else for(;d.firstChild;)h.appendChild(d.firstChild);d.parentNode.insertBefore(h,d.nextSibling),f=d,p=h}return s.isListItem(p)&&(p=p.childNodes.item(0)),o?p.setAttributeNS(a,"text:style-name",o):p.removeAttributeNS(a,"style-name"),0===l.textNode.length&&l.textNode.parentNode.removeChild(l.textNode),n.emit(ops.OdtDocument.signalStepsInserted,{position:r}),m&&i&&(n.moveCursor(e,r+1,0),n.emit(ops.Document.signalCursorMoved,m)),n.fixCursorPositions(),n.getOdfCanvas().refreshSize(),n.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:c,memberId:e,timeStamp:t}),n.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:p,memberId:e,timeStamp:t}),n.getOdfCanvas().rerenderAnnotations(),!0},this.spec=function(){return{optype:"SplitParagraph",memberid:e,timestamp:t,position:r,sourceParagraphPosition:n,paragraphStyleName:o,moveCursor:i}}},ops.OpUpdateMember=function(){var e,t,n,r;this.init=function(i){e=i.memberid,t=parseInt(i.timestamp,10),n=i.setProperties,r=i.removedProperties},this.isEdit=!1,this.group=void 0,this.execute=function(t){var i=t.getMember(e);return!!i&&(r&&i.removeProperties(r),n&&(i.setProperties(n),n.fullName&&function(t){var r="//dc:creator[@editinfo:memberid='"+e+"']";for(t=xmldom.XPath.getODFElementsWithXPath(t.getRootNode(),r,function(e){return"editinfo"===e?"urn:webodf:names:editinfo":odf.Namespaces.lookupNamespaceURI(e)}),r=0;r<t.length;r+=1)t[r].textContent=n.fullName}(t)),t.emit(ops.Document.signalMemberUpdated,i),!0)},this.spec=function(){return{optype:"UpdateMember",memberid:e,timestamp:t,setProperties:n,removedProperties:r}}},ops.OpUpdateMetadata=function(){var e,t,n,r;this.init=function(i){e=i.memberid,t=parseInt(i.timestamp,10),n=i.setProperties,r=i.removedProperties},this.isEdit=!0,this.group=void 0,this.execute=function(e){var t=e.getOdfCanvas().odfContainer(),i=null;return r&&(i=r.attributes.split(",")),t.setMetadata(n,i),e.emit(ops.OdtDocument.signalMetadataUpdated,{setProperties:null!==n?n:{},removedProperties:null!==i?i:[]}),!0},this.spec=function(){return{optype:"UpdateMetadata",memberid:e,timestamp:t,setProperties:n,removedProperties:r}}},ops.OpUpdateParagraphStyle=function(){function e(e,t){var n,r,i=t?t.split(","):[];for(n=0;n<i.length;n+=1)r=i[n].split(":"),e.removeAttributeNS(odf.Namespaces.lookupNamespaceURI(r[0]),r[1])}var t,n,r,i,o,s=odf.Namespaces.stylens;this.init=function(e){t=e.memberid,n=e.timestamp,r=e.styleName,i=e.setProperties,o=e.removedProperties},this.isEdit=!0,this.group=void 0,this.execute=function(t){var n,a,l,c=t.getFormatting();return!!(n=""!==r?c.getStyleElement(r,"paragraph"):c.getDefaultStyleElement("paragraph"))&&(a=n.getElementsByTagNameNS(s,"paragraph-properties").item(0),l=n.getElementsByTagNameNS(s,"text-properties").item(0),i&&c.updateStyle(n,i),o&&(c=o["style:paragraph-properties"],a&&c&&(e(a,c.attributes),0===a.attributes.length&&n.removeChild(a)),c=o["style:text-properties"],l&&c&&(e(l,c.attributes),0===l.attributes.length&&n.removeChild(l)),e(n,o.attributes)),t.getOdfCanvas().refreshCSS(),t.emit(ops.OdtDocument.signalParagraphStyleModified,r),t.getOdfCanvas().rerenderAnnotations(),!0)},this.spec=function(){return{optype:"UpdateParagraphStyle",memberid:t,timestamp:n,styleName:r,setProperties:i,removedProperties:o}}},ops.OperationFactory=function(){function e(e){return function(t){return new e}}var t;this.register=function(e,n){t[e]=n},this.create=function(e){var n=null,r=t[e.optype];return r&&(n=r(e)).init(e),n},t={AddMember:e(ops.OpAddMember),UpdateMember:e(ops.OpUpdateMember),RemoveMember:e(ops.OpRemoveMember),AddCursor:e(ops.OpAddCursor),ApplyDirectStyling:e(ops.OpApplyDirectStyling),SetBlob:e(ops.OpSetBlob),RemoveBlob:e(ops.OpRemoveBlob),InsertImage:e(ops.OpInsertImage),InsertTable:e(ops.OpInsertTable),InsertText:e(ops.OpInsertText),RemoveText:e(ops.OpRemoveText),MergeParagraph:e(ops.OpMergeParagraph),SplitParagraph:e(ops.OpSplitParagraph),SetParagraphStyle:e(ops.OpSetParagraphStyle),UpdateParagraphStyle:e(ops.OpUpdateParagraphStyle),AddStyle:e(ops.OpAddStyle),RemoveStyle:e(ops.OpRemoveStyle),MoveCursor:e(ops.OpMoveCursor),RemoveCursor:e(ops.OpRemoveCursor),AddAnnotation:e(ops.OpAddAnnotation),RemoveAnnotation:e(ops.OpRemoveAnnotation),UpdateMetadata:e(ops.OpUpdateMetadata),ApplyHyperlink:e(ops.OpApplyHyperlink),RemoveHyperlink:e(ops.OpRemoveHyperlink)}},ops.OperationRouter=function(){},ops.OperationRouter.prototype.setOperationFactory=function(e){},ops.OperationRouter.prototype.setPlaybackFunction=function(e){},ops.OperationRouter.prototype.push=function(e){},ops.OperationRouter.prototype.close=function(e){},ops.OperationRouter.prototype.subscribe=function(e,t){},ops.OperationRouter.prototype.unsubscribe=function(e,t){},ops.OperationRouter.prototype.hasLocalUnsyncedOps=function(){},ops.OperationRouter.prototype.hasSessionHostConnection=function(){},ops.OperationRouter.signalProcessingBatchStart="router/batchstart",ops.OperationRouter.signalProcessingBatchEnd="router/batchend",ops.TrivialOperationRouter=function(){var e,t,n=new core.EventNotifier([ops.OperationRouter.signalProcessingBatchStart,ops.OperationRouter.signalProcessingBatchEnd]),r=0;this.setOperationFactory=function(t){e=t},this.setPlaybackFunction=function(e){t=e},this.push=function(i){r+=1,n.emit(ops.OperationRouter.signalProcessingBatchStart,{}),i.forEach(function(n){(n=n.spec()).timestamp=Date.now(),(n=e.create(n)).group="g"+r,t(n)}),n.emit(ops.OperationRouter.signalProcessingBatchEnd,{})},this.close=function(e){e()},this.subscribe=function(e,t){n.subscribe(e,t)},this.unsubscribe=function(e,t){n.unsubscribe(e,t)},this.hasLocalUnsyncedOps=function(){return!1},this.hasSessionHostConnection=function(){return!0}},ops.Session=function(e){function t(e){i.emit(ops.OdtDocument.signalProcessingBatchStart,e)}function n(e){i.emit(ops.OdtDocument.signalProcessingBatchEnd,e)}var r=new ops.OperationFactory,i=new ops.OdtDocument(e),o=null;this.setOperationFactory=function(e){r=e,o&&o.setOperationFactory(r)},this.setOperationRouter=function(e){o&&(o.unsubscribe(ops.OperationRouter.signalProcessingBatchStart,t),o.unsubscribe(ops.OperationRouter.signalProcessingBatchEnd,n)),(o=e).subscribe(ops.OperationRouter.signalProcessingBatchStart,t),o.subscribe(ops.OperationRouter.signalProcessingBatchEnd,n),e.setPlaybackFunction(function(e){return i.emit(ops.OdtDocument.signalOperationStart,e),!!e.execute(i)&&(i.emit(ops.OdtDocument.signalOperationEnd,e),!0)}),e.setOperationFactory(r)},this.getOperationFactory=function(){return r},this.getOdtDocument=function(){return i},this.enqueue=function(e){o.push(e)},this.close=function(e){o.close(function(t){t?e(t):i.close(e)})},this.destroy=function(e){i.destroy(e)},this.setOperationRouter(new ops.TrivialOperationRouter)},gui.AnnotationController=function(e,t,n){function r(){var e=a.getCursor(n),e=e&&e.getNode(),t=!1;e&&(t=!u.isWithinAnnotation(e,a.getRootNode())),t!==l&&(l=t,c.emit(gui.AnnotationController.annotatableChanged,l))}function i(e){e.getMemberId()===n&&r()}function o(e){e===n&&r()}function s(e){e.getMemberId()===n&&r()}var a=e.getOdtDocument(),l=!1,c=new core.EventNotifier([gui.AnnotationController.annotatableChanged]),u=odf.OdfUtils,d=core.StepDirection.NEXT;this.isAnnotatable=function(){return l},this.addAnnotation=function(){var t=new ops.OpAddAnnotation,r=a.getCursorSelection(n),i=r.length,r=r.position;l&&(0===i?i=void 0:(r=0<=i?r:r+i,i=Math.abs(i)),t.init({memberid:n,position:r,length:i,name:n+Date.now()}),e.enqueue([t]))},this.removeAnnotation=function(r){var i,o;i=a.getMember(n).getProperties().fullName,!0===t.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)&&i!==u.getAnnotationCreator(r)||(i=a.convertDomPointToCursorStep(r,0,d),o=a.convertDomPointToCursorStep(r,r.childNodes.length),(r=new ops.OpRemoveAnnotation).init({memberid:n,position:i,length:o-i}),(o=new ops.OpMoveCursor).init({memberid:n,position:0<i?i-1:i,length:0}),e.enqueue([r,o]))},this.subscribe=function(e,t){c.subscribe(e,t)},this.unsubscribe=function(e,t){c.unsubscribe(e,t)},this.destroy=function(e){a.unsubscribe(ops.Document.signalCursorAdded,i),a.unsubscribe(ops.Document.signalCursorRemoved,o),a.unsubscribe(ops.Document.signalCursorMoved,s),e()},t.registerConstraint(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN),a.subscribe(ops.Document.signalCursorAdded,i),a.subscribe(ops.Document.signalCursorRemoved,o),a.subscribe(ops.Document.signalCursorMoved,s),r()},gui.AnnotationController.annotatableChanged="annotatable/changed",gui.Avatar=function(e,t){var n,r,i,o=this;this.setColor=function(e){r.style.borderColor=e},this.setImageUrl=function(e){o.isVisible()?r.src=e:i=e},this.isVisible=function(){return"block"===n.style.display},this.show=function(){i&&(r.src=i,i=void 0),n.style.display="block"},this.hide=function(){n.style.display="none"},this.markAsFocussed=function(e){e?n.classList.add("active"):n.classList.remove("active")},this.destroy=function(t){e.removeChild(n),t()},function(){var i=e.ownerDocument;n=i.createElement("div"),r=i.createElement("img"),n.appendChild(r),n.style.display=t?"block":"none",n.className="handle",e.appendChild(n)}()},gui.StepInfo=function(){},gui.StepInfo.VisualDirection={LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1},gui.StepInfo.prototype.container=function(){},gui.StepInfo.prototype.offset=function(){},gui.VisualStepScanner=function(){},gui.VisualStepScanner.prototype.process=function(e,t,n){},gui.GuiStepUtils=function(){function e(e){var i,o=null;return(e=n.getContentBounds(e))&&(e.container.nodeType===Node.TEXT_NODE?((i=e.container.ownerDocument.createRange()).setStart(e.container,e.startOffset),i.setEnd(e.container,e.endOffset),(o=0<i.getClientRects().length?i.getBoundingClientRect():null)&&" "===e.container.data.substring(e.startOffset,e.endOffset)&&1>=o.width&&(o=null),i.detach()):(t.isCharacterElement(e.container)||t.isCharacterFrame(e.container))&&(o=r.getBoundingClientRect(e.container))),o}var t=odf.OdfUtils,n=new odf.StepUtils,r=core.DomUtils,i=core.StepDirection.NEXT,o=gui.StepInfo.VisualDirection.LEFT_TO_RIGHT,s=gui.StepInfo.VisualDirection.RIGHT_TO_LEFT;this.getContentRect=e,this.moveToFilteredStep=function(t,n,r){function a(e,t){return t.process(p,u,d)&&(e=!0,!h&&t.token&&(h=t.token)),e}var l,c,u,d,h,p,f=n===i,m=t.snapshot();l=!1;do{l=e(t),p={token:t.snapshot(),container:t.container,offset:t.offset,direction:n,visualDirection:n===i?o:s},c=t.nextStep()?e(t):null,t.restore(p.token),f?(u=l,d=c):(u=c,d=l),l=r.reduce(a,!1)}while(!l&&t.advanceStep(n));return l||r.forEach(function(e){!h&&e.token&&(h=e.token)}),t.restore(h||m),Boolean(h)}},gui.Caret=function(e,t,n,r){function i(){u.style.opacity="0"===u.style.opacity?"1":"0",b.trigger()}function o(){return f.selectNodeContents(p),f.getBoundingClientRect()}function s(e){return _[e]!==w[e]}function a(){if(!1===w.isShown||e.getSelectionType()!==ops.OdtCursor.RangeSelection||!r&&!e.getSelectedRange().collapsed?(w.visibility="hidden",u.style.visibility="hidden",b.cancel()):(w.visibility="visible",u.style.visibility="visible",!1===w.isFocused?(u.style.opacity="1",b.cancel()):((C||s("visibility"))&&(u.style.opacity="1",b.cancel()),b.trigger())),A||x){var n;n=e.getNode();var i,a,l=v.getBoundingClientRect(y.getSizer()),p=!1,f=0;if(n.removeAttributeNS("urn:webodf:names:cursor","caret-sizer-active"),0<n.getClientRects().length)a=o(),f=a.left-v.getBoundingClientRect(n).left,p=!0;else if(m.setPosition(n,0),!(a=S.getContentRect(m))&&m.nextStep()&&(i=S.getContentRect(m))&&(a=i,p=!0),a||(n.setAttributeNS("urn:webodf:names:cursor","caret-sizer-active","true"),a=o(),p=!0),!a)for(runtime.log("WARN: No suitable client rectangle found for visual caret for "+e.getMemberId());n;){if(0<n.getClientRects().length){a=v.getBoundingClientRect(n),p=!0;break}n=n.parentNode}a=v.translateRect(a,l,y.getZoomLevel()),8>(n={top:a.top,height:a.height,right:p?a.left:a.right,width:v.adaptRangeDifferenceToZoomLevel(f,y.getZoomLevel())}).height&&(n={top:n.top-(8-n.height)/2,height:8,right:n.right}),c.style.height=n.height+"px",c.style.top=n.top+"px",c.style.left=n.right-n.width+"px",c.style.width=n.width?n.width+"px":"",h&&((n=runtime.getWindow().getComputedStyle(e.getNode(),null)).font?h.style.font=n.font:(h.style.fontStyle=n.fontStyle,h.style.fontVariant=n.fontVariant,h.style.fontWeight=n.fontWeight,h.style.fontSize=n.fontSize,h.style.lineHeight=n.lineHeight,h.style.fontFamily=n.fontFamily))}w.isShown&&x&&t.scrollIntoView(u.getBoundingClientRect()),s("isFocused")&&d.markAsFocussed(w.isFocused),Object.keys(w).forEach(function(e){_[e]=w[e]}),A=x=C=!1}function l(e){c.parentNode.removeChild(c),p.parentNode.removeChild(p),e()}var c,u,d,h,p,f,m,g,b,y=e.getDocument().getCanvas(),v=core.DomUtils,S=new gui.GuiStepUtils,C=!1,x=!1,A=!1,w={isFocused:!1,isShown:!0,visibility:"hidden"},_={isFocused:!w.isFocused,isShown:!w.isShown,visibility:"hidden"};this.handleUpdate=function(){A=!0,g.trigger()},this.refreshCursorBlinking=function(){C=!0,g.trigger()},this.setFocus=function(){w.isFocused=!0,g.trigger()},this.removeFocus=function(){w.isFocused=!1,g.trigger()},this.show=function(){w.isShown=!0,g.trigger()},this.hide=function(){w.isShown=!1,g.trigger()},this.setAvatarImageUrl=function(e){d.setImageUrl(e)},this.setColor=function(e){u.style.borderColor=e,d.setColor(e)},this.getCursor=function(){return e},this.getFocusElement=function(){return u},this.toggleHandleVisibility=function(){d.isVisible()?d.hide():d.show()},this.showHandle=function(){d.show()},this.hideHandle=function(){d.hide()},this.setOverlayElement=function(e){h=e,c.appendChild(e),A=!0,g.trigger()},this.ensureVisible=function(){x=!0,g.trigger()},this.getBoundingClientRect=function(){return v.getBoundingClientRect(c)},this.destroy=function(e){core.Async.destroyAll([g.destroy,b.destroy,d.destroy,l],e)},function(){var t=e.getDocument(),r=[t.createRootFilter(e.getMemberId()),t.getPositionFilter()],o=t.getDOMDocument();f=o.createRange(),(p=o.createElement("span")).className="webodf-caretSizer",p.textContent="|",e.getNode().appendChild(p),(c=o.createElement("div")).setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",e.getMemberId()),c.className="webodf-caretOverlay",(u=o.createElement("div")).className="caret",c.appendChild(u),d=new gui.Avatar(c,n),y.getSizer().appendChild(c),m=t.createStepIterator(e.getNode(),0,r,t.getRootNode()),g=core.Task.createRedrawTask(a),b=core.Task.createTimeoutTask(i,500),g.triggerImmediate()}()},odf.TextSerializer=function(){var e=this,t=odf.OdfUtils;this.filter=null,this.writeToString=function(n){return n?("\n"===(n=function n(r){var i,o="",s=e.filter?e.filter.acceptNode(r):NodeFilter.FILTER_ACCEPT,a=r.nodeType;if((s===NodeFilter.FILTER_ACCEPT||s===NodeFilter.FILTER_SKIP)&&t.isTextContentContainingNode(r))for(i=r.firstChild;i;)o+=n(i),i=i.nextSibling;s===NodeFilter.FILTER_ACCEPT&&(a===Node.ELEMENT_NODE&&t.isParagraph(r)?o+="\n":a===Node.TEXT_NODE&&r.textContent&&(o+=r.textContent));return o}(n))[n.length-1]&&(n=n.substr(0,n.length-1)),n):""}},gui.MimeDataExporter=function(){var e;this.exportRangeToDataTransfer=function(t,n){var r;(r=n.startContainer.ownerDocument.createElement("span")).appendChild(n.cloneContents()),r=e.writeToString(r);try{t.setData("text/plain",r)}catch(e){t.setData("Text",r)}},(e=new odf.TextSerializer).filter=new odf.OdfNodeFilter},gui.Clipboard=function(e){this.setDataFromRange=function(t,n){var r,i=t.clipboardData;return r=runtime.getWindow(),!i&&r&&(i=r.clipboardData),i?(r=!0,e.exportRangeToDataTransfer(i,n),t.preventDefault()):r=!1,r}},gui.SessionContext=function(e,t){var n=e.getOdtDocument(),r=odf.OdfUtils;this.isLocalCursorWithinOwnAnnotation=function(){var e,i=n.getCursor(t);return!!i&&(e=i&&i.getNode(),i=n.getMember(t).getProperties().fullName,!(!(e=r.getParentAnnotation(e,n.getRootNode()))||r.getAnnotationCreator(e)!==i))}},gui.StyleSummary=function(e){function t(t,n){var r,o=t+"|"+n;return i.hasOwnProperty(o)||(r=[],e.forEach(function(e){e=(e=e.styleProperties[t])&&e[n],-1===r.indexOf(e)&&r.push(e)}),i[o]=r),i[o]}function n(e,n,r){return function(){var i=t(e,n);return r.length>=i.length&&i.every(function(e){return-1!==r.indexOf(e)})}}function r(e,n){var r=t(e,n);return 1===r.length?r[0]:void 0}var i={};this.getPropertyValues=t,this.getCommonValue=r,this.isBold=n("style:text-properties","fo:font-weight",["bold"]),this.isItalic=n("style:text-properties","fo:font-style",["italic"]),this.hasUnderline=n("style:text-properties","style:text-underline-style",["solid"]),this.hasStrikeThrough=n("style:text-properties","style:text-line-through-style",["solid"]),this.fontSize=function(){var e=r("style:text-properties","fo:font-size");return e&&parseFloat(e)},this.fontName=function(){return r("style:text-properties","style:font-name")},this.isAlignedLeft=n("style:paragraph-properties","fo:text-align",["left","start"]),this.isAlignedCenter=n("style:paragraph-properties","fo:text-align",["center"]),this.isAlignedRight=n("style:paragraph-properties","fo:text-align",["right","end"]),this.isAlignedJustified=n("style:paragraph-properties","fo:text-align",["justify"]),this.text={isBold:this.isBold,isItalic:this.isItalic,hasUnderline:this.hasUnderline,hasStrikeThrough:this.hasStrikeThrough,fontSize:this.fontSize,fontName:this.fontName},this.paragraph={isAlignedLeft:this.isAlignedLeft,isAlignedCenter:this.isAlignedCenter,isAlignedRight:this.isAlignedRight,isAlignedJustified:this.isAlignedJustified}},gui.DirectFormattingController=function(e,t,n,r,i,o,s){function a(){return D.value().styleSummary}function l(){return D.value().enabledFeatures}function c(e){var t;return e.collapsed?((t=e.startContainer).hasChildNodes()&&e.startOffset<t.childNodes.length&&(t=t.childNodes.item(e.startOffset)),e=[t]):e=L.getTextElements(e,!0,!1),e}function u(){var e=F.getCursor(r),i=e&&e.getSelectedRange(),o=[],o=[],s=!0,a={directTextStyling:!0,directParagraphStyling:!0};return i&&(0===(o=c(i)).length&&(o=[i.startContainer,i.endContainer],s=!1),o=F.getFormatting().getAppliedStyles(o)),void 0!==o[0]&&j&&(o[0].styleProperties=M.mergeObjects(o[0].styleProperties,j)),!0===t.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(a.directTextStyling=a.directParagraphStyling=n.isLocalCursorWithinOwnAnnotation()),a.directTextStyling&&(a.directTextStyling=s&&void 0!==e&&e.getSelectionType()===ops.OdtCursor.RangeSelection),{enabledFeatures:a,appliedStyles:o,styleSummary:new gui.StyleSummary(o)}}function d(e,t){var n={};return Object.keys(e).forEach(function(r){var i=e[r](),o=t[r]();i!==o&&(n[r]=o)}),n}function h(){var e,t;t=O.styleSummary;var n=D.value(),r=n.styleSummary,i=O.enabledFeatures,o=n.enabledFeatures;e=d(t.text,r.text),t=d(t.paragraph,r.paragraph),i=!(o.directTextStyling===i.directTextStyling&&o.directParagraphStyling===i.directParagraphStyling),O=n,i&&B.emit(gui.DirectFormattingController.enabledChanged,o),0<Object.keys(e).length&&B.emit(gui.DirectFormattingController.textStylingChanged,e),0<Object.keys(t).length&&B.emit(gui.DirectFormattingController.paragraphStylingChanged,t)}function p(){D.reset(),h()}function f(e){("string"==typeof e?e:e.getMemberId())===r&&D.reset()}function m(){D.reset()}function g(e){var t=F.getCursor(r);e=e.paragraphElement,t&&L.getParagraphElement(t.getNode())===e&&D.reset()}function b(e,t){return t(!e()),!0}function y(t){if(l().directTextStyling){var n=F.getCursorSelection(r),i={"style:text-properties":t};0!==n.length?((t=new ops.OpApplyDirectStyling).init({memberid:r,position:n.position,length:n.length,setProperties:i}),e.enqueue([t])):(j=M.mergeObjects(j||{},i),D.reset())}}function v(e,t){var n={};n[e]=t,y(n)}function S(e){e=e.spec(),j&&e.memberid===r&&"SplitParagraph"!==e.optype&&(j=null,D.reset())}function C(e){v("fo:font-weight",e?"bold":"normal")}function x(e){v("fo:font-style",e?"italic":"normal")}function A(e){v("style:text-underline-style",e?"solid":"none")}function w(e){v("style:text-line-through-style",e?"solid":"none")}function _(t){if(l().directParagraphStyling){var n,o=F.getCursor(r).getSelectedRange(),o=L.getParagraphElements(o),s=F.getFormatting(),a=[],c={};o.forEach(function(e){var o,l=F.convertDomPointToCursorStep(e,0,z),u=e.getAttributeNS(odf.Namespaces.textns,"style-name");(e=u?c.hasOwnProperty(u)?c[u]:void 0:n)||(e=i.generateStyleName(),u?(c[u]=e,o=s.createDerivedStyleObject(u,"paragraph",{})):(n=e,o={}),o=t(o),(u=new ops.OpAddStyle).init({memberid:r,styleName:e.toString(),styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:o}),a.push(u)),(u=new ops.OpSetParagraphStyle).init({memberid:r,styleName:e.toString(),position:l}),a.push(u)}),e.enqueue(a)}}function N(e){!function(e){_(function(t){return M.mergeObjects(t,e)})}({"style:paragraph-properties":{"fo:text-align":e}})}function E(e,t){var n,r=F.getFormatting().getDefaultTabStopDistance(),i=t["style:paragraph-properties"];return i&&(i=i["fo:margin-left"],n=L.parseLength(i)),M.mergeObjects(t,{"style:paragraph-properties":{"fo:margin-left":n&&n.unit===r.unit?n.value+e*r.value+n.unit:e*r.value+r.unit}})}function T(e,t){var n=c(e),n=0===n.length?[e.startContainer]:n,n=F.getFormatting().getAppliedStyles(n),r=0<n.length?n[0].styleProperties:void 0,i=F.getFormatting().getAppliedStylesForElement(t).styleProperties;return!(!r||"text"!==r["style:family"]||!r["style:text-properties"])&&(!i||!i["style:text-properties"]||(r=r["style:text-properties"],i=i["style:text-properties"],!Object.keys(r).every(function(e){return r[e]===i[e]})))}function k(){}function P(){return!1}function R(){return!1}var O,D,I=this,F=e.getOdtDocument(),M=new core.Utils,L=odf.OdfUtils,B=new core.EventNotifier([gui.DirectFormattingController.enabledChanged,gui.DirectFormattingController.textStylingChanged,gui.DirectFormattingController.paragraphStylingChanged]),U=odf.Namespaces.textns,z=core.StepDirection.NEXT,j=null;this.enabledFeatures=l,this.formatTextSelection=y,this.createCursorStyleOp=function(e,t,n){var i=null,o=j;return n&&(o=(n=D.value().appliedStyles[0])&&n.styleProperties),o&&o["style:text-properties"]&&((i=new ops.OpApplyDirectStyling).init({memberid:r,position:e,length:t,setProperties:{"style:text-properties":o["style:text-properties"]}}),j=null,D.reset()),i},this.setBold=C,this.setItalic=x,this.setHasUnderline=A,this.setHasStrikethrough=w,this.setFontSize=function(e){v("fo:font-size",e+"pt")},this.setFontName=function(e){v("style:font-name",e)},this.getAppliedStyles=function(){return D.value().appliedStyles},this.toggleBold=b.bind(I,function(){return a().isBold()},C),this.toggleItalic=b.bind(I,function(){return a().isItalic()},x),this.toggleUnderline=b.bind(I,function(){return a().hasUnderline()},A),this.toggleStrikethrough=b.bind(I,function(){return a().hasStrikeThrough()},w),this.isBold=function(){return a().isBold()},this.isItalic=function(){return a().isItalic()},this.hasUnderline=function(){return a().hasUnderline()},this.hasStrikeThrough=function(){return a().hasStrikeThrough()},this.fontSize=function(){return a().fontSize()},this.fontName=function(){return a().fontName()},this.isAlignedLeft=function(){return a().isAlignedLeft()},this.isAlignedCenter=function(){return a().isAlignedCenter()},this.isAlignedRight=function(){return a().isAlignedRight()},this.isAlignedJustified=function(){return a().isAlignedJustified()},this.alignParagraphLeft=function(){return N("left"),!0},this.alignParagraphCenter=function(){return N("center"),!0},this.alignParagraphRight=function(){return N("right"),!0},this.alignParagraphJustified=function(){return N("justify"),!0},this.indent=function(){return _(E.bind(null,1)),!0},this.outdent=function(){return _(E.bind(null,-1)),!0},this.createParagraphStyleOps=function(e){if(!l().directParagraphStyling)return[];var t,n,o=F.getCursor(r),s=o.getSelectedRange(),a=[];o.hasForwardSelection()?(t=o.getAnchorNode(),n=o.getNode()):(t=o.getNode(),n=o.getAnchorNode()),o=L.getParagraphElement(n),runtime.assert(Boolean(o),"DirectFormattingController: Cursor outside paragraph");var c=o,u=[F.getPositionFilter(),F.createRootFilter(r)];return!1!==F.createStepIterator(s.endContainer,s.endOffset,u,c).nextStep()?a:(n!==t&&(o=L.getParagraphElement(t)),(j||T(s,o))&&(s=(s=D.value().appliedStyles[0])&&s.styleProperties)?((o=o.getAttributeNS(U,"style-name"))&&(s={"style:text-properties":s["style:text-properties"]},s=F.getFormatting().createDerivedStyleObject(o,"paragraph",s)),t=i.generateStyleName(),(o=new ops.OpAddStyle).init({memberid:r,styleName:t,styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:s}),a.push(o),(o=new ops.OpSetParagraphStyle).init({memberid:r,styleName:t,position:e}),a.push(o),a):a)},this.subscribe=function(e,t){B.subscribe(e,t)},this.unsubscribe=function(e,t){B.unsubscribe(e,t)},this.destroy=function(e){F.unsubscribe(ops.Document.signalCursorAdded,f),F.unsubscribe(ops.Document.signalCursorRemoved,f),F.unsubscribe(ops.Document.signalCursorMoved,f),F.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,m),F.unsubscribe(ops.OdtDocument.signalParagraphChanged,g),F.unsubscribe(ops.OdtDocument.signalOperationEnd,S),F.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,h),t.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,p),e()},F.subscribe(ops.Document.signalCursorAdded,f),F.subscribe(ops.Document.signalCursorRemoved,f),F.subscribe(ops.Document.signalCursorMoved,f),F.subscribe(ops.OdtDocument.signalParagraphStyleModified,m),F.subscribe(ops.OdtDocument.signalParagraphChanged,g),F.subscribe(ops.OdtDocument.signalOperationEnd,S),F.subscribe(ops.OdtDocument.signalProcessingBatchEnd,h),t.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,p),D=new core.LazyProperty(u),O=D.value(),o||(I.formatTextSelection=k,I.setBold=k,I.setItalic=k,I.setHasUnderline=k,I.setHasStrikethrough=k,I.setFontSize=k,I.setFontName=k,I.toggleBold=R,I.toggleItalic=R,I.toggleUnderline=R,I.toggleStrikethrough=R),s||(I.alignParagraphCenter=P,I.alignParagraphJustified=P,I.alignParagraphLeft=P,I.alignParagraphRight=P,I.createParagraphStyleOps=function(){return[]},I.indent=P,I.outdent=P)},gui.DirectFormattingController.enabledChanged="enabled/changed",gui.DirectFormattingController.textStylingChanged="textStyling/changed",gui.DirectFormattingController.paragraphStylingChanged="paragraphStyling/changed",gui.DirectFormattingController.SelectionInfo=function(){},gui.KeyboardHandler=function(){function e(e,n){switch(n||(n=t.None),e){case gui.KeyboardHandler.KeyCode.LeftMeta:case gui.KeyboardHandler.KeyCode.RightMeta:case gui.KeyboardHandler.KeyCode.MetaInMozilla:n|=t.Meta;break;case gui.KeyboardHandler.KeyCode.Ctrl:n|=t.Ctrl;break;case gui.KeyboardHandler.KeyCode.Alt:n|=t.Alt;break;case gui.KeyboardHandler.KeyCode.Shift:n|=t.Shift}return e+":"+n}var t=gui.KeyboardHandler.Modifier,n=null,r={};this.setDefault=function(e){n=e},this.bind=function(t,n,i,o){t=e(t,n),runtime.assert(o||!1===r.hasOwnProperty(t),"tried to overwrite the callback handler of key combo: "+t),r[t]=i},this.unbind=function(t,n){var i=e(t,n);delete r[i]},this.reset=function(){n=null,r={}},this.handleEvent=function(i){var o=i.keyCode,s=t.None;i.metaKey&&(s|=t.Meta),i.ctrlKey&&(s|=t.Ctrl),i.altKey&&(s|=t.Alt),i.shiftKey&&(s|=t.Shift),o=e(o,s),o=r[o],s=!1,o?s=o():null!==n&&(s=n(i)),s&&(i.preventDefault?i.preventDefault():i.returnValue=!1)}},gui.KeyboardHandler.Modifier={None:0,Meta:1,Ctrl:2,Alt:4,CtrlAlt:6,Shift:8,MetaShift:9,CtrlShift:10,AltShift:12},gui.KeyboardHandler.KeyCode={Backspace:8,Tab:9,Clear:12,Enter:13,Shift:16,Ctrl:17,Alt:18,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Delete:46,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,RightMeta:93,MetaInMozilla:224},gui.HyperlinkClickHandler=function(e,t,n){function r(){var t=e();runtime.assert(Boolean(t.classList),"Document container has no classList element"),t.classList.remove("webodf-inactiveLinks")}function i(){var t=e();runtime.assert(Boolean(t.classList),"Document container has no classList element"),t.classList.add("webodf-inactiveLinks")}function o(){d.removeEventListener("focus",i,!1),p.forEach(function(e){t.unbind(e.keyCode,e.modifier),n.unbind(e.keyCode,e.modifier)}),p.length=0}function s(e){if(o(),e!==a.None){switch(d.addEventListener("focus",i,!1),e){case a.Ctrl:p.push({keyCode:l.Ctrl,modifier:a.None});break;case a.Meta:p.push({keyCode:l.LeftMeta,modifier:a.None}),p.push({keyCode:l.RightMeta,modifier:a.None}),p.push({keyCode:l.MetaInMozilla,modifier:a.None})}p.forEach(function(e){t.bind(e.keyCode,e.modifier,r),n.bind(e.keyCode,e.modifier,i)})}}var a=gui.KeyboardHandler.Modifier,l=gui.KeyboardHandler.KeyCode,c=xmldom.XPath,u=odf.OdfUtils,d=runtime.getWindow(),h=a.None,p=[];runtime.assert(null!==d,"Expected to be run in an environment which has a global window, like a browser."),this.handleClick=function(t){var n,r,i=t.target||t.srcElement;if(t.ctrlKey?n=a.Ctrl:t.metaKey&&(n=a.Meta),h===a.None||h===n){e:{for(;null!==i;){if(u.isHyperlink(i))break e;if(u.isParagraph(i))break;i=i.parentNode}i=null}i&&(""!==(i=u.getHyperlinkTarget(i))&&("#"===i[0]?(i=i.substring(1),n=e(),0===(r=c.getODFElementsWithXPath(n,"//text:bookmark-start[@text:name='"+i+"']",odf.Namespaces.lookupNamespaceURI)).length&&(r=c.getODFElementsWithXPath(n,"//text:bookmark[@text:name='"+i+"']",odf.Namespaces.lookupNamespaceURI)),0<r.length&&r[0].scrollIntoView(!0)):/^\s*(javascript|data):/.test(i)?runtime.log("WARN:","potentially malicious URL ignored"):d.open(i),t.preventDefault?t.preventDefault():t.returnValue=!1))}},this.setModifier=function(e){h!==e&&(runtime.assert(e===a.None||e===a.Ctrl||e===a.Meta,"Unsupported KeyboardHandler.Modifier value: "+e),(h=e)!==a.None?i():r(),s(h))},this.getModifier=function(){return h},this.destroy=function(e){i(),o(),e()}},gui.EventManager=function(e){function t(e,t,n){function r(t){n(t,i,function(t){t.type=e,o.emit(e,t)})}var i={},o=new core.EventNotifier([e]);this.subscribe=function(t){o.subscribe(e,t)},this.unsubscribe=function(t){o.unsubscribe(e,t)},this.destroy=function(){t.forEach(function(e){x.unsubscribe(e,r)})},t.forEach(function(e){x.subscribe(e,r)})}function n(e){runtime.clearTimeout(e),delete A[e]}function r(e,t,r){var i=e.touches.length,o=e.touches[0],s=t.timer;"touchmove"===e.type||"touchend"===e.type?s&&n(s):"touchstart"===e.type&&(1!==i?runtime.clearTimeout(s):s=function(e,t){var r=runtime.setTimeout(function(){e(),n(r)},t);return A[r]=!0,r}(function(){r({clientX:o.clientX,clientY:o.clientY,pageX:o.pageX,pageY:o.pageY,target:e.target||e.srcElement||null,detail:1})},400)),t.timer=s}function i(e,t,n){var r=e.touches[0],i=e.target||e.srcElement||null,o=t.target;1!==e.touches.length||"touchend"===e.type?o=null:"touchstart"===e.type&&"webodf-draggable"===i.getAttribute("class")?o=i:"touchmove"===e.type&&o&&(e.preventDefault(),e.stopPropagation(),n({clientX:r.clientX,clientY:r.clientY,pageX:r.pageX,pageY:r.pageY,target:o,detail:1})),t.target=o}function o(e,t,n){var r=e.target||e.srcElement||null,i=t.dragging;"drag"===e.type?i=!0:"touchend"===e.type&&i&&(i=!1,e=e.changedTouches[0],n({clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,target:r,detail:1})),t.dragging=i}function s(){C.classList.add("webodf-touchEnabled"),x.unsubscribe("touchstart",s)}function a(e){var t=e.scrollTop,n=e.scrollLeft;this.restore=function(){e.scrollTop===t&&e.scrollLeft===n||(e.scrollTop=t,e.scrollLeft=n)}}function l(e,t){var n=S[e]||v[e]||null;return!n&&t&&(n=S[e]=new function(e){function t(e,t,n){var r,i=!1;r="on"+t,e.attachEvent&&(e.attachEvent(r,n),i=!0),!i&&e.addEventListener&&(e.addEventListener(t,n,!1),i=!0),i&&!b[t]||!e.hasOwnProperty(r)||(e[r]=n)}function n(e,t,n){var r="on"+t;e.detachEvent&&e.detachEvent(r,n),e.removeEventListener&&e.removeEventListener(t,n,!1),e[r]===n&&(e[r]=null)}function r(t){if(-1===o.indexOf(t)){if(o.push(t),i.filters.every(function(e){return e(t)}))try{s.emit(e,t)}catch(t){runtime.log("Error occurred while processing "+e+":\n"+t.message+"\n"+t.stack)}runtime.setTimeout(function(){o.splice(o.indexOf(t),1)},0)}}var i=this,o=[],s=new core.EventNotifier([e]);this.filters=[],this.subscribe=function(t){s.subscribe(e,t)},this.unsubscribe=function(t){s.unsubscribe(e,t)},this.destroy=function(){n(g,e,r),n(m,e,r),n(C,e,r)},y[e]&&t(g,e,r),t(m,e,r),t(C,e,r)}(e)),n}function c(e,t){l(e,!0).subscribe(t)}function u(e,t){var n=l(e,!1);n&&n.unsubscribe(t)}function d(){return e.getDOMDocument().activeElement===m}function h(){d()&&m.blur(),m.setAttribute("disabled","true")}function p(){m.removeAttribute("disabled")}function f(){var e;d()||(e=function(e){for(var t=[];e;)(e.scrollWidth>e.clientWidth||e.scrollHeight>e.clientHeight)&&t.push(new a(e)),e=e.parentNode;return t.push(new function(e){var t=e.scrollX,n=e.scrollY;this.restore=function(){e.scrollX===t&&e.scrollY===n||e.scrollTo(t,n)}}(g)),t}(m),p(),m.focus(),e.forEach(function(e){e.restore()}))}var m,g=runtime.getWindow(),b={beforecut:!0,beforepaste:!0,longpress:!0,drag:!0,dragstop:!0},y={mousedown:!0,mouseup:!0,focus:!0},v={},S={},C=e.getCanvas().getElement(),x=this,A={};this.addFilter=function(e,t){l(e,!0).filters.push(t)},this.removeFilter=function(e,t){var n=l(e,!0),r=n.filters.indexOf(t);-1!==r&&n.filters.splice(r,1)},this.subscribe=c,this.unsubscribe=u,this.hasFocus=d,this.focus=f,this.getEventTrap=function(){return m},this.setEditing=function(e){var t=d();t&&m.blur(),e?m.removeAttribute("readOnly"):m.setAttribute("readOnly","true"),t&&f()},this.destroy=function(e){u("touchstart",s),Object.keys(A).forEach(function(e){n(parseInt(e,10))}),A.length=0,Object.keys(v).forEach(function(e){v[e].destroy()}),v={},u("mousedown",h),u("mouseup",p),u("contextmenu",p),Object.keys(S).forEach(function(e){S[e].destroy()}),S={},m.parentNode.removeChild(m),e()},function(){var n=e.getOdfCanvas().getSizer(),a=n.ownerDocument;runtime.assert(Boolean(g),"EventManager requires a window object to operate correctly"),(m=a.createElement("textarea")).id="eventTrap",m.setAttribute("tabindex","-1"),m.setAttribute("readOnly","true"),m.setAttribute("rows","1"),n.appendChild(m),c("mousedown",h),c("mouseup",p),c("contextmenu",p),v.longpress=new t("longpress",["touchstart","touchmove","touchend"],r),v.drag=new t("drag",["touchstart","touchmove","touchend"],i),v.dragstop=new t("dragstop",["drag","touchend"],o),c("touchstart",s)}()},gui.IOSSafariSupport=function(e){function t(){n.innerHeight!==n.outerHeight&&(r.style.display="none",runtime.requestAnimationFrame(function(){r.style.display="block"}))}var n=runtime.getWindow(),r=e.getEventTrap();this.destroy=function(n){e.unsubscribe("focus",t),r.removeAttribute("autocapitalize"),r.style.WebkitTransform="",n()},e.subscribe("focus",t),r.setAttribute("autocapitalize","off"),r.style.WebkitTransform="translateX(-10000px)"},gui.HyperlinkController=function(e,t,n,r){function i(){var e=!0;!0===t.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(e=n.isLocalCursorWithinOwnAnnotation()),e!==c&&(c=e,l.emit(gui.HyperlinkController.enabledChanged,c))}function o(e){e.getMemberId()===r&&i()}var s=odf.OdfUtils,a=e.getOdtDocument(),l=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),c=!1;this.isEnabled=function(){return c},this.subscribe=function(e,t){l.subscribe(e,t)},this.unsubscribe=function(e,t){l.unsubscribe(e,t)},this.addHyperlink=function(t,n){if(c){var i=a.getCursorSelection(r),o=new ops.OpApplyHyperlink,s=[];(0===i.length||n)&&(n=n||t,(o=new ops.OpInsertText).init({memberid:r,position:i.position,text:n}),i.length=n.length,s.push(o)),(o=new ops.OpApplyHyperlink).init({memberid:r,position:i.position,length:i.length,hyperlink:t}),s.push(o),e.enqueue(s)}},this.removeHyperlinks=function(){if(c){var t,n,i=a.createPositionIterator(a.getRootNode()),o=a.getCursor(r).getSelectedRange(),l=s.getHyperlinkElements(o),u=o.collapsed&&1===l.length,d=a.getDOMDocument().createRange(),h=[];0!==l.length&&(l.forEach(function(e){d.selectNodeContents(e),t=a.convertDomToCursorRange({anchorNode:d.startContainer,anchorOffset:d.startOffset,focusNode:d.endContainer,focusOffset:d.endOffset}),(n=new ops.OpRemoveHyperlink).init({memberid:r,position:t.position,length:t.length}),h.push(n)}),u||(u=l[0],-1===o.comparePoint(u,0)&&(d.setStart(u,0),d.setEnd(o.startContainer,o.startOffset),0<(t=a.convertDomToCursorRange({anchorNode:d.startContainer,anchorOffset:d.startOffset,focusNode:d.endContainer,focusOffset:d.endOffset})).length&&((n=new ops.OpApplyHyperlink).init({memberid:r,position:t.position,length:t.length,hyperlink:s.getHyperlinkTarget(u)}),h.push(n))),l=l[l.length-1],i.moveToEndOfNode(l),i=i.unfilteredDomOffset(),1===o.comparePoint(l,i)&&(d.setStart(o.endContainer,o.endOffset),d.setEnd(l,i),0<(t=a.convertDomToCursorRange({anchorNode:d.startContainer,anchorOffset:d.startOffset,focusNode:d.endContainer,focusOffset:d.endOffset})).length&&((n=new ops.OpApplyHyperlink).init({memberid:r,position:t.position,length:t.length,hyperlink:s.getHyperlinkTarget(l)}),h.push(n)))),e.enqueue(h),d.detach())}},this.destroy=function(e){a.unsubscribe(ops.Document.signalCursorMoved,o),t.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,i),e()},a.subscribe(ops.Document.signalCursorMoved,o),t.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,i),i()},gui.HyperlinkController.enabledChanged="enabled/changed",gui.ImageController=function(e,t,n,r,i){function o(){var e=!0;!0===t.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(e=n.isLocalCursorWithinOwnAnnotation()),e!==p&&(p=e,h.emit(gui.ImageController.enabledChanged,p))}function s(e){e.getMemberId()===r&&o()}var a={"image/gif":".gif","image/jpeg":".jpg","image/png":".png"},l=odf.Namespaces.textns,c=e.getOdtDocument(),u=odf.OdfUtils,d=c.getFormatting(),h=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),p=!1;this.isEnabled=function(){return p},this.subscribe=function(e,t){h.subscribe(e,t)},this.unsubscribe=function(e,t){h.unsubscribe(e,t)},this.insertImage=function(t,n,o,s){if(p){var h=new core.CSSUnits;if(runtime.assert(0<o&&0<s,"Both width and height of the image should be greater than 0px."),s={width:o,height:s},o=u.getParagraphElement(c.getCursor(r).getNode()).getAttributeNS(l,"style-name")){o=d.getContentSize(o,"paragraph");var f=1,m=1;s.width>o.width&&(f=o.width/s.width),s.height>o.height&&(m=o.height/s.height),o=Math.min(f,m),s={width:s.width*o,height:s.height*o}}o=h.convert(s.width,"px","cm")+"cm",h=h.convert(s.height,"px","cm")+"cm",m=c.getOdfCanvas().odfContainer().rootElement.styles,s=t.toLowerCase();var g,f=a.hasOwnProperty(s)?a[s]:null;s=[],runtime.assert(null!==f,"Image type is not supported: "+t),f="Pictures/"+i.generateImageName()+f,(g=new ops.OpSetBlob).init({memberid:r,filename:f,mimetype:t,content:n}),s.push(g),d.getStyleElement("Graphics","graphic",[m])||((t=new ops.OpAddStyle).init({memberid:r,styleName:"Graphics",styleFamily:"graphic",isAutomaticStyle:!1,setProperties:{"style:graphic-properties":{"text:anchor-type":"paragraph","svg:x":"0cm","svg:y":"0cm","style:wrap":"dynamic","style:number-wrapped-paragraphs":"no-limit","style:wrap-contour":"false","style:vertical-pos":"top","style:vertical-rel":"paragraph","style:horizontal-pos":"center","style:horizontal-rel":"paragraph"}}}),s.push(t)),t=i.generateStyleName(),(n=new ops.OpAddStyle).init({memberid:r,styleName:t,styleFamily:"graphic",isAutomaticStyle:!0,setProperties:{"style:parent-style-name":"Graphics","style:graphic-properties":{"style:vertical-pos":"top","style:vertical-rel":"baseline","style:horizontal-pos":"center","style:horizontal-rel":"paragraph","fo:background-color":"transparent","style:background-transparency":"100%","style:shadow":"none","style:mirror":"none","fo:clip":"rect(0cm, 0cm, 0cm, 0cm)","draw:luminance":"0%","draw:contrast":"0%","draw:red":"0%","draw:green":"0%","draw:blue":"0%","draw:gamma":"100%","draw:color-inversion":"false","draw:image-opacity":"100%","draw:color-mode":"standard"}}}),s.push(n),(g=new ops.OpInsertImage).init({memberid:r,position:c.getCursorPosition(r),filename:f,frameWidth:o,frameHeight:h,frameStyleName:t,frameName:i.generateFrameName()}),s.push(g),e.enqueue(s)}},this.destroy=function(e){c.unsubscribe(ops.Document.signalCursorMoved,s),t.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,o),e()},c.subscribe(ops.Document.signalCursorMoved,s),t.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,o),o()},gui.ImageController.enabledChanged="enabled/changed",gui.ImageSelector=function(e){function t(){var t=e.getSizer(),n=i.createElement("div");return n.id="imageSelector",n.style.borderWidth="1px",t.appendChild(n),r.forEach(function(e){var t=i.createElement("div");t.className=e,n.appendChild(t)}),n}var n=odf.Namespaces.svgns,r="topLeft topRight bottomRight bottomLeft topMiddle rightMiddle bottomMiddle leftMiddle".split(" "),i=e.getElement().ownerDocument,o=!1;this.select=function(r){var s,a,l=i.getElementById("imageSelector");l||(l=t()),o=!0,s=l.parentNode,a=r.getBoundingClientRect();var c=s.getBoundingClientRect(),u=e.getZoomLevel();s=(a.left-c.left)/u-1,a=(a.top-c.top)/u-1,l.style.display="block",l.style.left=s+"px",l.style.top=a+"px",l.style.width=r.getAttributeNS(n,"width"),l.style.height=r.getAttributeNS(n,"height")},this.clearSelection=function(){var e;o&&(e=i.getElementById("imageSelector"))&&(e.style.display="none"),o=!1},this.isSelectorElement=function(e){var t=i.getElementById("imageSelector");return!!t&&(e===t||e.parentNode===t)}},function(){gui.InputMethodEditor=function(e,t){function n(e){m&&(e?m.getNode().setAttributeNS("urn:webodf:names:cursor","composing","true"):(m.getNode().removeAttributeNS("urn:webodf:names:cursor","composing"),u.textContent=""))}function r(){y&&(y=!1,n(!1),S.emit(gui.InputMethodEditor.signalCompositionEnd,{data:v}),v="")}function i(){x||(x=!0,r(),m&&m.getSelectedRange().collapsed?g.value="":g.value=p.writeToString(m.getSelectedRange().cloneContents()),g.setSelectionRange(0,g.value.length),x=!1)}function o(){t.hasFocus()&&d.trigger()}function s(){h=void 0,d.cancel(),n(!0),y||S.emit(gui.InputMethodEditor.signalCompositionStart,{data:""})}function a(e){e=h=e.data,y=!0,v+=e,d.trigger()}function l(e){e.data!==h&&(e=e.data,y=!0,v+=e,d.trigger()),h=void 0}function c(){u.textContent=g.value}var u,d,h,p,f,m=null,g=t.getEventTrap(),b=g.ownerDocument,y=!1,v="",S=new core.EventNotifier([gui.InputMethodEditor.signalCompositionStart,gui.InputMethodEditor.signalCompositionEnd]),C=[],x=!1;this.subscribe=S.subscribe,this.unsubscribe=S.unsubscribe,this.registerCursor=function(n){n.getMemberId()===e&&((m=n).getNode().appendChild(u),n.subscribe(ops.OdtCursor.signalCursorUpdated,o),t.subscribe("input",c),t.subscribe("compositionupdate",c))},this.removeCursor=function(n){m&&n===e&&(m.getNode().removeChild(u),m.unsubscribe(ops.OdtCursor.signalCursorUpdated,o),t.unsubscribe("input",c),t.unsubscribe("compositionupdate",c),m=null)},this.destroy=function(e){t.unsubscribe("compositionstart",s),t.unsubscribe("compositionend",a),t.unsubscribe("textInput",l),t.unsubscribe("keypress",r),t.unsubscribe("focus",i),core.Async.destroyAll(f,e)},(p=new odf.TextSerializer).filter=new odf.OdfNodeFilter,t.subscribe("compositionstart",s),t.subscribe("compositionend",a),t.subscribe("textInput",l),t.subscribe("keypress",r),t.subscribe("focus",i),C.push(new function(e){function t(e){return o=e.which&&String.fromCharCode(e.which)===i,i=void 0,!1===o}function n(){o=!1}function r(e){i=e.data,o=!1}var i,o=!1;this.destroy=function(i){e.unsubscribe("textInput",n),e.unsubscribe("compositionend",r),e.removeFilter("keypress",t),i()},e.subscribe("textInput",n),e.subscribe("compositionend",r),e.addFilter("keypress",t)}(t)),f=C.map(function(e){return e.destroy}),(u=b.createElement("span")).setAttribute("id","composer"),d=core.Task.createTimeoutTask(i,1),f.push(d.destroy)},gui.InputMethodEditor.signalCompositionStart="input/compositionstart",gui.InputMethodEditor.signalCompositionEnd="input/compositionend"}(),gui.MetadataController=function(e,t){function n(e){o.emit(gui.MetadataController.signalMetadataChanged,e)}function r(e){var t=-1===s.indexOf(e);return t||runtime.log("Setting "+e+" is restricted."),t}var i=e.getOdtDocument(),o=new core.EventNotifier([gui.MetadataController.signalMetadataChanged]),s=["dc:creator","dc:date","meta:editing-cycles","meta:editing-duration","meta:document-statistic"];this.setMetadata=function(n,i){var o,s={},a="";n&&Object.keys(n).filter(r).forEach(function(e){s[e]=n[e]}),i&&(a=i.filter(r).join(",")),(0<a.length||0<Object.keys(s).length)&&((o=new ops.OpUpdateMetadata).init({memberid:t,setProperties:s,removedProperties:0<a.length?{attributes:a}:null}),e.enqueue([o]))},this.getMetadata=function(e){var t;return runtime.assert("string"==typeof e,"Property must be a string"),t=e.split(":"),runtime.assert(2===t.length,"Property must be a namespace-prefixed string"),e=odf.Namespaces.lookupNamespaceURI(t[0]),runtime.assert(Boolean(e),"Prefix must be for an ODF namespace."),i.getOdfCanvas().odfContainer().getMetadata(e,t[1])},this.subscribe=function(e,t){o.subscribe(e,t)},this.unsubscribe=function(e,t){o.unsubscribe(e,t)},this.destroy=function(e){i.unsubscribe(ops.OdtDocument.signalMetadataUpdated,n),e()},i.subscribe(ops.OdtDocument.signalMetadataUpdated,n)},gui.MetadataController.signalMetadataChanged="metadata/changed",gui.PasteController=function(e,t,n,r){function i(){a=!0!==t.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)||n.isLocalCursorWithinOwnAnnotation()}function o(e){e.getMemberId()===r&&i()}var s=e.getOdtDocument(),a=!1,l=odf.Namespaces.textns,c=core.StepDirection.NEXT,u=odf.OdfUtils;this.isEnabled=function(){return a},this.paste=function(t){if(a){var n=s.getCursorPosition(r),i=s.getCursor(r).getNode(),i=u.getParagraphElement(i),o=i.getAttributeNS(l,"style-name")||"",d=n,h=[],p=s.convertDomPointToCursorStep(i,0,c);t.replace(/\r/g,"").split("\n").forEach(function(e){var t=new ops.OpInsertText,n=new ops.OpSplitParagraph;t.init({memberid:r,position:d,text:e,moveCursor:!0}),h.push(t),d+=e.length,n.init({memberid:r,position:d,paragraphStyleName:o,sourceParagraphPosition:p,moveCursor:!0}),h.push(n),p=d+=1}),h.pop(),e.enqueue(h)}},this.destroy=function(e){s.unsubscribe(ops.Document.signalCursorMoved,o),t.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,i),e()},s.subscribe(ops.Document.signalCursorMoved,o),t.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,i),i()},gui.ClosestXOffsetScanner=function(e){function t(t){return null!==t&&void 0!==r&&Math.abs(t-e)>r}function n(n){null!==n&&!1===t(n)&&(r=Math.abs(n-e))}var r,i=this,o=gui.StepInfo.VisualDirection.LEFT_TO_RIGHT;this.token=void 0,this.process=function(e,r,s){var a,l;return e.visualDirection===o?(a=r&&r.right,l=s&&s.left):(a=r&&r.left,l=s&&s.right),!(!t(a)&&!t(l))||((r||s)&&(n(a),n(l),i.token=e.token),!1)}},gui.LineBoundaryScanner=function(){var e=this,t=null;this.token=void 0,this.process=function(n,r,i){var o;if(o=i)if(t){var s=t;o=Math.min(s.bottom-s.top,i.bottom-i.top);var a=Math.max(s.top,i.top),s=Math.min(s.bottom,i.bottom)-a;o=.4>=(0<o?s/o:0)}else o=!1;return!r||i&&!o||(e.token=n.token),!!o||(t=(n=t)&&r?{left:Math.min(n.left,r.left),right:Math.max(n.right,r.right),top:Math.min(n.top,r.top),bottom:Math.min(n.bottom,r.bottom)}:n||r,!1)}},gui.ParagraphBoundaryScanner=function(){var e,t=this,n=!1,r=odf.OdfUtils;this.token=void 0,this.process=function(i){var o=r.getParagraphElement(i.container());return n||(e=o,n=!0),e!==o||(t.token=i.token,!1)}},odf.WordBoundaryFilter=function(e,t){function n(t,n,r){for(var i,o=null,s=e.getRootNode();t!==s&&null!==t&&null===o;)i=0>n?t.previousSibling:t.nextSibling,r(i)===NodeFilter.FILTER_ACCEPT&&(o=i),t=t.parentNode;return o}function r(e,t){var n;return null===e?p.NO_NEIGHBOUR:s.isCharacterElement(e)?p.SPACE_CHAR:e.nodeType===i||s.isTextSpan(e)||s.isHyperlink(e)?(n=e.textContent.charAt(t()),l.test(n)?p.SPACE_CHAR:a.test(n)?p.PUNCTUATION_CHAR:p.WORD_CHAR):p.OTHER}var i=Node.TEXT_NODE,o=Node.ELEMENT_NODE,s=odf.OdfUtils,a=/[!-#%-*,-\/:-;?-@\[-\]_{}\u00a1\u00ab\u00b7\u00bb\u00bf;\u00b7\u055a-\u055f\u0589-\u058a\u05be\u05c0\u05c3\u05c6\u05f3-\u05f4\u0609-\u060a\u060c-\u060d\u061b\u061e-\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0964-\u0965\u0970\u0df4\u0e4f\u0e5a-\u0e5b\u0f04-\u0f12\u0f3a-\u0f3d\u0f85\u0fd0-\u0fd4\u104a-\u104f\u10fb\u1361-\u1368\u166d-\u166e\u169b-\u169c\u16eb-\u16ed\u1735-\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u180a\u1944-\u1945\u19de-\u19df\u1a1e-\u1a1f\u1b5a-\u1b60\u1c3b-\u1c3f\u1c7e-\u1c7f\u2000-\u206e\u207d-\u207e\u208d-\u208e\u3008-\u3009\u2768-\u2775\u27c5-\u27c6\u27e6-\u27ef\u2983-\u2998\u29d8-\u29db\u29fc-\u29fd\u2cf9-\u2cfc\u2cfe-\u2cff\u2e00-\u2e7e\u3000-\u303f\u30a0\u30fb\ua60d-\ua60f\ua673\ua67e\ua874-\ua877\ua8ce-\ua8cf\ua92e-\ua92f\ua95f\uaa5c-\uaa5f\ufd3e-\ufd3f\ufe10-\ufe19\ufe30-\ufe52\ufe54-\ufe61\ufe63\ufe68\ufe6a-\ufe6b\uff01-\uff03\uff05-\uff0a\uff0c-\uff0f\uff1a-\uff1b\uff1f-\uff20\uff3b-\uff3d\uff3f\uff5b\uff5d\uff5f-\uff65]|\ud800[\udd00-\udd01\udf9f\udfd0]|\ud802[\udd1f\udd3f\ude50-\ude58]|\ud809[\udc00-\udc7e]/,l=/\s/,c=core.PositionFilter.FilterResult.FILTER_ACCEPT,u=core.PositionFilter.FilterResult.FILTER_REJECT,d=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,h=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,p={NO_NEIGHBOUR:0,SPACE_CHAR:1,PUNCTUATION_CHAR:2,WORD_CHAR:3,OTHER:4};this.acceptPosition=function(e){var i=e.container(),s=e.leftNode(),a=e.rightNode(),l=e.unfilteredDomOffset,f=function(){return e.unfilteredDomOffset()-1};return i.nodeType===o&&(null===a&&(a=n(i,1,e.getNodeFilter())),null===s&&(s=n(i,-1,e.getNodeFilter()))),i!==a&&(l=function(){return 0}),i!==s&&null!==s&&(f=function(){return s.textContent.length-1}),i=r(s,f),a=r(a,l),i===p.WORD_CHAR&&a===p.WORD_CHAR||i===p.PUNCTUATION_CHAR&&a===p.PUNCTUATION_CHAR||t===d&&i!==p.NO_NEIGHBOUR&&a===p.SPACE_CHAR||t===h&&i===p.SPACE_CHAR&&a!==p.NO_NEIGHBOUR?u:c}},odf.WordBoundaryFilter.IncludeWhitespace={None:0,TRAILING:1,LEADING:2},gui.SelectionController=function(e,t){function n(e){var n=e.spec();(e.isEdit||n.memberid===t)&&(g=void 0,b.cancel())}function r(){var e=y.getCursor(t).getNode();return y.createStepIterator(e,0,[C,A],y.getRootElement(e))}function i(e,t,n){n=new odf.WordBoundaryFilter(y,n);var r=y.getRootElement(e)||y.getRootNode(),i=y.createRootFilter(r);return y.createStepIterator(e,t,[C,i,n],r)}function o(e,t){return t?{anchorNode:e.startContainer,anchorOffset:e.startOffset,focusNode:e.endContainer,focusOffset:e.endOffset}:{anchorNode:e.endContainer,anchorOffset:e.endOffset,focusNode:e.startContainer,focusOffset:e.startOffset}}function s(e,n,r){var i=new ops.OpMoveCursor;return i.init({memberid:t,position:e,length:n||0,selectionType:r}),i}function a(n,r,i){var a;(a=o((a=y.getCursor(t)).getSelectedRange(),a.hasForwardSelection())).focusNode=n,a.focusOffset=r,i||(a.anchorNode=a.focusNode,a.anchorOffset=a.focusOffset),n=y.convertDomToCursorRange(a),e.enqueue([s(n.position,n.length)])}function l(e){var t;(t=i(e.startContainer,e.startOffset,_)).roundToPreviousStep()&&e.setStart(t.container(),t.offset()),(t=i(e.endContainer,e.endOffset,N)).roundToNextStep()&&e.setEnd(t.container(),t.offset())}function c(e){var t=S.getParagraphElements(e),n=t[0],t=t[t.length-1];n&&e.setStart(n,0),t&&(S.isParagraph(e.endContainer)&&0===e.endOffset?e.setEndBefore(t):e.setEnd(t,t.childNodes.length))}function u(e,t,n,r){var i,o;r?(i=n.startContainer,o=n.startOffset):(i=n.endContainer,o=n.endOffset),v.containsNode(e,i)||(o=0>v.comparePoints(e,0,i,o)?0:e.childNodes.length,i=e),(e=y.createStepIterator(i,o,t,S.getParagraphElement(i)||e)).roundToClosestStep()||runtime.assert(!1,"No step found in requested range"),r?n.setStart(e.container(),e.offset()):n.setEnd(e.container(),e.offset())}function d(e,t){var n=r();n.advanceStep(e)&&a(n.container(),n.offset(),t)}function h(e,t){var n,i=g,o=[new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner];void 0===i&&w&&(i=w()),isNaN(i)||(n=r(),x.moveToFilteredStep(n,e,o)&&n.advanceStep(e)&&(o=[new gui.ClosestXOffsetScanner(i),new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner],x.moveToFilteredStep(n,e,o)&&(a(n.container(),n.offset(),t),g=i,b.restart())))}function p(e,t){var n=r(),i=[new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner];x.moveToFilteredStep(n,e,i)&&a(n.container(),n.offset(),t)}function f(e,n){var r=y.getCursor(t),r=o(r.getSelectedRange(),r.hasForwardSelection()),r=i(r.focusNode,r.focusOffset,_);r.advanceStep(e)&&a(r.container(),r.offset(),n)}function m(e,n,r){var i=!1,s=y.getCursor(t),s=o(s.getSelectedRange(),s.hasForwardSelection()),i=y.getRootElement(s.focusNode);runtime.assert(Boolean(i),"SelectionController: Cursor outside root"),(s=y.createStepIterator(s.focusNode,s.focusOffset,[C,A],i)).roundToClosestStep(),s.advanceStep(e)&&(r=r(s.container()))&&(e===E?(s.setPosition(r,0),i=s.roundToNextStep()):(s.setPosition(r,r.childNodes.length),i=s.roundToPreviousStep()),i&&a(s.container(),s.offset(),n))}var g,b,y=e.getOdtDocument(),v=core.DomUtils,S=odf.OdfUtils,C=y.getPositionFilter(),x=new gui.GuiStepUtils,A=y.createRootFilter(t),w=null,_=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,N=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,E=core.StepDirection.PREVIOUS,T=core.StepDirection.NEXT;this.selectionToRange=function(e){var t=0<=v.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset),n=e.focusNode.ownerDocument.createRange();return t?(n.setStart(e.anchorNode,e.anchorOffset),n.setEnd(e.focusNode,e.focusOffset)):(n.setStart(e.focusNode,e.focusOffset),n.setEnd(e.anchorNode,e.anchorOffset)),{range:n,hasForwardSelection:t}},this.rangeToSelection=o,this.selectImage=function(t){var n,r=y.getRootElement(t),i=y.createRootFilter(r),r=y.createStepIterator(t,0,[i,y.getPositionFilter()],r);r.roundToPreviousStep()||runtime.assert(!1,"No walkable position before frame"),i=r.container(),n=r.offset(),r.setPosition(t,t.childNodes.length),r.roundToNextStep()||runtime.assert(!1,"No walkable position after frame"),t=s((t=y.convertDomToCursorRange({anchorNode:i,anchorOffset:n,focusNode:r.container(),focusOffset:r.offset()})).position,t.length,ops.OdtCursor.RegionSelection),e.enqueue([t])},this.expandToWordBoundaries=l,this.expandToParagraphBoundaries=c,this.selectRange=function(n,r,i){var a,d=y.getOdfCanvas().getElement(),h=[C];a=v.containsNode(d,n.startContainer),d=v.containsNode(d,n.endContainer),(a||d)&&(a&&d&&(2===i?l(n):3<=i&&c(n)),(i=r?y.getRootElement(n.startContainer):y.getRootElement(n.endContainer))||(i=y.getRootNode()),h.push(y.createRootFilter(i)),u(i,h,n,!0),u(i,h,n,!1),n=o(n,r),r=y.convertDomToCursorRange(n),n=y.getCursorSelection(t),(r.position!==n.position||r.length!==n.length)&&(n=s(r.position,r.length,ops.OdtCursor.RangeSelection),e.enqueue([n])))},this.moveCursorToLeft=function(){return d(E,!1),!0},this.moveCursorToRight=function(){return d(T,!1),!0},this.extendSelectionToLeft=function(){return d(E,!0),!0},this.extendSelectionToRight=function(){return d(T,!0),!0},this.setCaretXPositionLocator=function(e){w=e},this.moveCursorUp=function(){return h(E,!1),!0},this.moveCursorDown=function(){return h(T,!1),!0},this.extendSelectionUp=function(){return h(E,!0),!0},this.extendSelectionDown=function(){return h(T,!0),!0},this.moveCursorBeforeWord=function(){return f(E,!1),!0},this.moveCursorPastWord=function(){return f(T,!1),!0},this.extendSelectionBeforeWord=function(){return f(E,!0),!0},this.extendSelectionPastWord=function(){return f(T,!0),!0},this.moveCursorToLineStart=function(){return p(E,!1),!0},this.moveCursorToLineEnd=function(){return p(T,!1),!0},this.extendSelectionToLineStart=function(){return p(E,!0),!0},this.extendSelectionToLineEnd=function(){return p(T,!0),!0},this.extendSelectionToParagraphStart=function(){return m(E,!0,S.getParagraphElement),!0},this.extendSelectionToParagraphEnd=function(){return m(T,!0,S.getParagraphElement),!0},this.moveCursorToParagraphStart=function(){return m(E,!1,S.getParagraphElement),!0},this.moveCursorToParagraphEnd=function(){return m(T,!1,S.getParagraphElement),!0},this.moveCursorToDocumentStart=function(){return m(E,!1,y.getRootElement),!0},this.moveCursorToDocumentEnd=function(){return m(T,!1,y.getRootElement),!0},this.extendSelectionToDocumentStart=function(){return m(E,!0,y.getRootElement),!0},this.extendSelectionToDocumentEnd=function(){return m(T,!0,y.getRootElement),!0},this.extendSelectionToEntireDocument=function(){var n,r,i,o=y.getCursor(t),o=y.getRootElement(o.getNode());return runtime.assert(Boolean(o),"SelectionController: Cursor outside root"),(i=y.createStepIterator(o,0,[C,A],o)).roundToClosestStep(),n=i.container(),r=i.offset(),i.setPosition(o,o.childNodes.length),i.roundToClosestStep(),o=y.convertDomToCursorRange({anchorNode:n,anchorOffset:r,focusNode:i.container(),focusOffset:i.offset()}),e.enqueue([s(o.position,o.length)]),!0},this.destroy=function(e){y.unsubscribe(ops.OdtDocument.signalOperationStart,n),core.Async.destroyAll([b.destroy],e)},b=core.Task.createTimeoutTask(function(){g=void 0},2e3),y.subscribe(ops.OdtDocument.signalOperationStart,n)},gui.TextController=function(e,t,n,r,i,o){function s(){m=!0!==t.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)||n.isLocalCursorWithinOwnAnnotation()}function a(e){e.getMemberId()===r&&s()}function l(e,t,n){var r=[h.getPositionFilter()];return n&&r.push(h.createRootFilter(e.startContainer)),(n=h.createStepIterator(e.startContainer,e.startOffset,r,t)).roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range start"),t=h.convertDomPointToCursorStep(n.container(),n.offset()),e.collapsed?e=t:(n.setPosition(e.endContainer,e.endOffset),n.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range end"),e=h.convertDomPointToCursorStep(n.container(),n.offset())),{position:t,length:e-t}}function c(e){var t,n,i,o=p.getParagraphElements(e),s=e.cloneRange(),a=[];return t=o[0],1<o.length&&(p.hasNoODFContent(t)&&(t=o[o.length-1]),n=t.getAttributeNS(odf.Namespaces.textns,"style-name")||""),o.forEach(function(t,o){var c,u;s.setStart(t,0),s.collapse(!0),c=l(s,t,!1).position,0<o&&((u=new ops.OpMergeParagraph).init({memberid:r,paragraphStyleName:n,destinationStartPosition:i,sourceStartPosition:c,moveCursor:1===o}),a.unshift(u)),i=c,s.selectNodeContents(t),(c=f.rangeIntersection(s,e))&&(0<(c=l(c,t,!0)).length&&((u=new ops.OpRemoveText).init({memberid:r,position:c.position,length:c.length}),a.unshift(u)))}),a}function u(e){return 0>e.length&&(e.position+=e.length,e.length=-e.length),e}function d(t){if(!m)return!1;var n,i,o=h.getCursor(r).getSelectedRange().cloneRange(),s=u(h.getCursorSelection(r));if(0===s.length){s=void 0,n=h.getCursor(r).getNode(),i=h.getRootElement(n);var a=[h.getPositionFilter(),h.createRootFilter(i)];(i=h.createStepIterator(n,0,a,i)).roundToClosestStep()&&(t?i.nextStep():i.previousStep())&&(s=u(h.convertDomToCursorRange({anchorNode:n,anchorOffset:0,focusNode:i.container(),focusOffset:i.offset()})),t?(o.setStart(n,0),o.setEnd(i.container(),i.offset())):(o.setStart(i.container(),i.offset()),o.setEnd(n,0)))}return s&&e.enqueue(c(o)),void 0!==s}var h=e.getOdtDocument(),p=odf.OdfUtils,f=core.DomUtils,m=!1,g=odf.Namespaces.textns,b=core.StepDirection.NEXT;this.isEnabled=function(){return m},this.enqueueParagraphSplittingOps=function(){if(!m)return!1;var t=h.getCursor(r),n=t.getSelectedRange(),i=u(h.getCursorSelection(r)),s=[],t=p.getParagraphElement(t.getNode()),a=t.getAttributeNS(g,"style-name")||"";return 0<i.length&&(s=s.concat(c(n))),(n=new ops.OpSplitParagraph).init({memberid:r,position:i.position,paragraphStyleName:a,sourceParagraphPosition:h.convertDomPointToCursorStep(t,0,b),moveCursor:!0}),s.push(n),o&&(i=o(i.position+1),s=s.concat(i)),e.enqueue(s),!0},this.removeTextByBackspaceKey=function(){return d(!1)},this.removeTextByDeleteKey=function(){return d(!0)},this.removeCurrentSelection=function(){if(!m)return!1;var t=h.getCursor(r).getSelectedRange();return e.enqueue(c(t)),!0},this.insertText=function(t){if(m){var n=h.getCursor(r).getSelectedRange(),o=u(h.getCursorSelection(r)),s=[],a=!1;0<o.length&&(s=s.concat(c(n)),a=!0),(n=new ops.OpInsertText).init({memberid:r,position:o.position,text:t,moveCursor:!0}),s.push(n),i&&(t=i(o.position,t.length,a))&&s.push(t),e.enqueue(s)}},this.destroy=function(e){h.unsubscribe(ops.Document.signalCursorMoved,a),t.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,s),e()},h.subscribe(ops.Document.signalCursorMoved,a),t.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,s),s()},gui.UndoManager=function(){},gui.UndoManager.prototype.subscribe=function(e,t){},gui.UndoManager.prototype.unsubscribe=function(e,t){},gui.UndoManager.prototype.setDocument=function(e){},gui.UndoManager.prototype.setInitialState=function(){},gui.UndoManager.prototype.initialize=function(){},gui.UndoManager.prototype.purgeInitialState=function(){},gui.UndoManager.prototype.setPlaybackFunction=function(e){},gui.UndoManager.prototype.hasUndoStates=function(){},gui.UndoManager.prototype.hasRedoStates=function(){},gui.UndoManager.prototype.moveForward=function(e){},gui.UndoManager.prototype.moveBackward=function(e){},gui.UndoManager.prototype.onOperationExecuted=function(e){},gui.UndoManager.prototype.isDocumentModified=function(){},gui.UndoManager.prototype.setDocumentModified=function(e){},gui.UndoManager.signalUndoStackChanged="undoStackChanged",gui.UndoManager.signalUndoStateCreated="undoStateCreated",gui.UndoManager.signalUndoStateModified="undoStateModified",gui.UndoManager.signalDocumentModifiedChanged="documentModifiedChanged",gui.SessionControllerOptions=function(){this.annotationsEnabled=this.directParagraphStylingEnabled=this.directTextStylingEnabled=!1},function(){var e=core.PositionFilter.FilterResult.FILTER_ACCEPT;gui.SessionController=function(t,n,r,i){function o(e,t){var n=F.getDOMDocument(),r=null;return n.caretRangeFromPoint?(n=n.caretRangeFromPoint(e,t),r={container:n.startContainer,offset:n.startOffset}):n.caretPositionFromPoint&&(n=n.caretPositionFromPoint(e,t))&&n.offsetNode&&(r={container:n.offsetNode,offset:n.offset}),r}function s(e){var t=F.getCursor(n).getSelectedRange();t.collapsed?e.preventDefault():j.setDataFromRange(e,t)?ee.removeCurrentSelection():runtime.log("Cut operation failed")}function a(){return!1!==F.getCursor(n).getSelectedRange().collapsed}function l(e){var t=F.getCursor(n).getSelectedRange();t.collapsed?e.preventDefault():j.setDataFromRange(e,t)||runtime.log("Copy operation failed")}function c(e){var t;I.clipboardData&&I.clipboardData.getData?t=I.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData&&(t=e.clipboardData.getData("text/plain")),t&&(ee.removeCurrentSelection(),ie.paste(t)),e.preventDefault?e.preventDefault():e.returnValue=!1}function u(){return!1}function d(e){K&&K.onOperationExecuted(e)}function h(e){F.emit(ops.OdtDocument.signalUndoStackChanged,e)}function p(){var e;return!!K&&(e=$.hasFocus(),K.moveBackward(1),e&&$.focus(),!0)}function f(){var e;return!!K&&(e=$.hasFocus(),K.moveForward(1),e&&$.focus(),!0)}function m(t){var i=F.getCursor(n).getSelectedRange(),s=(t.target||t.srcElement||null).getAttribute("end");i&&s&&(t=o(t.clientX,t.clientY))&&(re.setUnfilteredPosition(t.container,t.offset),Y.acceptPosition(re)===e&&(i=i.cloneRange(),"left"===s?i.setStart(re.container(),re.unfilteredDomOffset()):i.setEnd(re.container(),re.unfilteredDomOffset()),r.setSelectedRange(i,"right"===s),F.emit(ops.Document.signalCursorMoved,r)))}function g(){ce.selectRange(r.getSelectedRange(),r.hasForwardSelection(),1)}function b(){var t=I.getSelection(),n=0<t.rangeCount&&ce.selectionToRange(t);V&&n&&(X=!0,ne.clearSelection(),re.setUnfilteredPosition(t.focusNode,t.focusOffset),Y.acceptPosition(re)===e&&(2===se?ce.expandToWordBoundaries(n.range):3<=se&&ce.expandToParagraphBoundaries(n.range),r.setSelectedRange(n.range,n.hasForwardSelection),F.emit(ops.Document.signalCursorMoved,r)))}function y(e){var t=e.target||e.srcElement||null,r=F.getCursor(n);(V=null!==t&&B.containsNode(F.getOdfCanvas().getElement(),t))&&(X=!1,t=F.getRootElement(t)||F.getRootNode(),Y=F.createRootFilter(t),se=0===e.button?e.detail:0,r&&e.shiftKey?I.getSelection().collapse(r.getAnchorNode(),0):(e=I.getSelection(),t=r.getSelectedRange(),e.extend?r.hasForwardSelection()?(e.collapse(t.startContainer,t.startOffset),e.extend(t.endContainer,t.endOffset)):(e.collapse(t.endContainer,t.endOffset),e.extend(t.startContainer,t.startOffset)):(e.removeAllRanges(),e.addRange(t.cloneRange()))),1<se&&b())}function v(e){var t=F.getRootElement(e),n=F.createRootFilter(t),t=F.createStepIterator(e,0,[n,F.getPositionFilter()],t);return t.setPosition(e,e.childNodes.length),t.roundToNextStep()?{container:t.container(),offset:t.offset()}:null}function S(e){var t;t=(t=I.getSelection())?{anchorNode:t.anchorNode,anchorOffset:t.anchorOffset,focusNode:t.focusNode,focusOffset:t.focusOffset}:null;var n,r,i=I.getSelection().isCollapsed;t.anchorNode||t.focusNode||!(n=o(e.clientX,e.clientY))||(t.anchorNode=n.container,t.anchorOffset=n.offset,t.focusNode=t.anchorNode,t.focusOffset=t.anchorOffset),U.isImage(t.focusNode)&&0===t.focusOffset&&U.isCharacterFrame(t.focusNode.parentNode)?(r=t.focusNode.parentNode,n=r.getBoundingClientRect(),e.clientX>n.left&&(n=v(r))&&(t.focusNode=n.container,t.focusOffset=n.offset,i&&(t.anchorNode=t.focusNode,t.anchorOffset=t.focusOffset))):U.isImage(t.focusNode.firstChild)&&1===t.focusOffset&&U.isCharacterFrame(t.focusNode)&&(n=v(t.focusNode))&&(t.anchorNode=t.focusNode=n.container,t.anchorOffset=t.focusOffset=n.offset),t.anchorNode&&t.focusNode&&(t=ce.selectionToRange(t),ce.selectRange(t.range,t.hasForwardSelection,0===e.button?e.detail:0)),$.focus()}function C(e){var t;(t=o(e.clientX,e.clientY))&&(e=t.container,t=t.offset,e={anchorNode:e,anchorOffset:t,focusNode:e,focusOffset:t},e=ce.selectionToRange(e),ce.selectRange(e.range,e.hasForwardSelection,2),$.focus())}function x(e){var t,n,i,o=e.target||e.srcElement||null;R.processRequests(),V&&(U.isImage(o)&&U.isCharacterFrame(o.parentNode)&&I.getSelection().isCollapsed?(ce.selectImage(o.parentNode),$.focus()):ne.isSelectorElement(o)?$.focus():X?(o=r.getSelectedRange(),n=o.collapsed,U.isImage(o.endContainer)&&0===o.endOffset&&U.isCharacterFrame(o.endContainer.parentNode)&&(i=v(i=o.endContainer.parentNode))&&(o.setEnd(i.container,i.offset),n&&o.collapse(!1)),ce.selectRange(o,r.hasForwardSelection(),0===e.button?e.detail:0),$.focus()):fe?S(e):(t=B.cloneEvent(e),P=runtime.setTimeout(function(){S(t)},0)),se=0,X=V=!1)}function A(e){var t=F.getCursor(n).getSelectedRange();t.collapsed||z.exportRangeToDataTransfer(e.dataTransfer,t)}function w(){V&&$.focus(),se=0,X=V=!1}function _(e){x(e)}function N(e){var t=e.target||e.srcElement||null,n=null;"annotationRemoveButton"===t.className?(runtime.assert(Z,"Remove buttons are displayed on annotations while annotation editing is disabled in the controller."),n=t.parentNode.getElementsByTagNameNS(odf.Namespaces.officens,"annotation").item(0),J.removeAnnotation(n),$.focus()):"webodf-draggable"!==t.getAttribute("class")&&x(e)}function E(e){(e=e.data)&&(-1===e.indexOf("\n")?ee.insertText(e):ie.paste(e))}function T(e){return function(t){return F.getCursor(n).getSelectionType()!==ops.OdtCursor.RangeSelection||e(t)}}function k(e){$.unsubscribe("keydown",W.handleEvent),$.unsubscribe("keypress",H.handleEvent),$.unsubscribe("keyup",q.handleEvent),$.unsubscribe("copy",l),$.unsubscribe("mousedown",y),$.unsubscribe("mousemove",R.trigger),$.unsubscribe("mouseup",N),$.unsubscribe("contextmenu",_),$.unsubscribe("dragstart",A),$.unsubscribe("dragend",w),$.unsubscribe("click",ae.handleClick),$.unsubscribe("longpress",C),$.unsubscribe("drag",m),$.unsubscribe("dragstop",g),F.unsubscribe(ops.OdtDocument.signalOperationEnd,O.trigger),F.unsubscribe(ops.Document.signalCursorAdded,oe.registerCursor),F.unsubscribe(ops.Document.signalCursorRemoved,oe.removeCursor),F.unsubscribe(ops.OdtDocument.signalOperationEnd,d),e()}var P,R,O,D,I=runtime.getWindow(),F=t.getOdtDocument(),M=new gui.SessionConstraints,L=new gui.SessionContext(t,n),B=core.DomUtils,U=odf.OdfUtils,z=new gui.MimeDataExporter,j=new gui.Clipboard(z),W=new gui.KeyboardHandler,H=new gui.KeyboardHandler,q=new gui.KeyboardHandler,V=!1,G=new odf.ObjectNameGenerator(F.getOdfCanvas().odfContainer(),n),X=!1,Y=null,K=null,$=new gui.EventManager(F),Z=i.annotationsEnabled,J=new gui.AnnotationController(t,M,n),Q=new gui.DirectFormattingController(t,M,L,n,G,i.directTextStylingEnabled,i.directParagraphStylingEnabled),ee=new gui.TextController(t,M,L,n,Q.createCursorStyleOp,Q.createParagraphStyleOps),te=new gui.ImageController(t,M,L,n,G),ne=new gui.ImageSelector(F.getOdfCanvas()),re=F.createPositionIterator(F.getRootNode()),ie=new gui.PasteController(t,M,L,n),oe=new gui.InputMethodEditor(n,$),se=0,ae=new gui.HyperlinkClickHandler(F.getOdfCanvas().getElement,W,q),le=new gui.HyperlinkController(t,M,L,n),ce=new gui.SelectionController(t,n),ue=new gui.MetadataController(t,n),de=gui.KeyboardHandler.Modifier,he=gui.KeyboardHandler.KeyCode,pe=-1!==I.navigator.appVersion.toLowerCase().indexOf("mac"),fe=-1!==["iPad","iPod","iPhone"].indexOf(I.navigator.platform);runtime.assert(null!==I,"Expected to be run in an environment which has a global window, like a browser."),this.undo=p,this.redo=f,this.insertLocalCursor=function(){runtime.assert(void 0===t.getOdtDocument().getCursor(n),"Inserting local cursor a second time.");var e=new ops.OpAddCursor;e.init({memberid:n}),t.enqueue([e]),$.focus()},this.removeLocalCursor=function(){runtime.assert(void 0!==t.getOdtDocument().getCursor(n),"Removing local cursor without inserting before.");var e=new ops.OpRemoveCursor;e.init({memberid:n}),t.enqueue([e])},this.startEditing=function(){var e;oe.subscribe(gui.InputMethodEditor.signalCompositionStart,ee.removeCurrentSelection),oe.subscribe(gui.InputMethodEditor.signalCompositionEnd,E),$.subscribe("beforecut",a),$.subscribe("cut",s),$.subscribe("beforepaste",u),$.subscribe("paste",c),K&&K.initialize(),$.setEditing(!0),ae.setModifier(pe?de.Meta:de.Ctrl),W.bind(he.Backspace,de.None,(e=ee.removeTextByBackspaceKey,function(){return e(),!0}),!0),W.bind(he.Delete,de.None,ee.removeTextByDeleteKey),W.bind(he.Tab,de.None,T(function(){return ee.insertText("\t"),!0})),pe?(W.bind(he.Clear,de.None,ee.removeCurrentSelection),W.bind(he.B,de.Meta,T(Q.toggleBold)),W.bind(he.I,de.Meta,T(Q.toggleItalic)),W.bind(he.U,de.Meta,T(Q.toggleUnderline)),W.bind(he.L,de.MetaShift,T(Q.alignParagraphLeft)),W.bind(he.E,de.MetaShift,T(Q.alignParagraphCenter)),W.bind(he.R,de.MetaShift,T(Q.alignParagraphRight)),W.bind(he.J,de.MetaShift,T(Q.alignParagraphJustified)),Z&&W.bind(he.C,de.MetaShift,J.addAnnotation),W.bind(he.Z,de.Meta,p),W.bind(he.Z,de.MetaShift,f)):(W.bind(he.B,de.Ctrl,T(Q.toggleBold)),W.bind(he.I,de.Ctrl,T(Q.toggleItalic)),W.bind(he.U,de.Ctrl,T(Q.toggleUnderline)),W.bind(he.L,de.CtrlShift,T(Q.alignParagraphLeft)),W.bind(he.E,de.CtrlShift,T(Q.alignParagraphCenter)),W.bind(he.R,de.CtrlShift,T(Q.alignParagraphRight)),W.bind(he.J,de.CtrlShift,T(Q.alignParagraphJustified)),Z&&W.bind(he.C,de.CtrlAlt,J.addAnnotation),W.bind(he.Z,de.Ctrl,p),W.bind(he.Z,de.CtrlShift,f)),H.setDefault(T(function(e){var t;return!(!(t=null===e.which||void 0===e.which?String.fromCharCode(e.keyCode):0!==e.which&&0!==e.charCode?String.fromCharCode(e.which):null)||e.altKey||e.ctrlKey||e.metaKey)&&(ee.insertText(t),!0)})),H.bind(he.Enter,de.None,T(ee.enqueueParagraphSplittingOps))},this.endEditing=function(){oe.unsubscribe(gui.InputMethodEditor.signalCompositionStart,ee.removeCurrentSelection),oe.unsubscribe(gui.InputMethodEditor.signalCompositionEnd,E),$.unsubscribe("cut",s),$.unsubscribe("beforecut",a),$.unsubscribe("paste",c),$.unsubscribe("beforepaste",u),$.setEditing(!1),ae.setModifier(de.None),W.bind(he.Backspace,de.None,function(){return!0},!0),W.unbind(he.Delete,de.None),W.unbind(he.Tab,de.None),pe?(W.unbind(he.Clear,de.None),W.unbind(he.B,de.Meta),W.unbind(he.I,de.Meta),W.unbind(he.U,de.Meta),W.unbind(he.L,de.MetaShift),W.unbind(he.E,de.MetaShift),W.unbind(he.R,de.MetaShift),W.unbind(he.J,de.MetaShift),Z&&W.unbind(he.C,de.MetaShift),W.unbind(he.Z,de.Meta),W.unbind(he.Z,de.MetaShift)):(W.unbind(he.B,de.Ctrl),W.unbind(he.I,de.Ctrl),W.unbind(he.U,de.Ctrl),W.unbind(he.L,de.CtrlShift),W.unbind(he.E,de.CtrlShift),W.unbind(he.R,de.CtrlShift),W.unbind(he.J,de.CtrlShift),Z&&W.unbind(he.C,de.CtrlAlt),W.unbind(he.Z,de.Ctrl),W.unbind(he.Z,de.CtrlShift)),H.setDefault(null),H.unbind(he.Enter,de.None)},this.getInputMemberId=function(){return n},this.getSession=function(){return t},this.getSessionConstraints=function(){return M},this.setUndoManager=function(e){K&&K.unsubscribe(gui.UndoManager.signalUndoStackChanged,h),(K=e)&&(K.setDocument(F),K.setPlaybackFunction(t.enqueue),K.subscribe(gui.UndoManager.signalUndoStackChanged,h))},this.getUndoManager=function(){return K},this.getMetadataController=function(){return ue},this.getAnnotationController=function(){return J},this.getDirectFormattingController=function(){return Q},this.getHyperlinkClickHandler=function(){return ae},this.getHyperlinkController=function(){return le},this.getImageController=function(){return te},this.getSelectionController=function(){return ce},this.getTextController=function(){return ee},this.getEventManager=function(){return $},this.getKeyboardHandlers=function(){return{keydown:W,keypress:H}},this.destroy=function(e){var t=[R.destroy,O.destroy,Q.destroy,oe.destroy,$.destroy,ae.destroy,le.destroy,ue.destroy,ce.destroy,ee.destroy,k];D&&t.unshift(D.destroy),runtime.clearTimeout(P),core.Async.destroyAll(t,e)},R=core.Task.createRedrawTask(b),O=core.Task.createRedrawTask(function(){var e=F.getCursor(n);e&&e.getSelectionType()===ops.OdtCursor.RegionSelection&&(e=U.getImageElements(e.getSelectedRange())[0])?ne.select(e.parentNode):ne.clearSelection()}),W.bind(he.Left,de.None,T(ce.moveCursorToLeft)),W.bind(he.Right,de.None,T(ce.moveCursorToRight)),W.bind(he.Up,de.None,T(ce.moveCursorUp)),W.bind(he.Down,de.None,T(ce.moveCursorDown)),W.bind(he.Left,de.Shift,T(ce.extendSelectionToLeft)),W.bind(he.Right,de.Shift,T(ce.extendSelectionToRight)),W.bind(he.Up,de.Shift,T(ce.extendSelectionUp)),W.bind(he.Down,de.Shift,T(ce.extendSelectionDown)),W.bind(he.Home,de.None,T(ce.moveCursorToLineStart)),W.bind(he.End,de.None,T(ce.moveCursorToLineEnd)),W.bind(he.Home,de.Ctrl,T(ce.moveCursorToDocumentStart)),W.bind(he.End,de.Ctrl,T(ce.moveCursorToDocumentEnd)),W.bind(he.Home,de.Shift,T(ce.extendSelectionToLineStart)),W.bind(he.End,de.Shift,T(ce.extendSelectionToLineEnd)),W.bind(he.Up,de.CtrlShift,T(ce.extendSelectionToParagraphStart)),W.bind(he.Down,de.CtrlShift,T(ce.extendSelectionToParagraphEnd)),W.bind(he.Home,de.CtrlShift,T(ce.extendSelectionToDocumentStart)),W.bind(he.End,de.CtrlShift,T(ce.extendSelectionToDocumentEnd)),pe?(W.bind(he.Left,de.Alt,T(ce.moveCursorBeforeWord)),W.bind(he.Right,de.Alt,T(ce.moveCursorPastWord)),W.bind(he.Left,de.Meta,T(ce.moveCursorToLineStart)),W.bind(he.Right,de.Meta,T(ce.moveCursorToLineEnd)),W.bind(he.Home,de.Meta,T(ce.moveCursorToDocumentStart)),W.bind(he.End,de.Meta,T(ce.moveCursorToDocumentEnd)),W.bind(he.Left,de.AltShift,T(ce.extendSelectionBeforeWord)),W.bind(he.Right,de.AltShift,T(ce.extendSelectionPastWord)),W.bind(he.Left,de.MetaShift,T(ce.extendSelectionToLineStart)),W.bind(he.Right,de.MetaShift,T(ce.extendSelectionToLineEnd)),W.bind(he.Up,de.AltShift,T(ce.extendSelectionToParagraphStart)),W.bind(he.Down,de.AltShift,T(ce.extendSelectionToParagraphEnd)),W.bind(he.Up,de.MetaShift,T(ce.extendSelectionToDocumentStart)),W.bind(he.Down,de.MetaShift,T(ce.extendSelectionToDocumentEnd)),W.bind(he.A,de.Meta,T(ce.extendSelectionToEntireDocument))):(W.bind(he.Left,de.Ctrl,T(ce.moveCursorBeforeWord)),W.bind(he.Right,de.Ctrl,T(ce.moveCursorPastWord)),W.bind(he.Left,de.CtrlShift,T(ce.extendSelectionBeforeWord)),W.bind(he.Right,de.CtrlShift,T(ce.extendSelectionPastWord)),W.bind(he.A,de.Ctrl,T(ce.extendSelectionToEntireDocument))),fe&&(D=new gui.IOSSafariSupport($)),$.subscribe("keydown",W.handleEvent),$.subscribe("keypress",H.handleEvent),$.subscribe("keyup",q.handleEvent),$.subscribe("copy",l),$.subscribe("mousedown",y),$.subscribe("mousemove",R.trigger),$.subscribe("mouseup",N),$.subscribe("contextmenu",_),$.subscribe("dragstart",A),$.subscribe("dragend",w),$.subscribe("click",ae.handleClick),$.subscribe("longpress",C),$.subscribe("drag",m),$.subscribe("dragstop",g),F.subscribe(ops.OdtDocument.signalOperationEnd,O.trigger),F.subscribe(ops.Document.signalCursorAdded,oe.registerCursor),F.subscribe(ops.Document.signalCursorRemoved,oe.removeCursor),F.subscribe(ops.OdtDocument.signalOperationEnd,d)}}(),gui.CaretManager=function(e,t){function n(e){return o.hasOwnProperty(e)?o[e]:null}function r(){return Object.keys(o).map(function(e){return o[e]})}function i(t){var n=o[t];n&&(delete o[t],t===e.getInputMemberId()?(a.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,n.ensureVisible),a.unsubscribe(ops.Document.signalCursorMoved,n.refreshCursorBlinking),l.unsubscribe("compositionupdate",n.handleUpdate),l.unsubscribe("compositionend",n.handleUpdate),l.unsubscribe("focus",n.setFocus),l.unsubscribe("blur",n.removeFocus),s.removeEventListener("focus",n.show,!1),s.removeEventListener("blur",n.hide,!1)):a.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,n.handleUpdate),n.destroy(function(){}))}var o={},s=runtime.getWindow(),a=e.getSession().getOdtDocument(),l=e.getEventManager();this.registerCursor=function(n,r,i){var c=n.getMemberId();return n=new gui.Caret(n,t,r,i),o[c]=n,c===e.getInputMemberId()?(runtime.log("Starting to track input on new cursor of "+c),a.subscribe(ops.OdtDocument.signalProcessingBatchEnd,n.ensureVisible),a.subscribe(ops.Document.signalCursorMoved,n.refreshCursorBlinking),l.subscribe("compositionupdate",n.handleUpdate),l.subscribe("compositionend",n.handleUpdate),l.subscribe("focus",n.setFocus),l.subscribe("blur",n.removeFocus),s.addEventListener("focus",n.show,!1),s.addEventListener("blur",n.hide,!1),n.setOverlayElement(l.getEventTrap())):a.subscribe(ops.OdtDocument.signalProcessingBatchEnd,n.handleUpdate),n},this.getCaret=n,this.getCarets=r,this.destroy=function(t){var n=r().map(function(e){return e.destroy});e.getSelectionController().setCaretXPositionLocator(null),a.unsubscribe(ops.Document.signalCursorRemoved,i),o={},core.Async.destroyAll(n,t)},e.getSelectionController().setCaretXPositionLocator(function(){var t,r=n(e.getInputMemberId());return r&&(t=r.getBoundingClientRect()),t?t.right:void 0}),a.subscribe(ops.Document.signalCursorRemoved,i)},gui.EditInfoHandle=function(e){var t,n=[],r=e.ownerDocument,i=r.documentElement.namespaceURI;this.setEdits=function(e){var o,s,a,l;for(n=e,core.DomUtils.removeAllChildNodes(t),e=0;e<n.length;e+=1)(o=r.createElementNS(i,"div")).className="editInfo",(s=r.createElementNS(i,"span")).className="editInfoColor",s.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",n[e].memberid),(a=r.createElementNS(i,"span")).className="editInfoAuthor",a.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",n[e].memberid),(l=r.createElementNS(i,"span")).className="editInfoTime",l.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",n[e].memberid),l.appendChild(r.createTextNode(n[e].time.toString())),o.appendChild(s),o.appendChild(a),o.appendChild(l),t.appendChild(o)},this.show=function(){t.style.display="block"},this.hide=function(){t.style.display="none"},this.destroy=function(n){e.removeChild(t),n()},(t=r.createElementNS(i,"div")).setAttribute("class","editInfoHandle"),t.style.display="none",e.appendChild(t)},ops.EditInfo=function(e,t){var n,r={};this.getNode=function(){return n},this.getOdtDocument=function(){return t},this.getEdits=function(){return r},this.getSortedEdits=function(){return function(){var e,t=[];for(e in r)r.hasOwnProperty(e)&&t.push({memberid:e,time:r[e].time});return t.sort(function(e,t){return e.time-t.time}),t}()},this.addEdit=function(e,t){r[e]={time:t}},this.clearEdits=function(){r={}},this.destroy=function(t){e.parentNode&&e.removeChild(n),t()},n=t.getDOMDocument().createElementNS("urn:webodf:names:editinfo","editinfo"),e.insertBefore(n,e.firstChild)},gui.EditInfoMarker=function(e,t){function n(e,t){return runtime.setTimeout(function(){o.style.opacity=e},t)}var r,i,o,s,a,l,c=this;this.addEdit=function(t,r){var c=Date.now()-r;e.addEdit(t,r),i.setEdits(e.getSortedEdits()),o.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",t),runtime.clearTimeout(a),runtime.clearTimeout(l),1e4>c?(s=n(1,0),a=n(.5,1e4-c),l=n(.2,2e4-c)):1e4<=c&&2e4>c?(s=n(.5,0),l=n(.2,2e4-c)):s=n(.2,0)},this.getEdits=function(){return e.getEdits()},this.clearEdits=function(){e.clearEdits(),i.setEdits([]),o.hasAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")&&o.removeAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")},this.getEditInfo=function(){return e},this.show=function(){o.style.display="block"},this.hide=function(){c.hideHandle(),o.style.display="none"},this.showHandle=function(){i.show()},this.hideHandle=function(){i.hide()},this.destroy=function(t){runtime.clearTimeout(s),runtime.clearTimeout(a),runtime.clearTimeout(l),r.removeChild(o),i.destroy(function(n){n?t(n):e.destroy(t)})},function(){var n=e.getOdtDocument().getDOMDocument();(o=n.createElementNS(n.documentElement.namespaceURI,"div")).setAttribute("class","editInfoMarker"),o.onmouseover=function(){c.showHandle()},o.onmouseout=function(){c.hideHandle()},(r=e.getNode()).appendChild(o),i=new gui.EditInfoHandle(r),t||c.hide()}()},gui.HyperlinkTooltipView=function(e,t){var n,r,i,o=core.DomUtils,s=odf.OdfUtils,a=runtime.getWindow();runtime.assert(null!==a,"Expected to be run in an environment which has a global window, like a browser."),this.showTooltip=function(l){var c,u=l.target||l.srcElement,d=e.getSizer(),h=e.getZoomLevel();e:{for(;u;){if(s.isHyperlink(u))break e;if(s.isParagraph(u)||s.isInlineRoot(u))break;u=u.parentNode}u=null}if(u){var p;switch(o.containsNode(d,i)||d.appendChild(i),c=r,t()){case gui.KeyboardHandler.Modifier.Ctrl:p=runtime.tr("Ctrl-click to follow link");break;case gui.KeyboardHandler.Modifier.Meta:p=runtime.tr("⌘-click to follow link");break;default:p=""}c.textContent=p,n.textContent=s.getHyperlinkTarget(u),i.style.display="block",c=a.innerWidth-i.offsetWidth-15,u=l.clientX>c?c:l.clientX+15,c=a.innerHeight-i.offsetHeight-10,l=l.clientY>c?c:l.clientY+10,d=d.getBoundingClientRect(),u=(u-d.left)/h,l=(l-d.top)/h,i.style.left=u+"px",i.style.top=l+"px"}},this.hideTooltip=function(){i.style.display="none"},this.destroy=function(e){i.parentNode&&i.parentNode.removeChild(i),e()},function(){var t=e.getElement().ownerDocument;n=t.createElement("span"),r=t.createElement("span"),n.className="webodf-hyperlinkTooltipLink",r.className="webodf-hyperlinkTooltipText",(i=t.createElement("div")).className="webodf-hyperlinkTooltip",i.appendChild(n),i.appendChild(r),e.getElement().appendChild(i)}()},gui.OdfFieldView=function(e){var t,n=e.getElement().ownerDocument;this.showFieldHighlight=function(){t.appendChild(n.createTextNode(function(){var e=(t=odf.OdfSchema.getFields().map(function(e){return e.replace(":","|")})).join(",\n")+"\n{ background-color: #D0D0D0; }\n",t=t.map(function(e){return e+":empty::after"}).join(",\n")+"\n{ content:' '; white-space: pre; }\n";return e+"\n"+t}()))},this.hideFieldHighlight=function(){for(var e=t.sheet,n=e.cssRules;n.length;)e.deleteRule(n.length-1)},this.destroy=function(e){t.parentNode&&t.parentNode.removeChild(t),e()},t=function(){var e=n.getElementsByTagName("head").item(0),t=n.createElement("style"),r="";return t.type="text/css",t.media="screen, print, handheld, projection",odf.Namespaces.forEachPrefix(function(e,t){r+="@namespace "+e+" url("+t+");\n"}),t.appendChild(n.createTextNode(r)),e.appendChild(t),t}()},gui.ShadowCursor=function(e){var t=e.getDOMDocument().createRange(),n=!0;this.removeFromDocument=function(){},this.getMemberId=function(){return gui.ShadowCursor.ShadowCursorMemberId},this.getSelectedRange=function(){return t},this.setSelectedRange=function(e,r){t=e,n=!1!==r},this.hasForwardSelection=function(){return n},this.getDocument=function(){return e},this.getSelectionType=function(){return ops.OdtCursor.RangeSelection},t.setStart(e.getRootNode(),0)},gui.ShadowCursor.ShadowCursorMemberId="",gui.SelectionView=function(e){},gui.SelectionView.prototype.rerender=function(){},gui.SelectionView.prototype.show=function(){},gui.SelectionView.prototype.hide=function(){},gui.SelectionView.prototype.destroy=function(e){},gui.SelectionViewManager=function(e){function t(){return Object.keys(n).map(function(e){return n[e]})}var n={};this.getSelectionView=function(e){return n.hasOwnProperty(e)?n[e]:null},this.getSelectionViews=t,this.removeSelectionView=function(e){n.hasOwnProperty(e)&&(n[e].destroy(function(){}),delete n[e])},this.hideSelectionView=function(e){n.hasOwnProperty(e)&&n[e].hide()},this.showSelectionView=function(e){n.hasOwnProperty(e)&&n[e].show()},this.rerenderSelectionViews=function(){Object.keys(n).forEach(function(e){n[e].rerender()})},this.registerCursor=function(t,r){var i=t.getMemberId(),o=new e(t);return r?o.show():o.hide(),n[i]=o},this.destroy=function(e){var n=t();!function t(r,i){i?e(i):r<n.length?n[r].destroy(function(e){t(r+1,e)}):e()}(0,void 0)}},gui.SessionViewOptions=function(){this.caretBlinksOnRangeSelect=this.caretAvatarsInitiallyVisible=this.editInfoMarkersInitiallyVisible=!0},function(){function e(e,t){return void 0!==e?Boolean(e):t}gui.SessionView=function(t,n,r,i,o,s){function a(e){e.memberId===n&&C.getViewport().scrollIntoView(e.annotation.getBoundingClientRect())}function l(){var e=document.getElementsByTagName("head").item(0),t=document.createElement("style");return t.type="text/css",t.media="screen, print, handheld, projection",e.appendChild(t),t}function c(e){var t,n;for(n in A)A.hasOwnProperty(n)&&(t=A[n],e?t.show():t.hide())}function u(e){o.getCarets().forEach(function(t){e?t.showHandle():t.hideHandle()})}function d(e){var t=e.getMemberId();e=e.getProperties(),function(e,t,r){function i(t,n,r){n=t+'[editinfo|memberid="'+e+'"]'+r+n;e:{var i=y.firstChild;for(t=t+'[editinfo|memberid="'+e+'"]'+r+"{";i;){if(i.nodeType===Node.TEXT_NODE&&0===i.data.indexOf(t)){t=i;break e}i=i.nextSibling}t=null}t?t.data=n:y.appendChild(document.createTextNode(n))}i("div.editInfoMarker","{ background-color: "+r+"; }",""),i("span.editInfoColor","{ background-color: "+r+"; }",""),i("span.editInfoAuthor",'{ content: "'+t+'"; }',":before"),i("dc|creator","{ background-color: "+r+"; }",""),i(".webodf-selectionOverlay","{ fill: "+r+"; stroke: "+r+";}",""),e===n&&(i(".webodf-touchEnabled .webodf-selectionOverlay","{ display: block; }"," > .webodf-draggable"),e=gui.ShadowCursor.ShadowCursorMemberId,i(".webodf-selectionOverlay","{ fill: "+r+"; stroke: "+r+";}",""),i(".webodf-touchEnabled .webodf-selectionOverlay","{ display: block; }"," > .webodf-draggable"))}(t,e.fullName,e.color)}function h(e){var t=e.getMemberId(),n=r.getOdtDocument().getMember(t).getProperties();o.registerCursor(e,_,N),s.registerCursor(e,!0),(e=o.getCaret(t))&&(e.setAvatarImageUrl(n.imageUrl),e.setColor(n.color)),runtime.log("+++ View here +++ eagerly created an Caret for '"+t+"'! +++")}function p(e){e=e.getMemberId();var t=s.getSelectionView(n),r=s.getSelectionView(gui.ShadowCursor.ShadowCursorMemberId),i=o.getCaret(n);e===n?(r.hide(),t&&t.show(),i&&i.show()):e===gui.ShadowCursor.ShadowCursorMemberId&&(r.show(),t&&t.hide(),i&&i.hide())}function f(e){s.removeSelectionView(e)}function m(e){var t=e.paragraphElement,n=e.memberId;e=e.timeStamp;var i,o="",s=t.getElementsByTagNameNS("urn:webodf:names:editinfo","editinfo").item(0);s?(o=s.getAttributeNS("urn:webodf:names:editinfo","id"),i=A[o]):(o=Math.random().toString(),i=new ops.EditInfo(t,r.getOdtDocument()),i=new gui.EditInfoMarker(i,w),(s=t.getElementsByTagNameNS("urn:webodf:names:editinfo","editinfo").item(0)).setAttributeNS("urn:webodf:names:editinfo","id",o),A[o]=i),i.addEdit(n,new Date(e)),x.trigger()}function g(){var e;v.hasChildNodes()&&core.DomUtils.removeAllChildNodes(v),!0===i.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)&&(e=r.getOdtDocument().getMember(n))&&(e=e.getProperties().fullName,v.appendChild(document.createTextNode(".annotationWrapper:not([creator = '"+e+"']) .annotationRemoveButton { display: none; }")))}function b(e){var t=Object.keys(A).map(function(e){return A[e]});S.unsubscribe(ops.Document.signalMemberAdded,d),S.unsubscribe(ops.Document.signalMemberUpdated,d),S.unsubscribe(ops.Document.signalCursorAdded,h),S.unsubscribe(ops.Document.signalCursorRemoved,f),S.unsubscribe(ops.OdtDocument.signalParagraphChanged,m),S.unsubscribe(ops.Document.signalCursorMoved,p),S.unsubscribe(ops.OdtDocument.signalParagraphChanged,s.rerenderSelectionViews),S.unsubscribe(ops.OdtDocument.signalTableAdded,s.rerenderSelectionViews),S.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,s.rerenderSelectionViews),i.unsubscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,g),S.unsubscribe(ops.Document.signalMemberAdded,g),S.unsubscribe(ops.Document.signalMemberUpdated,g),y.parentNode.removeChild(y),v.parentNode.removeChild(v),function n(r,i){i?e(i):r<t.length?t[r].destroy(function(e){n(r+1,e)}):e()}(0,void 0)}var y,v,S,C,x,A={},w=e(t.editInfoMarkersInitiallyVisible,!0),_=e(t.caretAvatarsInitiallyVisible,!0),N=e(t.caretBlinksOnRangeSelect,!0);this.showEditInfoMarkers=function(){w||c(w=!0)},this.hideEditInfoMarkers=function(){w&&c(w=!1)},this.showCaretAvatars=function(){_||u(_=!0)},this.hideCaretAvatars=function(){_&&u(_=!1)},this.getSession=function(){return r},this.getCaret=function(e){return o.getCaret(e)},this.destroy=function(e){var t=[x.destroy,b];S.unsubscribe(ops.OdtDocument.signalAnnotationAdded,a),core.Async.destroyAll(t,e)},S=r.getOdtDocument(),C=S.getOdfCanvas(),S.subscribe(ops.OdtDocument.signalAnnotationAdded,a),S.subscribe(ops.Document.signalMemberAdded,d),S.subscribe(ops.Document.signalMemberUpdated,d),S.subscribe(ops.Document.signalCursorAdded,h),S.subscribe(ops.Document.signalCursorRemoved,f),S.subscribe(ops.OdtDocument.signalParagraphChanged,m),S.subscribe(ops.Document.signalCursorMoved,p),S.subscribe(ops.OdtDocument.signalParagraphChanged,s.rerenderSelectionViews),S.subscribe(ops.OdtDocument.signalTableAdded,s.rerenderSelectionViews),S.subscribe(ops.OdtDocument.signalParagraphStyleModified,s.rerenderSelectionViews),i.subscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,g),S.subscribe(ops.Document.signalMemberAdded,g),S.subscribe(ops.Document.signalMemberUpdated,g),(y=l()).appendChild(document.createTextNode("@namespace editinfo url(urn:webodf:names:editinfo);")),y.appendChild(document.createTextNode("@namespace dc url(http://purl.org/dc/elements/1.1/);")),v=l(),g(),x=core.Task.createRedrawTask(function(){var e=C.getAnnotationViewManager();e&&(e.rehighlightAnnotations(),S.fixCursorPositions())})}}(),gui.SvgSelectionView=function(e){function t(){var e=m.getRootNode();h!==e&&(h=e,(p=m.getCanvas().getSizer()).appendChild(b),b.setAttribute("class","webodf-selectionOverlay"),v.setAttribute("class","webodf-draggable"),S.setAttribute("class","webodf-draggable"),v.setAttribute("end","left"),S.setAttribute("end","right"),v.setAttribute("r",8),S.setAttribute("r",8),b.appendChild(y),b.appendChild(v),b.appendChild(S))}function n(e){return e=e.getBoundingClientRect(),Boolean(e&&0!==e.height)}function r(e){var t,r=C.getTextElements(e,!0,!1),i=e.cloneRange(),o=e.cloneRange();if(e=e.cloneRange(),!r.length)return null;e:{var s=r[t=0],a=i.startContainer===s?i.startOffset:0,l=a;for(i.setStart(s,a),i.setEnd(s,l);!n(i);){if(s.nodeType===Node.ELEMENT_NODE&&l<s.childNodes.length)l=s.childNodes.length;else if(s.nodeType===Node.TEXT_NODE&&l<s.length)l+=1;else{if(!r[t]){t=!1;break e}s=r[t],t+=1,a=l=0}i.setStart(s,a),i.setEnd(s,l)}t=!0}if(!t)return null;e:{for(t=r.length-1,s=r[t],l=a=o.endContainer===s?o.endOffset:s.nodeType===Node.TEXT_NODE?s.length:s.childNodes.length,o.setStart(s,a),o.setEnd(s,l);!n(o);){if(s.nodeType===Node.ELEMENT_NODE&&0<a)a=0;else if(s.nodeType===Node.TEXT_NODE&&0<a)--a;else{if(!r[t]){r=!1;break e}s=r[t],--t,a=l=s.length||s.childNodes.length}o.setStart(s,a),o.setEnd(s,l)}r=!0}return r?(e.setStart(i.startContainer,i.startOffset),e.setEnd(o.endContainer,o.endOffset),{firstRange:i,lastRange:o,fillerRange:e}):null}function i(e,t){var n={};return n.top=Math.min(e.top,t.top),n.left=Math.min(e.left,t.left),n.right=Math.max(e.right,t.right),n.bottom=Math.max(e.bottom,t.bottom),n.width=n.right-n.left,n.height=n.bottom-n.top,n}function o(e,t){return t&&0<t.width&&0<t.height&&(e=e?i(e,t):t),e}function s(e){function t(e){return _.setUnfilteredPosition(e,0),y.acceptNode(e)===N&&a.acceptPosition(_)===N?N:E}function n(e){var n=null;return t(e)===N&&(n=x.getBoundingClientRect(e)),n}var r,i,s,a,l,c=e.commonAncestorContainer,u=e.startContainer,d=e.endContainer,h=e.startOffset,p=e.endOffset,f=null,b=g.createRange(),y=new odf.OdfNodeFilter;if(u===c||d===c)return b=e.cloneRange(),f=b.getBoundingClientRect(),b.detach(),f;for(e=u;e.parentNode!==c;)e=e.parentNode;for(i=d;i.parentNode!==c;)i=i.parentNode;for(a=m.createRootFilter(u),c=e.nextSibling;c&&c!==i;)s=n(c),f=o(f,s),c=c.nextSibling;if(C.isParagraph(e))f=o(f,x.getBoundingClientRect(e));else if(e.nodeType===Node.TEXT_NODE)c=e,b.setStart(c,h),b.setEnd(c,c===i?p:c.length),s=b.getBoundingClientRect(),f=o(f,s);else for(l=g.createTreeWalker(e,NodeFilter.SHOW_TEXT,t,!1),c=l.currentNode=u;c&&c!==d;)b.setStart(c,h),b.setEnd(c,c.length),s=b.getBoundingClientRect(),f=o(f,s),r=c,h=0,c=l.nextNode();if(r||(r=u),C.isParagraph(i))f=o(f,x.getBoundingClientRect(i));else if(i.nodeType===Node.TEXT_NODE)c=i,b.setStart(c,c===e?h:0),b.setEnd(c,p),s=b.getBoundingClientRect(),f=o(f,s);else for(l=g.createTreeWalker(i,NodeFilter.SHOW_TEXT,t,!1),c=l.currentNode=d;c&&c!==r;)b.setStart(c,0),b.setEnd(c,p),s=b.getBoundingClientRect(),f=o(f,s),(c=l.previousNode())&&(p=c.length);return f}function a(e,t){var n=e.getBoundingClientRect(),r={width:0};return r.top=n.top,r.bottom=n.bottom,r.height=n.height,r.left=r.right=t?n.right:n.left,r}function l(){var n,o=e.getSelectedRange();if(n=w&&e.getSelectionType()===ops.OdtCursor.RangeSelection&&!o.collapsed){t();var l,c,u,d,h,f,m=x.getBoundingClientRect(p),g=A.getZoomLevel(),o=r(o);if(o){var C;for(n=o.firstRange,l=o.lastRange,c=o.fillerRange,u=x.translateRect(a(n,!1),m,g),h=x.translateRect(a(l,!0),m,g),d=(d=s(c))?x.translateRect(d,m,g):i(u,h),f=d.left,d=u.left+Math.max(0,d.width-(u.left-d.left)),m=Math.min(u.top,h.top),g=h.top+h.height,f=[{x:u.left,y:m+u.height},{x:u.left,y:m},{x:d,y:m},{x:d,y:g-h.height},{x:h.right,y:g-h.height},{x:h.right,y:g},{x:f,y:g},{x:f,y:m+u.height},{x:u.left,y:m+u.height}],d="",C=0;C<f.length;C+=1)d+=f[C].x+","+f[C].y+" ";y.setAttribute("points",d),v.setAttribute("cx",u.left),v.setAttribute("cy",m+u.height/2),S.setAttribute("cx",h.right),S.setAttribute("cy",g-h.height/2),n.detach(),l.detach(),c.detach()}n=Boolean(o)}b.style.display=n?"block":"none"}function c(t){w&&t===e&&f.trigger()}function u(e){e=8/e,v.setAttribute("r",e),S.setAttribute("r",e)}function d(t){p.removeChild(b),p.classList.remove("webodf-virtualSelections"),e.getDocument().unsubscribe(ops.Document.signalCursorMoved,c),A.unsubscribe(gui.ZoomHelper.signalZoomChanged,u),t()}var h,p,f,m=e.getDocument(),g=m.getDOMDocument(),b=g.createElementNS("http://www.w3.org/2000/svg","svg"),y=g.createElementNS("http://www.w3.org/2000/svg","polygon"),v=g.createElementNS("http://www.w3.org/2000/svg","circle"),S=g.createElementNS("http://www.w3.org/2000/svg","circle"),C=odf.OdfUtils,x=core.DomUtils,A=m.getCanvas().getZoomHelper(),w=!0,_=e.getDocument().createPositionIterator(m.getRootNode()),N=NodeFilter.FILTER_ACCEPT,E=NodeFilter.FILTER_REJECT;this.rerender=function(){w&&f.trigger()},this.show=function(){w=!0,f.trigger()},this.hide=function(){w=!1,f.trigger()},this.destroy=function(e){core.Async.destroyAll([f.destroy,d],e)},function(){var n=e.getMemberId();f=core.Task.createRedrawTask(l),t(),b.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",n),p.classList.add("webodf-virtualSelections"),e.getDocument().subscribe(ops.Document.signalCursorMoved,c),A.subscribe(gui.ZoomHelper.signalZoomChanged,u),u(A.getZoomLevel())}()},gui.UndoStateRules=function(){function e(e,t){var n=e.length;this.previous=function(){for(--n;0<=n;--n)if(t(e[n]))return e[n];return null}}function t(e){var t;return(e=e.spec()).hasOwnProperty("position")&&(t=e.position),t}function n(e){return e.isEdit}function r(e,n,r){return r?(e=t(e),n=t(n),r=t(r),e-n==n-r):0===(r=t(e)-t(n))||1===Math.abs(r)}this.isEditOperation=n,this.isPartOfOperationSet=function(t,i){var o,s=void 0!==t.group;if(!t.isEdit||0===i.length)return!0;if(o=i[i.length-1],s&&t.group===o.group)return!0;e:switch(t.spec().optype){case"RemoveText":case"InsertText":o=!0;break e;default:o=!1}if(o&&i.some(n)){if(s){var a;s=t.spec().optype;var l,c,u=(o=new e(i,n)).previous(),d=null;for(runtime.assert(Boolean(u),"No edit operations found in state"),c=u.group,runtime.assert(void 0!==c,"Operation has no group"),l=1;u&&u.group===c;){if(s===u.spec().optype){a=u;break}u=o.previous()}if(a){for(u=o.previous();u;){if(u.group!==c){if(2===l)break;c=u.group,l+=1}if(s===u.spec().optype){d=u;break}u=o.previous()}a=r(t,a,d)}else a=!1;return a}return a=t.spec().optype,s=new e(i,n),o=s.previous(),runtime.assert(Boolean(o),"No edit operations found in state"),a=a===o.spec().optype&&r(t,o,s.previous())}return!1}},function(){function e(e,t){this.mainId=void 0!==e?e:-1,this.subId=void 0!==t?t:-1}function t(t,r,i){var o,s,a;this.addOperation=function(e){t.isEditOperation(e)&&(a+=1),s.push(e)},this.isNextStateId=function(e){return e.mainId===o&&e.subId===a},this.getNextStateId=function(){return new e(o,a)},this.getOperations=function(){return s},o=n+=1,s=r||[],a=r&&i?r.reduce(function(e,n){return e+(t.isEditOperation(n)?1:0)},0):0}var n=0;gui.TrivialUndoManager=function(n){function r(){return!0!==g.isNextStateId(m)}function i(e){0<(e=e.getOperations()).length&&(A=!0,p(e),A=!1)}function o(){C.emit(gui.UndoManager.signalUndoStackChanged,{undoAvailable:b.hasUndoStates(),redoAvailable:b.hasRedoStates()})}function s(e){var t=r();e!==t&&C.emit(gui.UndoManager.signalDocumentModifiedChanged,t)}function a(){g!==h&&g!==v[v.length-1]&&v.push(g)}function l(e){var t=e.previousSibling||e.nextSibling;e.parentNode.removeChild(e),y.normalizeTextNodes(t)}function c(e){return Object.keys(e).map(function(t){return e[t]})}function u(){var e=r(),n=d=f.cloneDocumentElement();y.getElementsByTagNameNS(n,"urn:webodf:names:cursor","cursor").forEach(l),y.getElementsByTagNameNS(n,"urn:webodf:names:cursor","anchor").forEach(l),a(),g=h=function(e){function n(e){var t=e.spec();if(a[t.memberid])switch(t.optype){case"AddCursor":o[t.memberid]||(o[t.memberid]=e,delete a[t.memberid],--r);break;case"MoveCursor":s[t.memberid]||(s[t.memberid]=e)}}var r,i,o={},s={},a={};for(i=e.pop(),f.getMemberIds().forEach(function(e){a[e]=!0}),r=Object.keys(a).length;i&&0<r;)(i=i.getOperations()).reverse(),i.forEach(n),i=e.pop();return new t(x,c(o).concat(c(s)))}([h].concat(v)),v.length=0,S.length=0,e||(m=g.getNextStateId()),o(),s(e)}var d,h,p,f,m,g,b=this,y=core.DomUtils,v=[],S=[],C=new core.EventNotifier([gui.UndoManager.signalUndoStackChanged,gui.UndoManager.signalUndoStateCreated,gui.UndoManager.signalUndoStateModified,gui.UndoManager.signalDocumentModifiedChanged,gui.TrivialUndoManager.signalDocumentRootReplaced]),x=n||new gui.UndoStateRules,A=!1;this.subscribe=function(e,t){C.subscribe(e,t)},this.unsubscribe=function(e,t){C.unsubscribe(e,t)},this.isDocumentModified=r,this.setDocumentModified=function(t){r()!==t&&(m=t?new e:g.getNextStateId(),C.emit(gui.UndoManager.signalDocumentModifiedChanged,t))},this.hasUndoStates=function(){return 0<v.length},this.hasRedoStates=function(){return 0<S.length},this.setDocument=function(e){f=e},this.purgeInitialState=function(){var e=r();v.length=0,S.length=0,g=h=new t(x),m=g.getNextStateId(),d=null,o(),s(e)},this.setInitialState=u,this.initialize=function(){d||u()},this.setPlaybackFunction=function(e){p=e},this.onOperationExecuted=function(e){if(!A){var n=r();x.isEditOperation(e)&&(g===h||0<S.length)||!x.isPartOfOperationSet(e,g.getOperations())?(S.length=0,a(),g=new t(x,[e],!0),v.push(g),C.emit(gui.UndoManager.signalUndoStateCreated,{operations:g.getOperations()}),o()):(g.addOperation(e),C.emit(gui.UndoManager.signalUndoStateModified,{operations:g.getOperations()})),s(n)}},this.moveForward=function(e){for(var t,n=0,a=r();e&&S.length;)t=S.pop(),v.push(t),i(t),--e,n+=1;return n&&(g=v[v.length-1],o(),s(a)),n},this.moveBackward=function(e){for(var t=0,n=r();e&&v.length;)S.push(v.pop()),--e,t+=1;return t&&(f.getMemberIds().forEach(function(e){f.hasCursor(e)&&f.removeCursor(e)}),f.setDocumentElement(d.cloneNode(!0)),C.emit(gui.TrivialUndoManager.signalDocumentRootReplaced,{}),i(h),v.forEach(i),g=v[v.length-1]||h,o(),s(n)),t},g=h=new t(x),m=g.getNextStateId()},gui.TrivialUndoManager.signalDocumentRootReplaced="documentRootReplaced"}(),odf.GraphicProperties=function(e,t,n){var r=this,i=odf.Namespaces.stylens,o=odf.Namespaces.svgns;this.verticalPos=function(){return r.data.value("verticalPos")},this.verticalRel=function(){return r.data.value("verticalRel")},this.horizontalPos=function(){return r.data.value("horizontalPos")},this.horizontalRel=function(){return r.data.value("horizontalRel")},this.strokeWidth=function(){return r.data.value("strokeWidth")},r.data=new odf.LazyStyleProperties(void 0===n?void 0:n.data,{verticalPos:function(){var t=e.getAttributeNS(i,"vertical-pos");return""===t?void 0:t},verticalRel:function(){var t=e.getAttributeNS(i,"vertical-rel");return""===t?void 0:t},horizontalPos:function(){var t=e.getAttributeNS(i,"horizontal-pos");return""===t?void 0:t},horizontalRel:function(){var t=e.getAttributeNS(i,"horizontal-rel");return""===t?void 0:t},strokeWidth:function(){var n=e.getAttributeNS(o,"stroke-width");return t.parseLength(n)}})},odf.ComputedGraphicProperties=function(){var e;this.setGraphicProperties=function(t){e=t},this.verticalPos=function(){return e&&e.verticalPos()||"from-top"},this.verticalRel=function(){return e&&e.verticalRel()||"page"},this.horizontalPos=function(){return e&&e.horizontalPos()||"from-left"},this.horizontalRel=function(){return e&&e.horizontalRel()||"page"}},odf.PageLayoutProperties=function(e,t,n){var r=this,i=odf.Namespaces.fons;this.pageHeight=function(){return r.data.value("pageHeight")||1123},this.pageWidth=function(){return r.data.value("pageWidth")||794},r.data=new odf.LazyStyleProperties(void 0===n?void 0:n.data,{pageHeight:function(){var n;return e&&(n=e.getAttributeNS(i,"page-height"),n=t.parseLength(n)),n},pageWidth:function(){var n;return e&&(n=e.getAttributeNS(i,"page-width"),n=t.parseLength(n)),n}})},odf.PageLayout=function(e,t,n){var r=null;e&&(r=t.getPropertiesElement("page-layout-properties",e)),this.pageLayout=new odf.PageLayoutProperties(r,t,n&&n.pageLayout)},odf.PageLayoutCache=function(){},odf.PageLayoutCache.prototype.getPageLayout=function(e){},odf.PageLayoutCache.prototype.getDefaultPageLayout=function(){},odf.ParagraphProperties=function(e,t,n){var r=this,i=odf.Namespaces.fons;this.marginTop=function(){return r.data.value("marginTop")},r.data=new odf.LazyStyleProperties(void 0===n?void 0:n.data,{marginTop:function(){var r=e.getAttributeNS(i,"margin-top");return t.parsePositiveLengthOrPercent(r,"marginTop",n&&n.data)}})},odf.ComputedParagraphProperties=function(){var e={},t=[];this.setStyleChain=function(n){t=n,e={}},this.marginTop=function(){var n,r;if(e.hasOwnProperty("marginTop"))n=e.marginTop;else{for(r=0;void 0===n&&r<t.length;r+=1)n=t[r].marginTop();e.marginTop=n}return n||0}},odf.TextProperties=function(e,t,n){var r=this,i=odf.Namespaces.fons;this.fontSize=function(){return r.data.value("fontSize")},r.data=new odf.LazyStyleProperties(void 0===n?void 0:n.data,{fontSize:function(){var r=e.getAttributeNS(i,"font-size");return t.parsePositiveLengthOrPercent(r,"fontSize",n&&n.data)}})},odf.ComputedTextProperties=function(){var e={},t=[];this.setStyleChain=function(n){t=n,e={}},this.fontSize=function(){var n,r;if(e.hasOwnProperty("fontSize"))n=e.fontSize;else{for(r=0;void 0===n&&r<t.length;r+=1)n=t[r].fontSize();e.fontSize=n}return n||12}},odf.MasterPage=function(e,t){var n;e?(n=e.getAttributeNS(odf.Namespaces.stylens,"page-layout-name"),this.pageLayout=t.getPageLayout(n)):this.pageLayout=t.getDefaultPageLayout()},odf.MasterPageCache=function(){},odf.MasterPageCache.prototype.getMasterPage=function(e){},odf.StylePileEntry=function(e,t,n,r){this.masterPage=function(){var t=e.getAttributeNS(odf.Namespaces.stylens,"master-page-name"),r=null;return t&&(r=n.getMasterPage(t)),r},function(n){var i=e.getAttributeNS(odf.Namespaces.stylens,"family"),o=null;"graphic"!==i&&"chart"!==i||(n.graphic=void 0===r?void 0:r.graphic,null!==(o=t.getPropertiesElement("graphic-properties",e,o))&&(n.graphic=new odf.GraphicProperties(o,t,n.graphic))),"paragraph"!==i&&"table-cell"!==i&&"graphic"!==i&&"presentation"!==i&&"chart"!==i||(n.paragraph=void 0===r?void 0:r.paragraph,null!==(o=t.getPropertiesElement("paragraph-properties",e,o))&&(n.paragraph=new odf.ParagraphProperties(o,t,n.paragraph))),"text"!==i&&"paragraph"!==i&&"table-cell"!==i&&"graphic"!==i&&"presentation"!==i&&"chart"!==i||(n.text=void 0===r?void 0:r.text,null!==(o=t.getPropertiesElement("text-properties",e,o))&&(n.text=new odf.TextProperties(o,t,n.text)))}(this)},odf.StylePile=function(e,t){function n(n,r){var s,a;return n.hasAttributeNS(o,"parent-style-name")&&(a=n.getAttributeNS(o,"parent-style-name"),-1===r.indexOf(a)&&(s=i(a,r))),new odf.StylePileEntry(n,e,t,s)}var r,i,o=odf.Namespaces.stylens,s={},a={},l={},c={};i=function(e,t){var r,i=l[e];return!i&&(r=s[e])&&(t.push(e),i=n(r,t),l[e]=i),i},this.getStyle=function(e){var t,r=c[e]||l[e],i=[];return r||((t=a[e])||(t=s[e])&&i.push(e),t&&(r=n(t,i))),r},this.addCommonStyle=function(e){var t;e.hasAttributeNS(o,"name")&&(t=e.getAttributeNS(o,"name"),s.hasOwnProperty(t)||(s[t]=e))},this.addAutomaticStyle=function(e){var t;e.hasAttributeNS(o,"name")&&(t=e.getAttributeNS(o,"name"),a.hasOwnProperty(t)||(a[t]=e))},this.setDefaultStyle=function(e){void 0===r&&(r=n(e,[]))},this.getDefaultStyle=function(){return r}},odf.ComputedGraphicStyle=function(){this.text=new odf.ComputedTextProperties,this.paragraph=new odf.ComputedParagraphProperties,this.graphic=new odf.ComputedGraphicProperties},odf.ComputedParagraphStyle=function(){this.text=new odf.ComputedTextProperties,this.paragraph=new odf.ComputedParagraphProperties},odf.ComputedTextStyle=function(){this.text=new odf.ComputedTextProperties},odf.StyleCache=function(e){function t(e,t,n,r){var i;if(t=n.getAttributeNS(t,"class-names"))for(t=t.split(" "),i=0;i<t.length;i+=1)(n=t[i])&&(r.push(e),r.push(n))}function n(e,n){var r=x.getStyleName("paragraph",e);return void 0!==r&&(n.push("paragraph"),n.push(r)),e.namespaceURI!==S||"h"!==e.localName&&"p"!==e.localName||t("paragraph",S,e,n),n}function r(e,t,n){var r,i,o,a,l=[];for(r=0;r<e.length;r+=2)o=e[r],a=e[r+1],o=s[o],void 0!==(a=o.getStyle(a))&&(void 0!==(a=a[t])&&a!==i&&(l.push(a),i=a));return o=s[n],(a=o.getDefaultStyle())&&(void 0!==(a=a[t])&&a!==i&&l.push(a)),l}function i(r,o){var s=x.getStyleName("text",r),a=r.parentNode;return void 0!==s&&(o.push("text"),o.push(s)),"span"===r.localName&&r.namespaceURI===S&&t("text",S,r,o),a&&a!==e?(a.namespaceURI!==S||"p"!==a.localName&&"h"!==a.localName?i(a,o):n(a,o),o):o}function o(e){return e=e.getAttributeNS(C,"family"),s[e]}var s,a,l,c,u,d,h,p,f,m,g,b,y,v=this,S=odf.Namespaces.textns,C=odf.Namespaces.stylens,x=new odf.StyleInfo,A=new odf.StyleParseUtils;this.getComputedGraphicStyle=function(e){var t=[];void 0!==(e=x.getStyleName("graphic",e))&&(t.push("graphic"),t.push(e)),e=t.join("/");var n=c[e];return runtime.assert(0==t.length%2,"Invalid style chain."),void 0===n&&((n=new odf.ComputedGraphicStyle).graphic.setGraphicProperties(r(t,"graphic","graphic")[0]),n.text.setStyleChain(r(t,"text","graphic")),n.paragraph.setStyleChain(r(t,"paragraph","graphic")),c[e]=n),n},this.getComputedParagraphStyle=function(e){var t=(e=n(e,[])).join("/"),i=l[t];return runtime.assert(0==e.length%2,"Invalid style chain."),void 0===i&&((i=new odf.ComputedParagraphStyle).text.setStyleChain(r(e,"text","paragraph")),i.paragraph.setStyleChain(r(e,"paragraph","paragraph")),l[t]=i),i},this.getComputedTextStyle=function(e){var t=(e=i(e,[])).join("/"),n=a[t];return runtime.assert(0==e.length%2,"Invalid style chain."),void 0===n&&((n=new odf.ComputedTextStyle).text.setStyleChain(r(e,"text","text")),a[t]=n),n},this.getPageLayout=function(e){var t=y[e];return t||((t=b[e])?(t=new odf.PageLayout(t,A,g),y[e]=t):t=g),t},this.getDefaultPageLayout=function(){return g},this.getMasterPage=function(e){var t=f[e];return void 0===t&&((t=p[e])?(t=new odf.MasterPage(t,v),f[e]=t):t=null),t},this.getDefaultMasterPage=function(){return m},this.update=function(){var t,n,r=null,i=null;for(a={},l={},c={},p={},f={},y={},b={},u=new odf.StylePile(A,v),d=new odf.StylePile(A,v),h=new odf.StylePile(A,v),s={text:u,paragraph:d,graphic:h},t=e.styles.firstElementChild;t;)t.namespaceURI===C&&((n=o(t))?"style"===t.localName?n.addCommonStyle(t):"default-style"===t.localName&&n.setDefaultStyle(t):"default-page-layout"===t.localName&&(r=t)),t=t.nextElementSibling;for(g=new odf.PageLayout(r,A),t=e.automaticStyles.firstElementChild;t;)t.namespaceURI===C&&((n=o(t))&&"style"===t.localName?n.addAutomaticStyle(t):"page-layout"===t.localName&&(b[t.getAttributeNS(C,"name")]=t)),t=t.nextElementSibling;for(t=e.masterStyles.firstElementChild;t;)t.namespaceURI===C&&"master-page"===t.localName&&(i=i||t,0<(r=(n=t).getAttributeNS(C,"name")).length&&!p.hasOwnProperty(r)&&(p[r]=n)),t=t.nextElementSibling;m=new odf.MasterPage(i,v)}},ops.OperationTransformMatrix=function(){function e(e){e.position+=e.length,e.length*=-1}function t(t){var n=0>t.length;return n&&e(t),n}function n(e,t){var n=[];return e&&["style:parent-style-name","style:next-style-name"].forEach(function(r){e[r]===t&&n.push(r)}),n}function r(e,t){e&&["style:parent-style-name","style:next-style-name"].forEach(function(n){e[n]===t&&delete e[n]})}function i(e){var t={};return Object.keys(e).forEach(function(n){t[n]="object"==typeof e[n]?i(e[n]):e[n]}),t}function o(e,t,n,r){var i,o,s=!1,a=!1,l=[];if(r&&r.attributes&&(l=r.attributes.split(",")),e&&(n||0<l.length)&&Object.keys(e).forEach(function(t){var r,i=e[t];"object"!=typeof i&&(n&&(r=n[t]),void 0!==r?(delete e[t],a=!0,r===i&&(delete n[t],s=!0)):-1!==l.indexOf(t)&&(delete e[t],a=!0))}),t&&t.attributes&&(n||0<l.length)){for(o=t.attributes.split(","),r=0;r<o.length;r+=1)i=o[r],(n&&void 0!==n[i]||l&&-1!==l.indexOf(i))&&(o.splice(r,1),--r,a=!0);0<o.length?t.attributes=o.join(","):delete t.attributes}return{majorChanged:s,minorChanged:a}}function s(e){for(var t in e)if(e.hasOwnProperty(t))return!0;return!1}function a(e){for(var t in e)if(e.hasOwnProperty(t)&&("attributes"!==t||0<e.attributes.length))return!0;return!1}function l(e,t,n,r,i){var l,c=e?e[i]:null,u=t?t[i]:null,d=n?n[i]:null,h=r?r[i]:null;return l=o(c,u,d,h),c&&!s(c)&&delete e[i],u&&!a(u)&&delete t[i],d&&!s(d)&&delete n[i],h&&!a(h)&&delete r[i],l}function c(e,t){return{opSpecsA:[e],opSpecsB:[t]}}var u;u={AddAnnotation:{AddAnnotation:function(e,t,n){var r;return e.position<t.position?(r=e,n=t):t.position<e.position?(r=t,n=e):(r=n?e:t,n=n?t:e),n.position<r.position+r.length&&(r.length+=2),n.position+=2,{opSpecsA:[e],opSpecsB:[t]}},AddCursor:c,AddMember:c,AddStyle:c,ApplyDirectStyling:function(e,t){return e.position<=t.position?t.position+=2:e.position<=t.position+t.length&&(t.length+=2),{opSpecsA:[e],opSpecsB:[t]}},InsertText:function(e,t){return t.position<=e.position?e.position+=t.text.length:(void 0!==e.length&&t.position<=e.position+e.length&&(e.length+=t.text.length),t.position+=2),{opSpecsA:[e],opSpecsB:[t]}},MergeParagraph:function(e,t){return t.sourceStartPosition<=e.position?--e.position:(void 0!==e.length&&t.sourceStartPosition<=e.position+e.length&&--e.length,t.sourceStartPosition+=2,e.position<t.destinationStartPosition&&(t.destinationStartPosition+=2)),{opSpecsA:[e],opSpecsB:[t]}},MoveCursor:function(n,r){var i=t(r);return n.position<r.position?r.position+=2:n.position<r.position+r.length&&(r.length+=2),i&&e(r),{opSpecsA:[n],opSpecsB:[r]}},RemoveAnnotation:function(e,t){return e.position<t.position?(t.position<e.position+e.length&&(e.length-=t.length+2),t.position+=2):e.position-=t.length+2,{opSpecsA:[e],opSpecsB:[t]}},RemoveCursor:c,RemoveMember:c,RemoveStyle:c,RemoveText:function(e,t){var n,r=t.position,i=t.position+t.length,o=[e],s=[t];return e.position<=t.position?t.position+=2:e.position<i&&(t.length=e.position-t.position,n={optype:"RemoveText",memberid:t.memberid,timestamp:t.timestamp,position:e.position+2,length:i-e.position},s.unshift(n)),t.position+t.length<=e.position?(e.position-=t.length,void 0!==e.length&&n&&(e.length=n.length>=e.length?0:e.length-n.length)):void 0!==e.length&&(n=e.position+e.length,i<=n?e.length-=t.length:r<n&&(e.length=r-e.position)),{opSpecsA:o,opSpecsB:s}},SetParagraphStyle:function(e,t){return e.position<t.position&&(t.position+=2),{opSpecsA:[e],opSpecsB:[t]}},SplitParagraph:function(e,t){return e.position<t.sourceParagraphPosition&&(t.sourceParagraphPosition+=2),t.position<=e.position?e.position+=1:(void 0!==e.length&&t.position<=e.position+e.length&&(e.length+=1),t.position+=2),{opSpecsA:[e],opSpecsB:[t]}},UpdateMember:c,UpdateMetadata:c,UpdateParagraphStyle:c},AddCursor:{AddCursor:c,AddMember:c,AddStyle:c,ApplyDirectStyling:c,InsertText:c,MergeParagraph:c,MoveCursor:c,RemoveAnnotation:c,RemoveCursor:c,RemoveMember:c,RemoveStyle:c,RemoveText:c,SetParagraphStyle:c,SplitParagraph:c,UpdateMember:c,UpdateMetadata:c,UpdateParagraphStyle:c},AddMember:{AddStyle:c,ApplyDirectStyling:c,InsertText:c,MergeParagraph:c,MoveCursor:c,RemoveAnnotation:c,RemoveCursor:c,RemoveStyle:c,RemoveText:c,SetParagraphStyle:c,SplitParagraph:c,UpdateMetadata:c,UpdateParagraphStyle:c},AddStyle:{AddStyle:c,ApplyDirectStyling:c,InsertText:c,MergeParagraph:c,MoveCursor:c,RemoveAnnotation:c,RemoveCursor:c,RemoveMember:c,RemoveStyle:function(e,t){var i,o=[e],s=[t];return e.styleFamily===t.styleFamily&&(0<(i=n(e.setProperties,t.styleName)).length&&(i={optype:"UpdateParagraphStyle",memberid:t.memberid,timestamp:t.timestamp,styleName:e.styleName,removedProperties:{attributes:i.join(",")}},s.unshift(i)),r(e.setProperties,t.styleName)),{opSpecsA:o,opSpecsB:s}},RemoveText:c,SetParagraphStyle:c,SplitParagraph:c,UpdateMember:c,UpdateMetadata:c,UpdateParagraphStyle:c},ApplyDirectStyling:{ApplyDirectStyling:function(e,t,n){var r,o,a,c,u,d,h,p;return c=[e],a=[t],e.position+e.length<=t.position||e.position>=t.position+t.length||(r=n?e:t,o=n?t:e,e.position===t.position&&e.length===t.length||(d=i(r),h=i(o)),((t=l(o.setProperties,null,r.setProperties,null,"style:text-properties")).majorChanged||t.minorChanged)&&(a=[],e=[],c=r.position+r.length,u=o.position+o.length,o.position<r.position?t.minorChanged&&((p=i(h)).length=r.position-o.position,e.push(p),o.position=r.position,o.length=u-o.position):r.position<o.position&&t.majorChanged&&((p=i(d)).length=o.position-r.position,a.push(p),r.position=o.position,r.length=c-r.position),u>c?t.minorChanged&&((d=h).position=c,d.length=u-c,e.push(d),o.length=c-o.position):c>u&&t.majorChanged&&(d.position=u,d.length=c-u,a.push(d),r.length=u-r.position),r.setProperties&&s(r.setProperties)&&a.push(r),o.setProperties&&s(o.setProperties)&&e.push(o),n?(c=a,a=e):c=e)),{opSpecsA:c,opSpecsB:a}},InsertText:function(e,t){return t.position<=e.position?e.position+=t.text.length:t.position<=e.position+e.length&&(e.length+=t.text.length),{opSpecsA:[e],opSpecsB:[t]}},MergeParagraph:function(e,t){var n=e.position,r=e.position+e.length;return n>=t.sourceStartPosition&&--n,r>=t.sourceStartPosition&&--r,e.position=n,e.length=r-n,{opSpecsA:[e],opSpecsB:[t]}},MoveCursor:c,RemoveAnnotation:function(e,t){var n=e.position,r=e.position+e.length,i=t.position+t.length,o=[e],s=[t];return t.position<=n&&r<=i?o=[]:(i<n&&(n-=t.length+2),i<r&&(r-=t.length+2),e.position=n,e.length=r-n),{opSpecsA:o,opSpecsB:s}},RemoveCursor:c,RemoveMember:c,RemoveStyle:c,RemoveText:function(e,t){var n=e.position+e.length,r=t.position+t.length,i=[e],o=[t];return r<=e.position?e.position-=t.length:t.position<n&&(e.position<t.position?e.length=r<n?e.length-t.length:t.position-e.position:(e.position=t.position,r<n?e.length=n-r:i=[])),{opSpecsA:i,opSpecsB:o}},SetParagraphStyle:c,SplitParagraph:function(e,t){return t.position<e.position?e.position+=1:t.position<e.position+e.length&&(e.length+=1),{opSpecsA:[e],opSpecsB:[t]}},UpdateMember:c,UpdateMetadata:c,UpdateParagraphStyle:c},InsertText:{InsertText:function(e,t,n){return e.position<t.position?t.position+=e.text.length:e.position>t.position?e.position+=t.text.length:n?t.position+=e.text.length:e.position+=t.text.length,{opSpecsA:[e],opSpecsB:[t]}},MergeParagraph:function(e,t){return e.position>=t.sourceStartPosition?--e.position:(e.position<t.sourceStartPosition&&(t.sourceStartPosition+=e.text.length),e.position<t.destinationStartPosition&&(t.destinationStartPosition+=e.text.length)),{opSpecsA:[e],opSpecsB:[t]}},MoveCursor:function(n,r){var i=t(r);return n.position<r.position?r.position+=n.text.length:n.position<r.position+r.length&&(r.length+=n.text.length),i&&e(r),{opSpecsA:[n],opSpecsB:[r]}},RemoveAnnotation:function(e,t){var n=e.position,r=t.position+t.length,i=[e],o=[t];return t.position<=n&&n<=r?(i=[],t.length+=e.text.length):r<e.position?e.position-=t.length+2:t.position+=e.text.length,{opSpecsA:i,opSpecsB:o}},RemoveCursor:c,RemoveMember:c,RemoveStyle:c,RemoveText:function(e,t){var n;n=t.position+t.length;var r=[e],i=[t];return n<=e.position?e.position-=t.length:e.position<=t.position?t.position+=e.text.length:(t.length=e.position-t.position,n={optype:"RemoveText",memberid:t.memberid,timestamp:t.timestamp,position:e.position+e.text.length,length:n-e.position},i.unshift(n),e.position=t.position),{opSpecsA:r,opSpecsB:i}},SetParagraphStyle:function(e,t){return t.position>e.position&&(t.position+=e.text.length),{opSpecsA:[e],opSpecsB:[t]}},SplitParagraph:function(e,t){return e.position<t.sourceParagraphPosition&&(t.sourceParagraphPosition+=e.text.length),e.position<=t.position?t.position+=e.text.length:e.position+=1,{opSpecsA:[e],opSpecsB:[t]}},UpdateMember:c,UpdateMetadata:c,UpdateParagraphStyle:c},MergeParagraph:{MergeParagraph:function(e,t,n){var r,i=[e],o=[t];return e.destinationStartPosition===t.destinationStartPosition?(i=[],o=[],e.moveCursor&&(r={optype:"MoveCursor",memberid:e.memberid,timestamp:e.timestamp,position:e.sourceStartPosition-1},i.push(r)),t.moveCursor&&(r={optype:"MoveCursor",memberid:t.memberid,timestamp:t.timestamp,position:t.sourceStartPosition-1},o.push(r)),e={optype:"SetParagraphStyle",memberid:(e=n?e:t).memberid,timestamp:e.timestamp,position:e.destinationStartPosition,styleName:e.paragraphStyleName},n?i.push(e):o.push(e)):t.sourceStartPosition===e.destinationStartPosition?(e.destinationStartPosition=t.destinationStartPosition,--e.sourceStartPosition,e.paragraphStyleName=t.paragraphStyleName):e.sourceStartPosition===t.destinationStartPosition?(t.destinationStartPosition=e.destinationStartPosition,--t.sourceStartPosition,t.paragraphStyleName=e.paragraphStyleName):e.destinationStartPosition<t.destinationStartPosition?(--t.destinationStartPosition,--t.sourceStartPosition):(--e.destinationStartPosition,--e.sourceStartPosition),{opSpecsA:i,opSpecsB:o}},MoveCursor:function(e,t){var n=t.position,r=t.position+t.length,i=Math.min(n,r),n=Math.max(n,r);return i>=e.sourceStartPosition&&--i,n>=e.sourceStartPosition&&--n,0<=t.length?(t.position=i,t.length=n-i):(t.position=n,t.length=i-n),{opSpecsA:[e],opSpecsB:[t]}},RemoveAnnotation:function(e,t){var n=t.position+t.length,r=[e],i=[t];return t.position<=e.destinationStartPosition&&e.sourceStartPosition<=n?(r=[],--t.length):e.sourceStartPosition<t.position?--t.position:(n<e.destinationStartPosition&&(e.destinationStartPosition-=t.length+2),n<e.sourceStartPosition&&(e.sourceStartPosition-=t.length+2)),{opSpecsA:r,opSpecsB:i}},RemoveCursor:c,RemoveMember:c,RemoveStyle:c,RemoveText:function(e,t){return t.position>=e.sourceStartPosition?--t.position:(t.position<e.destinationStartPosition&&(e.destinationStartPosition-=t.length),t.position<e.sourceStartPosition&&(e.sourceStartPosition-=t.length)),{opSpecsA:[e],opSpecsB:[t]}},SetParagraphStyle:function(e,t){var n=[e],r=[t];return t.position>e.sourceStartPosition?--t.position:t.position!==e.destinationStartPosition&&t.position!==e.sourceStartPosition||(t.position=e.destinationStartPosition,e.paragraphStyleName=t.styleName),{opSpecsA:n,opSpecsB:r}},SplitParagraph:function(e,t){var n,r=[e],i=[t];return t.position<e.destinationStartPosition?(e.destinationStartPosition+=1,e.sourceStartPosition+=1):t.position>=e.destinationStartPosition&&t.position<e.sourceStartPosition?(t.paragraphStyleName=e.paragraphStyleName,n={optype:"SetParagraphStyle",memberid:e.memberid,timestamp:e.timestamp,position:e.destinationStartPosition,styleName:e.paragraphStyleName},r.push(n),t.position===e.sourceStartPosition-1&&e.moveCursor&&(n={optype:"MoveCursor",memberid:e.memberid,timestamp:e.timestamp,position:t.position,length:0},r.push(n)),e.destinationStartPosition=t.position+1,e.sourceStartPosition+=1):t.position>=e.sourceStartPosition&&(--t.position,--t.sourceParagraphPosition),{opSpecsA:r,opSpecsB:i}},UpdateMember:c,UpdateMetadata:c,UpdateParagraphStyle:c},MoveCursor:{MoveCursor:c,RemoveAnnotation:function(n,r){var i=t(n),o=n.position+n.length,s=r.position+r.length;return r.position<=n.position&&o<=s?(n.position=r.position-1,n.length=0):(s<n.position?n.position-=r.length+2:s<o&&(n.length-=r.length+2),i&&e(n)),{opSpecsA:[n],opSpecsB:[r]}},RemoveCursor:function(e,t){return{opSpecsA:e.memberid===t.memberid?[]:[e],opSpecsB:[t]}},RemoveMember:c,RemoveStyle:c,RemoveText:function(n,r){var i=t(n),o=n.position+n.length,s=r.position+r.length;return s<=n.position?n.position-=r.length:r.position<o&&(n.position<r.position?n.length=s<o?n.length-r.length:r.position-n.position:(n.position=r.position,n.length=s<o?o-s:0)),i&&e(n),{opSpecsA:[n],opSpecsB:[r]}},SetParagraphStyle:c,SplitParagraph:function(n,r){var i=t(n);return r.position<n.position?n.position+=1:r.position<n.position+n.length&&(n.length+=1),i&&e(n),{opSpecsA:[n],opSpecsB:[r]}},UpdateMember:c,UpdateMetadata:c,UpdateParagraphStyle:c},RemoveAnnotation:{RemoveAnnotation:function(e,t){var n=[e],r=[t];return e.position===t.position&&e.length===t.length?(n=[],r=[]):e.position<t.position?t.position-=e.length+2:e.position-=t.length+2,{opSpecsA:n,opSpecsB:r}},RemoveCursor:c,RemoveMember:c,RemoveStyle:c,RemoveText:function(e,t){var n=e.position+e.length,r=t.position+t.length,i=[e],o=[t];return e.position<=t.position&&r<=n?(o=[],e.length-=t.length):r<e.position?e.position-=t.length:t.position<e.position?(e.position=t.position+1,t.length-=e.length+2):t.position-=e.length+2,{opSpecsA:i,opSpecsB:o}},SetParagraphStyle:function(e,t){var n=t.position,r=e.position+e.length,i=[e],o=[t];return e.position<=n&&n<=r?o=[]:r<n&&(t.position-=e.length+2),{opSpecsA:i,opSpecsB:o}},SplitParagraph:function(e,t){var n=t.position,r=e.position+e.length,i=[e],o=[t];return e.position<=n&&n<=r?(o=[],e.length+=1):(r<t.sourceParagraphPosition&&(t.sourceParagraphPosition-=e.length+2),r<n?t.position-=e.length+2:e.position+=1),{opSpecsA:i,opSpecsB:o}},UpdateMember:c,UpdateMetadata:c,UpdateParagraphStyle:c},RemoveCursor:{RemoveCursor:function(e,t){var n=e.memberid===t.memberid;return{opSpecsA:n?[]:[e],opSpecsB:n?[]:[t]}},RemoveMember:c,RemoveStyle:c,RemoveText:c,SetParagraphStyle:c,SplitParagraph:c,UpdateMember:c,UpdateMetadata:c,UpdateParagraphStyle:c},RemoveMember:{RemoveStyle:c,RemoveText:c,SetParagraphStyle:c,SplitParagraph:c,UpdateMetadata:c,UpdateParagraphStyle:c},RemoveStyle:{RemoveStyle:function(e,t){var n=e.styleName===t.styleName&&e.styleFamily===t.styleFamily;return{opSpecsA:n?[]:[e],opSpecsB:n?[]:[t]}},RemoveText:c,SetParagraphStyle:function(e,t){var n,r=[e],i=[t];return"paragraph"===e.styleFamily&&e.styleName===t.styleName&&(n={optype:"SetParagraphStyle",memberid:e.memberid,timestamp:e.timestamp,position:t.position,styleName:""},r.unshift(n),t.styleName=""),{opSpecsA:r,opSpecsB:i}},SplitParagraph:c,UpdateMember:c,UpdateMetadata:c,UpdateParagraphStyle:function(e,t){var i,o=[e],s=[t];return"paragraph"===e.styleFamily&&(0<(i=n(t.setProperties,e.styleName)).length&&(i={optype:"UpdateParagraphStyle",memberid:e.memberid,timestamp:e.timestamp,styleName:t.styleName,removedProperties:{attributes:i.join(",")}},o.unshift(i)),e.styleName===t.styleName?s=[]:r(t.setProperties,e.styleName)),{opSpecsA:o,opSpecsB:s}}},RemoveText:{RemoveText:function(e,t){var n=e.position+e.length,r=t.position+t.length,i=[e],o=[t];return r<=e.position?e.position-=t.length:n<=t.position?t.position-=e.length:t.position<n&&(e.position<t.position?(e.length=r<n?e.length-t.length:t.position-e.position,n<r?(t.position=e.position,t.length=r-n):o=[]):(n<r?t.length-=e.length:t.position<e.position?t.length=e.position-t.position:o=[],r<n?(e.position=t.position,e.length=n-r):i=[])),{opSpecsA:i,opSpecsB:o}},SetParagraphStyle:function(e,t){return e.position<t.position&&(t.position-=e.length),{opSpecsA:[e],opSpecsB:[t]}},SplitParagraph:function(e,t){var n=e.position+e.length,r=[e],i=[t];return t.position<=e.position?e.position+=1:t.position<n&&(e.length=t.position-e.position,n={optype:"RemoveText",memberid:e.memberid,timestamp:e.timestamp,position:t.position+1,length:n-t.position},r.unshift(n)),e.position+e.length<=t.position?t.position-=e.length:e.position<t.position&&(t.position=e.position),e.position+e.length<t.sourceParagraphPosition&&(t.sourceParagraphPosition-=e.length),{opSpecsA:r,opSpecsB:i}},UpdateMember:c,UpdateMetadata:c,UpdateParagraphStyle:c},SetParagraphStyle:{SetParagraphStyle:function(e,t,n){return e.position===t.position&&(n?t.styleName=e.styleName:e.styleName=t.styleName),{opSpecsA:[e],opSpecsB:[t]}},SplitParagraph:function(e,t){var n,r=[e],o=[t];return e.position>t.position?e.position+=1:e.position===t.sourceParagraphPosition&&(t.paragraphStyleName=e.styleName,(n=i(e)).position=t.position+1,r.push(n)),{opSpecsA:r,opSpecsB:o}},UpdateMember:c,UpdateMetadata:c,UpdateParagraphStyle:c},SplitParagraph:{SplitParagraph:function(e,t,n){var r,i;return e.position<t.position?r=!0:t.position<e.position?i=!0:e.position===t.position&&(n?r=!0:i=!0),r?(t.position+=1,t.sourceParagraphPosition=e.position<t.sourceParagraphPosition?t.sourceParagraphPosition+1:e.position+1):i&&(e.position+=1,e.sourceParagraphPosition=t.position<t.sourceParagraphPosition?e.sourceParagraphPosition+1:t.position+1),{opSpecsA:[e],opSpecsB:[t]}},UpdateMember:c,UpdateMetadata:c,UpdateParagraphStyle:c},UpdateMember:{UpdateMetadata:c,UpdateParagraphStyle:c},UpdateMetadata:{UpdateMetadata:function(e,t,n){var r,i=[e],l=[t];return r=n?e:t,o((e=n?t:e).setProperties||null,e.removedProperties||null,r.setProperties||null,r.removedProperties||null),r.setProperties&&s(r.setProperties)||r.removedProperties&&a(r.removedProperties)||(n?i=[]:l=[]),e.setProperties&&s(e.setProperties)||e.removedProperties&&a(e.removedProperties)||(n?l=[]:i=[]),{opSpecsA:i,opSpecsB:l}},UpdateParagraphStyle:c},UpdateParagraphStyle:{UpdateParagraphStyle:function(e,t,n){var r,i=[e],c=[t];return e.styleName===t.styleName&&(r=n?e:t,l((e=n?t:e).setProperties,e.removedProperties,r.setProperties,r.removedProperties,"style:paragraph-properties"),l(e.setProperties,e.removedProperties,r.setProperties,r.removedProperties,"style:text-properties"),o(e.setProperties||null,e.removedProperties||null,r.setProperties||null,r.removedProperties||null),r.setProperties&&s(r.setProperties)||r.removedProperties&&a(r.removedProperties)||(n?i=[]:c=[]),e.setProperties&&s(e.setProperties)||e.removedProperties&&a(e.removedProperties)||(n?c=[]:i=[])),{opSpecsA:i,opSpecsB:c}}}},this.passUnchanged=c,this.extendTransformations=function(e){Object.keys(e).forEach(function(t){var n,r=e[t],i=u.hasOwnProperty(t);runtime.log((i?"Extending":"Adding")+" map for optypeA: "+t),i||(u[t]={}),n=u[t],Object.keys(r).forEach(function(e){var i=n.hasOwnProperty(e);runtime.assert(t<=e,"Wrong order:"+t+", "+e),runtime.log("  "+(i?"Overwriting":"Adding")+" entry for optypeB: "+e),n[e]=r[e]})})},this.transformOpspecVsOpspec=function(e,t){var n,r=e.optype<=t.optype;return runtime.log("Crosstransforming:"),runtime.log(runtime.toJson(e)),runtime.log(runtime.toJson(t)),r||(n=e,e=t,t=n),(n=(n=u[e.optype])&&n[t.optype])?(n=n(e,t,!r),r||null===n||(n={opSpecsA:n.opSpecsB,opSpecsB:n.opSpecsA})):n=null,runtime.log("result:"),n?(runtime.log(runtime.toJson(n.opSpecsA)),runtime.log(runtime.toJson(n.opSpecsB))):runtime.log("null"),n}},ops.OperationTransformer=function(){function e(n,r){for(var i,o,s=[],a=[];0<n.length&&r;){if(i=n.shift(),!(i=t.transformOpspecVsOpspec(i,r)))return null;if(s=s.concat(i.opSpecsA),0===i.opSpecsB.length){s=s.concat(n),r=null;break}for(;1<i.opSpecsB.length;){if(!(o=e(n,i.opSpecsB.shift())))return null;a=a.concat(o.opSpecsB),n=o.opSpecsA}r=i.opSpecsB.pop()}return r&&a.push(r),{opSpecsA:s,opSpecsB:a}}var t=new ops.OperationTransformMatrix;this.getOperationTransformMatrix=function(){return t},this.transform=function(t,n){for(var r,i=[];0<n.length;){if(!(r=e(t,n.shift())))return null;t=r.opSpecsA,i=i.concat(r.opSpecsB)}return{opSpecsA:t,opSpecsB:i}}};var webodf_css='@namespace draw url(urn:oasis:names:tc:opendocument:xmlns:drawing:1.0);@namespace fo url(urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0);@namespace office url(urn:oasis:names:tc:opendocument:xmlns:office:1.0);@namespace presentation url(urn:oasis:names:tc:opendocument:xmlns:presentation:1.0);@namespace style url(urn:oasis:names:tc:opendocument:xmlns:style:1.0);@namespace svg url(urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0);@namespace table url(urn:oasis:names:tc:opendocument:xmlns:table:1.0);@namespace text url(urn:oasis:names:tc:opendocument:xmlns:text:1.0);@namespace webodfhelper url(urn:webodf:names:helper);@namespace cursor url(urn:webodf:names:cursor);@namespace editinfo url(urn:webodf:names:editinfo);@namespace annotation url(urn:webodf:names:annotation);@namespace dc url(http://purl.org/dc/elements/1.1/);@namespace svgns url(http://www.w3.org/2000/svg);office|document > *, office|document-content > * {display: none;}office|body, office|document {display: inline-block;position: relative;}text|p, text|h {display: block;padding: 0;margin: 0;line-height: normal;position: relative;}text|p::after, text|h::after {content: "\\200B";white-space: pre;}*[webodfhelper|containsparagraphanchor] {position: relative;}text|s {white-space: pre;}text|tab {display: inline;white-space: pre;}text|tracked-changes {display: none;}office|binary-data {display: none;}office|text {display: block;text-align: left;overflow: visible;word-wrap: break-word;}office|text::selection {background: transparent;}.webodf-virtualSelections *::selection {background: transparent;}.webodf-virtualSelections *::-moz-selection {background: transparent;}office|text * draw|text-box {display: block;border: 1px solid #d3d3d3;}office|text draw|frame {z-index: 1;}office|spreadsheet {display: block;border-collapse: collapse;empty-cells: show;font-family: sans-serif;font-size: 10pt;text-align: left;page-break-inside: avoid;overflow: hidden;}office|presentation {display: inline-block;text-align: left;}#shadowContent {display: inline-block;text-align: left;}draw|page {display: block;position: relative;overflow: hidden;}presentation|notes, presentation|footer-decl, presentation|date-time-decl {display: none;}@media print {draw|page {border: 1pt solid black;page-break-inside: avoid;}presentation|notes {}}office|spreadsheet text|p {border: 0px;padding: 1px;margin: 0px;}office|spreadsheet table|table {margin: 3px;}office|spreadsheet table|table:after {}office|spreadsheet table|table-row {counter-increment: row;}office|spreadsheet table|table-row:before {width: 3em;background: #cccccc;border: 1px solid black;text-align: center;content: counter(row);display: table-cell;}office|spreadsheet table|table-cell {border: 1px solid #cccccc;}table|table {display: table;}draw|frame table|table {width: 100%;height: 100%;background: white;}table|table-header-rows {display: table-header-group;}table|table-row {display: table-row;}table|table-column {display: table-column;}table|table-cell {width: 0.889in;display: table-cell;word-break: break-all;}draw|frame {display: block;}draw|image {display: block;width: 100%;height: 100%;top: 0px;left: 0px;background-repeat: no-repeat;background-size: 100% 100%;-moz-background-size: 100% 100%;}draw|frame > draw|image:nth-of-type(n+2) {display: none;}text|list:before {display: none;content:"";}text|list {display: block;}text|list-item {display: block;}text|number {display:none;}text|a {color: blue;text-decoration: underline;cursor: pointer;}.webodf-inactiveLinks text|a {cursor: text;}text|note-citation {vertical-align: super;font-size: smaller;}text|note-body {display: none;}text|note:hover text|note-citation {background: #dddddd;}text|note:hover text|note-body {display: block;left:1em;max-width: 80%;position: absolute;background: #ffffaa;}text|bibliography-source {display: none;}svg|title, svg|desc {display: none;}video {width: 100%;height: 100%}cursor|anchor {display: none;}cursor|cursor {display: none;}.webodf-caretOverlay {position: absolute;top: 5%;height: 1em;z-index: 10;padding-left: 1px;pointer-events: none;}.webodf-caretOverlay .caret {position: absolute;border-left: 2px solid black;top: 0;bottom: 0;right: 0;}.webodf-caretOverlay .handle {position: absolute;margin-top: 5px;padding-top: 3px;margin-left: auto;margin-right: auto;width: 64px;height: 68px;border-radius: 5px;opacity: 0.3;text-align: center;background-color: black;box-shadow: 0px 0px 5px rgb(90, 90, 90);border: 1px solid black;top: -85px;right: -32px;}.webodf-caretOverlay .handle > img {box-shadow: 0px 0px 5px rgb(90, 90, 90) inset;background-color: rgb(200, 200, 200);border-radius: 5px;border: 2px solid;height: 60px;width: 60px;display: block;margin: auto;}.webodf-caretOverlay .handle.active {opacity: 0.8;}.webodf-caretOverlay .handle:after {content: " ";position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: black transparent transparent transparent;top: 100%;left: 43%;}.webodf-caretSizer {display: inline-block;width: 0;visibility: hidden;}#eventTrap {display: block;position: absolute;bottom: 0;left: 0;outline: none;opacity: 0;color: rgba(255, 255, 255, 0);pointer-events: none;white-space: pre;overflow: hidden;}cursor|cursor > #composer {text-decoration: underline;}cursor|cursor[cursor|caret-sizer-active="true"],cursor|cursor[cursor|composing="true"] {display: inline;}editinfo|editinfo {display: inline-block;}.editInfoMarker {position: absolute;width: 10px;height: 100%;left: -20px;opacity: 0.8;top: 0;border-radius: 5px;background-color: transparent;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);}.editInfoMarker:hover {box-shadow: 0px 0px 8px rgba(0, 0, 0, 1);}.editInfoHandle {position: absolute;background-color: black;padding: 5px;border-radius: 5px;opacity: 0.8;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);bottom: 100%;margin-bottom: 10px;z-index: 3;left: -25px;}.editInfoHandle:after {content: " ";position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: black transparent transparent transparent;top: 100%;left: 5px;}.editInfo {font-family: sans-serif;font-weight: normal;font-style: normal;text-decoration: none;color: white;width: 100%;height: 12pt;}.editInfoColor {float: left;width: 10pt;height: 10pt;border: 1px solid white;}.editInfoAuthor {float: left;margin-left: 5pt;font-size: 10pt;text-align: left;height: 12pt;line-height: 12pt;}.editInfoTime {float: right;margin-left: 30pt;font-size: 8pt;font-style: italic;color: yellow;height: 12pt;line-height: 12pt;}.annotationWrapper {display: inline;position: relative;}.annotationRemoveButton:before {content: "×";color: white;padding: 5px;line-height: 1em;}.annotationRemoveButton {width: 20px;height: 20px;border-radius: 10px;background-color: black;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);position: absolute;top: -10px;left: -10px;z-index: 3;text-align: center;font-family: sans-serif;font-style: normal;font-weight: normal;text-decoration: none;font-size: 15px;}.annotationRemoveButton:hover {cursor: pointer;box-shadow: 0px 0px 5px rgba(0, 0, 0, 1);}.annotationNote {width: 4cm;position: absolute;display: inline;z-index: 10;top: 0;}.annotationNote > office|annotation {display: block;text-align: left;}.annotationConnector {position: absolute;display: inline;top: 0;z-index: 2;border-top: 1px dashed brown;}.annotationConnector.angular {-moz-transform-origin: left top;-webkit-transform-origin: left top;-ms-transform-origin: left top;transform-origin: left top;}.annotationConnector.horizontal {left: 0;}.annotationConnector.horizontal:before {content: "";display: inline;position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: brown transparent transparent transparent;top: -1px;left: -5px;}office|annotation {width: 100%;height: 100%;display: none;background: rgb(198, 238, 184);background: -moz-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -webkit-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -o-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -ms-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: linear-gradient(180deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);box-shadow: 0 3px 4px -3px #ccc;}office|annotation > dc|creator {display: block;font-size: 10pt;font-weight: normal;font-style: normal;font-family: sans-serif;color: white;background-color: brown;padding: 4px;}office|annotation > dc|date {display: block;font-size: 10pt;font-weight: normal;font-style: normal;font-family: sans-serif;border: 4px solid transparent;color: black;}office|annotation > text|list {display: block;padding: 5px;}office|annotation text|p {font-size: 10pt;color: black;font-weight: normal;font-style: normal;text-decoration: none;font-family: sans-serif;}#annotationsPane {background-color: #EAEAEA;width: 4cm;height: 100%;display: none;position: absolute;outline: 1px solid #ccc;}.webodf-annotationHighlight {background-color: yellow;position: relative;}.webodf-selectionOverlay {position: absolute;pointer-events: none;top: 0;left: 0;top: 0;left: 0;width: 100%;height: 100%;z-index: 15;}.webodf-selectionOverlay > polygon {fill-opacity: 0.3;stroke-opacity: 0.8;stroke-width: 1;fill-rule: evenodd;}.webodf-selectionOverlay > .webodf-draggable {fill-opacity: 0.8;stroke-opacity: 0;stroke-width: 8;pointer-events: all;display: none;-moz-transform-origin: center center;-webkit-transform-origin: center center;-ms-transform-origin: center center;transform-origin: center center;}#imageSelector {display: none;position: absolute;border-style: solid;border-color: black;}#imageSelector > div {width: 5px;height: 5px;display: block;position: absolute;border: 1px solid black;background-color: #ffffff;}#imageSelector > .topLeft {top: -4px;left: -4px;}#imageSelector > .topRight {top: -4px;right: -4px;}#imageSelector > .bottomRight {right: -4px;bottom: -4px;}#imageSelector > .bottomLeft {bottom: -4px;left: -4px;}#imageSelector > .topMiddle {top: -4px;left: 50%;margin-left: -2.5px;}#imageSelector > .rightMiddle {top: 50%;right: -4px;margin-top: -2.5px;}#imageSelector > .bottomMiddle {bottom: -4px;left: 50%;margin-left: -2.5px;}#imageSelector > .leftMiddle {top: 50%;left: -4px;margin-top: -2.5px;}div.webodf-customScrollbars::-webkit-scrollbar{width: 8px;height: 8px;background-color: transparent;}div.webodf-customScrollbars::-webkit-scrollbar-track{background-color: transparent;}div.webodf-customScrollbars::-webkit-scrollbar-thumb{background-color: #444;border-radius: 4px;}.webodf-hyperlinkTooltip {display: none;color: white;background-color: black;border-radius: 5px;box-shadow: 2px 2px 5px gray;padding: 3px;position: absolute;max-width: 210px;text-align: left;word-break: break-all;z-index: 16;}.webodf-hyperlinkTooltipText {display: block;font-weight: bold;}';return function(e){var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n=t.externs||(t.externs={});n.JSZip=function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return i(n||e)},c,c.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,module,exports){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";exports.encode=function(e,n){for(var r,i,o,s,a,l,c,u="",d=0;d<e.length;)r=e.charCodeAt(d++),i=e.charCodeAt(d++),o=e.charCodeAt(d++),s=r>>2,a=(3&r)<<4|i>>4,l=(15&i)<<2|o>>6,c=63&o,isNaN(i)?l=c=64:isNaN(o)&&(c=64),u=u+t.charAt(s)+t.charAt(a)+t.charAt(l)+t.charAt(c);return u},exports.decode=function(e,n){var r,i,o,s,a,l,c,u="",d=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");d<e.length;)s=t.indexOf(e.charAt(d++)),a=t.indexOf(e.charAt(d++)),l=t.indexOf(e.charAt(d++)),c=t.indexOf(e.charAt(d++)),r=s<<2|a>>4,i=(15&a)<<4|l>>2,o=(3&l)<<6|c,u+=String.fromCharCode(r),64!=l&&(u+=String.fromCharCode(i)),64!=c&&(u+=String.fromCharCode(o));return u}},{}],2:[function(e,module,exports){function t(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}t.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},module.exports=t},{}],3:[function(e,module,exports){exports.STORE={magic:"\0\0",compress:function(e){return e},uncompress:function(e){return e},compressInputType:null,uncompressInputType:null},exports.DEFLATE=e("./flate")},{"./flate":8}],4:[function(e,module,exports){var t=e("./utils"),n=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];module.exports=function(e,r){if(void 0===e||!e.length)return 0;var i="string"!==t.getTypeOf(e);void 0===r&&(r=0);var o=0;r^=-1;for(var s=0,a=e.length;s<a;s++)o=i?e[s]:e.charCodeAt(s),r=r>>>8^n[255&(r^o)];return-1^r}},{"./utils":21}],5:[function(e,module,exports){var t=e("./utils");function n(e){this.data=null,this.length=0,this.index=0}n.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,n=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)n=(n<<8)+this.byteAt(t);return this.index+=e,n},readString:function(e){return t.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1)}},module.exports=n},{"./utils":21}],6:[function(e,module,exports){exports.base64=!1,exports.binary=!1,exports.dir=!1,exports.createFolders=!1,exports.date=null,exports.compression=null,exports.comment=null},{}],7:[function(e,module,exports){var t=e("./utils");exports.string2binary=function(e){return t.string2binary(e)},exports.string2Uint8Array=function(e){return t.transformTo("uint8array",e)},exports.uint8Array2String=function(e){return t.transformTo("string",e)},exports.string2Blob=function(e){var n=t.transformTo("arraybuffer",e);return t.arrayBuffer2Blob(n)},exports.arrayBuffer2Blob=function(e){return t.arrayBuffer2Blob(e)},exports.transformTo=function(e,n){return t.transformTo(e,n)},exports.getTypeOf=function(e){return t.getTypeOf(e)},exports.checkSupport=function(e){return t.checkSupport(e)},exports.MAX_VALUE_16BITS=t.MAX_VALUE_16BITS,exports.MAX_VALUE_32BITS=t.MAX_VALUE_32BITS,exports.pretty=function(e){return t.pretty(e)},exports.findCompression=function(e){return t.findCompression(e)},exports.isRegExp=function(e){return t.isRegExp(e)}},{"./utils":21}],8:[function(e,module,exports){var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,n=e("pako");exports.uncompressInputType=t?"uint8array":"array",exports.compressInputType=t?"uint8array":"array",exports.magic="\b\0",exports.compress=function(e){return n.deflateRaw(e)},exports.uncompress=function(e){return n.inflateRaw(e)}},{pako:24}],9:[function(e,module,exports){var t=e("./base64");function n(e,t){if(!(this instanceof n))return new n(e,t);this.files={},this.comment=null,this.root="",e&&this.load(e,t),this.clone=function(){var e=new n;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}n.prototype=e("./object"),n.prototype.load=e("./load"),n.support=e("./support"),n.defaults=e("./defaults"),n.utils=e("./deprecatedPublicUtils"),n.base64={encode:function(e){return t.encode(e)},decode:function(e){return t.decode(e)}},n.compressions=e("./compressions"),module.exports=n},{"./base64":1,"./compressions":3,"./defaults":6,"./deprecatedPublicUtils":7,"./load":10,"./object":13,"./support":17}],10:[function(e,module,exports){var t=e("./base64"),n=e("./zipEntries");module.exports=function(e,r){var i,o,s,a;for((r=r||{}).base64&&(e=t.decode(e)),o=new n(e,r),i=o.files,s=0;s<i.length;s++)a=i[s],this.file(a.fileName,a.decompressed,{binary:!0,optimizedBinaryString:!0,date:a.date,dir:a.dir,comment:a.fileComment.length?a.fileComment:null,createFolders:r.createFolders});return o.zipComment.length&&(this.comment=o.zipComment),this}},{"./base64":1,"./zipEntries":22}],11:[function(e,module,exports){(function(e){module.exports=function(t,n){return new e(t,n)},module.exports.test=function(t){return e.isBuffer(t)}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],12:[function(e,module,exports){var t=e("./uint8ArrayReader");function n(e){this.data=e,this.length=this.data.length,this.index=0}n.prototype=new t,n.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},module.exports=n},{"./uint8ArrayReader":18}],13:[function(e,module,exports){var t=e("./support"),n=e("./utils"),r=e("./crc32"),i=e("./signature"),o=e("./defaults"),s=e("./base64"),a=e("./compressions"),l=e("./compressedObject"),c=e("./nodeBuffer"),u=e("./utf8"),d=e("./stringWriter"),h=e("./uint8ArrayWriter"),p=function(e){if(e._data instanceof l&&(e._data=e._data.getContent(),e.options.binary=!0,e.options.base64=!1,"uint8array"===n.getTypeOf(e._data))){var t=e._data;e._data=new Uint8Array(t.length),0!==t.length&&e._data.set(t,0)}return e._data},f=function(e){var r=p(e),i=n.getTypeOf(r);return"string"===i?!e.options.binary&&t.nodebuffer?c(r,"utf-8"):e.asBinary():r},m=function(e){var t=p(this);return null===t||void 0===t?"":(this.options.base64&&(t=s.decode(t)),t=e&&this.options.binary?w.utf8decode(t):n.transformTo("string",t),e||this.options.binary||(t=n.transformTo("string",w.utf8encode(t))),t)},g=function(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this._data=t,this.options=n,this._initialMetadata={dir:n.dir,date:n.date}};g.prototype={asText:function(){return m.call(this,!0)},asBinary:function(){return m.call(this,!1)},asNodeBuffer:function(){var e=f(this);return n.transformTo("nodebuffer",e)},asUint8Array:function(){var e=f(this);return n.transformTo("uint8array",e)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var b=function(e,t){var n,r="";for(n=0;n<t;n++)r+=String.fromCharCode(255&e),e>>>=8;return r},y=function(){var e,t,n={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===n[t]&&(n[t]=arguments[e][t]);return n},v=function(e,t,r){var i,s=n.getTypeOf(t);if((r=function(e){return!0!==(e=e||{}).base64||null!==e.binary&&void 0!==e.binary||(e.binary=!0),(e=y(e,o)).date=e.date||new Date,null!==e.compression&&(e.compression=e.compression.toUpperCase()),e}(r)).createFolders&&(i=S(e))&&C.call(this,i,!0),r.dir||null===t||void 0===t)r.base64=!1,r.binary=!1,t=null;else if("string"===s)r.binary&&!r.base64&&!0!==r.optimizedBinaryString&&(t=n.string2binary(t));else{if(r.base64=!1,r.binary=!0,!(s||t instanceof l))throw new Error("The data of '"+e+"' is in an unsupported format !");"arraybuffer"===s&&(t=n.transformTo("uint8array",t))}var a=new g(e,t,r);return this.files[e]=a,a},S=function(e){"/"==e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},C=function(e,t){return"/"!=e.slice(-1)&&(e+="/"),t=void 0!==t&&t,this.files[e]||v.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]},x=function(e,t){var i,o=new l;return e._data instanceof l?(o.uncompressedSize=e._data.uncompressedSize,o.crc32=e._data.crc32,0===o.uncompressedSize||e.dir?(t=a.STORE,o.compressedContent="",o.crc32=0):e._data.compressionMethod===t.magic?o.compressedContent=e._data.getCompressedContent():(i=e._data.getContent(),o.compressedContent=t.compress(n.transformTo(t.compressInputType,i)))):((i=f(e))&&0!==i.length&&!e.dir||(t=a.STORE,i=""),o.uncompressedSize=i.length,o.crc32=r(i),o.compressedContent=t.compress(n.transformTo(t.compressInputType,i))),o.compressedSize=o.compressedContent.length,o.compressionMethod=t.magic,o},A=function(e,t,o,s){o.compressedContent;var a,l,c,d,h=n.transformTo("string",u.utf8encode(t.name)),p=t.comment||"",f=n.transformTo("string",u.utf8encode(p)),m=h.length!==t.name.length,g=f.length!==p.length,y=t.options,v="",S="",C="";c=t._initialMetadata.dir!==t.dir?t.dir:y.dir,d=t._initialMetadata.date!==t.date?t.date:y.date,a=d.getHours(),a<<=6,a|=d.getMinutes(),a<<=5,a|=d.getSeconds()/2,l=d.getFullYear()-1980,l<<=4,l|=d.getMonth()+1,l<<=5,l|=d.getDate(),m&&(S=b(1,1)+b(r(h),4)+h,v+="up"+b(S.length,2)+S),g&&(C=b(1,1)+b(this.crc32(f),4)+f,v+="uc"+b(C.length,2)+C);var x="";x+="\n\0",x+=m||g?"\0\b":"\0\0",x+=o.compressionMethod,x+=b(a,2),x+=b(l,2),x+=b(o.crc32,4),x+=b(o.compressedSize,4),x+=b(o.uncompressedSize,4),x+=b(h.length,2),x+=b(v.length,2);var A=i.LOCAL_FILE_HEADER+x+h+v,w=i.CENTRAL_FILE_HEADER+"\0"+x+b(f.length,2)+"\0\0\0\0"+(!0===c?"\0\0\0":"\0\0\0\0")+b(s,4)+h+v+f;return{fileRecord:A,dirRecord:w,compressedObject:o}},w={load:function(e,t){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(e){var t,n,r,i,o=[];for(t in this.files)this.files.hasOwnProperty(t)&&(r=this.files[t],i=new g(r.name,r._data,y(r.options)),n=t.slice(this.root.length,t.length),t.slice(0,this.root.length)===this.root&&e(n,i)&&o.push(i));return o},file:function(e,t,r){if(1===arguments.length){if(n.isRegExp(e)){var i=e;return this.filter(function(e,t){return!t.dir&&i.test(e)})}return this.filter(function(t,n){return!n.dir&&t===e})[0]||null}return e=this.root+e,v.call(this,e,t,r),this},folder:function(e){if(!e)return this;if(n.isRegExp(e))return this.filter(function(t,n){return n.dir&&e.test(t)});var t=this.root+e,r=C.call(this,t),i=this.clone();return i.root=r.name,i},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!=e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var n=this.filter(function(t,n){return n.name.slice(0,e.length)===e}),r=0;r<n.length;r++)delete this.files[n[r].name];return this},generate:function(e){e=y(e||{},{base64:!0,compression:"STORE",type:"base64",comment:null}),n.checkSupport(e.type);var t,r,o=[],l=0,c=0,u=n.transformTo("string",this.utf8encode(e.comment||this.comment||""));for(var p in this.files)if(this.files.hasOwnProperty(p)){var f=this.files[p],m=f.options.compression||e.compression.toUpperCase(),g=a[m];if(!g)throw new Error(m+" is not a valid compression method !");var v=x.call(this,f,g),S=A.call(this,p,f,v,l);l+=S.fileRecord.length+v.compressedSize,c+=S.dirRecord.length,o.push(S)}var C="";C=i.CENTRAL_DIRECTORY_END+"\0\0\0\0"+b(o.length,2)+b(o.length,2)+b(c,4)+b(l,4)+b(u.length,2)+u;var w=e.type.toLowerCase();for(t="uint8array"===w||"arraybuffer"===w||"blob"===w||"nodebuffer"===w?new h(l+c+C.length):new d(l+c+C.length),r=0;r<o.length;r++)t.append(o[r].fileRecord),t.append(o[r].compressedObject.compressedContent);for(r=0;r<o.length;r++)t.append(o[r].dirRecord);t.append(C);var _=t.finalize();switch(e.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return n.transformTo(e.type.toLowerCase(),_);case"blob":return n.arrayBuffer2Blob(n.transformTo("arraybuffer",_));case"base64":return e.base64?s.encode(_):_;default:return _}},crc32:function(e,t){return r(e,t)},utf8encode:function(e){return n.transformTo("string",u.utf8encode(e))},utf8decode:function(e){return u.utf8decode(e)}};module.exports=w},{"./base64":1,"./compressedObject":2,"./compressions":3,"./crc32":4,"./defaults":6,"./nodeBuffer":11,"./signature":14,"./stringWriter":16,"./support":17,"./uint8ArrayWriter":19,"./utf8":20,"./utils":21}],14:[function(e,module,exports){exports.LOCAL_FILE_HEADER="PK",exports.CENTRAL_FILE_HEADER="PK",exports.CENTRAL_DIRECTORY_END="PK",exports.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",exports.ZIP64_CENTRAL_DIRECTORY_END="PK",exports.DATA_DESCRIPTOR="PK\b"},{}],15:[function(e,module,exports){var t=e("./dataReader"),n=e("./utils");function r(e,t){this.data=e,t||(this.data=n.string2binary(this.data)),this.length=this.data.length,this.index=0}r.prototype=new t,r.prototype.byteAt=function(e){return this.data.charCodeAt(e)},r.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)},r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},module.exports=r},{"./dataReader":5,"./utils":21}],16:[function(e,module,exports){var t=e("./utils"),n=function(){this.data=[]};n.prototype={append:function(e){e=t.transformTo("string",e),this.data.push(e)},finalize:function(){return this.data.join("")}},module.exports=n},{"./utils":21}],17:[function(e,module,exports){(function(e){if(exports.base64=!0,exports.array=!0,exports.string=!0,exports.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,exports.nodebuffer=void 0!==e,exports.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)exports.blob=!1;else{var t=new ArrayBuffer(0);try{exports.blob=0===new Blob([t],{type:"application/zip"}).size}catch(e){try{var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,r=new n;r.append(t),exports.blob=0===r.getBlob("application/zip").size}catch(e){exports.blob=!1}}}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],18:[function(e,module,exports){var t=e("./dataReader");function n(e){e&&(this.data=e,this.length=this.data.length,this.index=0)}n.prototype=new t,n.prototype.byteAt=function(e){return this.data[e]},n.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),n=e.charCodeAt(1),r=e.charCodeAt(2),i=e.charCodeAt(3),o=this.length-4;o>=0;--o)if(this.data[o]===t&&this.data[o+1]===n&&this.data[o+2]===r&&this.data[o+3]===i)return o;return-1},n.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.index,this.index+e);return this.index+=e,t},module.exports=n},{"./dataReader":5}],19:[function(e,module,exports){var t=e("./utils"),n=function(e){this.data=new Uint8Array(e),this.index=0};n.prototype={append:function(e){0!==e.length&&(e=t.transformTo("uint8array",e),this.data.set(e,this.index),this.index+=e.length)},finalize:function(){return this.data}},module.exports=n},{"./utils":21}],20:[function(e,module,exports){for(var t=e("./utils"),n=e("./support"),r=e("./nodeBuffer"),i=new Array(256),o=0;o<256;o++)i[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;i[254]=i[254]=1;var s=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0?t:0===n?t:n+i[e[n]]>t?n:t},a=function(e){var n,r,o,s,a=e.length,l=new Array(2*a);for(r=0,n=0;n<a;)if((o=e[n++])<128)l[r++]=o;else if((s=i[o])>4)l[r++]=65533,n+=s-1;else{for(o&=2===s?31:3===s?15:7;s>1&&n<a;)o=o<<6|63&e[n++],s--;s>1?l[r++]=65533:o<65536?l[r++]=o:(o-=65536,l[r++]=55296|o>>10&1023,l[r++]=56320|1023&o)}return l.length!==r&&(l.subarray?l=l.subarray(0,r):l.length=r),t.applyFromCharCode(l)};exports.utf8encode=function(e){return n.nodebuffer?r(e,"utf-8"):function(e){var t,r,i,o,s,a=e.length,l=0;for(o=0;o<a;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<a&&56320==(64512&(i=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=n.uint8array?new Uint8Array(l):new Array(l),s=0,o=0;s<l;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<a&&56320==(64512&(i=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),r<128?t[s++]=r:r<2048?(t[s++]=192|r>>>6,t[s++]=128|63&r):r<65536?(t[s++]=224|r>>>12,t[s++]=128|r>>>6&63,t[s++]=128|63&r):(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63,t[s++]=128|r>>>6&63,t[s++]=128|63&r);return t}(e)},exports.utf8decode=function(e){if(n.nodebuffer)return t.transformTo("nodebuffer",e).toString("utf-8");for(var r=[],i=0,o=(e=t.transformTo(n.uint8array?"uint8array":"array",e)).length;i<o;){var l=s(e,Math.min(i+65536,o));n.uint8array?r.push(a(e.subarray(i,l))):r.push(a(e.slice(i,l))),i=l}return r.join("")}},{"./nodeBuffer":11,"./support":17,"./utils":21}],21:[function(e,module,exports){var t=e("./support"),n=e("./compressions"),r=e("./nodeBuffer");function i(e){return e}function o(e,t){for(var n=0;n<e.length;++n)t[n]=255&e.charCodeAt(n);return t}function s(e){var t=65536,n=[],i=e.length,o=exports.getTypeOf(e),s=0,a=!0;try{switch(o){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,r(0))}}catch(e){a=!1}if(!a){for(var l="",c=0;c<e.length;c++)l+=String.fromCharCode(e[c]);return l}for(;s<i&&t>1;)try{"array"===o||"nodebuffer"===o?n.push(String.fromCharCode.apply(null,e.slice(s,Math.min(s+t,i)))):n.push(String.fromCharCode.apply(null,e.subarray(s,Math.min(s+t,i)))),s+=t}catch(e){t=Math.floor(t/2)}return n.join("")}function a(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}exports.string2binary=function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(255&e.charCodeAt(n));return t},exports.arrayBuffer2Blob=function(e){exports.checkSupport("blob");try{return new Blob([e],{type:"application/zip"})}catch(r){try{var t=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,n=new t;return n.append(e),n.getBlob("application/zip")}catch(e){throw new Error("Bug : can't construct the Blob.")}}},exports.applyFromCharCode=s;var l={};l.string={string:i,array:function(e){return o(e,new Array(e.length))},arraybuffer:function(e){return l.string.uint8array(e).buffer},uint8array:function(e){return o(e,new Uint8Array(e.length))},nodebuffer:function(e){return o(e,r(e.length))}},l.array={string:s,array:i,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return r(e)}},l.arraybuffer={string:function(e){return s(new Uint8Array(e))},array:function(e){return a(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:i,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return r(new Uint8Array(e))}},l.uint8array={string:s,array:function(e){return a(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:i,nodebuffer:function(e){return r(e)}},l.nodebuffer={string:s,array:function(e){return a(e,new Array(e.length))},arraybuffer:function(e){return l.nodebuffer.uint8array(e).buffer},uint8array:function(e){return a(e,new Uint8Array(e.length))},nodebuffer:i},exports.transformTo=function(e,t){if(t||(t=""),!e)return t;exports.checkSupport(e);var n=exports.getTypeOf(t),r=l[n][e](t);return r},exports.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":t.nodebuffer&&r.test(e)?"nodebuffer":t.uint8array&&e instanceof Uint8Array?"uint8array":t.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},exports.checkSupport=function(e){var n=t[e.toLowerCase()];if(!n)throw new Error(e+" is not supported by this browser")},exports.MAX_VALUE_16BITS=65535,exports.MAX_VALUE_32BITS=-1,exports.pretty=function(e){var t,n,r="";for(n=0;n<(e||"").length;n++)t=e.charCodeAt(n),r+="\\x"+(t<16?"0":"")+t.toString(16).toUpperCase();return r},exports.findCompression=function(e){for(var t in n)if(n.hasOwnProperty(t)&&n[t].magic===e)return n[t];return null},exports.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}},{"./compressions":3,"./nodeBuffer":11,"./support":17}],22:[function(e,module,exports){var t=e("./stringReader"),n=e("./nodeBufferReader"),r=e("./uint8ArrayReader"),i=e("./utils"),o=e("./signature"),s=e("./zipEntry"),a=e("./support"),l=e("./object");function c(e,t){this.files=[],this.loadOptions=t,e&&this.load(e)}c.prototype={checkSignature:function(e){var t=this.reader.readString(4);if(t!==e)throw new Error("Corrupted zip or bug : unexpected signature ("+i.pretty(t)+", expected "+i.pretty(e)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength),this.zipComment=l.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,n,r=this.zip64EndOfCentralSize-44;0<r;)e=this.reader.readInt(2),t=this.reader.readInt(4),n=this.reader.readString(t),this.zip64ExtensibleData[e]={id:e,length:t,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===o.CENTRAL_FILE_HEADER;)(e=new s({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(-1===e)throw new Error("Corrupted zip : can't find end of central directory");if(this.reader.setIndex(e),this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,-1===(e=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR)))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(e),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(e){var o=i.getTypeOf(e);"string"!==o||a.uint8array?this.reader="nodebuffer"===o?new n(e):new r(i.transformTo("uint8array",e)):this.reader=new t(e,this.loadOptions.optimizedBinaryString)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},module.exports=c},{"./nodeBufferReader":12,"./object":13,"./signature":14,"./stringReader":15,"./support":17,"./uint8ArrayReader":18,"./utils":21,"./zipEntry":23}],23:[function(e,module,exports){var t=e("./stringReader"),n=e("./utils"),r=e("./compressedObject"),i=e("./object");function o(e,t){this.options=e,this.loadOptions=t}o.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},prepareCompressedContent:function(e,t,n){return function(){var r=e.index;e.setIndex(t);var i=e.readData(n);return e.setIndex(r),i}},prepareContent:function(e,t,r,i,o){return function(){var e=n.transformTo(i.uncompressInputType,this.getCompressedContent()),t=i.uncompress(e);if(t.length!==o)throw new Error("Bug : uncompressed data size mismatch");return t}},readLocalPart:function(e){var t,o;if(e.skip(22),this.fileNameLength=e.readInt(2),o=e.readInt(2),this.fileName=e.readString(this.fileNameLength),e.skip(o),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(null===(t=n.findCompression(this.compressionMethod)))throw new Error("Corrupted zip : compression "+n.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");if(this.decompressed=new r,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(e,e.index,this.compressedSize,t),this.decompressed.getContent=this.prepareContent(e,e.index,this.compressedSize,t,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=n.transformTo("string",this.decompressed.getContent()),i.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(e){if(this.versionMadeBy=e.readString(2),this.versionNeeded=e.readInt(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4),this.fileNameLength=e.readInt(2),this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=e.readString(this.fileNameLength),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readString(this.fileCommentLength),this.dir=!!(16&this.externalFileAttributes)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var r=new t(this.extraFields[1].value);this.uncompressedSize===n.MAX_VALUE_32BITS&&(this.uncompressedSize=r.readInt(8)),this.compressedSize===n.MAX_VALUE_32BITS&&(this.compressedSize=r.readInt(8)),this.localHeaderOffset===n.MAX_VALUE_32BITS&&(this.localHeaderOffset=r.readInt(8)),this.diskNumberStart===n.MAX_VALUE_32BITS&&(this.diskNumberStart=r.readInt(4))}},readExtraFields:function(e){var t,n,r,i=e.index;for(this.extraFields=this.extraFields||{};e.index<i+this.extraFieldsLength;)t=e.readInt(2),n=e.readInt(2),r=e.readString(n),this.extraFields[t]={id:t,length:n,value:r}},handleUTF8:function(){if(this.useUTF8())this.fileName=i.utf8decode(this.fileName),this.fileComment=i.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();null!==e&&(this.fileName=e);var t=this.findExtraFieldUnicodeComment();null!==t&&(this.fileComment=t)}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var n=new t(e.value);return 1!==n.readInt(1)?null:i.crc32(this.fileName)!==n.readInt(4)?null:i.utf8decode(n.readString(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var n=new t(e.value);return 1!==n.readInt(1)?null:i.crc32(this.fileComment)!==n.readInt(4)?null:i.utf8decode(n.readString(e.length-5))}return null}},module.exports=o},{"./compressedObject":2,"./object":13,"./stringReader":15,"./utils":21}],24:[function(e,module,exports){var t=e("./lib/utils/common").assign,n=e("./lib/deflate"),r=e("./lib/inflate"),i=e("./lib/zlib/constants"),o={};t(o,n,r,i),module.exports=o},{"./lib/deflate":25,"./lib/inflate":26,"./lib/utils/common":27,"./lib/zlib/constants":30}],25:[function(e,module,exports){var t=e("./zlib/deflate.js"),n=e("./utils/common"),r=e("./utils/strings"),i=e("./zlib/messages"),o=e("./zlib/zstream"),s=function(e){this.options=n.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var s=t.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(0!==s)throw new Error(i[s]);r.header&&t.deflateSetHeader(this.strm,r.header)};function a(e,t){var n=new s(t);if(n.push(e,!0),n.err)throw n.msg;return n.result}s.prototype.push=function(e,i){var o,s,a=this.strm,l=this.options.chunkSize;if(this.ended)return!1;s=i===~~i?i:!0===i?4:0,a.input="string"==typeof e?r.string2buf(e):e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new n.Buf8(l),a.next_out=0,a.avail_out=l),1!==(o=t.deflate(a,s))&&0!==o)return this.onEnd(o),this.ended=!0,!1;(0===a.avail_out||0===a.avail_in&&4===s)&&("string"===this.options.to?this.onData(r.buf2binstring(n.shrinkBuf(a.output,a.next_out))):this.onData(n.shrinkBuf(a.output,a.next_out)))}while((a.avail_in>0||0===a.avail_out)&&1!==o);return 4!==s||(o=t.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,0===o)},s.prototype.onData=function(e){this.chunks.push(e)},s.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},exports.Deflate=s,exports.deflate=a,exports.deflateRaw=function(e,t){return(t=t||{}).raw=!0,a(e,t)},exports.gzip=function(e,t){return(t=t||{}).gzip=!0,a(e,t)}},{"./utils/common":27,"./utils/strings":28,"./zlib/deflate.js":32,"./zlib/messages":37,"./zlib/zstream":39}],26:[function(e,module,exports){var t=e("./zlib/inflate.js"),n=e("./utils/common"),r=e("./utils/strings"),i=e("./zlib/constants"),o=e("./zlib/messages"),s=e("./zlib/zstream"),a=e("./zlib/gzheader"),l=function(e){this.options=n.assign({chunkSize:16384,windowBits:0,to:""},e||{});var r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,0===r.windowBits&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||e&&e.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&0==(15&r.windowBits)&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var l=t.inflateInit2(this.strm,r.windowBits);if(l!==i.Z_OK)throw new Error(o[l]);this.header=new a,t.inflateGetHeader(this.strm,this.header)};function c(e,t){var n=new l(t);if(n.push(e,!0),n.err)throw n.msg;return n.result}l.prototype.push=function(e,o){var s,a,l,c,u,d=this.strm,h=this.options.chunkSize;if(this.ended)return!1;a=o===~~o?o:!0===o?i.Z_FINISH:i.Z_NO_FLUSH,d.input="string"==typeof e?r.binstring2buf(e):e,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new n.Buf8(h),d.next_out=0,d.avail_out=h),(s=t.inflate(d,i.Z_NO_FLUSH))!==i.Z_STREAM_END&&s!==i.Z_OK)return this.onEnd(s),this.ended=!0,!1;d.next_out&&(0===d.avail_out||s===i.Z_STREAM_END||0===d.avail_in&&a===i.Z_FINISH)&&("string"===this.options.to?(l=r.utf8border(d.output,d.next_out),c=d.next_out-l,u=r.buf2string(d.output,l),d.next_out=c,d.avail_out=h-c,c&&n.arraySet(d.output,d.output,l,c,0),this.onData(u)):this.onData(n.shrinkBuf(d.output,d.next_out)))}while(d.avail_in>0&&s!==i.Z_STREAM_END);return s===i.Z_STREAM_END&&(a=i.Z_FINISH),a!==i.Z_FINISH||(s=t.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===i.Z_OK)},l.prototype.onData=function(e){this.chunks.push(e)},l.prototype.onEnd=function(e){e===i.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},exports.Inflate=l,exports.inflate=c,exports.inflateRaw=function(e,t){return(t=t||{}).raw=!0,c(e,t)},exports.ungzip=c},{"./utils/common":27,"./utils/strings":28,"./zlib/constants":30,"./zlib/gzheader":33,"./zlib/inflate.js":35,"./zlib/messages":37,"./zlib/zstream":39}],27:[function(e,module,exports){var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;exports.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}}return e},exports.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var o=0;o<r;o++)e[i+o]=t[n+o]},flattenChunks:function(e){var t,n,r,i,o,s;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(s=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)o=e[t],s.set(o,i),i+=o.length;return s}},r={arraySet:function(e,t,n,r,i){for(var o=0;o<r;o++)e[i+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};exports.setTyped=function(e){e?(exports.Buf8=Uint8Array,exports.Buf16=Uint16Array,exports.Buf32=Int32Array,exports.assign(exports,n)):(exports.Buf8=Array,exports.Buf16=Array,exports.Buf32=Array,exports.assign(exports,r))},exports.setTyped(t)},{}],28:[function(e,module,exports){var t=e("./common"),n=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(e){n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){r=!1}for(var i=new t.Buf8(256),o=0;o<256;o++)i[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;function s(e,i){if(i<65537&&(e.subarray&&r||!e.subarray&&n))return String.fromCharCode.apply(null,t.shrinkBuf(e,i));for(var o="",s=0;s<i;s++)o+=String.fromCharCode(e[s]);return o}i[254]=i[254]=1,exports.string2buf=function(e){var n,r,i,o,s,a=e.length,l=0;for(o=0;o<a;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<a&&56320==(64512&(i=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),l+=r<128?1:r<2048?2:r<65536?3:4;for(n=new t.Buf8(l),s=0,o=0;s<l;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<a&&56320==(64512&(i=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),r<128?n[s++]=r:r<2048?(n[s++]=192|r>>>6,n[s++]=128|63&r):r<65536?(n[s++]=224|r>>>12,n[s++]=128|r>>>6&63,n[s++]=128|63&r):(n[s++]=240|r>>>18,n[s++]=128|r>>>12&63,n[s++]=128|r>>>6&63,n[s++]=128|63&r);return n},exports.buf2binstring=function(e){return s(e,e.length)},exports.binstring2buf=function(e){for(var n=new t.Buf8(e.length),r=0,i=n.length;r<i;r++)n[r]=e.charCodeAt(r);return n},exports.buf2string=function(e,t){var n,r,o,a,l=t||e.length,c=new Array(2*l);for(r=0,n=0;n<l;)if((o=e[n++])<128)c[r++]=o;else if((a=i[o])>4)c[r++]=65533,n+=a-1;else{for(o&=2===a?31:3===a?15:7;a>1&&n<l;)o=o<<6|63&e[n++],a--;a>1?c[r++]=65533:o<65536?c[r++]=o:(o-=65536,c[r++]=55296|o>>10&1023,c[r++]=56320|1023&o)}return s(c,r)},exports.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0?t:0===n?t:n+i[e[n]]>t?n:t}},{"./common":27}],29:[function(e,module,exports){module.exports=function(e,t,n,r){for(var i=65535&e|0,o=e>>>16&65535|0,s=0;0!==n;){n-=s=n>2e3?2e3:n;do{i=i+t[r++]|0,o=o+i|0}while(--s);i%=65521,o%=65521}return i|o<<16|0}},{}],30:[function(e,module,exports){module.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(e,module,exports){var t=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();module.exports=function(e,n,r,i){var o=t,s=i+r;e^=-1;for(var a=i;a<s;a++)e=e>>>8^o[255&(e^n[a])];return-1^e}},{}],32:[function(e,module,exports){var t=e("../utils/common"),n=e("./trees"),r=e("./adler32"),i=e("./crc32"),o=e("./messages"),s=0,a=1,l=3,c=4,u=5,d=0,h=1,p=-2,f=-3,m=-5,g=-1,b=1,y=2,v=3,S=4,C=0,x=2,A=8,w=9,_=15,N=8,E=286,T=30,k=19,P=2*E+1,R=15,O=3,D=258,I=D+O+1,F=32,M=42,L=69,B=73,U=91,z=103,j=113,W=666,H=1,q=2,V=3,G=4,X=3;function Y(e,t){return e.msg=o[t],t}function K(e){return(e<<1)-(e>4?9:0)}function $(e){for(var t=e.length;--t>=0;)e[t]=0}function Z(e){var n=e.state,r=n.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(t.arraySet(e.output,n.pending_buf,n.pending_out,r,e.next_out),e.next_out+=r,n.pending_out+=r,e.total_out+=r,e.avail_out-=r,n.pending-=r,0===n.pending&&(n.pending_out=0))}function J(e,t){n._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Z(e.strm)}function Q(e,t){e.pending_buf[e.pending++]=t}function ee(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function te(e,n,o,s){var a=e.avail_in;return a>s&&(a=s),0===a?0:(e.avail_in-=a,t.arraySet(n,e.input,e.next_in,a,o),1===e.state.wrap?e.adler=r(e.adler,n,a,o):2===e.state.wrap&&(e.adler=i(e.adler,n,a,o)),e.next_in+=a,e.total_in+=a,a)}function ne(e,t){var n,r,i=e.max_chain_length,o=e.strstart,s=e.prev_length,a=e.nice_match,l=e.strstart>e.w_size-I?e.strstart-(e.w_size-I):0,c=e.window,u=e.w_mask,d=e.prev,h=e.strstart+D,p=c[o+s-1],f=c[o+s];e.prev_length>=e.good_match&&(i>>=2),a>e.lookahead&&(a=e.lookahead);do{if(c[(n=t)+s]===f&&c[n+s-1]===p&&c[n]===c[o]&&c[++n]===c[o+1]){o+=2,n++;do{}while(c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&o<h);if(r=D-(h-o),o=h-D,r>s){if(e.match_start=t,s=r,r>=a)break;p=c[o+s-1],f=c[o+s]}}}while((t=d[t&u])>l&&0!=--i);return s<=e.lookahead?s:e.lookahead}function re(e){var n,r,i,o,s,a=e.w_size;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=a+(a-I)){t.arraySet(e.window,e.window,a,a,0),e.match_start-=a,e.strstart-=a,e.block_start-=a,r=e.hash_size,n=r;do{i=e.head[--n],e.head[n]=i>=a?i-a:0}while(--r);n=r=a;do{i=e.prev[--n],e.prev[n]=i>=a?i-a:0}while(--r);o+=a}if(0===e.strm.avail_in)break;if(r=te(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=r,e.lookahead+e.insert>=O)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+O-1])&e.hash_mask,e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<O)););}while(e.lookahead<I&&0!==e.strm.avail_in)}function ie(e,t){for(var r,i;;){if(e.lookahead<I){if(re(e),e.lookahead<I&&t===s)return H;if(0===e.lookahead)break}if(r=0,e.lookahead>=O&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+O-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-I&&(e.match_length=ne(e,r)),e.match_length>=O)if(i=n._tr_tally(e,e.strstart-e.match_start,e.match_length-O),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=O){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+O-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=n._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(J(e,!1),0===e.strm.avail_out))return H}return e.insert=e.strstart<O-1?e.strstart:O-1,t===c?(J(e,!0),0===e.strm.avail_out?V:G):e.last_lit&&(J(e,!1),0===e.strm.avail_out)?H:q}function oe(e,t){for(var r,i,o;;){if(e.lookahead<I){if(re(e),e.lookahead<I&&t===s)return H;if(0===e.lookahead)break}if(r=0,e.lookahead>=O&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+O-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=O-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-I&&(e.match_length=ne(e,r),e.match_length<=5&&(e.strategy===b||e.match_length===O&&e.strstart-e.match_start>4096)&&(e.match_length=O-1)),e.prev_length>=O&&e.match_length<=e.prev_length){o=e.strstart+e.lookahead-O,i=n._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-O),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=o&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+O-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=O-1,e.strstart++,i&&(J(e,!1),0===e.strm.avail_out))return H}else if(e.match_available){if((i=n._tr_tally(e,0,e.window[e.strstart-1]))&&J(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return H}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=n._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<O-1?e.strstart:O-1,t===c?(J(e,!0),0===e.strm.avail_out?V:G):e.last_lit&&(J(e,!1),0===e.strm.avail_out)?H:q}var se,ae=function(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i};function le(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=x,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?M:j,e.adler=2===t.wrap?0:1,t.last_flush=s,n._tr_init(t),d):Y(e,p)}function ce(e){var t,n=le(e);return n===d&&((t=e.state).window_size=2*t.w_size,$(t.head),t.max_lazy_match=se[t.level].max_lazy,t.good_match=se[t.level].good_length,t.nice_match=se[t.level].nice_length,t.max_chain_length=se[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=O-1,t.match_available=0,t.ins_h=0),n}function ue(e,n,r,i,o,s){if(!e)return p;var a=1;if(n===g&&(n=6),i<0?(a=0,i=-i):i>15&&(a=2,i-=16),o<1||o>w||r!==A||i<8||i>15||n<0||n>9||s<0||s>S)return Y(e,p);8===i&&(i=9);var l=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=A,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new t.Buf16(2*P),this.dyn_dtree=new t.Buf16(2*(2*T+1)),this.bl_tree=new t.Buf16(2*(2*k+1)),$(this.dyn_ltree),$(this.dyn_dtree),$(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new t.Buf16(R+1),this.heap=new t.Buf16(2*E+1),$(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new t.Buf16(2*E+1),$(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return e.state=l,l.strm=e,l.wrap=a,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+O-1)/O),l.window=new t.Buf8(2*l.w_size),l.head=new t.Buf16(l.hash_size),l.prev=new t.Buf16(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new t.Buf8(l.pending_buf_size),l.d_buf=l.lit_bufsize>>1,l.l_buf=3*l.lit_bufsize,l.level=n,l.strategy=s,l.method=r,ce(e)}se=[new ae(0,0,0,0,function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(re(e),0===e.lookahead&&t===s)return H;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,J(e,!1),0===e.strm.avail_out))return H;if(e.strstart-e.block_start>=e.w_size-I&&(J(e,!1),0===e.strm.avail_out))return H}return e.insert=0,t===c?(J(e,!0),0===e.strm.avail_out?V:G):(e.strstart>e.block_start&&(J(e,!1),e.strm.avail_out),H)}),new ae(4,4,8,4,ie),new ae(4,5,16,8,ie),new ae(4,6,32,32,ie),new ae(4,4,16,16,oe),new ae(8,16,32,32,oe),new ae(8,16,128,128,oe),new ae(8,32,128,256,oe),new ae(32,128,258,1024,oe),new ae(32,258,258,4096,oe)],exports.deflateInit=function(e,t){return ue(e,t,A,_,N,C)},exports.deflateInit2=ue,exports.deflateReset=ce,exports.deflateResetKeep=le,exports.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?p:(e.state.gzhead=t,d):p},exports.deflate=function(e,t){var r,o,f,g;if(!e||!e.state||t>u||t<0)return e?Y(e,p):p;if(o=e.state,!e.output||!e.input&&0!==e.avail_in||o.status===W&&t!==c)return Y(e,0===e.avail_out?m:p);if(o.strm=e,r=o.last_flush,o.last_flush=t,o.status===M)if(2===o.wrap)e.adler=0,Q(o,31),Q(o,139),Q(o,8),o.gzhead?(Q(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),Q(o,255&o.gzhead.time),Q(o,o.gzhead.time>>8&255),Q(o,o.gzhead.time>>16&255),Q(o,o.gzhead.time>>24&255),Q(o,9===o.level?2:o.strategy>=y||o.level<2?4:0),Q(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(Q(o,255&o.gzhead.extra.length),Q(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(e.adler=i(e.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=L):(Q(o,0),Q(o,0),Q(o,0),Q(o,0),Q(o,0),Q(o,9===o.level?2:o.strategy>=y||o.level<2?4:0),Q(o,X),o.status=j);else{var b=A+(o.w_bits-8<<4)<<8,S=-1;S=o.strategy>=y||o.level<2?0:o.level<6?1:6===o.level?2:3,b|=S<<6,0!==o.strstart&&(b|=F),b+=31-b%31,o.status=j,ee(o,b),0!==o.strstart&&(ee(o,e.adler>>>16),ee(o,65535&e.adler)),e.adler=1}if(o.status===L)if(o.gzhead.extra){for(f=o.pending;o.gzindex<(65535&o.gzhead.extra.length)&&(o.pending!==o.pending_buf_size||(o.gzhead.hcrc&&o.pending>f&&(e.adler=i(e.adler,o.pending_buf,o.pending-f,f)),Z(e),f=o.pending,o.pending!==o.pending_buf_size));)Q(o,255&o.gzhead.extra[o.gzindex]),o.gzindex++;o.gzhead.hcrc&&o.pending>f&&(e.adler=i(e.adler,o.pending_buf,o.pending-f,f)),o.gzindex===o.gzhead.extra.length&&(o.gzindex=0,o.status=B)}else o.status=B;if(o.status===B)if(o.gzhead.name){f=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>f&&(e.adler=i(e.adler,o.pending_buf,o.pending-f,f)),Z(e),f=o.pending,o.pending===o.pending_buf_size)){g=1;break}g=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,Q(o,g)}while(0!==g);o.gzhead.hcrc&&o.pending>f&&(e.adler=i(e.adler,o.pending_buf,o.pending-f,f)),0===g&&(o.gzindex=0,o.status=U)}else o.status=U;if(o.status===U)if(o.gzhead.comment){f=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>f&&(e.adler=i(e.adler,o.pending_buf,o.pending-f,f)),Z(e),f=o.pending,o.pending===o.pending_buf_size)){g=1;break}g=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,Q(o,g)}while(0!==g);o.gzhead.hcrc&&o.pending>f&&(e.adler=i(e.adler,o.pending_buf,o.pending-f,f)),0===g&&(o.status=z)}else o.status=z;if(o.status===z&&(o.gzhead.hcrc?(o.pending+2>o.pending_buf_size&&Z(e),o.pending+2<=o.pending_buf_size&&(Q(o,255&e.adler),Q(o,e.adler>>8&255),e.adler=0,o.status=j)):o.status=j),0!==o.pending){if(Z(e),0===e.avail_out)return o.last_flush=-1,d}else if(0===e.avail_in&&K(t)<=K(r)&&t!==c)return Y(e,m);if(o.status===W&&0!==e.avail_in)return Y(e,m);if(0!==e.avail_in||0!==o.lookahead||t!==s&&o.status!==W){var C=o.strategy===y?function(e,t){for(var r;;){if(0===e.lookahead&&(re(e),0===e.lookahead)){if(t===s)return H;break}if(e.match_length=0,r=n._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(J(e,!1),0===e.strm.avail_out))return H}return e.insert=0,t===c?(J(e,!0),0===e.strm.avail_out?V:G):e.last_lit&&(J(e,!1),0===e.strm.avail_out)?H:q}(o,t):o.strategy===v?function(e,t){for(var r,i,o,a,l=e.window;;){if(e.lookahead<=D){if(re(e),e.lookahead<=D&&t===s)return H;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=O&&e.strstart>0&&(o=e.strstart-1,(i=l[o])===l[++o]&&i===l[++o]&&i===l[++o])){a=e.strstart+D;do{}while(i===l[++o]&&i===l[++o]&&i===l[++o]&&i===l[++o]&&i===l[++o]&&i===l[++o]&&i===l[++o]&&i===l[++o]&&o<a);e.match_length=D-(a-o),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=O?(r=n._tr_tally(e,1,e.match_length-O),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=n._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(J(e,!1),0===e.strm.avail_out))return H}return e.insert=0,t===c?(J(e,!0),0===e.strm.avail_out?V:G):e.last_lit&&(J(e,!1),0===e.strm.avail_out)?H:q}(o,t):se[o.level].func(o,t);if(C!==V&&C!==G||(o.status=W),C===H||C===V)return 0===e.avail_out&&(o.last_flush=-1),d;if(C===q&&(t===a?n._tr_align(o):t!==u&&(n._tr_stored_block(o,0,0,!1),t===l&&($(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),Z(e),0===e.avail_out))return o.last_flush=-1,d}return t!==c?d:o.wrap<=0?h:(2===o.wrap?(Q(o,255&e.adler),Q(o,e.adler>>8&255),Q(o,e.adler>>16&255),Q(o,e.adler>>24&255),Q(o,255&e.total_in),Q(o,e.total_in>>8&255),Q(o,e.total_in>>16&255),Q(o,e.total_in>>24&255)):(ee(o,e.adler>>>16),ee(o,65535&e.adler)),Z(e),o.wrap>0&&(o.wrap=-o.wrap),0!==o.pending?d:h)},exports.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==M&&t!==L&&t!==B&&t!==U&&t!==z&&t!==j&&t!==W?Y(e,p):(e.state=null,t===j?Y(e,f):d):p},exports.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./messages":37,"./trees":38}],33:[function(e,module,exports){module.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],34:[function(e,module,exports){module.exports=function(e,t){var n,r,i,o,s,a,l,c,u,d,h,p,f,m,g,b,y,v,S,C,x,A,w,_,N;n=e.state,r=e.next_in,_=e.input,i=r+(e.avail_in-5),o=e.next_out,N=e.output,s=o-(t-e.avail_out),a=o+(e.avail_out-257),l=n.dmax,c=n.wsize,u=n.whave,d=n.wnext,h=n.window,p=n.hold,f=n.bits,m=n.lencode,g=n.distcode,b=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{f<15&&(p+=_[r++]<<f,f+=8,p+=_[r++]<<f,f+=8),v=m[p&b];t:for(;;){if(p>>>=S=v>>>24,f-=S,0==(S=v>>>16&255))N[o++]=65535&v;else{if(!(16&S)){if(0==(64&S)){v=m[(65535&v)+(p&(1<<S)-1)];continue t}if(32&S){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}C=65535&v,(S&=15)&&(f<S&&(p+=_[r++]<<f,f+=8),C+=p&(1<<S)-1,p>>>=S,f-=S),f<15&&(p+=_[r++]<<f,f+=8,p+=_[r++]<<f,f+=8),v=g[p&y];n:for(;;){if(p>>>=S=v>>>24,f-=S,!(16&(S=v>>>16&255))){if(0==(64&S)){v=g[(65535&v)+(p&(1<<S)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(x=65535&v,f<(S&=15)&&(p+=_[r++]<<f,(f+=8)<S&&(p+=_[r++]<<f,f+=8)),(x+=p&(1<<S)-1)>l){e.msg="invalid distance too far back",n.mode=30;break e}if(p>>>=S,f-=S,x>(S=o-s)){if((S=x-S)>u&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(A=0,w=h,0===d){if(A+=c-S,S<C){C-=S;do{N[o++]=h[A++]}while(--S);A=o-x,w=N}}else if(d<S){if(A+=c+d-S,(S-=d)<C){C-=S;do{N[o++]=h[A++]}while(--S);if(A=0,d<C){C-=S=d;do{N[o++]=h[A++]}while(--S);A=o-x,w=N}}}else if(A+=d-S,S<C){C-=S;do{N[o++]=h[A++]}while(--S);A=o-x,w=N}for(;C>2;)N[o++]=w[A++],N[o++]=w[A++],N[o++]=w[A++],C-=3;C&&(N[o++]=w[A++],C>1&&(N[o++]=w[A++]))}else{A=o-x;do{N[o++]=N[A++],N[o++]=N[A++],N[o++]=N[A++],C-=3}while(C>2);C&&(N[o++]=N[A++],C>1&&(N[o++]=N[A++]))}break}}break}}while(r<i&&o<a);r-=C=f>>3,p&=(1<<(f-=C<<3))-1,e.next_in=r,e.next_out=o,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=o<a?a-o+257:257-(o-a),n.hold=p,n.bits=f}},{}],35:[function(e,module,exports){var t=e("../utils/common"),n=e("./adler32"),r=e("./crc32"),i=e("./inffast"),o=e("./inftrees"),s=0,a=1,l=2,c=4,u=5,d=6,h=0,p=1,f=2,m=-2,g=-3,b=-4,y=-5,v=8,S=1,C=2,x=3,A=4,w=5,_=6,N=7,E=8,T=9,k=10,P=11,R=12,O=13,D=14,I=15,F=16,M=17,L=18,B=19,U=20,z=21,j=22,W=23,H=24,q=25,V=26,G=27,X=28,Y=29,K=30,$=31,Z=32,J=852,Q=592,ee=15;function te(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function ne(e){var n;return e&&e.state?(n=e.state,e.total_in=e.total_out=n.total=0,e.msg="",n.wrap&&(e.adler=1&n.wrap),n.mode=S,n.last=0,n.havedict=0,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new t.Buf32(J),n.distcode=n.distdyn=new t.Buf32(Q),n.sane=1,n.back=-1,h):m}function re(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,ne(e)):m}function ie(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?m:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,re(e))):m}function oe(e,n){var r,i;return e?(i=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new t.Buf16(320),this.work=new t.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},e.state=i,i.window=null,(r=ie(e,n))!==h&&(e.state=null),r):m}var se,ae,le=!0;function ce(e){if(le){var n;for(se=new t.Buf32(512),ae=new t.Buf32(32),n=0;n<144;)e.lens[n++]=8;for(;n<256;)e.lens[n++]=9;for(;n<280;)e.lens[n++]=7;for(;n<288;)e.lens[n++]=8;for(o(a,e.lens,0,288,se,0,e.work,{bits:9}),n=0;n<32;)e.lens[n++]=5;o(l,e.lens,0,32,ae,0,e.work,{bits:5}),le=!1}e.lencode=se,e.lenbits=9,e.distcode=ae,e.distbits=5}exports.inflateReset=re,exports.inflateReset2=ie,exports.inflateResetKeep=ne,exports.inflateInit=function(e){return oe(e,ee)},exports.inflateInit2=oe,exports.inflate=function(e,J){var Q,ee,ne,re,ie,oe,se,ae,le,ue,de,he,pe,fe,me,ge,be,ye,ve,Se,Ce,xe,Ae,we,_e=0,Ne=new t.Buf8(4),Ee=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return m;(Q=e.state).mode===R&&(Q.mode=O),ie=e.next_out,ne=e.output,se=e.avail_out,re=e.next_in,ee=e.input,oe=e.avail_in,ae=Q.hold,le=Q.bits,ue=oe,de=se,xe=h;e:for(;;)switch(Q.mode){case S:if(0===Q.wrap){Q.mode=O;break}for(;le<16;){if(0===oe)break e;oe--,ae+=ee[re++]<<le,le+=8}if(2&Q.wrap&&35615===ae){Q.check=0,Ne[0]=255&ae,Ne[1]=ae>>>8&255,Q.check=r(Q.check,Ne,2,0),ae=0,le=0,Q.mode=C;break}if(Q.flags=0,Q.head&&(Q.head.done=!1),!(1&Q.wrap)||(((255&ae)<<8)+(ae>>8))%31){e.msg="incorrect header check",Q.mode=K;break}if((15&ae)!==v){e.msg="unknown compression method",Q.mode=K;break}if(le-=4,Ce=8+(15&(ae>>>=4)),0===Q.wbits)Q.wbits=Ce;else if(Ce>Q.wbits){e.msg="invalid window size",Q.mode=K;break}Q.dmax=1<<Ce,e.adler=Q.check=1,Q.mode=512&ae?k:R,ae=0,le=0;break;case C:for(;le<16;){if(0===oe)break e;oe--,ae+=ee[re++]<<le,le+=8}if(Q.flags=ae,(255&Q.flags)!==v){e.msg="unknown compression method",Q.mode=K;break}if(57344&Q.flags){e.msg="unknown header flags set",Q.mode=K;break}Q.head&&(Q.head.text=ae>>8&1),512&Q.flags&&(Ne[0]=255&ae,Ne[1]=ae>>>8&255,Q.check=r(Q.check,Ne,2,0)),ae=0,le=0,Q.mode=x;case x:for(;le<32;){if(0===oe)break e;oe--,ae+=ee[re++]<<le,le+=8}Q.head&&(Q.head.time=ae),512&Q.flags&&(Ne[0]=255&ae,Ne[1]=ae>>>8&255,Ne[2]=ae>>>16&255,Ne[3]=ae>>>24&255,Q.check=r(Q.check,Ne,4,0)),ae=0,le=0,Q.mode=A;case A:for(;le<16;){if(0===oe)break e;oe--,ae+=ee[re++]<<le,le+=8}Q.head&&(Q.head.xflags=255&ae,Q.head.os=ae>>8),512&Q.flags&&(Ne[0]=255&ae,Ne[1]=ae>>>8&255,Q.check=r(Q.check,Ne,2,0)),ae=0,le=0,Q.mode=w;case w:if(1024&Q.flags){for(;le<16;){if(0===oe)break e;oe--,ae+=ee[re++]<<le,le+=8}Q.length=ae,Q.head&&(Q.head.extra_len=ae),512&Q.flags&&(Ne[0]=255&ae,Ne[1]=ae>>>8&255,Q.check=r(Q.check,Ne,2,0)),ae=0,le=0}else Q.head&&(Q.head.extra=null);Q.mode=_;case _:if(1024&Q.flags&&((he=Q.length)>oe&&(he=oe),he&&(Q.head&&(Ce=Q.head.extra_len-Q.length,Q.head.extra||(Q.head.extra=new Array(Q.head.extra_len)),t.arraySet(Q.head.extra,ee,re,he,Ce)),512&Q.flags&&(Q.check=r(Q.check,ee,he,re)),oe-=he,re+=he,Q.length-=he),Q.length))break e;Q.length=0,Q.mode=N;case N:if(2048&Q.flags){if(0===oe)break e;he=0;do{Ce=ee[re+he++],Q.head&&Ce&&Q.length<65536&&(Q.head.name+=String.fromCharCode(Ce))}while(Ce&&he<oe);if(512&Q.flags&&(Q.check=r(Q.check,ee,he,re)),oe-=he,re+=he,Ce)break e}else Q.head&&(Q.head.name=null);Q.length=0,Q.mode=E;case E:if(4096&Q.flags){if(0===oe)break e;he=0;do{Ce=ee[re+he++],Q.head&&Ce&&Q.length<65536&&(Q.head.comment+=String.fromCharCode(Ce))}while(Ce&&he<oe);if(512&Q.flags&&(Q.check=r(Q.check,ee,he,re)),oe-=he,re+=he,Ce)break e}else Q.head&&(Q.head.comment=null);Q.mode=T;case T:if(512&Q.flags){for(;le<16;){if(0===oe)break e;oe--,ae+=ee[re++]<<le,le+=8}if(ae!==(65535&Q.check)){e.msg="header crc mismatch",Q.mode=K;break}ae=0,le=0}Q.head&&(Q.head.hcrc=Q.flags>>9&1,Q.head.done=!0),e.adler=Q.check=0,Q.mode=R;break;case k:for(;le<32;){if(0===oe)break e;oe--,ae+=ee[re++]<<le,le+=8}e.adler=Q.check=te(ae),ae=0,le=0,Q.mode=P;case P:if(0===Q.havedict)return e.next_out=ie,e.avail_out=se,e.next_in=re,e.avail_in=oe,Q.hold=ae,Q.bits=le,f;e.adler=Q.check=1,Q.mode=R;case R:if(J===u||J===d)break e;case O:if(Q.last){ae>>>=7&le,le-=7&le,Q.mode=G;break}for(;le<3;){if(0===oe)break e;oe--,ae+=ee[re++]<<le,le+=8}switch(Q.last=1&ae,le-=1,3&(ae>>>=1)){case 0:Q.mode=D;break;case 1:if(ce(Q),Q.mode=U,J===d){ae>>>=2,le-=2;break e}break;case 2:Q.mode=M;break;case 3:e.msg="invalid block type",Q.mode=K}ae>>>=2,le-=2;break;case D:for(ae>>>=7&le,le-=7&le;le<32;){if(0===oe)break e;oe--,ae+=ee[re++]<<le,le+=8}if((65535&ae)!=(ae>>>16^65535)){e.msg="invalid stored block lengths",Q.mode=K;break}if(Q.length=65535&ae,ae=0,le=0,Q.mode=I,J===d)break e;case I:Q.mode=F;case F:if(he=Q.length){if(he>oe&&(he=oe),he>se&&(he=se),0===he)break e;t.arraySet(ne,ee,re,he,ie),oe-=he,re+=he,se-=he,ie+=he,Q.length-=he;break}Q.mode=R;break;case M:for(;le<14;){if(0===oe)break e;oe--,ae+=ee[re++]<<le,le+=8}if(Q.nlen=257+(31&ae),ae>>>=5,le-=5,Q.ndist=1+(31&ae),ae>>>=5,le-=5,Q.ncode=4+(15&ae),ae>>>=4,le-=4,Q.nlen>286||Q.ndist>30){e.msg="too many length or distance symbols",Q.mode=K;break}Q.have=0,Q.mode=L;case L:for(;Q.have<Q.ncode;){for(;le<3;){if(0===oe)break e;oe--,ae+=ee[re++]<<le,le+=8}Q.lens[Ee[Q.have++]]=7&ae,ae>>>=3,le-=3}for(;Q.have<19;)Q.lens[Ee[Q.have++]]=0;if(Q.lencode=Q.lendyn,Q.lenbits=7,Ae={bits:Q.lenbits},xe=o(s,Q.lens,0,19,Q.lencode,0,Q.work,Ae),Q.lenbits=Ae.bits,xe){e.msg="invalid code lengths set",Q.mode=K;break}Q.have=0,Q.mode=B;case B:for(;Q.have<Q.nlen+Q.ndist;){for(;_e=Q.lencode[ae&(1<<Q.lenbits)-1],ge=_e>>>16&255,be=65535&_e,!((me=_e>>>24)<=le);){if(0===oe)break e;oe--,ae+=ee[re++]<<le,le+=8}if(be<16)ae>>>=me,le-=me,Q.lens[Q.have++]=be;else{if(16===be){for(we=me+2;le<we;){if(0===oe)break e;oe--,ae+=ee[re++]<<le,le+=8}if(ae>>>=me,le-=me,0===Q.have){e.msg="invalid bit length repeat",Q.mode=K;break}Ce=Q.lens[Q.have-1],he=3+(3&ae),ae>>>=2,le-=2}else if(17===be){for(we=me+3;le<we;){if(0===oe)break e;oe--,ae+=ee[re++]<<le,le+=8}le-=me,Ce=0,he=3+(7&(ae>>>=me)),ae>>>=3,le-=3}else{for(we=me+7;le<we;){if(0===oe)break e;oe--,ae+=ee[re++]<<le,le+=8}le-=me,Ce=0,he=11+(127&(ae>>>=me)),ae>>>=7,le-=7}if(Q.have+he>Q.nlen+Q.ndist){e.msg="invalid bit length repeat",Q.mode=K;break}for(;he--;)Q.lens[Q.have++]=Ce}}if(Q.mode===K)break;if(0===Q.lens[256]){e.msg="invalid code -- missing end-of-block",Q.mode=K;break}if(Q.lenbits=9,Ae={bits:Q.lenbits},xe=o(a,Q.lens,0,Q.nlen,Q.lencode,0,Q.work,Ae),Q.lenbits=Ae.bits,xe){e.msg="invalid literal/lengths set",Q.mode=K;break}if(Q.distbits=6,Q.distcode=Q.distdyn,Ae={bits:Q.distbits},xe=o(l,Q.lens,Q.nlen,Q.ndist,Q.distcode,0,Q.work,Ae),Q.distbits=Ae.bits,xe){e.msg="invalid distances set",Q.mode=K;break}if(Q.mode=U,J===d)break e;case U:Q.mode=z;case z:if(oe>=6&&se>=258){e.next_out=ie,e.avail_out=se,e.next_in=re,e.avail_in=oe,Q.hold=ae,Q.bits=le,i(e,de),ie=e.next_out,ne=e.output,se=e.avail_out,re=e.next_in,ee=e.input,oe=e.avail_in,ae=Q.hold,le=Q.bits,Q.mode===R&&(Q.back=-1);break}for(Q.back=0;_e=Q.lencode[ae&(1<<Q.lenbits)-1],ge=_e>>>16&255,be=65535&_e,!((me=_e>>>24)<=le);){if(0===oe)break e;oe--,ae+=ee[re++]<<le,le+=8}if(ge&&0==(240&ge)){for(ye=me,ve=ge,Se=be;_e=Q.lencode[Se+((ae&(1<<ye+ve)-1)>>ye)],ge=_e>>>16&255,be=65535&_e,!(ye+(me=_e>>>24)<=le);){if(0===oe)break e;oe--,ae+=ee[re++]<<le,le+=8}ae>>>=ye,le-=ye,Q.back+=ye}if(ae>>>=me,le-=me,Q.back+=me,Q.length=be,0===ge){Q.mode=V;break}if(32&ge){Q.back=-1,Q.mode=R;break}if(64&ge){e.msg="invalid literal/length code",Q.mode=K;break}Q.extra=15&ge,Q.mode=j;case j:if(Q.extra){for(we=Q.extra;le<we;){if(0===oe)break e;oe--,ae+=ee[re++]<<le,le+=8}Q.length+=ae&(1<<Q.extra)-1,ae>>>=Q.extra,le-=Q.extra,Q.back+=Q.extra}Q.was=Q.length,Q.mode=W;case W:for(;_e=Q.distcode[ae&(1<<Q.distbits)-1],ge=_e>>>16&255,be=65535&_e,!((me=_e>>>24)<=le);){if(0===oe)break e;oe--,ae+=ee[re++]<<le,le+=8}if(0==(240&ge)){for(ye=me,ve=ge,Se=be;_e=Q.distcode[Se+((ae&(1<<ye+ve)-1)>>ye)],ge=_e>>>16&255,be=65535&_e,!(ye+(me=_e>>>24)<=le);){if(0===oe)break e;oe--,ae+=ee[re++]<<le,le+=8}ae>>>=ye,le-=ye,Q.back+=ye}if(ae>>>=me,le-=me,Q.back+=me,64&ge){e.msg="invalid distance code",Q.mode=K;break}Q.offset=be,Q.extra=15&ge,Q.mode=H;case H:if(Q.extra){for(we=Q.extra;le<we;){if(0===oe)break e;oe--,ae+=ee[re++]<<le,le+=8}Q.offset+=ae&(1<<Q.extra)-1,ae>>>=Q.extra,le-=Q.extra,Q.back+=Q.extra}if(Q.offset>Q.dmax){e.msg="invalid distance too far back",Q.mode=K;break}Q.mode=q;case q:if(0===se)break e;if(he=de-se,Q.offset>he){if((he=Q.offset-he)>Q.whave&&Q.sane){e.msg="invalid distance too far back",Q.mode=K;break}he>Q.wnext?(he-=Q.wnext,pe=Q.wsize-he):pe=Q.wnext-he,he>Q.length&&(he=Q.length),fe=Q.window}else fe=ne,pe=ie-Q.offset,he=Q.length;he>se&&(he=se),se-=he,Q.length-=he;do{ne[ie++]=fe[pe++]}while(--he);0===Q.length&&(Q.mode=z);break;case V:if(0===se)break e;ne[ie++]=Q.length,se--,Q.mode=z;break;case G:if(Q.wrap){for(;le<32;){if(0===oe)break e;oe--,ae|=ee[re++]<<le,le+=8}if(de-=se,e.total_out+=de,Q.total+=de,de&&(e.adler=Q.check=Q.flags?r(Q.check,ne,de,ie-de):n(Q.check,ne,de,ie-de)),de=se,(Q.flags?ae:te(ae))!==Q.check){e.msg="incorrect data check",Q.mode=K;break}ae=0,le=0}Q.mode=X;case X:if(Q.wrap&&Q.flags){for(;le<32;){if(0===oe)break e;oe--,ae+=ee[re++]<<le,le+=8}if(ae!==(4294967295&Q.total)){e.msg="incorrect length check",Q.mode=K;break}ae=0,le=0}Q.mode=Y;case Y:xe=p;break e;case K:xe=g;break e;case $:return b;case Z:default:return m}return e.next_out=ie,e.avail_out=se,e.next_in=re,e.avail_in=oe,Q.hold=ae,Q.bits=le,(Q.wsize||de!==e.avail_out&&Q.mode<K&&(Q.mode<G||J!==c))&&function(e,n,r,i){var o,s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new t.Buf8(s.wsize)),i>=s.wsize?(t.arraySet(s.window,n,r-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((o=s.wsize-s.wnext)>i&&(o=i),t.arraySet(s.window,n,r-i,o,s.wnext),(i-=o)?(t.arraySet(s.window,n,r-i,i,0),s.wnext=i,s.whave=s.wsize):(s.wnext+=o,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=o))),0}(e,e.output,e.next_out,de-e.avail_out)?(Q.mode=$,b):(ue-=e.avail_in,de-=e.avail_out,e.total_in+=ue,e.total_out+=de,Q.total+=de,Q.wrap&&de&&(e.adler=Q.check=Q.flags?r(Q.check,ne,de,e.next_out-de):n(Q.check,ne,de,e.next_out-de)),e.data_type=Q.bits+(Q.last?64:0)+(Q.mode===R?128:0)+(Q.mode===U||Q.mode===I?256:0),(0===ue&&0===de||J===c)&&xe===h&&(xe=y),xe)},exports.inflateEnd=function(e){if(!e||!e.state)return m;var t=e.state;return t.window&&(t.window=null),e.state=null,h},exports.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?m:(n.head=t,t.done=!1,h):m},exports.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./inffast":34,"./inftrees":36}],36:[function(e,module,exports){var t=e("../utils/common"),n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],i=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];module.exports=function(e,s,a,l,c,u,d,h){var p,f,m,g,b,y,v,S,C,x=h.bits,A=0,w=0,_=0,N=0,E=0,T=0,k=0,P=0,R=0,O=0,D=null,I=0,F=new t.Buf16(16),M=new t.Buf16(16),L=null,B=0;for(A=0;A<=15;A++)F[A]=0;for(w=0;w<l;w++)F[s[a+w]]++;for(E=x,N=15;N>=1&&0===F[N];N--);if(E>N&&(E=N),0===N)return c[u++]=20971520,c[u++]=20971520,h.bits=1,0;for(_=1;_<N&&0===F[_];_++);for(E<_&&(E=_),P=1,A=1;A<=15;A++)if(P<<=1,(P-=F[A])<0)return-1;if(P>0&&(0===e||1!==N))return-1;for(M[1]=0,A=1;A<15;A++)M[A+1]=M[A]+F[A];for(w=0;w<l;w++)0!==s[a+w]&&(d[M[s[a+w]]++]=w);if(0===e?(D=L=d,y=19):1===e?(D=n,I-=257,L=r,B-=257,y=256):(D=i,L=o,y=-1),O=0,w=0,A=_,b=u,T=E,k=0,m=-1,g=(R=1<<E)-1,1===e&&R>852||2===e&&R>592)return 1;for(;;){v=A-k,d[w]<y?(S=0,C=d[w]):d[w]>y?(S=L[B+d[w]],C=D[I+d[w]]):(S=96,C=0),p=1<<A-k,_=f=1<<T;do{c[b+(O>>k)+(f-=p)]=v<<24|S<<16|C|0}while(0!==f);for(p=1<<A-1;O&p;)p>>=1;if(0!==p?(O&=p-1,O+=p):O=0,w++,0==--F[A]){if(A===N)break;A=s[a+d[w]]}if(A>E&&(O&g)!==m){for(0===k&&(k=E),b+=_,P=1<<(T=A-k);T+k<N&&!((P-=F[T+k])<=0);)T++,P<<=1;if(R+=1<<T,1===e&&R>852||2===e&&R>592)return 1;c[m=O&g]=E<<24|T<<16|b-u|0}}return 0!==O&&(c[b+O]=A-k<<24|64<<16|0),h.bits=E,0}},{"../utils/common":27}],37:[function(e,module,exports){module.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],38:[function(e,module,exports){var t=e("../utils/common"),n=4,r=0,i=1,o=2;function s(e){for(var t=e.length;--t>=0;)e[t]=0}var a=0,l=1,c=2,u=29,d=256,h=d+1+u,p=30,f=19,m=2*h+1,g=15,b=16,y=7,v=256,S=16,C=17,x=18,A=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],w=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],E=new Array(2*(h+2));s(E);var T=new Array(2*p);s(T);var k=new Array(512);s(k);var P=new Array(256);s(P);var R=new Array(u);s(R);var O=new Array(p);s(O);var D,I,F,M=function(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length},L=function(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t};function B(e){return e<256?k[e]:k[256+(e>>>7)]}function U(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function z(e,t,n){e.bi_valid>b-n?(e.bi_buf|=t<<e.bi_valid&65535,U(e,e.bi_buf),e.bi_buf=t>>b-e.bi_valid,e.bi_valid+=n-b):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function j(e,t,n){z(e,n[2*t],n[2*t+1])}function W(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function H(e,t,n){var r,i,o=new Array(g+1),s=0;for(r=1;r<=g;r++)o[r]=s=s+n[r-1]<<1;for(i=0;i<=t;i++){var a=e[2*i+1];0!==a&&(e[2*i]=W(o[a]++,a))}}function q(e){var t;for(t=0;t<h;t++)e.dyn_ltree[2*t]=0;for(t=0;t<p;t++)e.dyn_dtree[2*t]=0;for(t=0;t<f;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*v]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function V(e){e.bi_valid>8?U(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function G(e,t,n,r){var i=2*t,o=2*n;return e[i]<e[o]||e[i]===e[o]&&r[t]<=r[n]}function X(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&G(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!G(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function Y(e,t,n){var r,i,o,s,a=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*a]<<8|e.pending_buf[e.d_buf+2*a+1],i=e.pending_buf[e.l_buf+a],a++,0===r?j(e,i,t):(o=P[i],j(e,o+d+1,t),0!==(s=A[o])&&(i-=R[o],z(e,i,s)),o=B(--r),j(e,o,n),0!==(s=w[o])&&(r-=O[o],z(e,r,s)))}while(a<e.last_lit);j(e,v,t)}function K(e,t){var n,r,i,o=t.dyn_tree,s=t.stat_desc.static_tree,a=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=m,n=0;n<l;n++)0!==o[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)i=e.heap[++e.heap_len]=c<2?++c:0,o[2*i]=1,e.depth[i]=0,e.opt_len--,a&&(e.static_len-=s[2*i+1]);for(t.max_code=c,n=e.heap_len>>1;n>=1;n--)X(e,o,n);i=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],X(e,o,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,o[2*i]=o[2*n]+o[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,o[2*n+1]=o[2*r+1]=i,e.heap[1]=i++,X(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,o,s,a,l=t.dyn_tree,c=t.max_code,u=t.stat_desc.static_tree,d=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,f=t.stat_desc.max_length,b=0;for(o=0;o<=g;o++)e.bl_count[o]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<m;n++)r=e.heap[n],(o=l[2*l[2*r+1]+1]+1)>f&&(o=f,b++),l[2*r+1]=o,r>c||(e.bl_count[o]++,s=0,r>=p&&(s=h[r-p]),a=l[2*r],e.opt_len+=a*(o+s),d&&(e.static_len+=a*(u[2*r+1]+s)));if(0!==b){do{for(o=f-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[f]--,b-=2}while(b>0);for(o=f;0!==o;o--)for(r=e.bl_count[o];0!==r;)(i=e.heap[--n])>c||(l[2*i+1]!==o&&(e.opt_len+=(o-l[2*i+1])*l[2*i],l[2*i+1]=o),r--)}}(e,t),H(o,c,e.bl_count)}function $(e,t,n){var r,i,o=-1,s=t[1],a=0,l=7,c=4;for(0===s&&(l=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=s,s=t[2*(r+1)+1],++a<l&&i===s||(a<c?e.bl_tree[2*i]+=a:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[2*S]++):a<=10?e.bl_tree[2*C]++:e.bl_tree[2*x]++,a=0,o=i,0===s?(l=138,c=3):i===s?(l=6,c=3):(l=7,c=4))}function Z(e,t,n){var r,i,o=-1,s=t[1],a=0,l=7,c=4;for(0===s&&(l=138,c=3),r=0;r<=n;r++)if(i=s,s=t[2*(r+1)+1],!(++a<l&&i===s)){if(a<c)do{j(e,i,e.bl_tree)}while(0!=--a);else 0!==i?(i!==o&&(j(e,i,e.bl_tree),a--),j(e,S,e.bl_tree),z(e,a-3,2)):a<=10?(j(e,C,e.bl_tree),z(e,a-3,3)):(j(e,x,e.bl_tree),z(e,a-11,7));a=0,o=i,0===s?(l=138,c=3):i===s?(l=6,c=3):(l=7,c=4)}}var J=!1;function Q(e,n,r,i){z(e,(a<<1)+(i?1:0),3),function(e,n,r,i){V(e),i&&(U(e,r),U(e,~r)),t.arraySet(e.pending_buf,e.window,n,r,e.pending),e.pending+=r}(e,n,r,!0)}exports._tr_init=function(e){J||(function(){var e,t,n,r,i,o=new Array(g+1);for(n=0,r=0;r<u-1;r++)for(R[r]=n,e=0;e<1<<A[r];e++)P[n++]=r;for(P[n-1]=r,i=0,r=0;r<16;r++)for(O[r]=i,e=0;e<1<<w[r];e++)k[i++]=r;for(i>>=7;r<p;r++)for(O[r]=i<<7,e=0;e<1<<w[r]-7;e++)k[256+i++]=r;for(t=0;t<=g;t++)o[t]=0;for(e=0;e<=143;)E[2*e+1]=8,e++,o[8]++;for(;e<=255;)E[2*e+1]=9,e++,o[9]++;for(;e<=279;)E[2*e+1]=7,e++,o[7]++;for(;e<=287;)E[2*e+1]=8,e++,o[8]++;for(H(E,h+1,o),e=0;e<p;e++)T[2*e+1]=5,T[2*e]=W(e,5);D=new M(E,A,d+1,h,g),I=new M(T,w,0,p,g),F=new M(new Array(0),_,0,f,y)}(),J=!0),e.l_desc=new L(e.dyn_ltree,D),e.d_desc=new L(e.dyn_dtree,I),e.bl_desc=new L(e.bl_tree,F),e.bi_buf=0,e.bi_valid=0,q(e)},exports._tr_stored_block=Q,exports._tr_flush_block=function(e,t,s,a){var u,h,p=0;e.level>0?(e.strm.data_type===o&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return r;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return i;for(t=32;t<d;t++)if(0!==e.dyn_ltree[2*t])return i;return r}(e)),K(e,e.l_desc),K(e,e.d_desc),p=function(e){var t;for($(e,e.dyn_ltree,e.l_desc.max_code),$(e,e.dyn_dtree,e.d_desc.max_code),K(e,e.bl_desc),t=f-1;t>=3&&0===e.bl_tree[2*N[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),u=e.opt_len+3+7>>>3,(h=e.static_len+3+7>>>3)<=u&&(u=h)):u=h=s+5,s+4<=u&&-1!==t?Q(e,t,s,a):e.strategy===n||h===u?(z(e,(l<<1)+(a?1:0),3),Y(e,E,T)):(z(e,(c<<1)+(a?1:0),3),function(e,t,n,r){var i;for(z(e,t-257,5),z(e,n-1,5),z(e,r-4,4),i=0;i<r;i++)z(e,e.bl_tree[2*N[i]+1],3);Z(e,e.dyn_ltree,t-1),Z(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,p+1),Y(e,e.dyn_ltree,e.dyn_dtree)),q(e),a&&V(e)},exports._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(P[n]+d+1)]++,e.dyn_dtree[2*B(t)]++),e.last_lit===e.lit_bufsize-1},exports._tr_align=function(e){z(e,l<<1,3),j(e,v,E),function(e){16===e.bi_valid?(U(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":27}],39:[function(e,module,exports){module.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}]},{},[9])(9)}(),{runtime:runtime,odf:odf}}),define("skylark-webodf/main",["skylark-langx-ns","./webodf"],function(e,t){return e.attach("intg.webodf",t)}),define("skylark-webodf",["skylark-webodf/main"],function(e){return e}),define("skylark-viewerjs/ODFViewerPlugin",["skylark-webodf","./viewerjs"],function(e,t){return t.ODFViewerPlugin=function(){"use strict";var t=this,n=null,r=null,i=null,o=null;this.initialize=function(s,a){(function(){var s,l,c,u,d,h,p,f;r=document.getElementById("canvas"),(n=new e.odf.OdfCanvas(r)).load(a),n.addListener("statereadychange",function(){if(i=n.odfContainer().rootElement,!0,"text"===(o=n.odfContainer().getDocumentType(i))){n.enableAnnotations(!0,!1),s=new ops.Session(n),c=s.getOdtDocument(),u=new gui.ShadowCursor(c),l=new gui.SessionController(s,"localuser",u,{}),f=l.getEventManager(),h=new gui.CaretManager(l,n.getViewport()),d=new gui.SelectionViewManager(gui.SvgSelectionView),new gui.SessionView({caretAvatarsInitiallyVisible:!1},"localuser",s,l.getSessionConstraints(),h,d),d.registerCursor(u),p=new gui.HyperlinkTooltipView(n,l.getHyperlinkClickHandler().getModifier),f.subscribe("mousemove",p.showTooltip),f.subscribe("mouseout",p.hideTooltip);var r=new ops.OpAddMember;r.init({memberid:"localuser",setProperties:{fillName:e.runtime.tr("Unknown Author"),color:"blue"}}),s.enqueue([r]),l.insertLocalCursor()}t.onLoad()})})()},this.isSlideshow=function(){return"presentation"===o},this.onLoad=function(){},this.fitToWidth=function(e){n.fitToWidth(e)},this.fitToHeight=function(e){n.fitToHeight(e)},this.fitToPage=function(e,t){n.fitToContainingElement(e,t)},this.fitSmart=function(e){n.fitSmart(e)},this.getZoomLevel=function(){return n.getZoomLevel()},this.setZoomLevel=function(e){n.setZoomLevel(e)},this.getPages=function(){var e,t,n,r=Array.prototype.slice.call(i.getElementsByTagNameNS({draw:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",presentation:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",text:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",office:"urn:oasis:names:tc:opendocument:xmlns:office:1.0"}[n="draw"]||console.log("prefix ["+n+"] unknown."),"page")),o=[];for(e=0;e<r.length;e+=1)t=[r[e].getAttribute("draw:name"),r[e]],o.push(t);return o},this.showPage=function(e){n.showPage(e)},this.getPluginName=function(){return"WebODF"},this.getPluginVersion=function(){return"undefined"!==String(typeof e)?e.Version:"Unknown"},this.getPluginURL=function(){return"http://webodf.org"}}}),define("skylark-langx/skylark",["skylark-langx-ns"],function(e){return e}),define("skylark-pdfjs-display/pdfjs",["skylark-langx/skylark"],function(e){return e.attach("intg.pdfjs")}),define("skylark-pdfjs-display/display",["./pdfjs"],function(pdfjs){return pdfjs.display=(()=>{"use strict";var __webpack_modules__=[(e,exports,t)=>{Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"addLinkAttributes",{enumerable:!0,get:function(){return n.addLinkAttributes}}),Object.defineProperty(exports,"getFilenameFromUrl",{enumerable:!0,get:function(){return n.getFilenameFromUrl}}),Object.defineProperty(exports,"LinkTarget",{enumerable:!0,get:function(){return n.LinkTarget}}),Object.defineProperty(exports,"loadScript",{enumerable:!0,get:function(){return n.loadScript}}),Object.defineProperty(exports,"PDFDateString",{enumerable:!0,get:function(){return n.PDFDateString}}),Object.defineProperty(exports,"RenderingCancelledException",{enumerable:!0,get:function(){return n.RenderingCancelledException}}),Object.defineProperty(exports,"build",{enumerable:!0,get:function(){return r.build}}),Object.defineProperty(exports,"getDocument",{enumerable:!0,get:function(){return r.getDocument}}),Object.defineProperty(exports,"LoopbackPort",{enumerable:!0,get:function(){return r.LoopbackPort}}),Object.defineProperty(exports,"PDFDataRangeTransport",{enumerable:!0,get:function(){return r.PDFDataRangeTransport}}),Object.defineProperty(exports,"PDFWorker",{enumerable:!0,get:function(){return r.PDFWorker}}),Object.defineProperty(exports,"version",{enumerable:!0,get:function(){return r.version}}),Object.defineProperty(exports,"CMapCompressionType",{enumerable:!0,get:function(){return i.CMapCompressionType}}),Object.defineProperty(exports,"createObjectURL",{enumerable:!0,get:function(){return i.createObjectURL}}),Object.defineProperty(exports,"createPromiseCapability",{enumerable:!0,get:function(){return i.createPromiseCapability}}),Object.defineProperty(exports,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return i.createValidAbsoluteUrl}}),Object.defineProperty(exports,"InvalidPDFException",{enumerable:!0,get:function(){return i.InvalidPDFException}}),Object.defineProperty(exports,"MissingPDFException",{enumerable:!0,get:function(){return i.MissingPDFException}}),Object.defineProperty(exports,"OPS",{enumerable:!0,get:function(){return i.OPS}}),Object.defineProperty(exports,"PasswordResponses",{enumerable:!0,get:function(){return i.PasswordResponses}}),Object.defineProperty(exports,"PermissionFlag",{enumerable:!0,get:function(){return i.PermissionFlag}}),Object.defineProperty(exports,"removeNullCharacters",{enumerable:!0,get:function(){return i.removeNullCharacters}}),Object.defineProperty(exports,"shadow",{enumerable:!0,get:function(){return i.shadow}}),Object.defineProperty(exports,"UnexpectedResponseException",{enumerable:!0,get:function(){return i.UnexpectedResponseException}}),Object.defineProperty(exports,"UNSUPPORTED_FEATURES",{enumerable:!0,get:function(){return i.UNSUPPORTED_FEATURES}}),Object.defineProperty(exports,"Util",{enumerable:!0,get:function(){return i.Util}}),Object.defineProperty(exports,"VerbosityLevel",{enumerable:!0,get:function(){return i.VerbosityLevel}}),Object.defineProperty(exports,"AnnotationLayer",{enumerable:!0,get:function(){return o.AnnotationLayer}}),Object.defineProperty(exports,"apiCompatibilityParams",{enumerable:!0,get:function(){return s.apiCompatibilityParams}}),Object.defineProperty(exports,"GlobalWorkerOptions",{enumerable:!0,get:function(){return a.GlobalWorkerOptions}}),Object.defineProperty(exports,"renderTextLayer",{enumerable:!0,get:function(){return l.renderTextLayer}}),Object.defineProperty(exports,"SVGGraphics",{enumerable:!0,get:function(){return c.SVGGraphics}});var n=t(1),r=t(5),i=t(2),o=t(19),s=t(9),a=t(12),l=t(21),c=t(22);{const{isNodeJS:e}=t(4);if(e){const e=t(23).PDFNodeStream;(0,r.setPDFNetworkStreamFactory)(t=>new e(t))}else{const e=t(26).PDFNetworkStream;let i;(0,n.isFetchSupported)()&&(i=t(27).PDFFetchStream),(0,r.setPDFNetworkStreamFactory)(t=>i&&(0,n.isValidFetchUrl)(t.url)?new i(t):new e(t))}}},(e,exports,t)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.addLinkAttributes=function(e,{url:t,target:i,rel:o,enabled:s=!0}={}){(0,n.assert)(t&&"string"==typeof t,'addLinkAttributes: A valid "url" parameter must provided.');const a=(0,n.removeNullCharacters)(t);s?e.href=e.title=a:(e.href="",e.title=`Disabled: ${a}`,e.onclick=(()=>!1));let c="";switch(i){case l.NONE:break;case l.SELF:c="_self";break;case l.BLANK:c="_blank";break;case l.PARENT:c="_parent";break;case l.TOP:c="_top"}e.target=c,e.rel="string"==typeof o?o:r},exports.deprecated=function(e){console.log("Deprecated API usage: "+e)},exports.getFilenameFromUrl=function(e){const t=e.indexOf("#"),n=e.indexOf("?"),r=Math.min(t>0?t:e.length,n>0?n:e.length);return e.substring(e.lastIndexOf("/",r)+1,r)},exports.isFetchSupported=c,exports.isValidFetchUrl=u,exports.loadScript=function(e,t=!1){return new Promise((n,r)=>{const i=document.createElement("script");i.src=e,i.onload=function(e){t&&i.remove(),n(e)},i.onerror=function(){r(new Error(`Cannot load script at: ${i.src}`))},(document.head||document.documentElement).appendChild(i)})},exports.StatTimer=exports.RenderingCancelledException=exports.PDFDateString=exports.PageViewport=exports.LinkTarget=exports.DOMSVGFactory=exports.DOMCMapReaderFactory=exports.DOMCanvasFactory=exports.DEFAULT_LINK_REL=exports.BaseCMapReaderFactory=exports.BaseCanvasFactory=void 0;var n=t(2);const r="noopener noreferrer nofollow";exports.DEFAULT_LINK_REL=r;const i="http://www.w3.org/2000/svg";class o{constructor(){this.constructor===o&&(0,n.unreachable)("Cannot initialize BaseCanvasFactory.")}create(e,t){(0,n.unreachable)("Abstract method `create` called.")}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}}exports.BaseCanvasFactory=o;exports.DOMCanvasFactory=class extends o{constructor({ownerDocument:e=globalThis.document}={}){super(),this._document=e}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const n=this._document.createElement("canvas"),r=n.getContext("2d");return n.width=e,n.height=t,{canvas:n,context:r}}};class s{constructor({baseUrl:e=null,isCompressed:t=!1}){this.constructor===s&&(0,n.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":""),r=this.isCompressed?n.CMapCompressionType.BINARY:n.CMapCompressionType.NONE;return this._fetchData(t,r).catch(e=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}_fetchData(e,t){(0,n.unreachable)("Abstract method `_fetchData` called.")}}exports.BaseCMapReaderFactory=s;exports.DOMCMapReaderFactory=class extends s{_fetchData(e,t){return c()&&u(e,document.baseURI)?fetch(e).then(async e=>{if(!e.ok)throw new Error(e.statusText);let r;return{cMapData:r=this.isCompressed?new Uint8Array(await e.arrayBuffer()):(0,n.stringToBytes)(await e.text()),compressionType:t}}):new Promise((r,i)=>{const o=new XMLHttpRequest;o.open("GET",e,!0),this.isCompressed&&(o.responseType="arraybuffer"),o.onreadystatechange=(()=>{if(o.readyState===XMLHttpRequest.DONE){if(200===o.status||0===o.status){let e;if(this.isCompressed&&o.response?e=new Uint8Array(o.response):!this.isCompressed&&o.responseText&&(e=(0,n.stringToBytes)(o.responseText)),e)return void r({cMapData:e,compressionType:t})}i(new Error(o.statusText))}}),o.send(null)})}};exports.DOMSVGFactory=class{create(e,t){(0,n.assert)(e>0&&t>0,"Invalid SVG dimensions");const r=document.createElementNS(i,"svg:svg");return r.setAttribute("version","1.1"),r.setAttribute("width",e+"px"),r.setAttribute("height",t+"px"),r.setAttribute("preserveAspectRatio","none"),r.setAttribute("viewBox","0 0 "+e+" "+t),r}createElement(e){return(0,n.assert)("string"==typeof e,"Invalid SVG element type"),document.createElementNS(i,e)}};class a{constructor({viewBox:e,scale:t,rotation:n,offsetX:r=0,offsetY:i=0,dontFlip:o=!1}){this.viewBox=e,this.scale=t,this.rotation=n,this.offsetX=r,this.offsetY=i;const s=(e[2]+e[0])/2,a=(e[3]+e[1])/2;let l,c,u,d,h,p,f,m;switch(n=(n%=360)<0?n+360:n){case 180:l=-1,c=0,u=0,d=1;break;case 90:l=0,c=1,u=1,d=0;break;case 270:l=0,c=-1,u=-1,d=0;break;case 0:l=1,c=0,u=0,d=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(u=-u,d=-d),0===l?(h=Math.abs(a-e[1])*t+r,p=Math.abs(s-e[0])*t+i,f=Math.abs(e[3]-e[1])*t,m=Math.abs(e[2]-e[0])*t):(h=Math.abs(s-e[0])*t+r,p=Math.abs(a-e[1])*t+i,f=Math.abs(e[2]-e[0])*t,m=Math.abs(e[3]-e[1])*t),this.transform=[l*t,c*t,u*t,d*t,h-l*t*s-u*t*a,p-c*t*s-d*t*a],this.width=f,this.height=m}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:r=this.offsetY,dontFlip:i=!1}={}){return new a({viewBox:this.viewBox.slice(),scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:i})}convertToViewportPoint(e,t){return n.Util.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){const t=n.Util.applyTransform([e[0],e[1]],this.transform),r=n.Util.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],r[0],r[1]]}convertToPdfPoint(e,t){return n.Util.applyInverseTransform([e,t],this.transform)}}exports.PageViewport=a;exports.RenderingCancelledException=class extends n.BaseException{constructor(e,t){super(e),this.type=t}};const l={NONE:0,SELF:1,BLANK:2,PARENT:3,TOP:4};exports.LinkTarget=l;function c(){return"undefined"!=typeof fetch&&"undefined"!=typeof Response&&"body"in Response.prototype&&"undefined"!=typeof ReadableStream}function u(e,t){try{const{protocol:n}=t?new URL(e,t):new URL(e);return"http:"===n||"https:"===n}catch(e){return!1}}let d;exports.StatTimer=class{constructor(){this.started=Object.create(null),this.times=[]}time(e){e in this.started&&(0,n.warn)(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||(0,n.warn)(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const e of this.times){const n=e.name;n.length>t&&(t=n.length)}for(const n of this.times){const r=n.end-n.start;e.push(`${n.name.padEnd(t)} ${r}ms\n`)}return e.join("")}};exports.PDFDateString=class{static toDateObject(e){if(!e||!(0,n.isString)(e))return null;d||(d=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=d.exec(e);if(!t)return null;const r=parseInt(t[1],10);let i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let o=parseInt(t[3],10);o=o>=1&&o<=31?o:1;let s=parseInt(t[4],10);s=s>=0&&s<=23?s:0;let a=parseInt(t[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;const c=t[7]||"Z";let u=parseInt(t[8],10);u=u>=0&&u<=23?u:0;let h=parseInt(t[9],10)||0;return h=h>=0&&h<=59?h:0,"-"===c?(s+=u,a+=h):"+"===c&&(s-=u,a-=h),new Date(Date.UTC(r,i,o,s,a,l))}}},(e,exports,t)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.arrayByteLength=d,exports.arraysToBytes=function(e){const t=e.length;if(1===t&&e[0]instanceof Uint8Array)return e[0];let n=0;for(let r=0;r<t;r++)n+=d(e[r]);let r=0;const i=new Uint8Array(n);for(let n=0;n<t;n++){let t=e[n];t instanceof Uint8Array||(t="string"==typeof t?u(t):new Uint8Array(t));const o=t.byteLength;i.set(t,r),r+=o}return i},exports.assert=s,exports.bytesToString=function(e){s(null!==e&&"object"==typeof e&&void 0!==e.length,"Invalid argument for bytesToString");const t=e.length;if(t<8192)return String.fromCharCode.apply(null,e);const n=[];for(let r=0;r<t;r+=8192){const i=Math.min(r+8192,t),o=e.subarray(r,i);n.push(String.fromCharCode.apply(null,o))}return n.join("")},exports.createPromiseCapability=function(){const e=Object.create(null);let t=!1;return Object.defineProperty(e,"settled",{get:()=>t}),e.promise=new Promise(function(n,r){e.resolve=function(e){t=!0,n(e)},e.reject=function(e){t=!0,r(e)}}),e},exports.createValidAbsoluteUrl=function(e,t){if(!e)return null;try{const n=t?new URL(e,t):new URL(e);if(function(e){if(!e)return!1;switch(e.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(n))return n}catch(e){}return null},exports.encodeToXmlString=function(e){const t=[];let n=0;for(let r=0,i=e.length;r<i;r++){const i=e.codePointAt(r);if(32<=i&&i<=126){const o=y[i];o&&(n<r&&t.push(e.substring(n,r)),t.push(o),n=r+1)}else n<r&&t.push(e.substring(n,r)),t.push(`&#x${i.toString(16).toUpperCase()};`),i>55295&&(i<57344||i>65533)&&r++,n=r+1}if(0===t.length)return e;n<e.length&&t.push(e.substring(n,e.length));return t.join("")},exports.escapeString=function(e){return e.replace(/([()\\\n\r])/g,e=>"\n"===e?"\\n":"\r"===e?"\\r":`\\${e}`)},exports.getModificationDate=function(e=new Date){return[e.getUTCFullYear().toString(),(e.getUTCMonth()+1).toString().padStart(2,"0"),e.getUTCDate().toString().padStart(2,"0"),e.getUTCHours().toString().padStart(2,"0"),e.getUTCMinutes().toString().padStart(2,"0"),e.getUTCSeconds().toString().padStart(2,"0")].join("")},exports.getVerbosityLevel=function(){return r},exports.info=function(e){r>=n.INFOS&&console.log(`Info: ${e}`)},exports.isArrayBuffer=function(e){return"object"==typeof e&&null!==e&&void 0!==e.byteLength},exports.isArrayEqual=function(e,t){if(e.length!==t.length)return!1;return e.every(function(e,n){return e===t[n]})},exports.isAscii=function(e){return/^[\x00-\x7F]*$/.test(e)},exports.isBool=function(e){return"boolean"==typeof e},exports.isNum=function(e){return"number"==typeof e},exports.isSameOrigin=function(e,t){let n;try{if(!(n=new URL(e)).origin||"null"===n.origin)return!1}catch(e){return!1}const r=new URL(t,n);return n.origin===r.origin},exports.isString=function(e){return"string"==typeof e},exports.objectFromEntries=function(e){return Object.assign(Object.create(null),Object.fromEntries(e))},exports.objectSize=function(e){return Object.keys(e).length},exports.removeNullCharacters=function(e){if("string"!=typeof e)return i("The argument for removeNullCharacters must be a string."),e;return e.replace(c,"")},exports.setVerbosityLevel=function(e){Number.isInteger(e)&&(r=e)},exports.shadow=a,exports.string32=function(e){return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e)},exports.stringToBytes=u,exports.stringToPDFString=function(e){const t=e.length,n=[];if("þ"===e[0]&&"ÿ"===e[1])for(let r=2;r<t;r+=2)n.push(String.fromCharCode(e.charCodeAt(r)<<8|e.charCodeAt(r+1)));else if("ÿ"===e[0]&&"þ"===e[1])for(let r=2;r<t;r+=2)n.push(String.fromCharCode(e.charCodeAt(r+1)<<8|e.charCodeAt(r)));else for(let r=0;r<t;++r){const t=g[e.charCodeAt(r)];n.push(t?String.fromCharCode(t):e.charAt(r))}return n.join("")},exports.stringToUTF16BEString=function(e){const t=["þÿ"];for(let n=0,r=e.length;n<r;n++){const r=e.charCodeAt(n);t.push(String.fromCharCode(r>>8&255)),t.push(String.fromCharCode(255&r))}return t.join("")},exports.stringToUTF8String=function(e){return decodeURIComponent(escape(e))},exports.unreachable=o,exports.utf8StringToString=function(e){return unescape(encodeURIComponent(e))},exports.warn=i,exports.VerbosityLevel=exports.Util=exports.UNSUPPORTED_FEATURES=exports.UnknownErrorException=exports.UnexpectedResponseException=exports.TextRenderingMode=exports.StreamType=exports.PermissionFlag=exports.PasswordResponses=exports.PasswordException=exports.PageActionEventType=exports.OPS=exports.MissingPDFException=exports.IsLittleEndianCached=exports.IsEvalSupportedCached=exports.InvalidPDFException=exports.ImageKind=exports.IDENTITY_MATRIX=exports.FormatError=exports.FontType=exports.FONT_IDENTITY_MATRIX=exports.DocumentActionEventType=exports.createObjectURL=exports.CMapCompressionType=exports.BaseException=exports.AnnotationType=exports.AnnotationStateModelType=exports.AnnotationReviewState=exports.AnnotationReplyType=exports.AnnotationMarkedState=exports.AnnotationFlag=exports.AnnotationFieldFlag=exports.AnnotationBorderStyleType=exports.AnnotationActionEventType=exports.AbortException=void 0,t(3);exports.IDENTITY_MATRIX=[1,0,0,1,0,0];exports.FONT_IDENTITY_MATRIX=[.001,0,0,.001,0,0];exports.PermissionFlag={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};exports.TextRenderingMode={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};exports.ImageKind={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};exports.AnnotationType={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};exports.AnnotationStateModelType={MARKED:"Marked",REVIEW:"Review"};exports.AnnotationMarkedState={MARKED:"Marked",UNMARKED:"Unmarked"};exports.AnnotationReviewState={ACCEPTED:"Accepted",REJECTED:"Rejected",CANCELLED:"Cancelled",COMPLETED:"Completed",NONE:"None"};exports.AnnotationReplyType={GROUP:"Group",REPLY:"R"};exports.AnnotationFlag={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};exports.AnnotationFieldFlag={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};exports.AnnotationBorderStyleType={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};exports.AnnotationActionEventType={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};exports.DocumentActionEventType={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};exports.PageActionEventType={O:"PageOpen",C:"PageClose"};exports.StreamType={UNKNOWN:"UNKNOWN",FLATE:"FLATE",LZW:"LZW",DCT:"DCT",JPX:"JPX",JBIG:"JBIG",A85:"A85",AHX:"AHX",CCF:"CCF",RLX:"RLX"};exports.FontType={UNKNOWN:"UNKNOWN",TYPE1:"TYPE1",TYPE1C:"TYPE1C",CIDFONTTYPE0:"CIDFONTTYPE0",CIDFONTTYPE0C:"CIDFONTTYPE0C",TRUETYPE:"TRUETYPE",CIDFONTTYPE2:"CIDFONTTYPE2",TYPE3:"TYPE3",OPENTYPE:"OPENTYPE",TYPE0:"TYPE0",MMTYPE1:"MMTYPE1"};const n={ERRORS:0,WARNINGS:1,INFOS:5};exports.VerbosityLevel=n;exports.CMapCompressionType={NONE:0,BINARY:1,STREAM:2};exports.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};exports.UNSUPPORTED_FEATURES={unknown:"unknown",forms:"forms",javaScript:"javaScript",smask:"smask",shadingPattern:"shadingPattern",font:"font",errorTilingPattern:"errorTilingPattern",errorExtGState:"errorExtGState",errorXObject:"errorXObject",errorFontLoadType3:"errorFontLoadType3",errorFontState:"errorFontState",errorFontMissing:"errorFontMissing",errorFontTranslate:"errorFontTranslate",errorColorSpace:"errorColorSpace",errorOperatorList:"errorOperatorList",errorFontToUnicode:"errorFontToUnicode",errorFontLoadNative:"errorFontLoadNative",errorFontGetPath:"errorFontGetPath",errorMarkedContent:"errorMarkedContent"};exports.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let r=n.WARNINGS;function i(e){r>=n.WARNINGS&&console.log(`Warning: ${e}`)}function o(e){throw new Error(e)}function s(e,t){e||o(t)}function a(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!1}),n}const l=function(){function e(t){this.constructor===e&&o("Cannot initialize BaseException."),this.message=t,this.name=this.constructor.name}return e.prototype=new Error,e.constructor=e,e}();exports.BaseException=l;exports.PasswordException=class extends l{constructor(e,t){super(e),this.code=t}};exports.UnknownErrorException=class extends l{constructor(e,t){super(e),this.details=t}};exports.InvalidPDFException=class extends l{};exports.MissingPDFException=class extends l{};exports.UnexpectedResponseException=class extends l{constructor(e,t){super(e),this.status=t}};exports.FormatError=class extends l{};exports.AbortException=class extends l{};const c=/\x00/g;function u(e){s("string"==typeof e,"Invalid argument for stringToBytes");const t=e.length,n=new Uint8Array(t);for(let r=0;r<t;++r)n[r]=255&e.charCodeAt(r);return n}function d(e){return void 0!==e.length?e.length:(s(void 0!==e.byteLength,"arrayByteLength - invalid argument."),e.byteLength)}const h={get value(){return a(this,"value",function(){const e=new Uint8Array(4);return e[0]=1,1===new Uint32Array(e.buffer,0,1)[0]}())}};exports.IsLittleEndianCached=h;const p={get value(){return a(this,"value",function(){try{return new Function(""),!0}catch(e){return!1}}())}};exports.IsEvalSupportedCached=p;const f=[...Array(256).keys()].map(e=>e.toString(16).padStart(2,"0"));class m{static makeHexColor(e,t,n){return`#${f[e]}${f[t]}${f[n]}`}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){const n=e[0]*t[0]+e[1]*t[2]+t[4],r=e[0]*t[1]+e[1]*t[3]+t[5];return[n,r]}static applyInverseTransform(e,t){const n=t[0]*t[3]-t[1]*t[2],r=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,i=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n;return[r,i]}static getAxialAlignedBoundingBox(e,t){const n=m.applyTransform(e,t),r=m.applyTransform(e.slice(2,4),t),i=m.applyTransform([e[0],e[3]],t),o=m.applyTransform([e[2],e[1]],t);return[Math.min(n[0],r[0],i[0],o[0]),Math.min(n[1],r[1],i[1],o[1]),Math.max(n[0],r[0],i[0],o[0]),Math.max(n[1],r[1],i[1],o[1])]}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static apply3dTransform(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[3]*t[0]+e[4]*t[1]+e[5]*t[2],e[6]*t[0]+e[7]*t[1]+e[8]*t[2]]}static singularValueDecompose2dScale(e){const t=[e[0],e[2],e[1],e[3]],n=e[0]*t[0]+e[1]*t[2],r=e[0]*t[1]+e[1]*t[3],i=e[2]*t[0]+e[3]*t[2],o=e[2]*t[1]+e[3]*t[3],s=(n+o)/2,a=Math.sqrt((n+o)*(n+o)-4*(n*o-i*r))/2,l=s+a||1,c=s-a||1;return[Math.sqrt(l),Math.sqrt(c)]}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){function n(e,t){return e-t}const r=[e[0],e[2],t[0],t[2]].sort(n),i=[e[1],e[3],t[1],t[3]].sort(n),o=[];return e=m.normalizeRect(e),t=m.normalizeRect(t),r[0]===e[0]&&r[1]===t[0]||r[0]===t[0]&&r[1]===e[0]?(o[0]=r[1],o[2]=r[2],i[0]===e[1]&&i[1]===t[1]||i[0]===t[1]&&i[1]===e[1]?(o[1]=i[1],o[3]=i[2],o):null):null}}exports.Util=m;const g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];const b=function(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return function(t,n,r=!1){if(!r&&URL.createObjectURL){const e=new Blob([t],{type:n});return URL.createObjectURL(e)}let i=`data:${n};base64,`;for(let n=0,r=t.length;n<r;n+=3){const o=255&t[n],s=255&t[n+1],a=255&t[n+2],l=o>>2,c=(3&o)<<4|s>>4,u=n+1<r?(15&s)<<2|a>>6:64,d=n+2<r?63&a:64;i+=e[l]+e[c]+e[u]+e[d]}return i}}();exports.createObjectURL=b;const y={60:"&lt;",62:"&gt;",38:"&amp;",34:"&quot;",39:"&apos;"}},(e,t,n)=>{n(4)},(e,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.isNodeJS=void 0;const t=!("object"!=typeof process||process+""!="[object process]"||process.versions.nw||process.versions.electron&&process.type&&"browser"!==process.type);exports.isNodeJS=t},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.getDocument=getDocument,exports.setPDFNetworkStreamFactory=setPDFNetworkStreamFactory,exports.version=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultCMapReaderFactory=exports.DefaultCanvasFactory=exports.build=void 0;var _util=__w_pdfjs_require__(2),_display_utils=__w_pdfjs_require__(1),_font_loader=__w_pdfjs_require__(6),_node_utils=__w_pdfjs_require__(7),_annotation_storage=__w_pdfjs_require__(8),_api_compatibility=__w_pdfjs_require__(9),_canvas=__w_pdfjs_require__(10),_worker_options=__w_pdfjs_require__(12),_is_node=__w_pdfjs_require__(4),_message_handler=__w_pdfjs_require__(13),_metadata=__w_pdfjs_require__(14),_optional_content_config=__w_pdfjs_require__(16),_transport_stream=__w_pdfjs_require__(17),_webgl=__w_pdfjs_require__(18);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DefaultCanvasFactory=_is_node.isNodeJS?_node_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_is_node.isNodeJS?_node_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;let createPDFNetworkStream;function setPDFNetworkStreamFactory(e){createPDFNetworkStream=e}function getDocument(e){const t=new PDFDocumentLoadingTask;let n;if("string"==typeof e)n={url:e};else if((0,_util.isArrayBuffer)(e))n={data:e};else if(e instanceof PDFDataRangeTransport)n={range:e};else{if("object"!=typeof e)throw new Error("Invalid parameter in getDocument, need either Uint8Array, string or a parameter object");if(!e.url&&!e.data&&!e.range)throw new Error("Invalid parameter object: need either .data, .range or .url");n=e}const r=Object.create(null);let i=null,o=null;for(const e in n)if("url"!==e||"undefined"==typeof window)if("range"!==e)if("worker"!==e)if("data"!==e||n[e]instanceof Uint8Array)r[e]=n[e];else{const t=n[e];if("string"==typeof t)r[e]=(0,_util.stringToBytes)(t);else if("object"!=typeof t||null===t||isNaN(t.length)){if(!(0,_util.isArrayBuffer)(t))throw new Error("Invalid PDF binary data: either typed array, string or array-like object is expected in the data property.");r[e]=new Uint8Array(t)}else r[e]=new Uint8Array(t)}else o=n[e];else i=n[e];else r[e]=new URL(n[e],window.location).href;if(r.rangeChunkSize=r.rangeChunkSize||DEFAULT_RANGE_CHUNK_SIZE,r.CMapReaderFactory=r.CMapReaderFactory||DefaultCMapReaderFactory,r.ignoreErrors=!0!==r.stopAtErrors,r.fontExtraProperties=!0===r.fontExtraProperties,r.pdfBug=!0===r.pdfBug,Number.isInteger(r.maxImageSize)||(r.maxImageSize=-1),"boolean"!=typeof r.isEvalSupported&&(r.isEvalSupported=!0),"boolean"!=typeof r.disableFontFace&&(r.disableFontFace=_api_compatibility.apiCompatibilityParams.disableFontFace||!1),void 0===r.ownerDocument&&(r.ownerDocument=globalThis.document),"boolean"!=typeof r.disableRange&&(r.disableRange=!1),"boolean"!=typeof r.disableStream&&(r.disableStream=!1),"boolean"!=typeof r.disableAutoFetch&&(r.disableAutoFetch=!1),(0,_util.setVerbosityLevel)(r.verbosity),!o){const e={verbosity:r.verbosity,port:_worker_options.GlobalWorkerOptions.workerPort};o=e.port?PDFWorker.fromPort(e):new PDFWorker(e),t._worker=o}const s=t.docId;return o.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");const e=_fetchDocument(o,r,i,s),n=new Promise(function(e){let t;i?t=new _transport_stream.PDFDataTransportStream({length:r.length,initialData:r.initialData,progressiveDone:r.progressiveDone,disableRange:r.disableRange,disableStream:r.disableStream},i):r.data||(t=createPDFNetworkStream({url:r.url,length:r.length,httpHeaders:r.httpHeaders,withCredentials:r.withCredentials,rangeChunkSize:r.rangeChunkSize,disableRange:r.disableRange,disableStream:r.disableStream})),e(t)});return Promise.all([e,n]).then(function([e,n]){if(t.destroyed)throw new Error("Loading aborted");const i=new _message_handler.MessageHandler(s,e,o.port);i.postMessageTransfers=o.postMessageTransfers;const a=new WorkerTransport(i,t,n,r);t._transport=a,i.send("Ready",null)})}).catch(t._capability.reject),t}function _fetchDocument(e,t,n,r){return e.destroyed?Promise.reject(new Error("Worker was destroyed")):(n&&(t.length=n.length,t.initialData=n.initialData,t.progressiveDone=n.progressiveDone),e.messageHandler.sendWithPromise("GetDocRequest",{docId:r,apiVersion:"2.7.570",source:{data:t.data,url:t.url,password:t.password,disableAutoFetch:t.disableAutoFetch,rangeChunkSize:t.rangeChunkSize,length:t.length},maxImageSize:t.maxImageSize,disableFontFace:t.disableFontFace,postMessageTransfers:e.postMessageTransfers,docBaseUrl:t.docBaseUrl,ignoreErrors:t.ignoreErrors,isEvalSupported:t.isEvalSupported,fontExtraProperties:t.fontExtraProperties}).then(function(t){if(e.destroyed)throw new Error("Worker was destroyed");return t}))}exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const PDFDocumentLoadingTask=function(){let e=0;return class{constructor(){this._capability=(0,_util.createPromiseCapability)(),this._transport=null,this._worker=null,this.docId="d"+e++,this.destroyed=!1,this.onPassword=null,this.onProgress=null,this.onUnsupportedFeature=null}get promise(){return this._capability.promise}destroy(){this.destroyed=!0;const e=this._transport?this._transport.destroy():Promise.resolve();return e.then(()=>{this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)})}}}();class PDFDataRangeTransport{constructor(e,t,n=!1){this.length=e,this.initialData=t,this.progressiveDone=n,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=(0,_util.createPromiseCapability)()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const n of this._rangeListeners)n(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(const n of this._progressListeners)n(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(const t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}get numPages(){return this._pdfInfo.numPages}get fingerprint(){return this._pdfInfo.fingerprint}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}getStats(){return this._transport.getStats()}cleanup(){return this._transport.startCleanup()}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}saveDocument(e){return this._transport.saveDocument(e)}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(e,t,n,r,i=!1){this._pageIndex=e,this._pageInfo=t,this._ownerDocument=r,this._transport=n,this._stats=i?new _display_utils.StatTimer:null,this._pdfBug=i,this.commonObjs=n.commonObjs,this.objs=new PDFObjects,this.cleanupAfterRender=!1,this.pendingCleanup=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:r=0,dontFlip:i=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:i})}getAnnotations({intent:e=null}={}){return this.annotationsPromise&&this.annotationsIntent===e||(this.annotationsPromise=this._transport.getAnnotations(this._pageIndex,e),this.annotationsIntent=e),this.annotationsPromise}getJSActions(){return this._jsActionsPromise||(this._jsActionsPromise=this._transport.getPageJSActions(this._pageIndex))}render({canvasContext:e,viewport:t,intent:n="display",enableWebGL:r=!1,renderInteractiveForms:i=!1,transform:o=null,imageLayer:s=null,canvasFactory:a=null,background:l=null,annotationStorage:c=null,optionalContentConfigPromise:u=null}){this._stats&&this._stats.time("Overall");const d="print"===n?"print":"display";this.pendingCleanup=!1,u||(u=this._transport.getOptionalContentConfig());let h=this._intentStates.get(d);h||(h=Object.create(null),this._intentStates.set(d,h)),h.streamReaderCancelTimeout&&(clearTimeout(h.streamReaderCancelTimeout),h.streamReaderCancelTimeout=null);const p=a||new DefaultCanvasFactory({ownerDocument:this._ownerDocument}),f=new _webgl.WebGLContext({enable:r});h.displayReadyCapability||(h.displayReadyCapability=(0,_util.createPromiseCapability)(),h.operatorList={fnArray:[],argsArray:[],lastChunk:!1},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList({pageIndex:this._pageIndex,intent:d,renderInteractiveForms:!0===i,annotationStorage:c&&c.getAll()||null}));const m=e=>{const t=h.renderTasks.indexOf(g);t>=0&&h.renderTasks.splice(t,1),(this.cleanupAfterRender||"print"===d)&&(this.pendingCleanup=!0),this._tryCleanup(),e?(g.capability.reject(e),this._abortOperatorList({intentState:h,reason:e})):g.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"))},g=new InternalRenderTask({callback:m,params:{canvasContext:e,viewport:t,transform:o,imageLayer:s,background:l},objs:this.objs,commonObjs:this.commonObjs,operatorList:h.operatorList,pageIndex:this._pageIndex,canvasFactory:p,webGLContext:f,useRequestAnimationFrame:"print"!==d,pdfBug:this._pdfBug});h.renderTasks||(h.renderTasks=[]),h.renderTasks.push(g);const b=g.task;return Promise.all([h.displayReadyCapability.promise,u]).then(([e,t])=>{this.pendingCleanup?m():(this._stats&&this._stats.time("Rendering"),g.initializeGraphics({transparency:e,optionalContentConfig:t}),g.operatorListChanged())}).catch(m),b}getOperatorList(){let e,t=this._intentStates.get("oplist");return t||(t=Object.create(null),this._intentStates.set("oplist",t)),t.opListReadCapability||((e=Object.create(null)).operatorListChanged=function(){if(t.operatorList.lastChunk){t.opListReadCapability.resolve(t.operatorList);const n=t.renderTasks.indexOf(e);n>=0&&t.renderTasks.splice(n,1)}},t.opListReadCapability=(0,_util.createPromiseCapability)(),t.renderTasks=[],t.renderTasks.push(e),t.operatorList={fnArray:[],argsArray:[],lastChunk:!1},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList({pageIndex:this._pageIndex,intent:"oplist"})),t.opListReadCapability.promise}streamTextContent({normalizeWhitespace:e=!1,disableCombineTextItems:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,normalizeWhitespace:!0===e,combineTextItems:!0!==t},{highWaterMark:100,size:e=>e.items.length})}getTextContent(e={}){const t=this.streamTextContent(e);return new Promise(function(e,n){const r=t.getReader(),i={items:[],styles:Object.create(null)};!function t(){r.read().then(function({value:n,done:r}){r?e(i):(Object.assign(i.styles,n.styles),i.items.push(...n.items),t())},n)}()})}_destroy(){this.destroyed=!0,this._transport.pageCache[this._pageIndex]=null;const e=[];for(const[t,n]of this._intentStates)if(this._abortOperatorList({intentState:n,reason:new Error("Page was destroyed."),force:!0}),"oplist"!==t)for(const t of n.renderTasks)e.push(t.completed),t.cancel();return this.objs.clear(),this.annotationsPromise=null,this._jsActionsPromise=null,this.pendingCleanup=!1,Promise.all(e)}cleanup(e=!1){return this.pendingCleanup=!0,this._tryCleanup(e)}_tryCleanup(e=!1){if(!this.pendingCleanup)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(0!==e.length||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.annotationsPromise=null,this._jsActionsPromise=null,e&&this._stats&&(this._stats=new _display_utils.StatTimer),this.pendingCleanup=!1,!0}_startRenderPage(e,t){const n=this._intentStates.get(t);n&&(this._stats&&this._stats.timeEnd("Page Request"),n.displayReadyCapability&&n.displayReadyCapability.resolve(e))}_renderPageChunk(e,t){for(let n=0,r=e.length;n<r;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk;for(let e=0;e<t.renderTasks.length;e++)t.renderTasks[e].operatorListChanged();e.lastChunk&&this._tryCleanup()}_pumpOperatorList(e){(0,_util.assert)(e.intent,'PDFPageProxy._pumpOperatorList: Expected "intent" argument.');const t=this._transport.messageHandler.sendWithStream("GetOperatorList",e),n=t.getReader(),r=this._intentStates.get(e.intent);r.streamReader=n;const i=()=>{n.read().then(({value:e,done:t})=>{t?r.streamReader=null:this._transport.destroyed||(this._renderPageChunk(e,r),i())},e=>{if(r.streamReader=null,!this._transport.destroyed){if(r.operatorList){r.operatorList.lastChunk=!0;for(let e=0;e<r.renderTasks.length;e++)r.renderTasks[e].operatorListChanged();this._tryCleanup()}if(r.displayReadyCapability)r.displayReadyCapability.reject(e);else{if(!r.opListReadCapability)throw e;r.opListReadCapability.reject(e)}}})};i()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if((0,_util.assert)(t instanceof Error||"object"==typeof t&&null!==t,'PDFPageProxy._abortOperatorList: Expected "reason" argument.'),e.streamReader){if(!n){if(0!==e.renderTasks.length)return;if(t instanceof _display_utils.RenderingCancelledException)return void(e.streamReaderCancelTimeout=setTimeout(()=>{this._abortOperatorList({intentState:e,reason:t,force:!0}),e.streamReaderCancelTimeout=null},RENDERING_CANCELLED_TIMEOUT))}if(e.streamReader.cancel(new _util.AbortException(t&&t.message)),e.streamReader=null,!this._transport.destroyed){for(const[t,n]of this._intentStates)if(n===e){this._intentStates.delete(t);break}this.cleanup()}}}get stats(){return this._stats}}exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(e=!0){this._listeners=[],this._defer=e,this._deferred=Promise.resolve(void 0)}postMessage(e,t){if(!this._defer)return void this._listeners.forEach(t=>{t.call(this,{data:e})});const n=new WeakMap,r={data:function e(r){if("object"!=typeof r||null===r)return r;if(n.has(r))return n.get(r);let i,o;if((i=r.buffer)&&(0,_util.isArrayBuffer)(i))return o=t&&t.includes(i)?new r.constructor(i,r.byteOffset,r.byteLength):new r.constructor(r),n.set(r,o),o;o=Array.isArray(r)?[]:{};n.set(r,o);for(const t in r){let n,i=r;for(;!(n=Object.getOwnPropertyDescriptor(i,t));)i=Object.getPrototypeOf(i);if(void 0!==n.value)if("function"!=typeof n.value)o[t]=e(n.value);else if(r.hasOwnProperty&&r.hasOwnProperty(t))throw new Error(`LoopbackPort.postMessage - cannot clone: ${r[t]}`)}return o}(e)};this._deferred.then(()=>{this._listeners.forEach(e=>{e.call(this,r)})})}addEventListener(e,t){this._listeners.push(t)}removeEventListener(e,t){const n=this._listeners.indexOf(t);this._listeners.splice(n,1)}terminate(){this._listeners.length=0}}exports.LoopbackPort=LoopbackPort;const PDFWorker=function PDFWorkerClosure(){const pdfWorkerPorts=new WeakMap;let isWorkerDisabled=!1,fallbackWorkerSrc,nextFakeWorkerId=0,fakeWorkerCapability;if(_is_node.isNodeJS&&"function"==typeof require)isWorkerDisabled=!0,fallbackWorkerSrc="./skylark-pdfjs-worker-all.js";else if("object"==typeof document&&"currentScript"in document){const e=document.currentScript&&document.currentScript.src;e&&(fallbackWorkerSrc=e.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}function getWorkerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(void 0!==fallbackWorkerSrc)return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}function getMainThreadWorkerMessageHandler(){let e;try{e=pdfjs.worker.WorkerMessageHandler}catch(e){}return e||null}function setupFakeWorkerGlobal(){if(fakeWorkerCapability)return fakeWorkerCapability.promise;fakeWorkerCapability=(0,_util.createPromiseCapability)();const loader=async function(){const mainWorkerMessageHandler=getMainThreadWorkerMessageHandler();if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_is_node.isNodeJS&&"function"==typeof require){const worker=eval("require")(getWorkerSrc());return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(getWorkerSrc()),window.pdfjsWorker.WorkerMessageHandler};return loader().then(fakeWorkerCapability.resolve,fakeWorkerCapability.reject),fakeWorkerCapability.promise}function createCDNWrapper(e){const t="importScripts('"+e+"');";return URL.createObjectURL(new Blob([t]))}class PDFWorker{constructor({name:e=null,port:t=null,verbosity:n=(0,_util.getVerbosityLevel)()}={}){if(t&&pdfWorkerPorts.has(t))throw new Error("Cannot use more than one PDFWorker per port");if(this.name=e,this.destroyed=!1,this.postMessageTransfers=!0,this.verbosity=n,this._readyCapability=(0,_util.createPromiseCapability)(),this._port=null,this._webWorker=null,this._messageHandler=null,t)return pdfWorkerPorts.set(t,this),void this._initializeFromPort(t);this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new _message_handler.MessageHandler("main","worker",e),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve()}_initialize(){if("undefined"!=typeof Worker&&!isWorkerDisabled&&!getMainThreadWorkerMessageHandler()){let e=getWorkerSrc();try{(0,_util.isSameOrigin)(window.location.href,e)||(e=createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e),n=new _message_handler.MessageHandler("main","worker",t),r=()=>{t.removeEventListener("error",i),n.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},i=()=>{this._webWorker||r()};t.addEventListener("error",i),n.on("test",e=>{t.removeEventListener("error",i),this.destroyed?r():e?(this._messageHandler=n,this._port=t,this._webWorker=t,e.supportTransfers||(this.postMessageTransfers=!1),this._readyCapability.resolve(),n.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),n.destroy(),t.terminate())}),n.on("ready",e=>{if(t.removeEventListener("error",i),this.destroyed)r();else try{o()}catch(e){this._setupFakeWorker()}});const o=()=>{const e=new Uint8Array([this.postMessageTransfers?255:0]);try{n.send("test",e,[e.buffer])}catch(t){(0,_util.warn)("Cannot use postMessage transfers."),e[0]=0,n.send("test",e)}};return void o()}catch(e){(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),isWorkerDisabled=!0),setupFakeWorkerGlobal().then(e=>{if(this.destroyed)return void this._readyCapability.reject(new Error("Worker was destroyed"));const t=new LoopbackPort;this._port=t;const n="fake"+nextFakeWorkerId++,r=new _message_handler.MessageHandler(n+"_worker",n,t);e.setup(r,t);const i=new _message_handler.MessageHandler(n,n+"_worker",t);this._messageHandler=i,this._readyCapability.resolve(),i.send("configure",{verbosity:this.verbosity})}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),pdfWorkerPorts.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(e){if(!e||!e.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return pdfWorkerPorts.has(e.port)?pdfWorkerPorts.get(e.port):new PDFWorker(e)}static getWorkerSrc(){return getWorkerSrc()}}return PDFWorker}();exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(e,t,n,r){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({docId:t.docId,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),ownerDocument:r.ownerDocument}),this._params=r,this.CMapReaderFactory=new r.CMapReaderFactory({baseUrl:r.cMapUrl,isCompressed:r.cMapPacked}),this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.pageCache=[],this.pagePromises=[],this.downloadInfoCapability=(0,_util.createPromiseCapability)(),this.setupMessageHandler()}get loadingTaskSettled(){return this.loadingTask._capability.settled}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=(0,_util.createPromiseCapability)(),this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];this.pageCache.forEach(function(t){t&&e.push(t._destroy())}),this.pageCache.length=0,this.pagePromises.length=0;const t=this.messageHandler.sendWithPromise("Terminate",null);if(e.push(t),this.loadingTaskSettled){const t=this.loadingTask.promise.then(e=>{e.hasOwnProperty("annotationStorage")&&e.annotationStorage.resetModified()}).catch(()=>{});e.push(t)}return Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this._hasJSActionsPromise=null,this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(e,t)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=(e=>{this._lastProgress={loaded:e.loaded,total:e.total}}),t.onPull=(()=>{this._fullReader.read().then(function({value:e,done:n}){n?t.close():((0,_util.assert)((0,_util.isArrayBuffer)(e),"GetReader - expected an ArrayBuffer."),t.enqueue(new Uint8Array(e),1,[e]))}).catch(e=>{t.error(e)})}),t.onCancel=(e=>{this._fullReader.cancel(e),t.ready.catch(e=>{if(!this.destroyed)throw e})})}),e.on("ReaderHeadersReady",e=>{const n=(0,_util.createPromiseCapability)(),r=this._fullReader;return r.headersReady.then(()=>{r.isStreamingSupported&&r.isRangeSupported||(this._lastProgress&&t.onProgress&&t.onProgress(this._lastProgress),r.onProgress=(e=>{t.onProgress&&t.onProgress({loaded:e.loaded,total:e.total})})),n.resolve({isStreamingSupported:r.isStreamingSupported,isRangeSupported:r.isRangeSupported,contentLength:r.contentLength})},n.reject),n.promise}),e.on("GetRangeReader",(e,t)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(e.begin,e.end);n?(t.onPull=(()=>{n.read().then(function({value:e,done:n}){n?t.close():((0,_util.assert)((0,_util.isArrayBuffer)(e),"GetRangeReader - expected an ArrayBuffer."),t.enqueue(new Uint8Array(e),1,[e]))}).catch(e=>{t.error(e)})}),t.onCancel=(e=>{n.cancel(e),t.ready.catch(e=>{if(!this.destroyed)throw e})})):t.close()}),e.on("GetDoc",({pdfInfo:e})=>{this._numPages=e.numPages,t._capability.resolve(new PDFDocumentProxy(e,this))}),e.on("DocException",function(e){let n;switch(e.name){case"PasswordException":n=new _util.PasswordException(e.message,e.code);break;case"InvalidPDFException":n=new _util.InvalidPDFException(e.message);break;case"MissingPDFException":n=new _util.MissingPDFException(e.message);break;case"UnexpectedResponseException":n=new _util.UnexpectedResponseException(e.message,e.status);break;case"UnknownErrorException":n=new _util.UnknownErrorException(e.message,e.details)}if(!(n instanceof Error)){const e="DocException - expected a valid Error.";(0,_util.warn)(e)}t._capability.reject(n)}),e.on("PasswordRequest",e=>{if(this._passwordCapability=(0,_util.createPromiseCapability)(),t.onPassword){const n=e=>{this._passwordCapability.resolve({password:e})};try{t.onPassword(n,e.code)}catch(e){this._passwordCapability.reject(e)}}else this._passwordCapability.reject(new _util.PasswordException(e.message,e.code));return this._passwordCapability.promise}),e.on("DataLoaded",e=>{t.onProgress&&t.onProgress({loaded:e.length,total:e.length}),this.downloadInfoCapability.resolve(e)}),e.on("StartRenderPage",e=>{if(this.destroyed)return;const t=this.pageCache[e.pageIndex];t._startRenderPage(e.transparency,e.intent)}),e.on("commonobj",t=>{if(this.destroyed)return;const[n,r,i]=t;if(!this.commonObjs.has(n))switch(r){case"Font":const t=this._params;if("error"in i){const e=i.error;(0,_util.warn)(`Error during font loading: ${e}`),this.commonObjs.resolve(n,e);break}let o=null;t.pdfBug&&globalThis.FontInspector&&globalThis.FontInspector.enabled&&(o={registerFont(e,t){globalThis.FontInspector.fontAdded(e,t)}});const s=new _font_loader.FontFaceObject(i,{isEvalSupported:t.isEvalSupported,disableFontFace:t.disableFontFace,ignoreErrors:t.ignoreErrors,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),fontRegistry:o});this.fontLoader.bind(s).catch(t=>e.sendWithPromise("FontFallback",{id:n})).finally(()=>{!t.fontExtraProperties&&s.data&&(s.data=null),this.commonObjs.resolve(n,s)});break;case"FontPath":case"Image":this.commonObjs.resolve(n,i);break;default:throw new Error(`Got unknown common object type ${r}`)}}),e.on("obj",e=>{if(this.destroyed)return;const[t,n,r,i]=e,o=this.pageCache[n];if(!o.objs.has(t))switch(r){case"Image":o.objs.resolve(t,i);const e=8e6;i&&i.data&&i.data.length>e&&(o.cleanupAfterRender=!0);break;default:throw new Error(`Got unknown object type ${r}`)}}),e.on("DocProgress",e=>{this.destroyed||t.onProgress&&t.onProgress({loaded:e.loaded,total:e.total})}),e.on("UnsupportedFeature",this._onUnsupportedFeature.bind(this)),e.on("FetchBuiltInCMap",(e,t)=>{if(this.destroyed)return void t.error(new Error("Worker was destroyed"));let n=!1;t.onPull=(()=>{n?t.close():(n=!0,this.CMapReaderFactory.fetch(e).then(function(e){t.enqueue(e,1,[e.cMapData.buffer])}).catch(function(e){t.error(e)}))})})}_onUnsupportedFeature({featureId:e}){this.destroyed||this.loadingTask.onUnsupportedFeature&&this.loadingTask.onUnsupportedFeature(e)}getData(){return this.messageHandler.sendWithPromise("GetData",null)}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request"));const t=e-1;if(t in this.pagePromises)return this.pagePromises[t];const n=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(e=>{if(this.destroyed)throw new Error("Transport destroyed");const n=new PDFPageProxy(t,e,this,this._params.ownerDocument,this._params.pdfBug);return this.pageCache[t]=n,n});return this.pagePromises[t]=n,n}getPageIndex(e){return this.messageHandler.sendWithPromise("GetPageIndex",{ref:e}).catch(function(e){return Promise.reject(new Error(e))})}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}saveDocument(e){return this.messageHandler.sendWithPromise("SaveDocument",{numPages:this._numPages,annotationStorage:e&&e.getAll()||null,filename:this._fullReader&&this._fullReader.filename||null}).finally(()=>{e&&e.resetModified()})}getFieldObjects(){return this.messageHandler.sendWithPromise("GetFieldObjects",null)}hasJSActions(){return this._hasJSActionsPromise||(this._hasJSActionsPromise=this.messageHandler.sendWithPromise("HasJSActions",null))}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return"string"!=typeof e?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(e=>new _optional_content_config.OptionalContentConfig(e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){return this.messageHandler.sendWithPromise("GetMetadata",null).then(e=>({info:e[0],metadata:e[1]?new _metadata.Metadata(e[1]):null,contentDispositionFilename:this._fullReader&&this._fullReader.filename||null,contentLength:this._fullReader&&this._fullReader.contentLength||null}))}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}getStats(){return this.messageHandler.sendWithPromise("GetStats",null)}startCleanup(){return this.messageHandler.sendWithPromise("Cleanup",null).then(()=>{for(let e=0,t=this.pageCache.length;e<t;e++){const t=this.pageCache[e];if(t){const n=t.cleanup();if(!n)throw new Error(`startCleanup: Page ${e+1} is currently rendering.`)}}this.commonObjs.clear(),this.fontLoader.clear(),this._hasJSActionsPromise=null})}get loadingParams(){const e=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:e.disableAutoFetch,disableFontFace:e.disableFontFace})}}class PDFObjects{constructor(){this._objs=Object.create(null)}_ensureObj(e){return this._objs[e]?this._objs[e]:this._objs[e]={capability:(0,_util.createPromiseCapability)(),data:null,resolved:!1}}get(e,t=null){if(t)return this._ensureObj(e).capability.promise.then(t),null;const n=this._objs[e];if(!n||!n.resolved)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){const t=this._objs[e];return t&&t.resolved||!1}resolve(e,t){const n=this._ensureObj(e);n.resolved=!0,n.data=t,n.capability.resolve(t)}clear(){this._objs=Object.create(null)}}class RenderTask{constructor(e){this._internalRenderTask=e,this.onContinue=null}get promise(){return this._internalRenderTask.capability.promise}cancel(){this._internalRenderTask.cancel()}}const InternalRenderTask=function(){const e=new WeakSet;return class{constructor({callback:e,params:t,objs:n,commonObjs:r,operatorList:i,pageIndex:o,canvasFactory:s,webGLContext:a,useRequestAnimationFrame:l=!1,pdfBug:c=!1}){this.callback=e,this.params=t,this.objs=n,this.commonObjs=r,this.operatorListIdx=null,this.operatorList=i,this._pageIndex=o,this.canvasFactory=s,this.webGLContext=a,this._pdfBug=c,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===l&&"undefined"!=typeof window,this.cancelled=!1,this.capability=(0,_util.createPromiseCapability)(),this.task=new RenderTask(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:n}){if(this.cancelled)return;if(this._canvas){if(e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager&&globalThis.StepperManager.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:r,viewport:i,transform:o,imageLayer:s,background:a}=this.params;this.gfx=new _canvas.CanvasGraphics(r,this.commonObjs,this.objs,this.canvasFactory,this.webGLContext,s,n),this.gfx.beginDrawing({transform:o,viewport:i,transparency:t,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback&&this.graphicsReadyCallback()}cancel(t=null){this.running=!1,this.cancelled=!0,this.gfx&&this.gfx.endDrawing(),this._canvas&&e.delete(this._canvas),this.callback(t||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,"canvas"))}operatorListChanged(){this.graphicsReady?(this.stepper&&this.stepper.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound)}_continue(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this.cancel.bind(this))}):Promise.resolve().then(this._nextBound).catch(this.cancel.bind(this))}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),this._canvas&&e.delete(this._canvas),this.callback())))}}}(),version="2.7.570";exports.version=version;const build="f2c7338b0";exports.build=build},(e,exports,t)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.FontLoader=exports.FontFaceObject=void 0;var n=t(2);class r{constructor({docId:e,onUnsupportedFeature:t,ownerDocument:i=globalThis.document}){this.constructor===r&&(0,n.unreachable)("Cannot initialize BaseFontLoader."),this.docId=e,this._onUnsupportedFeature=t,this._document=i,this.nativeFontFaces=[],this.styleElement=null}addNativeFontFace(e){this.nativeFontFaces.push(e),this._document.fonts.add(e)}insertRule(e){let t=this.styleElement;t||((t=this.styleElement=this._document.createElement("style")).id=`PDFJS_FONT_STYLE_TAG_${this.docId}`,this._document.documentElement.getElementsByTagName("head")[0].appendChild(t));const n=t.sheet;n.insertRule(e,n.cssRules.length)}clear(){this.nativeFontFaces.forEach(e=>{this._document.fonts.delete(e)}),this.nativeFontFaces.length=0,this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async bind(e){if(e.attached||e.missingFile)return;if(e.attached=!0,this.isFontLoadingAPISupported){const t=e.createNativeFontFace();if(t){this.addNativeFontFace(t);try{await t.loaded}catch(r){throw this._onUnsupportedFeature({featureId:n.UNSUPPORTED_FEATURES.errorFontLoadNative}),(0,n.warn)(`Failed to load font '${t.family}': '${r}'.`),e.disableFontFace=!0,r}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const r=this._queueLoadingCallback(n);this._prepareFontLoadEvent([t],[e],r)})}}_queueLoadingCallback(e){(0,n.unreachable)("Abstract method `_queueLoadingCallback`.")}get isFontLoadingAPISupported(){return(0,n.shadow)(this,"isFontLoadingAPISupported",!(!this._document||!this._document.fonts))}get isSyncFontLoadingSupported(){(0,n.unreachable)("Abstract method `isSyncFontLoadingSupported`.")}get _loadTestFont(){(0,n.unreachable)("Abstract method `_loadTestFont`.")}_prepareFontLoadEvent(e,t,r){(0,n.unreachable)("Abstract method `_prepareFontLoadEvent`.")}}let i;exports.FontLoader=i,exports.FontLoader=i=class extends r{constructor(e){super(e),this.loadingContext={requests:[],nextRequestId:0},this.loadTestFontId=0}get isSyncFontLoadingSupported(){let e=!1;if("undefined"==typeof navigator)e=!0;else{const t=/Mozilla\/5.0.*?rv:(\d+).*? Gecko/.exec(navigator.userAgent);t&&t[1]>=14&&(e=!0)}return(0,n.shadow)(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){const t=this.loadingContext,r={id:`pdfjs-font-loading-${t.nextRequestId++}`,done:!1,complete:function(){(0,n.assert)(!r.done,"completeRequest() cannot be called twice."),r.done=!0;for(;t.requests.length>0&&t.requests[0].done;){const e=t.requests.shift();setTimeout(e.callback,0)}},callback:e};return t.requests.push(r),r}get _loadTestFont(){return(0,n.shadow)(this,"_loadTestFont",atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA=="))}_prepareFontLoadEvent(e,t,r){function i(e,t){return e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|255&e.charCodeAt(t+3)}function o(e,t,n,r){const i=e.substring(0,t),o=e.substring(t+n);return i+r+o}let s,a;const l=this._document.createElement("canvas");l.width=1,l.height=1;const c=l.getContext("2d");let u=0;const d=`lt${Date.now()}${this.loadTestFontId++}`;let h=this._loadTestFont;let p=i(h=o(h,976,d.length,d),16);for(s=0,a=d.length-3;s<a;s+=4)p=p-1482184792+i(d,s)|0;s<d.length&&(p=p-1482184792+i(d+"XXX",s)|0),h=o(h,16,4,(0,n.string32)(p));const f=`url(data:font/opentype;base64,${btoa(h)});`,m=`@font-face {font-family:"${d}";src:${f}}`;this.insertRule(m);const g=[];for(s=0,a=t.length;s<a;s++)g.push(t[s].loadedName);g.push(d);const b=this._document.createElement("div");for(b.style.visibility="hidden",b.style.width=b.style.height="10px",b.style.position="absolute",b.style.top=b.style.left="0px",s=0,a=g.length;s<a;++s){const e=this._document.createElement("span");e.textContent="Hi",e.style.fontFamily=g[s],b.appendChild(e)}this._document.body.appendChild(b),function e(t,r){u++;if(u>30)return(0,n.warn)("Load test font never loaded."),void r();c.font="30px "+t;c.fillText(".",0,20);const i=c.getImageData(0,0,1,1);if(i.data[3]>0)return void r();setTimeout(e.bind(null,t,r))}(d,()=>{this._document.body.removeChild(b),r.complete()})}};exports.FontFaceObject=class{constructor(e,{isEvalSupported:t=!0,disableFontFace:n=!1,ignoreErrors:r=!1,onUnsupportedFeature:i=null,fontRegistry:o=null}){this.compiledGlyphs=Object.create(null);for(const t in e)this[t]=e[t];this.isEvalSupported=!1!==t,this.disableFontFace=!0===n,this.ignoreErrors=!0===r,this._onUnsupportedFeature=i,this.fontRegistry=o}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;const e=new FontFace(this.loadedName,this.data,{});return this.fontRegistry&&this.fontRegistry.registerFont(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const e=(0,n.bytesToString)(new Uint8Array(this.data)),t=`url(data:${this.mimetype};base64,${btoa(e)});`,r=`@font-face {font-family:"${this.loadedName}";src:${t}}`;return this.fontRegistry&&this.fontRegistry.registerFont(this,t),r}getPathGenerator(e,t){if(void 0!==this.compiledGlyphs[t])return this.compiledGlyphs[t];let r,i;try{r=e.get(this.loadedName+"_path_"+t)}catch(e){if(!this.ignoreErrors)throw e;return this._onUnsupportedFeature&&this._onUnsupportedFeature({featureId:n.UNSUPPORTED_FEATURES.errorFontGetPath}),(0,n.warn)(`getPathGenerator - ignoring character: "${e}".`),this.compiledGlyphs[t]=function(e,t){}}if(this.isEvalSupported&&n.IsEvalSupportedCached.value){let e,n="";for(let t=0,o=r.length;t<o;t++)i=r[t],e=void 0!==i.args?i.args.join(","):"",n+="c."+i.cmd+"("+e+");\n";return this.compiledGlyphs[t]=new Function("c","size",n)}return this.compiledGlyphs[t]=function(e,t){for(let n=0,o=r.length;n<o;n++)"scale"===(i=r[n]).cmd&&(i.args=[t,-t]),e[i.cmd].apply(e,i.args)}}}},(e,exports,t)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.NodeCMapReaderFactory=exports.NodeCanvasFactory=void 0;var n=t(1),r=t(4),i=t(2);let o=class{constructor(){(0,i.unreachable)("Not implemented: NodeCanvasFactory")}};exports.NodeCanvasFactory=o;let s=class{constructor(){(0,i.unreachable)("Not implemented: NodeCMapReaderFactory")}};exports.NodeCMapReaderFactory=s,r.isNodeJS&&(exports.NodeCanvasFactory=o=class extends n.BaseCanvasFactory{create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const n=require("canvas"),r=n.createCanvas(e,t);return{canvas:r,context:r.getContext("2d")}}},exports.NodeCMapReaderFactory=s=class extends n.BaseCMapReaderFactory{_fetchData(e,t){return new Promise((n,r)=>{const i=require("fs");i.readFile(e,(e,i)=>{!e&&i?n({cMapData:new Uint8Array(i),compressionType:t}):r(new Error(e))})})}})},(e,exports,t)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.AnnotationStorage=void 0;var n=t(2);exports.AnnotationStorage=class{constructor(){this._storage=new Map,this._modified=!1,this.onSetModified=null,this.onResetModified=null}getOrCreateValue(e,t){return this._storage.has(e)?this._storage.get(e):(this._storage.set(e,t),t)}setValue(e,t){const n=this._storage.get(e);let r=!1;if(void 0!==n)for(const[e,i]of Object.entries(t))n[e]!==i&&(r=!0,n[e]=i);else this._storage.set(e,t),r=!0;r&&this._setModified()}getAll(){return 0===this._storage.size?null:(0,n.objectFromEntries)(this._storage)}get size(){return this._storage.size}_setModified(){this._modified||(this._modified=!0,"function"==typeof this.onSetModified&&this.onSetModified())}resetModified(){this._modified&&(this._modified=!1,"function"==typeof this.onResetModified&&this.onResetModified())}}},(e,exports,t)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.apiCompatibilityParams=void 0;var n=t(4);const r=Object.create(null);n.isNodeJS&&(r.disableFontFace=!0);const i=Object.freeze(r);exports.apiCompatibilityParams=i},(e,exports,t)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.CanvasGraphics=void 0;var n=t(2),r=t(11);const i=16;function o(e){e.mozCurrentTransform||(e._originalSave=e.save,e._originalRestore=e.restore,e._originalRotate=e.rotate,e._originalScale=e.scale,e._originalTranslate=e.translate,e._originalTransform=e.transform,e._originalSetTransform=e.setTransform,e._transformMatrix=e._transformMatrix||[1,0,0,1,0,0],e._transformStack=[],Object.defineProperty(e,"mozCurrentTransform",{get:function(){return this._transformMatrix}}),Object.defineProperty(e,"mozCurrentTransformInverse",{get:function(){const e=this._transformMatrix,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=t*i-n*r,l=n*r-t*i;return[i/a,n/l,r/l,t/a,(i*o-r*s)/l,(n*o-t*s)/a]}}),e.save=function(){const e=this._transformMatrix;this._transformStack.push(e),this._transformMatrix=e.slice(0,6),this._originalSave()},e.restore=function(){const e=this._transformStack.pop();e&&(this._transformMatrix=e,this._originalRestore())},e.translate=function(e,t){const n=this._transformMatrix;n[4]=n[0]*e+n[2]*t+n[4],n[5]=n[1]*e+n[3]*t+n[5],this._originalTranslate(e,t)},e.scale=function(e,t){const n=this._transformMatrix;n[0]=n[0]*e,n[1]=n[1]*e,n[2]=n[2]*t,n[3]=n[3]*t,this._originalScale(e,t)},e.transform=function(t,n,r,i,o,s){const a=this._transformMatrix;this._transformMatrix=[a[0]*t+a[2]*n,a[1]*t+a[3]*n,a[0]*r+a[2]*i,a[1]*r+a[3]*i,a[0]*o+a[2]*s+a[4],a[1]*o+a[3]*s+a[5]],e._originalTransform(t,n,r,i,o,s)},e.setTransform=function(t,n,r,i,o,s){this._transformMatrix=[t,n,r,i,o,s],e._originalSetTransform(t,n,r,i,o,s)},e.rotate=function(e){const t=Math.cos(e),n=Math.sin(e),r=this._transformMatrix;this._transformMatrix=[r[0]*t+r[2]*n,r[1]*t+r[3]*n,r[0]*-n+r[2]*t,r[1]*-n+r[3]*t,r[4],r[5]],this._originalRotate(e)})}const s=function(){function e(e){this.canvasFactory=e,this.cache=Object.create(null)}return e.prototype={getCanvas:function(e,t,n,r){let i;return void 0!==this.cache[e]?(i=this.cache[e],this.canvasFactory.reset(i,t,n),i.context.setTransform(1,0,0,1,0,0)):(i=this.canvasFactory.create(t,n),this.cache[e]=i),r&&o(i.context),i},clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}},e}();const a=function(){function e(){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=n.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=n.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=n.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.resumeSMaskCtx=null,this.transferMaps=null}return e.prototype={clone:function(){return Object.create(this)},setCurrentPoint:function(e,t){this.x=e,this.y=t}},e}(),l=function(){function e(e,t,n,r,i,l,c){this.ctx=e,this.current=new a,this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=r,this.webGLContext=i,this.imageLayer=l,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.contentVisible=!0,this.markedContentStack=[],this.optionalContentConfig=c,this.cachedCanvases=new s(this.canvasFactory),e&&o(e),this._cachedGetSinglePixelWidth=null}function t(e,t,r=null){if("undefined"!=typeof ImageData&&t instanceof ImageData)return void e.putImageData(t,0,0);const o=t.height,s=t.width,a=o%i,l=(o-a)/i,c=0===a?l:l+1,u=e.createImageData(s,i);let d,h=0;const p=t.data,f=u.data;let m,g,b,y,v,S,C,x;if(r)switch(r.length){case 1:v=r[0],S=r[0],C=r[0],x=r[0];break;case 4:v=r[0],S=r[1],C=r[2],x=r[3]}if(t.kind===n.ImageKind.GRAYSCALE_1BPP){const t=p.byteLength,r=new Uint32Array(f.buffer,0,f.byteLength>>2),o=r.length,y=s+7>>3;let v=4294967295,S=n.IsLittleEndianCached.value?4278190080:255;for(x&&255===x[0]&&0===x[255]&&([v,S]=[S,v]),m=0;m<c;m++){for(b=m<l?i:a,d=0,g=0;g<b;g++){const e=t-h;let n=0;const i=e>y?s:8*e-7,o=-8&i;let a=0,l=0;for(;n<o;n+=8)l=p[h++],r[d++]=128&l?v:S,r[d++]=64&l?v:S,r[d++]=32&l?v:S,r[d++]=16&l?v:S,r[d++]=8&l?v:S,r[d++]=4&l?v:S,r[d++]=2&l?v:S,r[d++]=1&l?v:S;for(;n<i;n++)0===a&&(l=p[h++],a=128),r[d++]=l&a?v:S,a>>=1}for(;d<o;)r[d++]=0;e.putImageData(u,0,m*i)}}else if(t.kind===n.ImageKind.RGBA_32BPP){const t=!!(v||S||C);for(g=0,y=s*i*4,m=0;m<l;m++){if(f.set(p.subarray(h,h+y)),h+=y,t)for(let e=0;e<y;e+=4)v&&(f[e+0]=v[f[e+0]]),S&&(f[e+1]=S[f[e+1]]),C&&(f[e+2]=C[f[e+2]]);e.putImageData(u,0,g),g+=i}if(m<c){if(y=s*a*4,f.set(p.subarray(h,h+y)),t)for(let e=0;e<y;e+=4)v&&(f[e+0]=v[f[e+0]]),S&&(f[e+1]=S[f[e+1]]),C&&(f[e+2]=C[f[e+2]]);e.putImageData(u,0,g)}}else{if(t.kind!==n.ImageKind.RGB_24BPP)throw new Error(`bad image kind: ${t.kind}`);{const t=!!(v||S||C);for(y=s*(b=i),m=0;m<c;m++){for(m>=l&&(y=s*(b=a)),d=0,g=y;g--;)f[d++]=p[h++],f[d++]=p[h++],f[d++]=p[h++],f[d++]=255;if(t)for(let e=0;e<d;e+=4)v&&(f[e+0]=v[f[e+0]]),S&&(f[e+1]=S[f[e+1]]),C&&(f[e+2]=C[f[e+2]]);e.putImageData(u,0,m*i)}}}}function l(e,t){const n=t.height,r=t.width,o=n%i,s=(n-o)/i,a=0===o?s:s+1,l=e.createImageData(r,i);let c=0;const u=t.data,d=l.data;for(let t=0;t<a;t++){const n=t<s?i:o;let a=3;for(let e=0;e<n;e++){let e,t=0;for(let n=0;n<r;n++)t||(e=u[c++],t=128),d[a]=e&t?0:255,a+=4,t>>=1}e.putImageData(l,0,t*i)}}function c(e,t){const n=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font"];for(let r=0,i=n.length;r<i;r++){const i=n[r];void 0!==e[i]&&(t[i]=e[i])}void 0!==e.setLineDash&&(t.setLineDash(e.getLineDash()),t.lineDashOffset=e.lineDashOffset)}function u(e){e.strokeStyle="#000000",e.fillStyle="#000000",e.fillRule="nonzero",e.globalAlpha=1,e.lineWidth=1,e.lineCap="butt",e.lineJoin="miter",e.miterLimit=10,e.globalCompositeOperation="source-over",e.font="10px sans-serif",void 0!==e.setLineDash&&(e.setLineDash([]),e.lineDashOffset=0)}function d(e,t,n,r){const i=e.length;for(let o=3;o<i;o+=4){const i=e[o];if(0===i)e[o-3]=t,e[o-2]=n,e[o-1]=r;else if(i<255){const s=255-i;e[o-3]=e[o-3]*i+t*s>>8,e[o-2]=e[o-2]*i+n*s>>8,e[o-1]=e[o-1]*i+r*s>>8}}}function h(e,t,n){const r=e.length;for(let i=3;i<r;i+=4){const r=n?n[e[i]]:e[i];t[i]=t[i]*r*(1/255)|0}}function p(e,t,n){const r=e.length;for(let i=3;i<r;i+=4){const r=77*e[i-3]+152*e[i-2]+28*e[i-1];t[i]=n?t[i]*n[r>>8]>>8:t[i]*r>>16}}function f(e,t,n,r){const i=t.canvas,o=t.context;e.setTransform(t.scaleX,0,0,t.scaleY,t.offsetX,t.offsetY);const s=t.backdrop||null;if(!t.transferMap&&r.isEnabled){const o=r.composeSMask({layer:n.canvas,mask:i,properties:{subtype:t.subtype,backdrop:s}});return e.setTransform(1,0,0,1,0,0),void e.drawImage(o,t.offsetX,t.offsetY)}!function(e,t,n,r,i,o,s){const a=!!o,l=a?o[0]:0,c=a?o[1]:0,u=a?o[2]:0;let f;f="Luminosity"===i?p:h;const m=Math.min(r,Math.ceil(1048576/n));for(let i=0;i<r;i+=m){const o=Math.min(m,r-i),h=e.getImageData(0,i,n,o),p=t.getImageData(0,i,n,o);a&&d(h.data,l,c,u),f(h.data,p.data,s),e.putImageData(p,0,i)}}(o,n,i.width,i.height,t.subtype,s,t.transferMap),e.drawImage(i,0,0)}const m=["butt","round","square"],g=["miter","round","bevel"],b={},y={};e.prototype={beginDrawing({transform:e,viewport:t,transparency:n=!1,background:r=null}){const i=this.ctx.canvas.width,o=this.ctx.canvas.height;if(this.ctx.save(),this.ctx.fillStyle=r||"rgb(255, 255, 255)",this.ctx.fillRect(0,0,i,o),this.ctx.restore(),n){const e=this.cachedCanvases.getCanvas("transparent",i,o,!0);this.compositeCtx=this.ctx,this.transparentCanvas=e.canvas,this.ctx=e.context,this.ctx.save(),this.ctx.transform.apply(this.ctx,this.compositeCtx.mozCurrentTransform)}this.ctx.save(),u(this.ctx),e&&this.ctx.transform.apply(this.ctx,e),this.ctx.transform.apply(this.ctx,t.transform),this.baseTransform=this.ctx.mozCurrentTransform.slice(),this._combinedScaleFactor=Math.hypot(this.baseTransform[0],this.baseTransform[2]),this.imageLayer&&this.imageLayer.beginLayout()},executeOperatorList:function(e,t,r,i){const o=e.argsArray,s=e.fnArray;let a=t||0;const l=o.length;if(l===a)return a;const c=l-a>10&&"function"==typeof r,u=c?Date.now()+15:0;let d=0;const h=this.commonObjs,p=this.objs;let f;for(;;){if(void 0!==i&&a===i.nextBreakPoint)return i.breakIt(a,r),a;if((f=s[a])!==n.OPS.dependency)this[f].apply(this,o[a]);else for(const e of o[a]){const t=e.startsWith("g_")?h:p;if(!t.has(e))return t.get(e,r),a}if(++a===l)return a;if(c&&++d>10){if(Date.now()>u)return r(),a;d=0}}},endDrawing:function(){for(;this.stateStack.length||null!==this.current.activeSMask;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null),this.cachedCanvases.clear(),this.webGLContext.clear(),this.imageLayer&&this.imageLayer.endLayout()},setLineWidth:function(e){this.current.lineWidth=e,this.ctx.lineWidth=e},setLineCap:function(e){this.ctx.lineCap=m[e]},setLineJoin:function(e){this.ctx.lineJoin=g[e]},setMiterLimit:function(e){this.ctx.miterLimit=e},setDash:function(e,t){const n=this.ctx;void 0!==n.setLineDash&&(n.setLineDash(e),n.lineDashOffset=t)},setRenderingIntent(e){},setFlatness(e){},setGState:function(e){for(let t=0,n=e.length;t<n;t++){const n=e[t],r=n[0],i=n[1];switch(r){case"LW":this.setLineWidth(i);break;case"LC":this.setLineCap(i);break;case"LJ":this.setLineJoin(i);break;case"ML":this.setMiterLimit(i);break;case"D":this.setDash(i[0],i[1]);break;case"RI":this.setRenderingIntent(i);break;case"FL":this.setFlatness(i);break;case"Font":this.setFont(i[0],i[1]);break;case"CA":this.current.strokeAlpha=n[1];break;case"ca":this.current.fillAlpha=n[1],this.ctx.globalAlpha=n[1];break;case"BM":this.ctx.globalCompositeOperation=i;break;case"SMask":this.current.activeSMask&&(this.stateStack.length>0&&this.stateStack[this.stateStack.length-1].activeSMask===this.current.activeSMask?this.suspendSMaskGroup():this.endSMaskGroup()),this.current.activeSMask=i?this.tempSMask:null,this.current.activeSMask&&this.beginSMaskGroup(),this.tempSMask=null;break;case"TR":this.current.transferMaps=i}}},beginSMaskGroup:function(){const e=this.current.activeSMask,t=e.canvas.width,n=e.canvas.height,r="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(r,t,n,!0),o=this.ctx,s=o.mozCurrentTransform;this.ctx.save();const a=i.context;a.scale(1/e.scaleX,1/e.scaleY),a.translate(-e.offsetX,-e.offsetY),a.transform.apply(a,s),e.startTransformInverse=a.mozCurrentTransformInverse,c(o,a),this.ctx=a,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(o),this.groupLevel++},suspendSMaskGroup:function(){const e=this.ctx;this.groupLevel--,this.ctx=this.groupStack.pop(),f(this.ctx,this.current.activeSMask,e,this.webGLContext),this.ctx.restore(),this.ctx.save(),c(e,this.ctx),this.current.resumeSMaskCtx=e;const t=n.Util.transform(this.current.activeSMask.startTransformInverse,e.mozCurrentTransform);this.ctx.transform.apply(this.ctx,t),e.save(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.restore()},resumeSMaskGroup:function(){const e=this.current.resumeSMaskCtx,t=this.ctx;this.ctx=e,this.groupStack.push(t),this.groupLevel++},endSMaskGroup:function(){const e=this.ctx;this.groupLevel--,this.ctx=this.groupStack.pop(),f(this.ctx,this.current.activeSMask,e,this.webGLContext),this.ctx.restore(),c(e,this.ctx);const t=n.Util.transform(this.current.activeSMask.startTransformInverse,e.mozCurrentTransform);this.ctx.transform.apply(this.ctx,t)},save:function(){this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone(),this.current.resumeSMaskCtx=null},restore:function(){this.current.resumeSMaskCtx&&this.resumeSMaskGroup(),null===this.current.activeSMask||0!==this.stateStack.length&&this.stateStack[this.stateStack.length-1].activeSMask===this.current.activeSMask||this.endSMaskGroup(),0!==this.stateStack.length?(this.current=this.stateStack.pop(),this.ctx.restore(),this.pendingClip=null,this._cachedGetSinglePixelWidth=null):this.current.activeSMask=null},transform:function(e,t,n,r,i,o){this.ctx.transform(e,t,n,r,i,o),this._cachedGetSinglePixelWidth=null},constructPath:function(e,t){const r=this.ctx,i=this.current;let o=i.x,s=i.y;for(let i=0,a=0,l=e.length;i<l;i++)switch(0|e[i]){case n.OPS.rectangle:o=t[a++],s=t[a++];const l=t[a++],c=t[a++],u=o+l,d=s+c;r.moveTo(o,s),0===l||0===c?r.lineTo(u,d):(r.lineTo(u,s),r.lineTo(u,d),r.lineTo(o,d)),r.closePath();break;case n.OPS.moveTo:o=t[a++],s=t[a++],r.moveTo(o,s);break;case n.OPS.lineTo:o=t[a++],s=t[a++],r.lineTo(o,s);break;case n.OPS.curveTo:o=t[a+4],s=t[a+5],r.bezierCurveTo(t[a],t[a+1],t[a+2],t[a+3],o,s),a+=6;break;case n.OPS.curveTo2:r.bezierCurveTo(o,s,t[a],t[a+1],t[a+2],t[a+3]),o=t[a+2],s=t[a+3],a+=4;break;case n.OPS.curveTo3:o=t[a+2],s=t[a+3],r.bezierCurveTo(t[a],t[a+1],o,s,o,s),a+=4;break;case n.OPS.closePath:r.closePath()}i.setCurrentPoint(o,s)},closePath:function(){this.ctx.closePath()},stroke:function(e){e=void 0===e||e;const t=this.ctx,r=this.current.strokeColor;if(t.globalAlpha=this.current.strokeAlpha,this.contentVisible)if("object"==typeof r&&r&&r.getPattern){t.save();const e=t.mozCurrentTransform,i=n.Util.singularValueDecompose2dScale(e)[0];t.strokeStyle=r.getPattern(t,this);const o=this.getSinglePixelWidth(),s=this.current.lineWidth*i;o<0&&-o>=s?(t.resetTransform(),t.lineWidth=Math.round(this._combinedScaleFactor)):t.lineWidth=Math.max(o,s),t.stroke(),t.restore()}else{const e=this.getSinglePixelWidth();e<0&&-e>=this.current.lineWidth?(t.save(),t.resetTransform(),t.lineWidth=Math.round(this._combinedScaleFactor),t.stroke(),t.restore()):(t.lineWidth=Math.max(e,this.current.lineWidth),t.stroke())}e&&this.consumePath(),t.globalAlpha=this.current.fillAlpha},closeStroke:function(){this.closePath(),this.stroke()},fill:function(e){e=void 0===e||e;const t=this.ctx,n=this.current.fillColor,r=this.current.patternFill;let i=!1;r&&(t.save(),this.baseTransform&&t.setTransform.apply(t,this.baseTransform),t.fillStyle=n.getPattern(t,this),i=!0),this.contentVisible&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),i&&t.restore(),e&&this.consumePath()},eoFill:function(){this.pendingEOFill=!0,this.fill()},fillStroke:function(){this.fill(!1),this.stroke(!1),this.consumePath()},eoFillStroke:function(){this.pendingEOFill=!0,this.fillStroke()},closeFillStroke:function(){this.closePath(),this.fillStroke()},closeEOFillStroke:function(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()},endPath:function(){this.consumePath()},clip:function(){this.pendingClip=b},eoClip:function(){this.pendingClip=y},beginText:function(){this.current.textMatrix=n.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0},endText:function(){const e=this.pendingTextPaths,t=this.ctx;if(void 0!==e){t.save(),t.beginPath();for(let n=0;n<e.length;n++){const r=e[n];t.setTransform.apply(t,r.transform),t.translate(r.x,r.y),r.addToPath(t,r.fontSize)}t.restore(),t.clip(),t.beginPath(),delete this.pendingTextPaths}else t.beginPath()},setCharSpacing:function(e){this.current.charSpacing=e},setWordSpacing:function(e){this.current.wordSpacing=e},setHScale:function(e){this.current.textHScale=e/100},setLeading:function(e){this.current.leading=-e},setFont:function(e,t){const r=this.commonObjs.get(e),i=this.current;if(!r)throw new Error(`Can't find font for ${e}`);if(i.fontMatrix=r.fontMatrix||n.FONT_IDENTITY_MATRIX,0!==i.fontMatrix[0]&&0!==i.fontMatrix[3]||(0,n.warn)("Invalid font matrix for font "+e),t<0?(t=-t,i.fontDirection=-1):i.fontDirection=1,this.current.font=r,this.current.fontSize=t,r.isType3Font)return;const o=r.loadedName||"sans-serif";let s="normal";r.black?s="900":r.bold&&(s="bold");const a=r.italic?"italic":"normal",l=`"${o}", ${r.fallbackName}`;let c=t;t<16?c=16:t>100&&(c=100),this.current.fontSizeScale=t/c,this.ctx.font=`${a} ${s} ${c}px ${l}`},setTextRenderingMode:function(e){this.current.textRenderingMode=e},setTextRise:function(e){this.current.textRise=e},moveText:function(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t},setLeadingMoveText:function(e,t){this.setLeading(-t),this.moveText(e,t)},setTextMatrix:function(e,t,n,r,i,o){this.current.textMatrix=[e,t,n,r,i,o],this.current.textMatrixScale=Math.sqrt(e*e+t*t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0},nextLine:function(){this.moveText(0,this.current.leading)},paintChar(e,t,r,i,o){const s=this.ctx,a=this.current,l=a.font,c=a.textRenderingMode,u=a.fontSize/a.fontSizeScale,d=c&n.TextRenderingMode.FILL_STROKE_MASK,h=!!(c&n.TextRenderingMode.ADD_TO_PATH_FLAG),p=a.patternFill&&!l.missingFile;let f;if((l.disableFontFace||h||p)&&(f=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||p?(s.save(),s.translate(t,r),s.beginPath(),f(s,u),i&&s.setTransform.apply(s,i),d!==n.TextRenderingMode.FILL&&d!==n.TextRenderingMode.FILL_STROKE||s.fill(),d!==n.TextRenderingMode.STROKE&&d!==n.TextRenderingMode.FILL_STROKE||(o&&(s.resetTransform(),s.lineWidth=Math.round(this._combinedScaleFactor)),s.stroke()),s.restore()):(d!==n.TextRenderingMode.FILL&&d!==n.TextRenderingMode.FILL_STROKE||s.fillText(e,t,r),d!==n.TextRenderingMode.STROKE&&d!==n.TextRenderingMode.FILL_STROKE||(o?(s.save(),s.moveTo(t,r),s.resetTransform(),s.lineWidth=Math.round(this._combinedScaleFactor),s.strokeText(e,0,0),s.restore()):s.strokeText(e,t,r))),h){const e=this.pendingTextPaths||(this.pendingTextPaths=[]);e.push({transform:s.mozCurrentTransform,x:t,y:r,fontSize:u,addToPath:f})}},get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let r=!1;for(let e=3;e<t.length;e+=4)if(t[e]>0&&t[e]<255){r=!0;break}return(0,n.shadow)(this,"isFontSubpixelAAEnabled",r)},showText:function(e){const t=this.current,r=t.font;if(r.isType3Font)return this.showType3Text(e);const i=t.fontSize;if(0===i)return;const o=this.ctx,s=t.fontSizeScale,a=t.charSpacing,l=t.wordSpacing,c=t.fontDirection,u=t.textHScale*c,d=e.length,h=r.vertical,p=h?1:-1,f=r.defaultVMetrics,m=i*t.fontMatrix[0],g=t.textRenderingMode===n.TextRenderingMode.FILL&&!r.disableFontFace&&!t.patternFill;let b;if(o.save(),t.patternFill){o.save();const e=t.fillColor.getPattern(o,this);b=o.mozCurrentTransform,o.restore(),o.fillStyle=e}o.transform.apply(o,t.textMatrix),o.translate(t.x,t.y+t.textRise),c>0?o.scale(u,-1):o.scale(u,1);let y=t.lineWidth,v=!1;const S=t.textMatrixScale;if(0===S||0===y){const e=t.textRenderingMode&n.TextRenderingMode.FILL_STROKE_MASK;e!==n.TextRenderingMode.STROKE&&e!==n.TextRenderingMode.FILL_STROKE||(this._cachedGetSinglePixelWidth=null,y=this.getSinglePixelWidth(),v=y<0)}else y/=S;1!==s&&(o.scale(s,s),y/=s),o.lineWidth=y;let C,x=0;for(C=0;C<d;++C){const t=e[C];if((0,n.isNum)(t)){x+=p*t*i/1e3;continue}let u=!1;const d=(t.isSpace?l:0)+a,y=t.fontChar,S=t.accent;let A,w,_,N=t.width;if(h){const e=t.vmetric||f,n=-(t.vmetric?e[1]:.5*N)*m,r=e[2]*m;N=e?-e[0]:N,A=n/s,w=(x+r)/s}else A=x/s,w=0;if(r.remeasure&&N>0){const e=1e3*o.measureText(y).width/i*s;if(N<e&&this.isFontSubpixelAAEnabled){const t=N/e;u=!0,o.save(),o.scale(t,1),A/=t}else N!==e&&(A+=(N-e)/2e3*i/s)}if(this.contentVisible&&(t.isInFont||r.missingFile))if(g&&!S)o.fillText(y,A,w);else if(this.paintChar(y,A,w,b,v),S){const e=A+i*S.offset.x/s,t=w-i*S.offset.y/s;this.paintChar(S.fontChar,e,t,b,v)}x+=_=h?N*m-d*c:N*m+d*c,u&&o.restore()}h?t.y-=x:t.x+=x*u,o.restore()},showType3Text:function(e){const t=this.ctx,r=this.current,i=r.font,o=r.fontSize,s=r.fontDirection,a=i.vertical?1:-1,l=r.charSpacing,c=r.wordSpacing,u=r.textHScale*s,d=r.fontMatrix||n.FONT_IDENTITY_MATRIX,h=e.length,p=r.textRenderingMode===n.TextRenderingMode.INVISIBLE;let f,m,g,b;if(!p&&0!==o){for(this._cachedGetSinglePixelWidth=null,t.save(),t.transform.apply(t,r.textMatrix),t.translate(r.x,r.y),t.scale(u,s),f=0;f<h;++f){if(m=e[f],(0,n.isNum)(m)){b=a*m*o/1e3,this.ctx.translate(b,0),r.x+=b*u;continue}const s=(m.isSpace?c:0)+l,h=i.charProcOperatorList[m.operatorListId];if(!h){(0,n.warn)(`Type3 character "${m.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=m,this.save(),t.scale(o,o),t.transform.apply(t,d),this.executeOperatorList(h),this.restore());const p=n.Util.applyTransform([m.width,0],d);g=p[0]*o+s,t.translate(g,0),r.x+=g*u}t.restore(),this.processingType3=null}},setCharWidth:function(e,t){},setCharWidthAndBounds:function(e,t,n,r,i,o){this.ctx.rect(n,r,i-n,o-r),this.clip(),this.endPath()},getColorN_Pattern:function(t){let n;if("TilingPattern"===t[0]){const i=t[1],o=this.baseTransform||this.ctx.mozCurrentTransform.slice(),s={createCanvasGraphics:t=>new e(t,this.commonObjs,this.objs,this.canvasFactory,this.webGLContext)};n=new r.TilingPattern(t,i,this.ctx,s,o)}else n=(0,r.getShadingPatternFromIR)(t);return n},setStrokeColorN:function(){this.current.strokeColor=this.getColorN_Pattern(arguments)},setFillColorN:function(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0},setStrokeRGBColor:function(e,t,r){const i=n.Util.makeHexColor(e,t,r);this.ctx.strokeStyle=i,this.current.strokeColor=i},setFillRGBColor:function(e,t,r){const i=n.Util.makeHexColor(e,t,r);this.ctx.fillStyle=i,this.current.fillColor=i,this.current.patternFill=!1},shadingFill:function(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const i=(0,r.getShadingPatternFromIR)(e);t.fillStyle=i.getPattern(t,this,!0);const o=t.mozCurrentTransformInverse;if(o){const e=t.canvas,r=e.width,i=e.height,s=n.Util.applyTransform([0,0],o),a=n.Util.applyTransform([0,i],o),l=n.Util.applyTransform([r,0],o),c=n.Util.applyTransform([r,i],o),u=Math.min(s[0],a[0],l[0],c[0]),d=Math.min(s[1],a[1],l[1],c[1]),h=Math.max(s[0],a[0],l[0],c[0]),p=Math.max(s[1],a[1],l[1],c[1]);this.ctx.fillRect(u,d,h-u,p-d)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.restore()},beginInlineImage:function(){(0,n.unreachable)("Should not call beginInlineImage")},beginImageData:function(){(0,n.unreachable)("Should not call beginImageData")},paintFormXObjectBegin:function(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(e)&&6===e.length&&this.transform.apply(this,e),this.baseTransform=this.ctx.mozCurrentTransform,t)){const e=t[2]-t[0],n=t[3]-t[1];this.ctx.rect(t[0],t[1],e,n),this.clip(),this.endPath()}},paintFormXObjectEnd:function(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())},beginGroup:function(e){if(!this.contentVisible)return;this.save();const t=this.ctx;e.isolated||(0,n.info)("TODO: Support non-isolated groups."),e.knockout&&(0,n.warn)("Knockout groups not supported.");const r=t.mozCurrentTransform;if(e.matrix&&t.transform.apply(t,e.matrix),!e.bbox)throw new Error("Bounding box is required.");let i=n.Util.getAxialAlignedBoundingBox(e.bbox,t.mozCurrentTransform);const o=[0,0,t.canvas.width,t.canvas.height];i=n.Util.intersect(i,o)||[0,0,0,0];const s=Math.floor(i[0]),a=Math.floor(i[1]);let l=Math.max(Math.ceil(i[2])-s,1),u=Math.max(Math.ceil(i[3])-a,1),d=1,h=1;l>4096&&(d=l/4096,l=4096),u>4096&&(h=u/4096,u=4096);let p="groupAt"+this.groupLevel;e.smask&&(p+="_smask_"+this.smaskCounter++%2);const f=this.cachedCanvases.getCanvas(p,l,u,!0),m=f.context;m.scale(1/d,1/h),m.translate(-s,-a),m.transform.apply(m,r),e.smask?this.smaskStack.push({canvas:f.canvas,context:m,offsetX:s,offsetY:a,scaleX:d,scaleY:h,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(s,a),t.scale(d,h)),c(t,m),this.ctx=m,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++,this.current.activeSMask=null},endGroup:function(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx;this.ctx=this.groupStack.pop(),void 0!==this.ctx.imageSmoothingEnabled?this.ctx.imageSmoothingEnabled=!1:this.ctx.mozImageSmoothingEnabled=!1,e.smask?this.tempSMask=this.smaskStack.pop():this.ctx.drawImage(t.canvas,0,0),this.restore()},beginAnnotations:function(){this.save(),this.baseTransform&&this.ctx.setTransform.apply(this.ctx,this.baseTransform)},endAnnotations:function(){this.restore()},beginAnnotation:function(e,t,n){if(this.save(),u(this.ctx),this.current=new a,Array.isArray(e)&&4===e.length){const t=e[2]-e[0],n=e[3]-e[1];this.ctx.rect(e[0],e[1],t,n),this.clip(),this.endPath()}this.transform.apply(this,t),this.transform.apply(this,n)},endAnnotation:function(){this.restore()},paintImageMaskXObject:function(e){if(!this.contentVisible)return;const t=this.ctx,n=e.width,r=e.height,i=this.current.fillColor,o=this.current.patternFill,s=this.processingType3;if(s&&void 0===s.compiled&&(s.compiled=n<=1e3&&r<=1e3?function(e){const t=e.width,n=e.height,r=t+1;let i,o,s,a;const l=new Uint8Array(r*(n+1)),c=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),u=t+7&-8,d=e.data,h=new Uint8Array(u*n);let p=0;for(i=0,o=d.length;i<o;i++){const e=d[i];let t=128;for(;t>0;)h[p++]=e&t?0:255,t>>=1}let f=0;0!==h[p=0]&&(l[0]=1,++f);for(s=1;s<t;s++)h[p]!==h[p+1]&&(l[s]=h[p]?2:1,++f),p++;0!==h[p]&&(l[s]=2,++f);for(i=1;i<n;i++){a=i*r,h[(p=i*u)-u]!==h[p]&&(l[a]=h[p]?1:8,++f);let e=(h[p]?4:0)+(h[p-u]?8:0);for(s=1;s<t;s++)e=(e>>2)+(h[p+1]?4:0)+(h[p-u+1]?8:0),c[e]&&(l[a+s]=c[e],++f),p++;if(h[p-u]!==h[p]&&(l[a+s]=h[p]?2:4,++f),f>1e3)return null}a=i*r,0!==h[p=u*(n-1)]&&(l[a]=8,++f);for(s=1;s<t;s++)h[p]!==h[p+1]&&(l[a+s]=h[p]?4:8,++f),p++;0!==h[p]&&(l[a+s]=4,++f);if(f>1e3)return null;const m=new Int32Array([0,r,-1,0,-r,0,0,0,1]),g=[];for(i=0;f&&i<=n;i++){let e=i*r;const n=e+t;for(;e<n&&!l[e];)e++;if(e===n)continue;const o=[e%r,i],s=e;let a=l[e];do{const t=m[a];do{e+=t}while(!l[e]);const n=l[e];5!==n&&10!==n?(a=n,l[e]=0):(a=n&51*a>>4,l[e]&=a>>2|a<<2),o.push(e%r),o.push(e/r|0),l[e]||--f}while(s!==e);g.push(o),--i}return function(e){e.save(),e.scale(1/t,-1/n),e.translate(0,-n),e.beginPath();for(let t=0,n=g.length;t<n;t++){const n=g[t];e.moveTo(n[0],n[1]);for(let t=2,r=n.length;t<r;t+=2)e.lineTo(n[t],n[t+1])}e.fill(),e.beginPath(),e.restore()}}({data:e.data,width:n,height:r}):null),s&&s.compiled)return void s.compiled(t);const a=this.cachedCanvases.getCanvas("maskCanvas",n,r),c=a.context;c.save(),l(c,e),c.globalCompositeOperation="source-in",c.fillStyle=o?i.getPattern(c,this):i,c.fillRect(0,0,n,r),c.restore(),this.paintInlineImageXObject(a.canvas)},paintImageMaskXObjectRepeat(e,t,n=0,r=0,i,o){if(!this.contentVisible)return;const s=e.width,a=e.height,c=this.current.fillColor,u=this.current.patternFill,d=this.cachedCanvases.getCanvas("maskCanvas",s,a),h=d.context;h.save(),l(h,e),h.globalCompositeOperation="source-in",h.fillStyle=u?c.getPattern(h,this):c,h.fillRect(0,0,s,a),h.restore();const p=this.ctx;for(let e=0,l=o.length;e<l;e+=2)p.save(),p.transform(t,n,r,i,o[e],o[e+1]),p.scale(1,-1),p.drawImage(d.canvas,0,0,s,a,0,-1,1,1),p.restore()},paintImageMaskXObjectGroup:function(e){if(!this.contentVisible)return;const t=this.ctx,n=this.current.fillColor,r=this.current.patternFill;for(let i=0,o=e.length;i<o;i++){const o=e[i],s=o.width,a=o.height,c=this.cachedCanvases.getCanvas("maskCanvas",s,a),u=c.context;u.save(),l(u,o),u.globalCompositeOperation="source-in",u.fillStyle=r?n.getPattern(u,this):n,u.fillRect(0,0,s,a),u.restore(),t.save(),t.transform.apply(t,o.transform),t.scale(1,-1),t.drawImage(c.canvas,0,0,s,a,0,-1,1,1),t.restore()}},paintImageXObject:function(e){if(!this.contentVisible)return;const t=e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e);t?this.paintInlineImageXObject(t):(0,n.warn)("Dependent image isn't ready yet")},paintImageXObjectRepeat:function(e,t,r,i){if(!this.contentVisible)return;const o=e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e);if(!o)return void(0,n.warn)("Dependent image isn't ready yet");const s=o.width,a=o.height,l=[];for(let e=0,n=i.length;e<n;e+=2)l.push({transform:[t,0,0,r,i[e],i[e+1]],x:0,y:0,w:s,h:a});this.paintInlineImageXObjectGroup(o,l)},paintInlineImageXObject:function(e){if(!this.contentVisible)return;const n=e.width,r=e.height,i=this.ctx;this.save(),i.scale(1/n,-1/r);const o=i.mozCurrentTransformInverse,s=o[0],a=o[1];let l=Math.max(Math.sqrt(s*s+a*a),1);const c=o[2],u=o[3];let d,h,p,f=Math.max(Math.sqrt(c*c+u*u),1);"function"==typeof HTMLElement&&e instanceof HTMLElement||!e.data?d=e:(h=this.cachedCanvases.getCanvas("inlineImage",n,r),t(p=h.context,e,this.current.transferMaps),d=h.canvas);let m=n,g=r,b="prescale1";for(;l>2&&m>1||f>2&&g>1;){let e=m,t=g;l>2&&m>1&&(e=Math.ceil(m/2),l/=m/e),f>2&&g>1&&(t=Math.ceil(g/2),f/=g/t),h=this.cachedCanvases.getCanvas(b,e,t),(p=h.context).clearRect(0,0,e,t),p.drawImage(d,0,0,m,g,0,0,e,t),d=h.canvas,m=e,g=t,b="prescale1"===b?"prescale2":"prescale1"}if(i.drawImage(d,0,0,m,g,0,-r,n,r),this.imageLayer){const t=this.getCanvasPosition(0,-r);this.imageLayer.appendImage({imgData:e,left:t[0],top:t[1],width:n/o[0],height:r/o[3]})}this.restore()},paintInlineImageXObjectGroup:function(e,n){if(!this.contentVisible)return;const r=this.ctx,i=e.width,o=e.height,s=this.cachedCanvases.getCanvas("inlineImage",i,o),a=s.context;t(a,e,this.current.transferMaps);for(let t=0,a=n.length;t<a;t++){const a=n[t];if(r.save(),r.transform.apply(r,a.transform),r.scale(1,-1),r.drawImage(s.canvas,a.x,a.y,a.w,a.h,0,-1,1,1),this.imageLayer){const t=this.getCanvasPosition(a.x,a.y);this.imageLayer.appendImage({imgData:e,left:t[0],top:t[1],width:i,height:o})}r.restore()}},paintSolidColorImageMask:function(){this.contentVisible&&this.ctx.fillRect(0,0,1,1)},markPoint:function(e){},markPointProps:function(e,t){},beginMarkedContent:function(e){this.markedContentStack.push({visible:!0})},beginMarkedContentProps:function(e,t){"OC"===e?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()},endMarkedContent:function(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()},beginCompat:function(){},endCompat:function(){},consumePath:function(){const e=this.ctx;this.pendingClip&&(this.pendingClip===y?e.clip("evenodd"):e.clip(),this.pendingClip=null),e.beginPath()},getSinglePixelWidth(){if(null===this._cachedGetSinglePixelWidth){const e=this.ctx.mozCurrentTransform,t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=e[0]**2+e[2]**2,r=e[1]**2+e[3]**2,i=Math.sqrt(Math.max(n,r))/t;n!==r&&this._combinedScaleFactor*i>1?this._cachedGetSinglePixelWidth=-this._combinedScaleFactor*i:t>Number.EPSILON?this._cachedGetSinglePixelWidth=1.0000001*i:this._cachedGetSinglePixelWidth=1}return this._cachedGetSinglePixelWidth},getCanvasPosition:function(e,t){const n=this.ctx.mozCurrentTransform;return[n[0]*e+n[2]*t+n[4],n[1]*e+n[3]*t+n[5]]},isContentVisible:function(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};for(const t in n.OPS)e.prototype[n.OPS[t]]=e.prototype[t];return e}();exports.CanvasGraphics=l},(e,exports,t)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.getShadingPatternFromIR=function(e){const t=r[e[0]];if(!t)throw new Error(`Unknown IR type: ${e[0]}`);return t.fromIR(e)},exports.TilingPattern=void 0;var n=t(2);const r={};function i(e,t){if(!t||"undefined"==typeof Path2D)return;const n=t[2]-t[0],r=t[3]-t[1],i=new Path2D;i.rect(t[0],t[1],n,r),e.clip(i)}r.RadialAxial={fromIR:function(e){const t=e[1],n=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7];return{getPattern:function(e){let c;i(e,n),"axial"===t?c=e.createLinearGradient(o[0],o[1],s[0],s[1]):"radial"===t&&(c=e.createRadialGradient(o[0],o[1],a,s[0],s[1],l));for(let e=0,t=r.length;e<t;++e){const t=r[e];c.addColorStop(t[0],t[1])}return c}}}};const o=function(){function e(e,t,n,r,i,o,s,a){const l=t.coords,c=t.colors,u=e.data,d=4*e.width;let h;l[n+1]>l[r+1]&&(h=n,n=r,r=h,h=o,o=s,s=h),l[r+1]>l[i+1]&&(h=r,r=i,i=h,h=s,s=a,a=h),l[n+1]>l[r+1]&&(h=n,n=r,r=h,h=o,o=s,s=h);const p=(l[n]+t.offsetX)*t.scaleX,f=(l[n+1]+t.offsetY)*t.scaleY,m=(l[r]+t.offsetX)*t.scaleX,g=(l[r+1]+t.offsetY)*t.scaleY,b=(l[i]+t.offsetX)*t.scaleX,y=(l[i+1]+t.offsetY)*t.scaleY;if(f>=y)return;const v=c[o],S=c[o+1],C=c[o+2],x=c[s],A=c[s+1],w=c[s+2],_=c[a],N=c[a+1],E=c[a+2],T=Math.round(f),k=Math.round(y);let P,R,O,D,I,F,M,L;for(let e=T;e<=k;e++){if(e<g){let t;P=p-(p-m)*(t=e<f?0:f===g?1:(f-e)/(f-g)),R=v-(v-x)*t,O=S-(S-A)*t,D=C-(C-w)*t}else{let t;P=m-(m-b)*(t=e>y?1:g===y?0:(g-e)/(g-y)),R=x-(x-_)*t,O=A-(A-N)*t,D=w-(w-E)*t}let t;I=p-(p-b)*(t=e<f?0:e>y?1:(f-e)/(f-y)),F=v-(v-_)*t,M=S-(S-N)*t,L=C-(C-E)*t;const n=Math.round(Math.min(P,I)),r=Math.round(Math.max(P,I));let i=d*e+4*n;for(let e=n;e<=r;e++)(t=(P-e)/(P-I))<0?t=0:t>1&&(t=1),u[i++]=R-(R-F)*t|0,u[i++]=O-(O-M)*t|0,u[i++]=D-(D-L)*t|0,u[i++]=255}}function t(t,n,r){const i=n.coords,o=n.colors;let s,a;switch(n.type){case"lattice":const l=n.verticesPerRow,c=Math.floor(i.length/l)-1,u=l-1;for(s=0;s<c;s++){let n=s*l;for(let s=0;s<u;s++,n++)e(t,r,i[n],i[n+1],i[n+l],o[n],o[n+1],o[n+l]),e(t,r,i[n+l+1],i[n+1],i[n+l],o[n+l+1],o[n+1],o[n+l])}break;case"triangles":for(s=0,a=i.length;s<a;s+=3)e(t,r,i[s],i[s+1],i[s+2],o[s],o[s+1],o[s+2]);break;default:throw new Error("illegal figure")}}return function(e,n,r,i,o,s,a,l){const c=Math.floor(e[0]),u=Math.floor(e[1]),d=Math.ceil(e[2])-c,h=Math.ceil(e[3])-u,p=Math.min(Math.ceil(Math.abs(d*n[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(h*n[1]*1.1)),3e3),m=d/p,g=h/f,b={coords:r,colors:i,offsetX:-c,offsetY:-u,scaleX:1/m,scaleY:1/g},y=p+4,v=f+4;let S,C,x,A;if(l.isEnabled)S=l.drawFigures({width:p,height:f,backgroundColor:s,figures:o,context:b}),(C=a.getCanvas("mesh",y,v,!1)).context.drawImage(S,2,2),S=C.canvas;else{const e=(C=a.getCanvas("mesh",y,v,!1)).context,n=e.createImageData(p,f);if(s){const e=n.data;for(x=0,A=e.length;x<A;x+=4)e[x]=s[0],e[x+1]=s[1],e[x+2]=s[2],e[x+3]=255}for(x=0;x<o.length;x++)t(n,o[x],b);e.putImageData(n,2,2),S=C.canvas}return{canvas:S,offsetX:c-2*m,offsetY:u-2*g,scaleX:m,scaleY:g}}}();r.Mesh={fromIR:function(e){const t=e[2],r=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return{getPattern:function(e,d,h){let p;if(i(e,c),h)p=n.Util.singularValueDecompose2dScale(e.mozCurrentTransform);else if(p=n.Util.singularValueDecompose2dScale(d.baseTransform),l){const e=n.Util.singularValueDecompose2dScale(l);p=[p[0]*e[0],p[1]*e[1]]}const f=o(a,p,t,r,s,h?null:u,d.cachedCanvases,d.webGLContext);return h||(e.setTransform.apply(e,d.baseTransform),l&&e.transform.apply(e,l)),e.translate(f.offsetX,f.offsetY),e.scale(f.scaleX,f.scaleY),e.createPattern(f.canvas,"no-repeat")}}}},r.Dummy={fromIR:function(){return{getPattern:function(){return"hotpink"}}}};const s=function(){const e={COLORED:1,UNCOLORED:2};function t(e,t,n,r,i){this.operatorList=e[2],this.matrix=e[3]||[1,0,0,1,0,0],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.canvasGraphicsFactory=r,this.baseTransform=i,this.ctx=n}return t.prototype={createPatternCanvas:function(e){const t=this.operatorList,r=this.bbox,i=this.xstep,o=this.ystep,s=this.paintType,a=this.tilingType,l=this.color,c=this.canvasGraphicsFactory;(0,n.info)("TilingType: "+a);const u=r[0],d=r[1],h=r[2],p=r[3],f=n.Util.singularValueDecompose2dScale(this.matrix),m=n.Util.singularValueDecompose2dScale(this.baseTransform),g=[f[0]*m[0],f[1]*m[1]],b=this.getSizeAndScale(i,this.ctx.canvas.width,g[0]),y=this.getSizeAndScale(o,this.ctx.canvas.height,g[1]),v=e.cachedCanvases.getCanvas("pattern",b.size,y.size,!0),S=v.context,C=c.createCanvasGraphics(S);return C.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(C,s,l),C.transform(b.scale,0,0,y.scale,0,0),C.transform(1,0,0,1,-u,-d),this.clipBbox(C,r,u,d,h,p),C.executeOperatorList(t),this.ctx.transform(1,0,0,1,u,d),this.ctx.scale(1/b.scale,1/y.scale),v.canvas},getSizeAndScale:function(e,t,n){e=Math.abs(e);const r=Math.max(3e3,t);let i=Math.ceil(e*n);return i>=r?i=r:n=i/e,{scale:n,size:i}},clipBbox:function(e,t,n,r,i,o){if(Array.isArray(t)&&4===t.length){const t=i-n,s=o-r;e.ctx.rect(n,r,t,s),e.clip(),e.endPath()}},setFillAndStrokeStyleToContext:function(t,r,i){const o=t.ctx,s=t.current;switch(r){case e.COLORED:const t=this.ctx;o.fillStyle=t.fillStyle,o.strokeStyle=t.strokeStyle,s.fillColor=t.fillStyle,s.strokeColor=t.strokeStyle;break;case e.UNCOLORED:const a=n.Util.makeHexColor(i[0],i[1],i[2]);o.fillStyle=a,o.strokeStyle=a,s.fillColor=a,s.strokeColor=a;break;default:throw new n.FormatError(`Unsupported paint type: ${r}`)}},getPattern:function(e,t){(e=this.ctx).setTransform.apply(e,this.baseTransform),e.transform.apply(e,this.matrix);const n=this.createPatternCanvas(t);return e.createPattern(n,"repeat")}},t}();exports.TilingPattern=s},(e,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.GlobalWorkerOptions=void 0;const t=Object.create(null);exports.GlobalWorkerOptions=t,t.workerPort=void 0===t.workerPort?null:t.workerPort,t.workerSrc=void 0===t.workerSrc?"":t.workerSrc},(e,exports,t)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.MessageHandler=void 0;var n=t(2);const r={UNKNOWN:0,DATA:1,ERROR:2},i={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function o(e){if("object"!=typeof e||null===e)return e;switch(e.name){case"AbortException":return new n.AbortException(e.message);case"MissingPDFException":return new n.MissingPDFException(e.message);case"UnexpectedResponseException":return new n.UnexpectedResponseException(e.message,e.status);case"UnknownErrorException":return new n.UnknownErrorException(e.message,e.details);default:return new n.UnknownErrorException(e.message,e.toString())}}exports.MessageHandler=class{constructor(e,t,n){this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.postMessageTransfers=!0,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=(e=>{const t=e.data;if(t.targetName!==this.sourceName)return;if(t.stream)return void this._processStreamMessage(t);if(t.callback){const e=t.callbackId,n=this.callbackCapabilities[e];if(!n)throw new Error(`Cannot resolve callback ${e}`);if(delete this.callbackCapabilities[e],t.callback===r.DATA)n.resolve(t.data);else{if(t.callback!==r.ERROR)throw new Error("Unexpected callback case");n.reject(o(t.reason))}return}const i=this.actionHandler[t.action];if(!i)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const e=this.sourceName,s=t.sourceName;new Promise(function(e){e(i(t.data))}).then(function(i){n.postMessage({sourceName:e,targetName:s,callback:r.DATA,callbackId:t.callbackId,data:i})},function(i){n.postMessage({sourceName:e,targetName:s,callback:r.ERROR,callbackId:t.callbackId,reason:o(i)})})}else t.streamId?this._createStreamSink(t):i(t.data)}),n.addEventListener("message",this._onComObjOnMessage)}on(e,t){const n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this._postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,r){const i=this.callbackId++,o=(0,n.createPromiseCapability)();this.callbackCapabilities[i]=o;try{this._postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},r)}catch(e){o.reject(e)}return o.promise}sendWithStream(e,t,r,s){const a=this.streamId++,l=this.sourceName,c=this.targetName,u=this.comObj;return new ReadableStream({start:r=>{const i=(0,n.createPromiseCapability)();return this.streamControllers[a]={controller:r,startCall:i,pullCall:null,cancelCall:null,isClosed:!1},this._postMessage({sourceName:l,targetName:c,action:e,streamId:a,data:t,desiredSize:r.desiredSize},s),i.promise},pull:e=>{const t=(0,n.createPromiseCapability)();return this.streamControllers[a].pullCall=t,u.postMessage({sourceName:l,targetName:c,stream:i.PULL,streamId:a,desiredSize:e.desiredSize}),t.promise},cancel:e=>{(0,n.assert)(e instanceof Error,"cancel must have a valid reason");const t=(0,n.createPromiseCapability)();return this.streamControllers[a].cancelCall=t,this.streamControllers[a].isClosed=!0,u.postMessage({sourceName:l,targetName:c,stream:i.CANCEL,streamId:a,reason:o(e)}),t.promise}},r)}_createStreamSink(e){const t=this,r=this.actionHandler[e.action],s=e.streamId,a=this.sourceName,l=e.sourceName,c=this.comObj,u={enqueue(e,r=1,o){if(this.isCancelled)return;const c=this.desiredSize;this.desiredSize-=r,c>0&&this.desiredSize<=0&&(this.sinkCapability=(0,n.createPromiseCapability)(),this.ready=this.sinkCapability.promise),t._postMessage({sourceName:a,targetName:l,stream:i.ENQUEUE,streamId:s,chunk:e},o)},close(){this.isCancelled||(this.isCancelled=!0,c.postMessage({sourceName:a,targetName:l,stream:i.CLOSE,streamId:s}),delete t.streamSinks[s])},error(e){(0,n.assert)(e instanceof Error,"error must have a valid reason"),this.isCancelled||(this.isCancelled=!0,c.postMessage({sourceName:a,targetName:l,stream:i.ERROR,streamId:s,reason:o(e)}))},sinkCapability:(0,n.createPromiseCapability)(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};u.sinkCapability.resolve(),u.ready=u.sinkCapability.promise,this.streamSinks[s]=u,new Promise(function(t){t(r(e.data,u))}).then(function(){c.postMessage({sourceName:a,targetName:l,stream:i.START_COMPLETE,streamId:s,success:!0})},function(e){c.postMessage({sourceName:a,targetName:l,stream:i.START_COMPLETE,streamId:s,reason:o(e)})})}_processStreamMessage(e){const t=e.streamId,r=this.sourceName,s=e.sourceName,a=this.comObj;switch(e.stream){case i.START_COMPLETE:e.success?this.streamControllers[t].startCall.resolve():this.streamControllers[t].startCall.reject(o(e.reason));break;case i.PULL_COMPLETE:e.success?this.streamControllers[t].pullCall.resolve():this.streamControllers[t].pullCall.reject(o(e.reason));break;case i.PULL:if(!this.streamSinks[t]){a.postMessage({sourceName:r,targetName:s,stream:i.PULL_COMPLETE,streamId:t,success:!0});break}this.streamSinks[t].desiredSize<=0&&e.desiredSize>0&&this.streamSinks[t].sinkCapability.resolve(),this.streamSinks[t].desiredSize=e.desiredSize;const{onPull:l}=this.streamSinks[e.streamId];new Promise(function(e){e(l&&l())}).then(function(){a.postMessage({sourceName:r,targetName:s,stream:i.PULL_COMPLETE,streamId:t,success:!0})},function(e){a.postMessage({sourceName:r,targetName:s,stream:i.PULL_COMPLETE,streamId:t,reason:o(e)})});break;case i.ENQUEUE:if((0,n.assert)(this.streamControllers[t],"enqueue should have stream controller"),this.streamControllers[t].isClosed)break;this.streamControllers[t].controller.enqueue(e.chunk);break;case i.CLOSE:if((0,n.assert)(this.streamControllers[t],"close should have stream controller"),this.streamControllers[t].isClosed)break;this.streamControllers[t].isClosed=!0,this.streamControllers[t].controller.close(),this._deleteStreamController(t);break;case i.ERROR:(0,n.assert)(this.streamControllers[t],"error should have stream controller"),this.streamControllers[t].controller.error(o(e.reason)),this._deleteStreamController(t);break;case i.CANCEL_COMPLETE:e.success?this.streamControllers[t].cancelCall.resolve():this.streamControllers[t].cancelCall.reject(o(e.reason)),this._deleteStreamController(t);break;case i.CANCEL:if(!this.streamSinks[t])break;const{onCancel:c}=this.streamSinks[e.streamId];new Promise(function(t){t(c&&c(o(e.reason)))}).then(function(){a.postMessage({sourceName:r,targetName:s,stream:i.CANCEL_COMPLETE,streamId:t,success:!0})},function(e){a.postMessage({sourceName:r,targetName:s,stream:i.CANCEL_COMPLETE,streamId:t,reason:o(e)})}),this.streamSinks[t].sinkCapability.reject(o(e.reason)),this.streamSinks[t].isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async _deleteStreamController(e){await Promise.allSettled([this.streamControllers[e].startCall,this.streamControllers[e].pullCall,this.streamControllers[e].cancelCall].map(function(e){return e&&e.promise})),delete this.streamControllers[e]}_postMessage(e,t){t&&this.postMessageTransfers?this.comObj.postMessage(e,t):this.comObj.postMessage(e)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}},(e,exports,t)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.Metadata=void 0;var n=t(2),r=t(15);exports.Metadata=class{constructor(e){(0,n.assert)("string"==typeof e,"Metadata: input is not a string"),e=this._repair(e);const t=new r.SimpleXMLParser({lowerCaseName:!0}),i=t.parseFromString(e);this._metadataMap=new Map,i&&this._parse(i),this._data=e}_repair(e){return e.replace(/^[^<]+/,"").replace(/>\\376\\377([^<]+)/g,function(e,t){const n=t.replace(/\\([0-3])([0-7])([0-7])/g,function(e,t,n,r){return String.fromCharCode(64*t+8*n+1*r)}).replace(/&(amp|apos|gt|lt|quot);/g,function(e,t){switch(t){case"amp":return"&";case"apos":return"'";case"gt":return">";case"lt":return"<";case"quot":return'"'}throw new Error(`_repair: ${t} isn't defined.`)});let r="";for(let e=0,t=n.length;e<t;e+=2){const t=256*n.charCodeAt(e)+n.charCodeAt(e+1);r+=t>=32&&t<127&&60!==t&&62!==t&&38!==t?String.fromCharCode(t):"&#x"+(65536+t).toString(16).substring(1)+";"}return">"+r})}_getSequence(e){const t=e.nodeName;return"rdf:bag"!==t&&"rdf:seq"!==t&&"rdf:alt"!==t?null:e.childNodes.filter(e=>"rdf:li"===e.nodeName)}_getCreators(e){if("dc:creator"!==e.nodeName)return!1;if(!e.hasChildNodes())return!0;const t=e.childNodes[0],n=this._getSequence(t)||[];return this._metadataMap.set(e.nodeName,n.map(e=>e.textContent.trim())),!0}_parse(e){let t=e.documentElement;if("rdf:rdf"!==t.nodeName)for(t=t.firstChild;t&&"rdf:rdf"!==t.nodeName;)t=t.nextSibling;if(t&&"rdf:rdf"===t.nodeName&&t.hasChildNodes())for(const e of t.childNodes)if("rdf:description"===e.nodeName)for(const t of e.childNodes){const e=t.nodeName;"#text"!==e&&(this._getCreators(t)||this._metadataMap.set(e,t.textContent.trim()))}}getRaw(){return this._data}get(e){return this._metadataMap.get(e)||null}getAll(){return(0,n.objectFromEntries)(this._metadataMap)}has(e){return this._metadataMap.has(e)}}},(e,exports,t)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.SimpleXMLParser=exports.SimpleDOMNode=void 0;var n=t(2);const r={NoError:0,EndOfDocument:-1,UnterminatedCdat:-2,UnterminatedXmlDeclaration:-3,UnterminatedDoctypeDeclaration:-4,UnterminatedComment:-5,MalformedElement:-6,OutOfMemory:-7,UnterminatedAttributeValue:-8,UnterminatedElement:-9,ElementNeverBegun:-10};function i(e,t){const n=e[t];return" "===n||"\n"===n||"\r"===n||"\t"===n}class o{_resolveEntities(e){return e.replace(/&([^;]+);/g,(e,t)=>{if("#x"===t.substring(0,2))return String.fromCodePoint(parseInt(t.substring(2),16));if("#"===t.substring(0,1))return String.fromCodePoint(parseInt(t.substring(1),10));switch(t){case"lt":return"<";case"gt":return">";case"amp":return"&";case"quot":return'"'}return this.onResolveEntity(t)})}_parseContent(e,t){const n=[];let r=t;function o(){for(;r<e.length&&i(e,r);)++r}for(;r<e.length&&!i(e,r)&&">"!==e[r]&&"/"!==e[r];)++r;const s=e.substring(t,r);for(o();r<e.length&&">"!==e[r]&&"/"!==e[r]&&"?"!==e[r];){o();let t="",s="";for(;r<e.length&&!i(e,r)&&"="!==e[r];)t+=e[r],++r;if(o(),"="!==e[r])return null;++r,o();const a=e[r];if('"'!==a&&"'"!==a)return null;const l=e.indexOf(a,++r);if(l<0)return null;s=e.substring(r,l),n.push({name:t,value:this._resolveEntities(s)}),r=l+1,o()}return{name:s,attributes:n,parsed:r-t}}_parseProcessingInstruction(e,t){let n=t;for(;n<e.length&&!i(e,n)&&">"!==e[n]&&"/"!==e[n];)++n;const r=e.substring(t,n);!function(){for(;n<e.length&&i(e,n);)++n}();const o=n;for(;n<e.length&&("?"!==e[n]||">"!==e[n+1]);)++n;const s=e.substring(o,n);return{name:r,value:s,parsed:n-t}}parseXml(e){let t=0;for(;t<e.length;){const n=e[t];let i=t;if("<"===n){const t=e[++i];let n;switch(t){case"/":if(++i,(n=e.indexOf(">",i))<0)return void this.onError(r.UnterminatedElement);this.onEndElement(e.substring(i,n)),i=n+1;break;case"?":++i;const o=this._parseProcessingInstruction(e,i);if("?>"!==e.substring(i+o.parsed,i+o.parsed+2))return void this.onError(r.UnterminatedXmlDeclaration);this.onPi(o.name,o.value),i+=o.parsed+2;break;case"!":if("--"===e.substring(i+1,i+3)){if((n=e.indexOf("--\x3e",i+3))<0)return void this.onError(r.UnterminatedComment);this.onComment(e.substring(i+3,n)),i=n+3}else if("[CDATA["===e.substring(i+1,i+8)){if((n=e.indexOf("]]>",i+8))<0)return void this.onError(r.UnterminatedCdat);this.onCdata(e.substring(i+8,n)),i=n+3}else{if("DOCTYPE"!==e.substring(i+1,i+8))return void this.onError(r.MalformedElement);{const t=e.indexOf("[",i+8);let o=!1;if((n=e.indexOf(">",i+8))<0)return void this.onError(r.UnterminatedDoctypeDeclaration);if(t>0&&n>t){if((n=e.indexOf("]>",i+8))<0)return void this.onError(r.UnterminatedDoctypeDeclaration);o=!0}const s=e.substring(i+8,n+(o?1:0));this.onDoctype(s),i=n+(o?2:1)}}break;default:const s=this._parseContent(e,i);if(null===s)return void this.onError(r.MalformedElement);let a=!1;if("/>"===e.substring(i+s.parsed,i+s.parsed+2))a=!0;else if(">"!==e.substring(i+s.parsed,i+s.parsed+1))return void this.onError(r.UnterminatedElement);this.onBeginElement(s.name,s.attributes,a),i+=s.parsed+(a?2:1)}}else{for(;i<e.length&&"<"!==e[i];)i++;const n=e.substring(t,i);this.onText(this._resolveEntities(n))}t=i}}onResolveEntity(e){return`&${e};`}onPi(e,t){}onComment(e){}onCdata(e){}onDoctype(e){}onText(e){}onBeginElement(e,t,n){}onEndElement(e){}onError(e){}}class s{constructor(e,t){this.nodeName=e,this.nodeValue=t,Object.defineProperty(this,"parentNode",{value:null,writable:!0})}get firstChild(){return this.childNodes&&this.childNodes[0]}get nextSibling(){const e=this.parentNode.childNodes;if(!e)return;const t=e.indexOf(this);return-1!==t?e[t+1]:void 0}get textContent(){return this.childNodes?this.childNodes.map(function(e){return e.textContent}).join(""):this.nodeValue||""}hasChildNodes(){return this.childNodes&&this.childNodes.length>0}searchNode(e,t){if(t>=e.length)return this;const n=e[t],r=[];let i=this;for(;;){if(n.name===i.nodeName){if(0!==n.pos){if(0===r.length)return null;{const[o]=r.pop();let s=0;for(const r of o.childNodes)if(n.name===r.nodeName){if(s===n.pos)return r.searchNode(e,t+1);s++}return i.searchNode(e,t+1)}}{const n=i.searchNode(e,t+1);if(null!==n)return n}}if(i.childNodes&&0!==i.childNodes.length)r.push([i,0]),i=i.childNodes[0];else{if(0===r.length)return null;for(;0!==r.length;){const[e,t]=r.pop(),n=t+1;if(n<e.childNodes.length){r.push([e,n]),i=e.childNodes[n];break}}if(0===r.length)return null}}}dump(e){if("#text"!==this.nodeName){if(e.push(`<${this.nodeName}`),this.attributes)for(const t of this.attributes)e.push(` ${t.name}="${(0,n.encodeToXmlString)(t.value)}"`);if(this.hasChildNodes()){e.push(">");for(const t of this.childNodes)t.dump(e);e.push(`</${this.nodeName}>`)}else this.nodeValue?e.push(`>${(0,n.encodeToXmlString)(this.nodeValue)}</${this.nodeName}>`):e.push("/>")}else e.push((0,n.encodeToXmlString)(this.nodeValue))}}exports.SimpleDOMNode=s;exports.SimpleXMLParser=class extends o{constructor({hasAttributes:e=!1,lowerCaseName:t=!1}){super(),this._currentFragment=null,this._stack=null,this._errorCode=r.NoError,this._hasAttributes=e,this._lowerCaseName=t}parseFromString(e){if(this._currentFragment=[],this._stack=[],this._errorCode=r.NoError,this.parseXml(e),this._errorCode!==r.NoError)return;const[t]=this._currentFragment;return t?{documentElement:t}:void 0}onResolveEntity(e){switch(e){case"apos":return"'"}return super.onResolveEntity(e)}onText(e){if(function(e){for(let t=0,n=e.length;t<n;t++)if(!i(e,t))return!1;return!0}(e))return;const t=new s("#text",e);this._currentFragment.push(t)}onCdata(e){const t=new s("#text",e);this._currentFragment.push(t)}onBeginElement(e,t,n){this._lowerCaseName&&(e=e.toLowerCase());const r=new s(e);r.childNodes=[],this._hasAttributes&&(r.attributes=t),this._currentFragment.push(r),n||(this._stack.push(this._currentFragment),this._currentFragment=r.childNodes)}onEndElement(e){this._currentFragment=this._stack.pop()||[];const t=this._currentFragment[this._currentFragment.length-1];if(t)for(let e=0,n=t.childNodes.length;e<n;e++)t.childNodes[e].parentNode=t}onError(e){this._errorCode=e}}},(e,exports,t)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.OptionalContentConfig=void 0;var n=t(2);class r{constructor(e,t){this.visible=!0,this.name=e,this.intent=t}}exports.OptionalContentConfig=class{constructor(e){if(this.name=null,this.creator=null,this._order=null,this._groups=new Map,null!==e){this.name=e.name,this.creator=e.creator,this._order=e.order;for(const t of e.groups)this._groups.set(t.id,new r(t.name,t.intent));if("OFF"===e.baseState)for(const e of this._groups)e.visible=!1;for(const t of e.on)this._groups.get(t).visible=!0;for(const t of e.off)this._groups.get(t).visible=!1}}isVisible(e){if("OCG"===e.type)return this._groups.has(e.id)?this._groups.get(e.id).visible:((0,n.warn)(`Optional content group not found: ${e.id}`),!0);if("OCMD"===e.type){if(e.expression&&(0,n.warn)("Visibility expression not supported yet."),!e.policy||"AnyOn"===e.policy){for(const t of e.ids){if(!this._groups.has(t))return(0,n.warn)(`Optional content group not found: ${t}`),!0;if(this._groups.get(t).visible)return!0}return!1}if("AllOn"===e.policy){for(const t of e.ids){if(!this._groups.has(t))return(0,n.warn)(`Optional content group not found: ${t}`),!0;if(!this._groups.get(t).visible)return!1}return!0}if("AnyOff"===e.policy){for(const t of e.ids){if(!this._groups.has(t))return(0,n.warn)(`Optional content group not found: ${t}`),!0;if(!this._groups.get(t).visible)return!0}return!1}if("AllOff"===e.policy){for(const t of e.ids){if(!this._groups.has(t))return(0,n.warn)(`Optional content group not found: ${t}`),!0;if(this._groups.get(t).visible)return!1}return!0}return(0,n.warn)(`Unknown optional content policy ${e.policy}.`),!0}return(0,n.warn)(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0){this._groups.has(e)?this._groups.get(e).visible=!!t:(0,n.warn)(`Optional content group not found: ${e}`)}getOrder(){return this._groups.size?this._order?this._order.slice():Array.from(this._groups.keys()):null}getGroups(){return this._groups.size?(0,n.objectFromEntries)(this._groups):null}getGroup(e){return this._groups.get(e)||null}}},(e,exports,t)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.PDFDataTransportStream=void 0;var n=t(2);exports.PDFDataTransportStream=class{constructor(e,t){(0,n.assert)(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=e.progressiveDone||!1;const r=e.initialData;if(r&&r.length>0){const e=new Uint8Array(r).buffer;this._queuedChunks.push(e)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._contentLength=e.length,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((e,t)=>{this._onReceiveData({begin:e,chunk:t})}),this._pdfDataRangeTransport.addProgressListener((e,t)=>{this._onProgress({loaded:e,total:t})}),this._pdfDataRangeTransport.addProgressiveReadListener(e=>{this._onReceiveData({chunk:e})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData(e){const t=new Uint8Array(e.chunk).buffer;if(void 0===e.begin)this._fullRequestReader?this._fullRequestReader._enqueue(t):this._queuedChunks.push(t);else{const r=this._rangeReaders.some(function(n){return n._begin===e.begin&&(n._enqueue(t),!0)});(0,n.assert)(r,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader&&this._fullRequestReader._loaded||0}_onProgress(e){if(void 0===e.total){const t=this._rangeReaders[0];t&&t.onProgress&&t.onProgress({loaded:e.loaded})}else{const t=this._fullRequestReader;t&&t.onProgress&&t.onProgress({loaded:e.loaded,total:e.total})}}_onProgressiveDone(){this._fullRequestReader&&this._fullRequestReader.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){(0,n.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new r(this,e,this._progressiveDone)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new i(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader&&this._fullRequestReader.cancel(e);const t=this._rangeReaders.slice(0);t.forEach(function(t){t.cancel(e)}),this._pdfDataRangeTransport.abort()}};class r{constructor(e,t,n=!1){this._stream=e,this._done=n||!1,this._filename=null,this._queuedChunks=t||[],this._loaded=0;for(const e of this._queuedChunks)this._loaded+=e.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length>0){const t=this._requests.shift();t.resolve({value:e,done:!1})}else this._queuedChunks.push(e);this._loaded+=e.byteLength}}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0){const e=this._queuedChunks.shift();return{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const e=(0,n.createPromiseCapability)();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._requests.forEach(function(e){e.resolve({value:void 0,done:!0})}),this._requests=[]}progressiveDone(){this._done||(this._done=!0)}}class i{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(0===this._requests.length)this._queuedChunk=e;else{const t=this._requests.shift();t.resolve({value:e,done:!1}),this._requests.forEach(function(e){e.resolve({value:void 0,done:!0})}),this._requests=[]}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const e=(0,n.createPromiseCapability)();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._requests.forEach(function(e){e.resolve({value:void 0,done:!0})}),this._requests=[],this._stream._removeRangeReader(this)}}},(e,exports,t)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebGLContext=void 0;var n=t(2);exports.WebGLContext=class{constructor({enable:e=!1}){this._enabled=!0===e}get isEnabled(){let e=this._enabled;return e&&(e=r.tryInitGL()),(0,n.shadow)(this,"isEnabled",e)}composeSMask({layer:e,mask:t,properties:n}){return r.composeSMask(e,t,n)}drawFigures({width:e,height:t,backgroundColor:n,figures:i,context:o}){return r.drawFigures(e,t,n,i,o)}clear(){r.cleanup()}};const r=function(){function e(e,t,n){const r=e.createShader(n);e.shaderSource(r,t),e.compileShader(r);const i=e.getShaderParameter(r,e.COMPILE_STATUS);if(!i){const t=e.getShaderInfoLog(r);throw new Error("Error during shader compilation: "+t)}return r}function t(t,n){return e(t,n,t.VERTEX_SHADER)}function n(t,n){return e(t,n,t.FRAGMENT_SHADER)}function r(e,t){const n=e.createProgram();for(let r=0,i=t.length;r<i;++r)e.attachShader(n,t[r]);e.linkProgram(n);const r=e.getProgramParameter(n,e.LINK_STATUS);if(!r){const t=e.getProgramInfoLog(n);throw new Error("Error during program linking: "+t)}return n}function i(e,t,n){e.activeTexture(n);const r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),r}let o,s;function a(){o||(s=document.createElement("canvas"),o=s.getContext("webgl",{premultipliedalpha:!1}))}const l="    attribute vec2 a_position;                                        attribute vec2 a_texCoord;                                                                                                          uniform vec2 u_resolution;                                                                                                          varying vec2 v_texCoord;                                                                                                            void main() {                                                       vec2 clipSpace = (a_position / u_resolution) * 2.0 - 1.0;         gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);                                                                                  v_texCoord = a_texCoord;                                        }                                                             ",c="    precision mediump float;                                                                                                            uniform vec4 u_backdrop;                                          uniform int u_subtype;                                            uniform sampler2D u_image;                                        uniform sampler2D u_mask;                                                                                                           varying vec2 v_texCoord;                                                                                                            void main() {                                                       vec4 imageColor = texture2D(u_image, v_texCoord);                 vec4 maskColor = texture2D(u_mask, v_texCoord);                   if (u_backdrop.a > 0.0) {                                           maskColor.rgb = maskColor.rgb * maskColor.a +                                     u_backdrop.rgb * (1.0 - maskColor.a);           }                                                                 float lum;                                                        if (u_subtype == 0) {                                               lum = maskColor.a;                                              } else {                                                            lum = maskColor.r * 0.3 + maskColor.g * 0.59 +                          maskColor.b * 0.11;                                       }                                                                 imageColor.a *= lum;                                              imageColor.rgb *= imageColor.a;                                   gl_FragColor = imageColor;                                      }                                                             ";let u=null;const d="    attribute vec2 a_position;                                        attribute vec3 a_color;                                                                                                             uniform vec2 u_resolution;                                        uniform vec2 u_scale;                                             uniform vec2 u_offset;                                                                                                              varying vec4 v_color;                                                                                                               void main() {                                                       vec2 position = (a_position + u_offset) * u_scale;                vec2 clipSpace = (position / u_resolution) * 2.0 - 1.0;           gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);                                                                                  v_color = vec4(a_color / 255.0, 1.0);                           }                                                             ",h="    precision mediump float;                                                                                                            varying vec4 v_color;                                                                                                               void main() {                                                       gl_FragColor = v_color;                                         }                                                             ";let p=null;return{tryInitGL(){try{return a(),!!o}catch(e){}return!1},composeSMask:function(e,d,h){const p=e.width,f=e.height;u||function(){a();const e=s;s=null;const i=o;o=null;const d=t(i,l),h=n(i,c),p=r(i,[d,h]);i.useProgram(p);const f={};f.gl=i,f.canvas=e,f.resolutionLocation=i.getUniformLocation(p,"u_resolution"),f.positionLocation=i.getAttribLocation(p,"a_position"),f.backdropLocation=i.getUniformLocation(p,"u_backdrop"),f.subtypeLocation=i.getUniformLocation(p,"u_subtype");const m=i.getAttribLocation(p,"a_texCoord"),g=i.getUniformLocation(p,"u_image"),b=i.getUniformLocation(p,"u_mask"),y=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,y),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),i.STATIC_DRAW),i.enableVertexAttribArray(m),i.vertexAttribPointer(m,2,i.FLOAT,!1,0,0),i.uniform1i(g,0),i.uniform1i(b,1),u=f}();const m=u,g=m.canvas,b=m.gl;g.width=p,g.height=f,b.viewport(0,0,b.drawingBufferWidth,b.drawingBufferHeight),b.uniform2f(m.resolutionLocation,p,f),h.backdrop?b.uniform4f(m.resolutionLocation,h.backdrop[0],h.backdrop[1],h.backdrop[2],1):b.uniform4f(m.resolutionLocation,0,0,0,0);b.uniform1i(m.subtypeLocation,"Luminosity"===h.subtype?1:0);const y=i(b,e,b.TEXTURE0),v=i(b,d,b.TEXTURE1),S=b.createBuffer();return b.bindBuffer(b.ARRAY_BUFFER,S),b.bufferData(b.ARRAY_BUFFER,new Float32Array([0,0,p,0,0,f,0,f,p,0,p,f]),b.STATIC_DRAW),b.enableVertexAttribArray(m.positionLocation),b.vertexAttribPointer(m.positionLocation,2,b.FLOAT,!1,0,0),b.clearColor(0,0,0,0),b.enable(b.BLEND),b.blendFunc(b.ONE,b.ONE_MINUS_SRC_ALPHA),b.clear(b.COLOR_BUFFER_BIT),b.drawArrays(b.TRIANGLES,0,6),b.flush(),b.deleteTexture(y),b.deleteTexture(v),b.deleteBuffer(S),g},drawFigures:function(e,i,l,c,u){p||function(){a();const e=s;s=null;const i=o;o=null;const l=t(i,d),c=n(i,h),u=r(i,[l,c]);i.useProgram(u);const f={};f.gl=i,f.canvas=e,f.resolutionLocation=i.getUniformLocation(u,"u_resolution"),f.scaleLocation=i.getUniformLocation(u,"u_scale"),f.offsetLocation=i.getUniformLocation(u,"u_offset"),f.positionLocation=i.getAttribLocation(u,"a_position"),f.colorLocation=i.getAttribLocation(u,"a_color"),p=f}();const f=p,m=f.canvas,g=f.gl;m.width=e,m.height=i,g.viewport(0,0,g.drawingBufferWidth,g.drawingBufferHeight),g.uniform2f(f.resolutionLocation,e,i);let b=0;for(let e=0,t=c.length;e<t;e++)switch(c[e].type){case"lattice":const t=c[e].coords.length/c[e].verticesPerRow|0;b+=(t-1)*(c[e].verticesPerRow-1)*6;break;case"triangles":b+=c[e].coords.length}const y=new Float32Array(2*b),v=new Uint8Array(3*b),S=u.coords,C=u.colors;let x=0,A=0;for(let e=0,t=c.length;e<t;e++){const t=c[e],n=t.coords,r=t.colors;switch(t.type){case"lattice":const e=t.verticesPerRow,i=n.length/e|0;for(let t=1;t<i;t++){let i=t*e+1;for(let t=1;t<e;t++,i++)y[x]=S[n[i-e-1]],y[x+1]=S[n[i-e-1]+1],y[x+2]=S[n[i-e]],y[x+3]=S[n[i-e]+1],y[x+4]=S[n[i-1]],y[x+5]=S[n[i-1]+1],v[A]=C[r[i-e-1]],v[A+1]=C[r[i-e-1]+1],v[A+2]=C[r[i-e-1]+2],v[A+3]=C[r[i-e]],v[A+4]=C[r[i-e]+1],v[A+5]=C[r[i-e]+2],v[A+6]=C[r[i-1]],v[A+7]=C[r[i-1]+1],v[A+8]=C[r[i-1]+2],y[x+6]=y[x+2],y[x+7]=y[x+3],y[x+8]=y[x+4],y[x+9]=y[x+5],y[x+10]=S[n[i]],y[x+11]=S[n[i]+1],v[A+9]=v[A+3],v[A+10]=v[A+4],v[A+11]=v[A+5],v[A+12]=v[A+6],v[A+13]=v[A+7],v[A+14]=v[A+8],v[A+15]=C[r[i]],v[A+16]=C[r[i]+1],v[A+17]=C[r[i]+2],x+=12,A+=18}break;case"triangles":for(let e=0,t=n.length;e<t;e++)y[x]=S[n[e]],y[x+1]=S[n[e]+1],v[A]=C[r[e]],v[A+1]=C[r[e]+1],v[A+2]=C[r[e]+2],x+=2,A+=3}}l?g.clearColor(l[0]/255,l[1]/255,l[2]/255,1):g.clearColor(0,0,0,0);g.clear(g.COLOR_BUFFER_BIT);const w=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,w),g.bufferData(g.ARRAY_BUFFER,y,g.STATIC_DRAW),g.enableVertexAttribArray(f.positionLocation),g.vertexAttribPointer(f.positionLocation,2,g.FLOAT,!1,0,0);const _=g.createBuffer();return g.bindBuffer(g.ARRAY_BUFFER,_),g.bufferData(g.ARRAY_BUFFER,v,g.STATIC_DRAW),g.enableVertexAttribArray(f.colorLocation),g.vertexAttribPointer(f.colorLocation,3,g.UNSIGNED_BYTE,!1,0,0),g.uniform2f(f.scaleLocation,u.scaleX,u.scaleY),g.uniform2f(f.offsetLocation,u.offsetX,u.offsetY),g.drawArrays(g.TRIANGLES,0,b),g.flush(),g.deleteBuffer(w),g.deleteBuffer(_),m},cleanup(){u&&u.canvas&&(u.canvas.width=0,u.canvas.height=0),p&&p.canvas&&(p.canvas.width=0,p.canvas.height=0),u=null,p=null}}}()},(e,exports,t)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.AnnotationLayer=void 0;var n=t(1),r=t(2),i=t(8),o=t(20);class s{static create(e){const t=e.data.annotationType;switch(t){case r.AnnotationType.LINK:return new l(e);case r.AnnotationType.TEXT:return new c(e);case r.AnnotationType.WIDGET:const n=e.data.fieldType;switch(n){case"Tx":return new d(e);case"Btn":return e.data.radioButton?new p(e):e.data.checkBox?new h(e):new f(e);case"Ch":return new m(e)}return new u(e);case r.AnnotationType.POPUP:return new g(e);case r.AnnotationType.FREETEXT:return new y(e);case r.AnnotationType.LINE:return new v(e);case r.AnnotationType.SQUARE:return new S(e);case r.AnnotationType.CIRCLE:return new C(e);case r.AnnotationType.POLYLINE:return new x(e);case r.AnnotationType.CARET:return new w(e);case r.AnnotationType.INK:return new _(e);case r.AnnotationType.POLYGON:return new A(e);case r.AnnotationType.HIGHLIGHT:return new N(e);case r.AnnotationType.UNDERLINE:return new E(e);case r.AnnotationType.SQUIGGLY:return new T(e);case r.AnnotationType.STRIKEOUT:return new k(e);case r.AnnotationType.STAMP:return new P(e);case r.AnnotationType.FILEATTACHMENT:return new R(e);default:return new a(e)}}}class a{constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:r=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.page=e.page,this.viewport=e.viewport,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderInteractiveForms=e.renderInteractiveForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._mouseState=e.mouseState,t&&(this.container=this._createContainer(n)),r&&(this.quadrilaterals=this._createQuadrilaterals(n))}_createContainer(e=!1){const t=this.data,n=this.page,i=this.viewport,o=document.createElement("section");let s=t.rect[2]-t.rect[0],a=t.rect[3]-t.rect[1];o.setAttribute("data-annotation-id",t.id);const l=r.Util.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]);if(o.style.transform=`matrix(${i.transform.join(",")})`,o.style.transformOrigin=`${-l[0]}px ${-l[1]}px`,!e&&t.borderStyle.width>0){o.style.borderWidth=`${t.borderStyle.width}px`,t.borderStyle.style!==r.AnnotationBorderStyleType.UNDERLINE&&(s-=2*t.borderStyle.width,a-=2*t.borderStyle.width);const e=t.borderStyle.horizontalCornerRadius,n=t.borderStyle.verticalCornerRadius;if(e>0||n>0){const t=`${e}px / ${n}px`;o.style.borderRadius=t}switch(t.borderStyle.style){case r.AnnotationBorderStyleType.SOLID:o.style.borderStyle="solid";break;case r.AnnotationBorderStyleType.DASHED:o.style.borderStyle="dashed";break;case r.AnnotationBorderStyleType.BEVELED:(0,r.warn)("Unimplemented border style: beveled");break;case r.AnnotationBorderStyleType.INSET:(0,r.warn)("Unimplemented border style: inset");break;case r.AnnotationBorderStyleType.UNDERLINE:o.style.borderBottomStyle="solid"}t.color?o.style.borderColor=r.Util.makeHexColor(0|t.color[0],0|t.color[1],0|t.color[2]):o.style.borderWidth=0}return o.style.left=`${l[0]}px`,o.style.top=`${l[1]}px`,o.style.width=`${s}px`,o.style.height=`${a}px`,o}_createQuadrilaterals(e=!1){if(!this.data.quadPoints)return null;const t=[],n=this.data.rect;for(const n of this.data.quadPoints)this.data.rect=[n[2].x,n[2].y,n[1].x,n[1].y],t.push(this._createContainer(e));return this.data.rect=n,t}_createPopup(e,t){let n=this.container;this.quadrilaterals&&(e=e||this.quadrilaterals,n=this.quadrilaterals[0]),e||((e=document.createElement("div")).style.height=n.style.height,e.style.width=n.style.width,n.appendChild(e));const r=new b({container:n,trigger:e,color:t.color,title:t.title,modificationDate:t.modificationDate,contents:t.contents,hideWrapper:!0}),i=r.render();i.style.left=n.style.width,n.appendChild(i)}_renderQuadrilaterals(e){return this.quadrilaterals.forEach(t=>{t.className=e}),this.quadrilaterals}render(){(0,r.unreachable)("Abstract method `AnnotationElement.render` called")}}class l extends a{constructor(e){const t=!!(e.data.url||e.data.dest||e.data.action||e.data.isTooltipOnly||e.data.actions&&(e.data.actions.Action||e.data.actions["Mouse Up"]||e.data.actions["Mouse Down"]));super(e,{isRenderable:t,createQuadrilaterals:!0})}render(){const{data:e,linkService:t}=this,r=document.createElement("a");return e.url?(0,n.addLinkAttributes)(r,{url:e.url,target:e.newWindow?n.LinkTarget.BLANK:t.externalLinkTarget,rel:t.externalLinkRel,enabled:t.externalLinkEnabled}):e.action?this._bindNamedAction(r,e.action):e.dest?this._bindLink(r,e.dest):e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions?this._bindJSAction(r,e):this._bindLink(r,""),this.quadrilaterals?this._renderQuadrilaterals("linkAnnotation").map((e,t)=>{const n=0===t?r:r.cloneNode();return e.appendChild(n),e}):(this.container.className="linkAnnotation",this.container.appendChild(r),this.container)}_bindLink(e,t){e.href=this.linkService.getDestinationHash(t),e.onclick=(()=>(t&&this.linkService.goToDestination(t),!1)),(t||""===t)&&(e.className="internalLink")}_bindNamedAction(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=(()=>(this.linkService.executeNamedAction(t),!1)),e.className="internalLink"}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");const n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const r of Object.keys(t.actions)){const i=n.get(r);i&&(e[i]=(()=>(this.linkService.eventBus&&this.linkService.eventBus.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:r}}),!1)))}e.className="internalLink"}}class c extends a{constructor(e){const t=!!(e.data.hasPopup||e.data.title||e.data.contents);super(e,{isRenderable:t})}render(){this.container.className="textAnnotation";const e=document.createElement("img");return e.style.height=this.container.style.height,e.style.width=this.container.style.width,e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.alt="[{{type}} Annotation]",e.dataset.l10nId="text_annotation_type",e.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.hasPopup||this._createPopup(e,this.data),this.container.appendChild(e),this.container}}class u extends a{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}_getKeyModifier(e){return navigator.platform.includes("Win")&&e.ctrlKey||navigator.platform.includes("Mac")&&e.metaKey}_setEventListener(e,t,n,r){t.includes("mouse")?e.addEventListener(t,e=>{this.linkService.eventBus&&this.linkService.eventBus.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:r(e),shift:e.shiftKey,modifier:this._getKeyModifier(e)}})}):e.addEventListener(t,e=>{this.linkService.eventBus&&this.linkService.eventBus.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:e.target.checked}})})}_setEventListeners(e,t,n){for(const[r,i]of t)("Action"===i||this.data.actions&&this.data.actions[i])&&this._setEventListener(e,r,i,n)}}class d extends u{constructor(e){const t=e.renderInteractiveForms||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}render(){const e=this.annotationStorage,t=this.data.id;this.container.className="textWidgetAnnotation";let n=null;if(this.renderInteractiveForms){const r=e.getOrCreateValue(t,{value:this.data.fieldValue}).value,i={userValue:null,formattedValue:null,beforeInputSelectionRange:null,beforeInputValue:null};this.data.multiLine?(n=document.createElement("textarea")).textContent=r:((n=document.createElement("input")).type="text",n.setAttribute("value",r)),i.userValue=r,n.setAttribute("id",t),n.addEventListener("input",function(n){e.setValue(t,{value:n.target.value})});let s=e=>{i.formattedValue&&(e.target.value=i.formattedValue),e.target.setSelectionRange(0,0),i.beforeInputSelectionRange=null};if(this.enableScripting&&this.hasJSActions&&(n.addEventListener("focus",e=>{i.userValue&&(e.target.value=i.userValue)}),n.addEventListener("updatefromsandbox",function(n){const{detail:r}=n,s={value(){i.userValue=r.value||"",e.setValue(t,{value:i.userValue.toString()}),i.formattedValue||(n.target.value=i.userValue)},valueAsString(){i.formattedValue=r.valueAsString||"",n.target!==document.activeElement&&(n.target.value=i.formattedValue),e.setValue(t,{formattedValue:i.formattedValue})},focus(){setTimeout(()=>n.target.focus({preventScroll:!1}),0)},userName(){n.target.title=r.userName},hidden(){n.target.style.visibility=r.hidden?"hidden":"visible",e.setValue(t,{hidden:r.hidden})},editable(){n.target.disabled=!r.editable},selRange(){const[e,t]=r.selRange;e>=0&&t<n.target.value.length&&n.target.setSelectionRange(e,t)},strokeColor(){const e=r.strokeColor;n.target.style.color=o.ColorConverters[`${e[0]}_HTML`](e.slice(1))}};Object.keys(r).filter(e=>e in s).forEach(e=>s[e]())}),this.data.actions)){n.addEventListener("keydown",e=>{i.beforeInputValue=e.target.value;let n=-1;"Escape"===e.key?n=0:"Enter"===e.key?n=2:"Tab"===e.key&&(n=3),-1!==n&&(i.userValue=e.target.value,this.linkService.eventBus&&this.linkService.eventBus.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:e.target.value,willCommit:!0,commitKey:n,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}))});const e=s;s=null,n.addEventListener("blur",n=>{this._mouseState.isDown&&(i.userValue=n.target.value,this.linkService.eventBus&&this.linkService.eventBus.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:n.target.value,willCommit:!0,commitKey:1,selStart:n.target.selectionStart,selEnd:n.target.selectionEnd}})),e(n)}),n.addEventListener("mousedown",e=>{i.beforeInputValue=e.target.value,i.beforeInputSelectionRange=null}),n.addEventListener("keyup",e=>{e.target.selectionStart===e.target.selectionEnd&&(i.beforeInputSelectionRange=null)}),n.addEventListener("select",e=>{i.beforeInputSelectionRange=[e.target.selectionStart,e.target.selectionEnd]}),"Keystroke"in this.data.actions&&n.addEventListener("input",e=>{let n=-1,r=-1;i.beforeInputSelectionRange&&([n,r]=i.beforeInputSelectionRange),this.linkService.eventBus&&this.linkService.eventBus.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:i.beforeInputValue,change:e.data,willCommit:!1,selStart:n,selEnd:r}})}),this._setEventListeners(n,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],e=>e.target.value)}if(s&&n.addEventListener("blur",s),n.disabled=this.data.readOnly,n.name=this.data.fieldName,null!==this.data.maxLen&&(n.maxLength=this.data.maxLen),this.data.comb){const e=this.data.rect[2]-this.data.rect[0],t=e/this.data.maxLen;n.classList.add("comb"),n.style.letterSpacing=`calc(${t}px - 1ch)`}}else(n=document.createElement("div")).textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell";return this._setTextStyle(n),this.container.appendChild(n),this.container}_setTextStyle(e){const t=["left","center","right"],{fontSize:n,fontColor:i}=this.data.defaultAppearanceData,o=e.style;n&&(o.fontSize=`${n}px`),o.color=r.Util.makeHexColor(i[0],i[1],i[2]),null!==this.data.textAlignment&&(o.textAlign=t[this.data.textAlignment])}}class h extends u{constructor(e){super(e,{isRenderable:e.renderInteractiveForms})}render(){const e=this.annotationStorage,t=this.data,n=t.id,r=e.getOrCreateValue(n,{value:t.fieldValue&&"Off"!==t.fieldValue}).value;this.container.className="buttonWidgetAnnotation checkBox";const i=document.createElement("input");return i.disabled=t.readOnly,i.type="checkbox",i.name=this.data.fieldName,r&&i.setAttribute("checked",!0),i.setAttribute("id",n),i.addEventListener("change",function(t){const r=t.target.name;for(const n of document.getElementsByName(r))n!==t.target&&(n.checked=!1,e.setValue(n.parentNode.getAttribute("data-annotation-id"),{value:!1}));e.setValue(n,{value:t.target.checked})}),this.enableScripting&&this.hasJSActions&&(i.addEventListener("updatefromsandbox",t=>{const{detail:r}=t,i={value(){t.target.checked="Off"!==r.value,e.setValue(n,{value:t.target.checked})},focus(){setTimeout(()=>t.target.focus({preventScroll:!1}),0)},hidden(){t.target.style.visibility=r.hidden?"hidden":"visible",e.setValue(n,{hidden:r.hidden})},editable(){t.target.disabled=!r.editable}};Object.keys(r).filter(e=>e in i).forEach(e=>i[e]())}),this._setEventListeners(i,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],e=>e.target.checked)),this.container.appendChild(i),this.container}}class p extends u{constructor(e){super(e,{isRenderable:e.renderInteractiveForms})}render(){this.container.className="buttonWidgetAnnotation radioButton";const e=this.annotationStorage,t=this.data,n=t.id,r=e.getOrCreateValue(n,{value:t.fieldValue===t.buttonValue}).value,i=document.createElement("input");return i.disabled=t.readOnly,i.type="radio",i.name=t.fieldName,r&&i.setAttribute("checked",!0),i.setAttribute("pdfButtonValue",t.buttonValue),i.setAttribute("id",n),i.addEventListener("change",function(t){const{target:r}=t;for(const t of document.getElementsByName(r.name))t!==r&&e.setValue(t.getAttribute("id"),{value:!1});e.setValue(n,{value:r.checked})}),this.enableScripting&&this.hasJSActions&&(i.addEventListener("updatefromsandbox",t=>{const{detail:r}=t,i={value(){const n=r.value;for(const r of document.getElementsByName(t.target.name)){const t=r.getAttribute("id");n===r.getAttribute("pdfButtonValue")?(r.setAttribute("checked",!0),e.setValue(t,{value:!0})):e.setValue(t,{value:!1})}},focus(){setTimeout(()=>t.target.focus({preventScroll:!1}),0)},hidden(){t.target.style.visibility=r.hidden?"hidden":"visible",e.setValue(n,{hidden:r.hidden})},editable(){t.target.disabled=!r.editable}};Object.keys(r).filter(e=>e in i).forEach(e=>i[e]())}),this._setEventListeners(i,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],e=>e.target.checked)),this.container.appendChild(i),this.container}}class f extends l{render(){const e=super.render();return e.className="buttonWidgetAnnotation pushButton",this.data.alternativeText&&(e.title=this.data.alternativeText),e}}class m extends u{constructor(e){super(e,{isRenderable:e.renderInteractiveForms})}render(){this.container.className="choiceWidgetAnnotation";const e=this.annotationStorage,t=this.data.id;e.getOrCreateValue(t,{value:this.data.fieldValue.length>0?this.data.fieldValue[0]:void 0});const n=document.createElement("select");n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.setAttribute("id",t),this.data.combo||(n.size=this.data.options.length,this.data.multiSelect&&(n.multiple=!0));for(const e of this.data.options){const t=document.createElement("option");t.textContent=e.displayValue,t.value=e.exportValue,this.data.fieldValue.includes(e.exportValue)&&t.setAttribute("selected",!0),n.appendChild(t)}function r(e){const t=e.target.options;return t[t.selectedIndex].value}return this.enableScripting&&this.hasJSActions?(n.addEventListener("updatefromsandbox",n=>{const{detail:r}=n,i={value(){const i=n.target.options,o=r.value,s=i.indexOf(o);-1!==s&&(i.selectedIndex=s,e.setValue(t,{value:o}))},focus(){setTimeout(()=>n.target.focus({preventScroll:!1}),0)},hidden(){n.target.style.visibility=r.hidden?"hidden":"visible",e.setValue(t,{hidden:r.hidden})},editable(){n.target.disabled=!r.editable}};Object.keys(r).filter(e=>e in i).forEach(e=>i[e]())}),n.addEventListener("input",n=>{const i=r(n);e.setValue(t,{value:i}),this.linkService.eventBus&&this.linkService.eventBus.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",changeEx:i,willCommit:!0,commitKey:1,keyDown:!1}})}),this._setEventListeners(n,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],e=>e.target.checked)):n.addEventListener("input",function(n){e.setValue(t,{value:r(n)})}),this.container.appendChild(n),this.container}}class g extends a{constructor(e){const t=!(!e.data.title&&!e.data.contents);super(e,{isRenderable:t})}render(){if(this.container.className="popupAnnotation",["Line","Square","Circle","PolyLine","Polygon","Ink"].includes(this.data.parentType))return this.container;const e=`[data-annotation-id="${this.data.parentId}"]`,t=this.layer.querySelectorAll(e);if(0===t.length)return this.container;const n=new b({container:this.container,trigger:Array.from(t),color:this.data.color,title:this.data.title,modificationDate:this.data.modificationDate,contents:this.data.contents}),i=this.page,o=r.Util.normalizeRect([this.data.parentRect[0],i.view[3]-this.data.parentRect[1]+i.view[1],this.data.parentRect[2],i.view[3]-this.data.parentRect[3]+i.view[1]]),s=o[0]+this.data.parentRect[2]-this.data.parentRect[0],a=o[1];return this.container.style.transformOrigin=`${-s}px ${-a}px`,this.container.style.left=`${s}px`,this.container.style.top=`${a}px`,this.container.appendChild(n.render()),this.container}}class b{constructor(e){this.container=e.container,this.trigger=e.trigger,this.color=e.color,this.title=e.title,this.modificationDate=e.modificationDate,this.contents=e.contents,this.hideWrapper=e.hideWrapper||!1,this.pinned=!1}render(){const e=document.createElement("div");e.className="popupWrapper",this.hideElement=this.hideWrapper?e:this.container,this.hideElement.setAttribute("hidden",!0);const t=document.createElement("div");t.className="popup";const i=this.color;if(i){const e=.7*(255-i[0])+i[0],n=.7*(255-i[1])+i[1],o=.7*(255-i[2])+i[2];t.style.backgroundColor=r.Util.makeHexColor(0|e,0|n,0|o)}const o=document.createElement("h1");o.textContent=this.title,t.appendChild(o);const s=n.PDFDateString.toDateObject(this.modificationDate);if(s){const e=document.createElement("span");e.textContent="{{date}}, {{time}}",e.dataset.l10nId="annotation_date_string",e.dataset.l10nArgs=JSON.stringify({date:s.toLocaleDateString(),time:s.toLocaleTimeString()}),t.appendChild(e)}const a=this._formatContents(this.contents);return t.appendChild(a),Array.isArray(this.trigger)||(this.trigger=[this.trigger]),this.trigger.forEach(e=>{e.addEventListener("click",this._toggle.bind(this)),e.addEventListener("mouseover",this._show.bind(this,!1)),e.addEventListener("mouseout",this._hide.bind(this,!1))}),t.addEventListener("click",this._hide.bind(this,!0)),e.appendChild(t),e}_formatContents(e){const t=document.createElement("p"),n=e.split(/(?:\r\n?|\n)/);for(let e=0,r=n.length;e<r;++e){const i=n[e];t.appendChild(document.createTextNode(i)),e<r-1&&t.appendChild(document.createElement("br"))}return t}_toggle(){this.pinned?this._hide(!0):this._show(!0)}_show(e=!1){e&&(this.pinned=!0),this.hideElement.hasAttribute("hidden")&&(this.hideElement.removeAttribute("hidden"),this.container.style.zIndex+=1)}_hide(e=!0){e&&(this.pinned=!1),this.hideElement.hasAttribute("hidden")||this.pinned||(this.hideElement.setAttribute("hidden",!0),this.container.style.zIndex-=1)}}class y extends a{constructor(e){const t=!!(e.data.hasPopup||e.data.title||e.data.contents);super(e,{isRenderable:t,ignoreBorder:!0})}render(){return this.container.className="freeTextAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class v extends a{constructor(e){const t=!!(e.data.hasPopup||e.data.title||e.data.contents);super(e,{isRenderable:t,ignoreBorder:!0})}render(){this.container.className="lineAnnotation";const e=this.data,t=e.rect[2]-e.rect[0],n=e.rect[3]-e.rect[1],r=this.svgFactory.create(t,n),i=this.svgFactory.createElement("svg:line");return i.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),i.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),i.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),i.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),i.setAttribute("stroke-width",e.borderStyle.width||1),i.setAttribute("stroke","transparent"),r.appendChild(i),this.container.append(r),this._createPopup(i,e),this.container}}class S extends a{constructor(e){const t=!!(e.data.hasPopup||e.data.title||e.data.contents);super(e,{isRenderable:t,ignoreBorder:!0})}render(){this.container.className="squareAnnotation";const e=this.data,t=e.rect[2]-e.rect[0],n=e.rect[3]-e.rect[1],r=this.svgFactory.create(t,n),i=e.borderStyle.width,o=this.svgFactory.createElement("svg:rect");return o.setAttribute("x",i/2),o.setAttribute("y",i/2),o.setAttribute("width",t-i),o.setAttribute("height",n-i),o.setAttribute("stroke-width",i||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","none"),r.appendChild(o),this.container.append(r),this._createPopup(o,e),this.container}}class C extends a{constructor(e){const t=!!(e.data.hasPopup||e.data.title||e.data.contents);super(e,{isRenderable:t,ignoreBorder:!0})}render(){this.container.className="circleAnnotation";const e=this.data,t=e.rect[2]-e.rect[0],n=e.rect[3]-e.rect[1],r=this.svgFactory.create(t,n),i=e.borderStyle.width,o=this.svgFactory.createElement("svg:ellipse");return o.setAttribute("cx",t/2),o.setAttribute("cy",n/2),o.setAttribute("rx",t/2-i/2),o.setAttribute("ry",n/2-i/2),o.setAttribute("stroke-width",i||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","none"),r.appendChild(o),this.container.append(r),this._createPopup(o,e),this.container}}class x extends a{constructor(e){const t=!!(e.data.hasPopup||e.data.title||e.data.contents);super(e,{isRenderable:t,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;const e=this.data,t=e.rect[2]-e.rect[0],n=e.rect[3]-e.rect[1],r=this.svgFactory.create(t,n);let i=[];for(const t of e.vertices){const n=t.x-e.rect[0],r=e.rect[3]-t.y;i.push(n+","+r)}i=i.join(" ");const o=this.svgFactory.createElement(this.svgElementName);return o.setAttribute("points",i),o.setAttribute("stroke-width",e.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","none"),r.appendChild(o),this.container.append(r),this._createPopup(o,e),this.container}}class A extends x{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class w extends a{constructor(e){const t=!!(e.data.hasPopup||e.data.title||e.data.contents);super(e,{isRenderable:t,ignoreBorder:!0})}render(){return this.container.className="caretAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class _ extends a{constructor(e){const t=!!(e.data.hasPopup||e.data.title||e.data.contents);super(e,{isRenderable:t,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;const e=this.data,t=e.rect[2]-e.rect[0],n=e.rect[3]-e.rect[1],r=this.svgFactory.create(t,n);for(const t of e.inkLists){let n=[];for(const r of t){const t=r.x-e.rect[0],i=e.rect[3]-r.y;n.push(`${t},${i}`)}n=n.join(" ");const i=this.svgFactory.createElement(this.svgElementName);i.setAttribute("points",n),i.setAttribute("stroke-width",e.borderStyle.width||1),i.setAttribute("stroke","transparent"),i.setAttribute("fill","none"),this._createPopup(i,e),r.appendChild(i)}return this.container.append(r),this.container}}class N extends a{constructor(e){const t=!!(e.data.hasPopup||e.data.title||e.data.contents);super(e,{isRenderable:t,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("highlightAnnotation"):(this.container.className="highlightAnnotation",this.container)}}class E extends a{constructor(e){const t=!!(e.data.hasPopup||e.data.title||e.data.contents);super(e,{isRenderable:t,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("underlineAnnotation"):(this.container.className="underlineAnnotation",this.container)}}class T extends a{constructor(e){const t=!!(e.data.hasPopup||e.data.title||e.data.contents);super(e,{isRenderable:t,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("squigglyAnnotation"):(this.container.className="squigglyAnnotation",this.container)}}class k extends a{constructor(e){const t=!!(e.data.hasPopup||e.data.title||e.data.contents);super(e,{isRenderable:t,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("strikeoutAnnotation"):(this.container.className="strikeoutAnnotation",this.container)}}class P extends a{constructor(e){const t=!!(e.data.hasPopup||e.data.title||e.data.contents);super(e,{isRenderable:t,ignoreBorder:!0})}render(){return this.container.className="stampAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class R extends a{constructor(e){super(e,{isRenderable:!0});const{filename:t,content:i}=this.data.file;this.filename=(0,n.getFilenameFromUrl)(t),this.content=i,this.linkService.eventBus&&this.linkService.eventBus.dispatch("fileattachmentannotation",{source:this,id:(0,r.stringToPDFString)(t),filename:t,content:i})}render(){this.container.className="fileAttachmentAnnotation";const e=document.createElement("div");return e.style.height=this.container.style.height,e.style.width=this.container.style.width,e.addEventListener("dblclick",this._download.bind(this)),this.data.hasPopup||!this.data.title&&!this.data.contents||this._createPopup(e,this.data),this.container.appendChild(e),this.container}_download(){this.downloadManager?this.downloadManager.downloadData(this.content,this.filename,""):(0,r.warn)("Download cannot be started due to unavailable download manager")}}exports.AnnotationLayer=class{static render(e){const t=[],o=[];for(const n of e.annotations)n&&(n.annotationType!==r.AnnotationType.POPUP?t.push(n):o.push(n));o.length&&t.push(...o);for(const r of t){const t=s.create({data:r,layer:e.div,page:e.page,viewport:e.viewport,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderInteractiveForms:"boolean"!=typeof e.renderInteractiveForms||e.renderInteractiveForms,svgFactory:new n.DOMSVGFactory,annotationStorage:e.annotationStorage||new i.AnnotationStorage,enableScripting:e.enableScripting,hasJSActions:e.hasJSActions,mouseState:e.mouseState||{isDown:!1}});if(t.isRenderable){const n=t.render();if(r.hidden&&(n.style.visibility="hidden"),Array.isArray(n))for(const t of n)e.div.appendChild(t);else t instanceof g?e.div.prepend(n):e.div.appendChild(n)}}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;for(const n of e.annotations){const r=e.div.querySelectorAll(`[data-annotation-id="${n.id}"]`);r&&r.forEach(e=>{e.style.transform=t})}e.div.removeAttribute("hidden")}}},(e,exports)=>{function t(e){return Math.floor(255*Math.max(0,Math.min(1,e))).toString(16).padStart(2,"0")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ColorConverters=void 0;exports.ColorConverters=class{static CMYK_G([e,t,n,r]){return["G",1-Math.min(1,.3*e+.59*n+.11*t+r)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_HTML([e]){const n=t(e);return`#${n}${n}${n}`}static RGB_G([e,t,n]){return["G",.3*e+.59*t+.11*n]}static RGB_HTML([e,n,r]){const i=t(e),o=t(n),s=t(r);return`#${i}${o}${s}`}static T_HTML(){return"#00000000"}static CMYK_RGB([e,t,n,r]){return["RGB",1-Math.min(1,e+r),1-Math.min(1,n+r),1-Math.min(1,t+r)]}static CMYK_HTML(e){return this.RGB_HTML(this.CMYK_RGB(e))}static RGB_CMYK([e,t,n]){const r=1-e,i=1-t,o=1-n,s=Math.min(r,i,o);return["CMYK",r,i,o,s]}}},(e,exports,t)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.renderTextLayer=void 0;var n=t(2);const r=function(){const e=1e5,t=/\S/;function r(e,r,i){const o=document.createElement("span"),s={angle:0,canvasWidth:0,isWhitespace:!1,originalTransform:null,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,scale:1};if(e._textDivs.push(o),a=r.str,!t.test(a))return s.isWhitespace=!0,void e._textDivProperties.set(o,s);var a;const l=n.Util.transform(e._viewport.transform,r.transform);let c=Math.atan2(l[1],l[0]);const u=i[r.fontName];u.vertical&&(c+=Math.PI/2);const d=Math.sqrt(l[2]*l[2]+l[3]*l[3]);let h,p,f=d;u.ascent?f=u.ascent*f:u.descent&&(f=(1+u.descent)*f),0===c?(h=l[4],p=l[5]-f):(h=l[4]+f*Math.sin(c),p=l[5]-f*Math.cos(c)),o.style.left=`${h}px`,o.style.top=`${p}px`,o.style.fontSize=`${d}px`,o.style.fontFamily=u.fontFamily,o.textContent=r.str,e._fontInspectorEnabled&&(o.dataset.fontName=r.fontName),0!==c&&(s.angle=c*(180/Math.PI));let m=!1;if(r.str.length>1)m=!0;else if(r.transform[0]!==r.transform[3]){const e=Math.abs(r.transform[0]),t=Math.abs(r.transform[3]);e!==t&&Math.max(e,t)/Math.min(e,t)>1.5&&(m=!0)}if(m&&(u.vertical?s.canvasWidth=r.height*e._viewport.scale:s.canvasWidth=r.width*e._viewport.scale),e._textDivProperties.set(o,s),e._textContentStream&&e._layoutText(o),e._enhanceTextSelection){let t=1,i=0;0!==c&&(t=Math.cos(c),i=Math.sin(c));const s=(u.vertical?r.height:r.width)*e._viewport.scale,a=d;let l,f;0!==c?(l=[t,i,-i,t,h,p],f=n.Util.getAxialAlignedBoundingBox([0,0,s,a],l)):f=[h,p,h+s,p+a],e._bounds.push({left:f[0],top:f[1],right:f[2],bottom:f[3],div:o,size:[s,a],m:l})}}function i(t){if(t._canceled)return;const n=t._textDivs,r=t._capability,i=n.length;if(i>e)return t._renderingDone=!0,void r.resolve();if(!t._textContentStream)for(let e=0;e<i;e++)t._layoutText(n[e]);t._renderingDone=!0,r.resolve()}function o(e,t,n){let r=0;for(let i=0;i<n;i++){const n=e[t++];n>0&&(r=r?Math.min(n,r):n)}return r}function s(e){const t=e._bounds,r=e._viewport,i=function(e,t,n){const r=n.map(function(e,t){return{x1:e.left,y1:e.top,x2:e.right,y2:e.bottom,index:t,x1New:void 0,x2New:void 0}});a(e,r);const i=new Array(n.length);return r.forEach(function(e){const t=e.index;i[t]={left:e.x1New,top:0,right:e.x2New,bottom:0}}),n.map(function(t,n){const o=i[n],s=r[n];s.x1=t.top,s.y1=e-o.right,s.x2=t.bottom,s.y2=e-o.left,s.index=n,s.x1New=void 0,s.x2New=void 0}),a(t,r),r.forEach(function(e){const t=e.index;i[t].top=e.x1New,i[t].bottom=e.x2New}),i}(r.width,r.height,t);for(let r=0;r<i.length;r++){const s=t[r].div,a=e._textDivProperties.get(s);if(0===a.angle){a.paddingLeft=t[r].left-i[r].left,a.paddingTop=t[r].top-i[r].top,a.paddingRight=i[r].right-t[r].right,a.paddingBottom=i[r].bottom-t[r].bottom,e._textDivProperties.set(s,a);continue}const l=i[r],c=t[r],u=c.m,d=u[0],h=u[1],p=[[0,0],[0,c.size[1]],[c.size[0],0],c.size],f=new Float64Array(64);p.forEach(function(e,t){const r=n.Util.applyTransform(e,u);f[t+0]=d&&(l.left-r[0])/d,f[t+4]=h&&(l.top-r[1])/h,f[t+8]=d&&(l.right-r[0])/d,f[t+12]=h&&(l.bottom-r[1])/h,f[t+16]=h&&(l.left-r[0])/-h,f[t+20]=d&&(l.top-r[1])/d,f[t+24]=h&&(l.right-r[0])/-h,f[t+28]=d&&(l.bottom-r[1])/d,f[t+32]=d&&(l.left-r[0])/-d,f[t+36]=h&&(l.top-r[1])/-h,f[t+40]=d&&(l.right-r[0])/-d,f[t+44]=h&&(l.bottom-r[1])/-h,f[t+48]=h&&(l.left-r[0])/h,f[t+52]=d&&(l.top-r[1])/-d,f[t+56]=h&&(l.right-r[0])/h,f[t+60]=d&&(l.bottom-r[1])/-d});const m=1+Math.min(Math.abs(d),Math.abs(h));a.paddingLeft=o(f,32,16)/m,a.paddingTop=o(f,48,16)/m,a.paddingRight=o(f,0,16)/m,a.paddingBottom=o(f,16,16)/m,e._textDivProperties.set(s,a)}}function a(e,t){t.sort(function(e,t){return e.x1-t.x1||e.index-t.index});const n={x1:-1/0,y1:-1/0,x2:0,y2:1/0,index:-1,x1New:0,x2New:0},r=[{start:-1/0,end:1/0,boundary:n}];t.forEach(function(e){let t=0;for(;t<r.length&&r[t].end<=e.y1;)t++;let n,i,o=r.length-1;for(;o>=0&&r[o].start>=e.y2;)o--;let s,a,l=-1/0;for(s=t;s<=o;s++){let t;n=r[s],i=n.boundary,(t=i.x2>e.x1?i.index>e.index?i.x1New:e.x1:void 0===i.x2New?(i.x2+e.x1)/2:i.x2New)>l&&(l=t)}for(e.x1New=l,s=t;s<=o;s++)n=r[s],void 0===(i=n.boundary).x2New?i.x2>e.x1?i.index>e.index&&(i.x2New=i.x2):i.x2New=l:i.x2New>l&&(i.x2New=Math.max(l,i.x2));const c=[];let u=null;for(s=t;s<=o;s++){n=r[s];const t=(i=n.boundary).x2>e.x2?i:e;u===t?c[c.length-1].end=n.end:(c.push({start:n.start,end:n.end,boundary:t}),u=t)}for(r[t].start<e.y1&&(c[0].start=e.y1,c.unshift({start:r[t].start,end:e.y1,boundary:r[t].boundary})),e.y2<r[o].end&&(c[c.length-1].end=e.y2,c.push({start:e.y2,end:r[o].end,boundary:r[o].boundary})),s=t;s<=o;s++){if(n=r[s],void 0!==(i=n.boundary).x2New)continue;let e=!1;for(a=t-1;!e&&a>=0&&r[a].start>=i.y1;a--)e=r[a].boundary===i;for(a=o+1;!e&&a<r.length&&r[a].end<=i.y2;a++)e=r[a].boundary===i;for(a=0;!e&&a<c.length;a++)e=c[a].boundary===i;e||(i.x2New=l)}Array.prototype.splice.apply(r,[t,o-t+1].concat(c))}),r.forEach(function(t){const n=t.boundary;void 0===n.x2New&&(n.x2New=Math.max(e,n.x2))})}function l({textContent:e,textContentStream:t,container:r,viewport:i,textDivs:o,textContentItemsStr:s,enhanceTextSelection:a}){this._textContent=e,this._textContentStream=t,this._container=r,this._document=r.ownerDocument,this._viewport=i,this._textDivs=o||[],this._textContentItemsStr=s||[],this._enhanceTextSelection=!!a,this._fontInspectorEnabled=!(!globalThis.FontInspector||!globalThis.FontInspector.enabled),this._reader=null,this._layoutTextLastFontSize=null,this._layoutTextLastFontFamily=null,this._layoutTextCtx=null,this._textDivProperties=new WeakMap,this._renderingDone=!1,this._canceled=!1,this._capability=(0,n.createPromiseCapability)(),this._renderTimer=null,this._bounds=[],this._capability.promise.finally(()=>{this._layoutTextCtx&&(this._layoutTextCtx.canvas.width=0,this._layoutTextCtx.canvas.height=0,this._layoutTextCtx=null)}).catch(()=>{})}return l.prototype={get promise(){return this._capability.promise},cancel:function(){this._canceled=!0,this._reader&&(this._reader.cancel(new n.AbortException("TextLayer task cancelled.")),this._reader=null),null!==this._renderTimer&&(clearTimeout(this._renderTimer),this._renderTimer=null),this._capability.reject(new Error("TextLayer task cancelled."))},_processItems(e,t){for(let n=0,i=e.length;n<i;n++)this._textContentItemsStr.push(e[n].str),r(this,e[n],t)},_layoutText(e){const t=this._textDivProperties.get(e);if(t.isWhitespace)return;let n="";if(0!==t.canvasWidth){const{fontSize:r,fontFamily:i}=e.style;r===this._layoutTextLastFontSize&&i===this._layoutTextLastFontFamily||(this._layoutTextCtx.font=`${r} ${i}`,this._layoutTextLastFontSize=r,this._layoutTextLastFontFamily=i);const{width:o}=this._layoutTextCtx.measureText(e.textContent);o>0&&(t.scale=t.canvasWidth/o,n=`scaleX(${t.scale})`)}0!==t.angle&&(n=`rotate(${t.angle}deg) ${n}`),n.length>0&&(this._enhanceTextSelection&&(t.originalTransform=n),e.style.transform=n),this._textDivProperties.set(e,t),this._container.appendChild(e)},_render:function(e){const t=(0,n.createPromiseCapability)();let r=Object.create(null);const o=this._document.createElement("canvas");if(o.mozOpaque=!0,this._layoutTextCtx=o.getContext("2d",{alpha:!1}),this._textContent){const e=this._textContent.items,n=this._textContent.styles;this._processItems(e,n),t.resolve()}else{if(!this._textContentStream)throw new Error('Neither "textContent" nor "textContentStream" parameters specified.');{const e=()=>{this._reader.read().then(({value:n,done:i})=>{i?t.resolve():(Object.assign(r,n.styles),this._processItems(n.items,r),e())},t.reject)};this._reader=this._textContentStream.getReader(),e()}}t.promise.then(()=>{r=null,e?this._renderTimer=setTimeout(()=>{i(this),this._renderTimer=null},e):i(this)},this._capability.reject)},expandTextDivs:function(e){if(!this._enhanceTextSelection||!this._renderingDone)return;null!==this._bounds&&(s(this),this._bounds=null);const t=[],n=[];for(let r=0,i=this._textDivs.length;r<i;r++){const i=this._textDivs[r],o=this._textDivProperties.get(i);o.isWhitespace||(e?(t.length=0,n.length=0,o.originalTransform&&t.push(o.originalTransform),o.paddingTop>0?(n.push(`${o.paddingTop}px`),t.push(`translateY(${-o.paddingTop}px)`)):n.push(0),o.paddingRight>0?n.push(`${o.paddingRight/o.scale}px`):n.push(0),o.paddingBottom>0?n.push(`${o.paddingBottom}px`):n.push(0),o.paddingLeft>0?(n.push(`${o.paddingLeft/o.scale}px`),t.push(`translateX(${-o.paddingLeft/o.scale}px)`)):n.push(0),i.style.padding=n.join(" "),t.length&&(i.style.transform=t.join(" "))):(i.style.padding=null,i.style.transform=o.originalTransform))}}},function(e){const t=new l({textContent:e.textContent,textContentStream:e.textContentStream,container:e.container,viewport:e.viewport,textDivs:e.textDivs,textContentItemsStr:e.textContentItemsStr,enhanceTextSelection:e.enhanceTextSelection});return t._render(e.timeout),t}}();exports.renderTextLayer=r},(e,exports,t)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.SVGGraphics=void 0;var n=t(2),r=t(1),i=t(4);let o=function(){throw new Error("Not implemented: SVGGraphics")};exports.SVGGraphics=o;{const e={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},t="http://www.w3.org/XML/1998/namespace",l="http://www.w3.org/1999/xlink",c=["butt","round","square"],u=["miter","round","bevel"],d=function(){const e=new Uint8Array([137,80,78,71,13,10,26,10]),t=12,r=new Int32Array(256);for(let e=0;e<256;e++){let t=e;for(let e=0;e<8;e++)t=1&t?3988292384^t>>1&2147483647:t>>1&2147483647;r[e]=t}function o(e,t,n,i){let o=i;const s=t.length;n[o]=s>>24&255,n[o+1]=s>>16&255,n[o+2]=s>>8&255,n[o+3]=255&s,n[o+=4]=255&e.charCodeAt(0),n[o+1]=255&e.charCodeAt(1),n[o+2]=255&e.charCodeAt(2),n[o+3]=255&e.charCodeAt(3),o+=4,n.set(t,o),o+=t.length;const a=function(e,t,n){let i=-1;for(let o=t;o<n;o++){const t=255&(i^e[o]),n=r[t];i=i>>>8^n}return-1^i}(n,i+4,o);n[o]=a>>24&255,n[o+1]=a>>16&255,n[o+2]=a>>8&255,n[o+3]=255&a}function s(e){let t=e.length;const n=Math.ceil(t/65535),r=new Uint8Array(2+t+5*n+4);let i=0;r[i++]=120,r[i++]=156;let o=0;for(;t>65535;)r[i++]=0,r[i++]=255,r[i++]=255,r[i++]=0,r[i++]=0,r.set(e.subarray(o,o+65535),i),i+=65535,o+=65535,t-=65535;r[i++]=1,r[i++]=255&t,r[i++]=t>>8&255,r[i++]=255&~t,r[i++]=(65535&~t)>>8&255,r.set(e.subarray(o),i),i+=e.length-o;const s=function(e,t,n){let r=1,i=0;for(let o=t;o<n;++o)r=(r+(255&e[o]))%65521,i=(i+r)%65521;return i<<16|r}(e,0,e.length);return r[i++]=s>>24&255,r[i++]=s>>16&255,r[i++]=s>>8&255,r[i++]=255&s,r}function a(r,a,l,c){const u=r.width,d=r.height;let h,p,f;const m=r.data;switch(a){case n.ImageKind.GRAYSCALE_1BPP:p=0,h=1,f=u+7>>3;break;case n.ImageKind.RGB_24BPP:p=2,h=8,f=3*u;break;case n.ImageKind.RGBA_32BPP:p=6,h=8,f=4*u;break;default:throw new Error("invalid format")}const g=new Uint8Array((1+f)*d);let b=0,y=0;for(let e=0;e<d;++e)g[b++]=0,g.set(m.subarray(y,y+f),b),y+=f,b+=f;if(a===n.ImageKind.GRAYSCALE_1BPP&&c){b=0;for(let e=0;e<d;e++){b++;for(let e=0;e<f;e++)g[b++]^=255}}const v=new Uint8Array([u>>24&255,u>>16&255,u>>8&255,255&u,d>>24&255,d>>16&255,d>>8&255,255&d,h,p,0,0,0]),S=function(e){if(!i.isNodeJS)return s(e);try{let t;t=parseInt(process.versions.node)>=8?e:Buffer.from(e);const r=require("zlib").deflateSync(t,{level:9});return r instanceof Uint8Array?r:new Uint8Array(r)}catch(e){(0,n.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+e)}return s(e)}(g),C=e.length+3*t+v.length+S.length,x=new Uint8Array(C);let A=0;return x.set(e,A),A+=e.length,o("IHDR",v,x,A),A+=t+v.length,o("IDATA",S,x,A),A+=t+S.length,o("IEND",new Uint8Array(0),x,A),(0,n.createObjectURL)(x,"image/png",l)}return function(e,t,r){const i=void 0===e.kind?n.ImageKind.GRAYSCALE_1BPP:e.kind;return a(e,i,t,r)}}();class h{constructor(){this.fontSizeScale=1,this.fontWeight=e.fontWeight,this.fontSize=0,this.textMatrix=n.IDENTITY_MATRIX,this.fontMatrix=n.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=n.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=e.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(e,t){this.x=e,this.y=t}}function s(e){if(Number.isInteger(e))return e.toString();const t=e.toFixed(10);let n=t.length-1;if("0"!==t[n])return t;do{n--}while("0"===t[n]);return t.substring(0,"."===t[n]?n:n+1)}function a(e){if(0===e[4]&&0===e[5]){if(0===e[1]&&0===e[2])return 1===e[0]&&1===e[3]?"":`scale(${s(e[0])} ${s(e[3])})`;if(e[0]===e[3]&&e[1]===-e[2]){const t=180*Math.acos(e[0])/Math.PI;return`rotate(${s(t)})`}}else if(1===e[0]&&0===e[1]&&0===e[2]&&1===e[3])return`translate(${s(e[4])} ${s(e[5])})`;return`matrix(${s(e[0])} ${s(e[1])} ${s(e[2])} ${s(e[3])} ${s(e[4])} `+`${s(e[5])})`}let p=0,f=0,m=0;exports.SVGGraphics=o=class{constructor(e,t,i=!1){this.svgFactory=new r.DOMSVGFactory,this.current=new h,this.transformMatrix=n.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=e,this.objs=t,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!i,this._operatorIdMapping=[];for(const e in n.OPS)this._operatorIdMapping[n.OPS[e]]=e}save(){this.transformStack.push(this.transformMatrix);const e=this.current;this.extraStack.push(e),this.current=e.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(e){this.save(),this.executeOpTree(e),this.restore()}loadDependencies(e){const t=e.fnArray,r=e.argsArray;for(let e=0,i=t.length;e<i;e++)if(t[e]===n.OPS.dependency)for(const t of r[e]){const e=t.startsWith("g_")?this.commonObjs:this.objs,n=new Promise(n=>{e.get(t,n)});this.current.dependencies.push(n)}return Promise.all(this.current.dependencies)}transform(e,t,r,i,o,s){const a=[e,t,r,i,o,s];this.transformMatrix=n.Util.transform(this.transformMatrix,a),this.tgrp=null}getSVG(e,t){this.viewport=t;const r=this._initialize(t);return this.loadDependencies(e).then(()=>(this.transformMatrix=n.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(e)),r))}convertOpList(e){const t=this._operatorIdMapping,n=e.argsArray,r=e.fnArray,i=[];for(let e=0,o=r.length;e<o;e++){const o=r[e];i.push({fnId:o,fn:t[o],args:n[e]})}return function(e){let t=[];const n=[];for(const r of e)"save"!==r.fn?"restore"===r.fn?t=n.pop():t.push(r):(t.push({fnId:92,fn:"group",items:[]}),n.push(t),t=t[t.length-1].items);return t}(i)}executeOpTree(e){for(const t of e){const e=t.fn,r=t.fnId,i=t.args;switch(0|r){case n.OPS.beginText:this.beginText();break;case n.OPS.dependency:break;case n.OPS.setLeading:this.setLeading(i);break;case n.OPS.setLeadingMoveText:this.setLeadingMoveText(i[0],i[1]);break;case n.OPS.setFont:this.setFont(i);break;case n.OPS.showText:case n.OPS.showSpacedText:this.showText(i[0]);break;case n.OPS.endText:this.endText();break;case n.OPS.moveText:this.moveText(i[0],i[1]);break;case n.OPS.setCharSpacing:this.setCharSpacing(i[0]);break;case n.OPS.setWordSpacing:this.setWordSpacing(i[0]);break;case n.OPS.setHScale:this.setHScale(i[0]);break;case n.OPS.setTextMatrix:this.setTextMatrix(i[0],i[1],i[2],i[3],i[4],i[5]);break;case n.OPS.setTextRise:this.setTextRise(i[0]);break;case n.OPS.setTextRenderingMode:this.setTextRenderingMode(i[0]);break;case n.OPS.setLineWidth:this.setLineWidth(i[0]);break;case n.OPS.setLineJoin:this.setLineJoin(i[0]);break;case n.OPS.setLineCap:this.setLineCap(i[0]);break;case n.OPS.setMiterLimit:this.setMiterLimit(i[0]);break;case n.OPS.setFillRGBColor:this.setFillRGBColor(i[0],i[1],i[2]);break;case n.OPS.setStrokeRGBColor:this.setStrokeRGBColor(i[0],i[1],i[2]);break;case n.OPS.setStrokeColorN:this.setStrokeColorN(i);break;case n.OPS.setFillColorN:this.setFillColorN(i);break;case n.OPS.shadingFill:this.shadingFill(i[0]);break;case n.OPS.setDash:this.setDash(i[0],i[1]);break;case n.OPS.setRenderingIntent:this.setRenderingIntent(i[0]);break;case n.OPS.setFlatness:this.setFlatness(i[0]);break;case n.OPS.setGState:this.setGState(i[0]);break;case n.OPS.fill:this.fill();break;case n.OPS.eoFill:this.eoFill();break;case n.OPS.stroke:this.stroke();break;case n.OPS.fillStroke:this.fillStroke();break;case n.OPS.eoFillStroke:this.eoFillStroke();break;case n.OPS.clip:this.clip("nonzero");break;case n.OPS.eoClip:this.clip("evenodd");break;case n.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case n.OPS.paintImageXObject:this.paintImageXObject(i[0]);break;case n.OPS.paintInlineImageXObject:this.paintInlineImageXObject(i[0]);break;case n.OPS.paintImageMaskXObject:this.paintImageMaskXObject(i[0]);break;case n.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(i[0],i[1]);break;case n.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case n.OPS.closePath:this.closePath();break;case n.OPS.closeStroke:this.closeStroke();break;case n.OPS.closeFillStroke:this.closeFillStroke();break;case n.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case n.OPS.nextLine:this.nextLine();break;case n.OPS.transform:this.transform(i[0],i[1],i[2],i[3],i[4],i[5]);break;case n.OPS.constructPath:this.constructPath(i[0],i[1]);break;case n.OPS.endPath:this.endPath();break;case 92:this.group(t.items);break;default:(0,n.warn)(`Unimplemented operator ${e}`)}}}setWordSpacing(e){this.current.wordSpacing=e}setCharSpacing(e){this.current.charSpacing=e}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(e,t,n,r,i,o){const a=this.current;a.textMatrix=a.lineMatrix=[e,t,n,r,i,o],a.textMatrixScale=Math.sqrt(e*e+t*t),a.x=a.lineX=0,a.y=a.lineY=0,a.xcoords=[],a.ycoords=[],a.tspan=this.svgFactory.createElement("svg:tspan"),a.tspan.setAttributeNS(null,"font-family",a.fontFamily),a.tspan.setAttributeNS(null,"font-size",`${s(a.fontSize)}px`),a.tspan.setAttributeNS(null,"y",s(-a.y)),a.txtElement=this.svgFactory.createElement("svg:text"),a.txtElement.appendChild(a.tspan)}beginText(){const e=this.current;e.x=e.lineX=0,e.y=e.lineY=0,e.textMatrix=n.IDENTITY_MATRIX,e.lineMatrix=n.IDENTITY_MATRIX,e.textMatrixScale=1,e.tspan=this.svgFactory.createElement("svg:tspan"),e.txtElement=this.svgFactory.createElement("svg:text"),e.txtgrp=this.svgFactory.createElement("svg:g"),e.xcoords=[],e.ycoords=[]}moveText(e,t){const n=this.current;n.x=n.lineX+=e,n.y=n.lineY+=t,n.xcoords=[],n.ycoords=[],n.tspan=this.svgFactory.createElement("svg:tspan"),n.tspan.setAttributeNS(null,"font-family",n.fontFamily),n.tspan.setAttributeNS(null,"font-size",`${s(n.fontSize)}px`),n.tspan.setAttributeNS(null,"y",s(-n.y))}showText(r){const i=this.current,o=i.font,l=i.fontSize;if(0===l)return;const c=i.fontSizeScale,u=i.charSpacing,d=i.wordSpacing,h=i.fontDirection,p=i.textHScale*h,f=o.vertical,m=f?1:-1,g=o.defaultVMetrics,b=l*i.fontMatrix[0];let y=0;for(const e of r){if(null===e){y+=h*d;continue}if((0,n.isNum)(e)){y+=m*e*l/1e3;continue}const t=(e.isSpace?d:0)+u,r=e.fontChar;let s,a,p,v=e.width;if(f){let t;const n=e.vmetric||g;t=-(t=e.vmetric?n[1]:.5*v)*b;const r=n[2]*b;v=n?-n[0]:v,s=t/c,a=(y+r)/c}else s=y/c,a=0;(e.isInFont||o.missingFile)&&(i.xcoords.push(i.x+s),f&&i.ycoords.push(-i.y+a),i.tspan.textContent+=r),y+=p=f?v*b-t*h:v*b+t*h}i.tspan.setAttributeNS(null,"x",i.xcoords.map(s).join(" ")),f?i.tspan.setAttributeNS(null,"y",i.ycoords.map(s).join(" ")):i.tspan.setAttributeNS(null,"y",s(-i.y)),f?i.y-=y:i.x+=y*p,i.tspan.setAttributeNS(null,"font-family",i.fontFamily),i.tspan.setAttributeNS(null,"font-size",`${s(i.fontSize)}px`),i.fontStyle!==e.fontStyle&&i.tspan.setAttributeNS(null,"font-style",i.fontStyle),i.fontWeight!==e.fontWeight&&i.tspan.setAttributeNS(null,"font-weight",i.fontWeight);const v=i.textRenderingMode&n.TextRenderingMode.FILL_STROKE_MASK;if(v===n.TextRenderingMode.FILL||v===n.TextRenderingMode.FILL_STROKE?(i.fillColor!==e.fillColor&&i.tspan.setAttributeNS(null,"fill",i.fillColor),i.fillAlpha<1&&i.tspan.setAttributeNS(null,"fill-opacity",i.fillAlpha)):i.textRenderingMode===n.TextRenderingMode.ADD_TO_PATH?i.tspan.setAttributeNS(null,"fill","transparent"):i.tspan.setAttributeNS(null,"fill","none"),v===n.TextRenderingMode.STROKE||v===n.TextRenderingMode.FILL_STROKE){const e=1/(i.textMatrixScale||1);this._setStrokeAttributes(i.tspan,e)}let S=i.textMatrix;0!==i.textRise&&((S=S.slice())[5]+=i.textRise),i.txtElement.setAttributeNS(null,"transform",`${a(S)} scale(${s(p)}, -1)`),i.txtElement.setAttributeNS(t,"xml:space","preserve"),i.txtElement.appendChild(i.tspan),i.txtgrp.appendChild(i.txtElement),this._ensureTransformGroup().appendChild(i.txtElement)}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}addFontStyle(e){if(!e.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.appendChild(this.cssStyle));const t=(0,n.createObjectURL)(e.data,e.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${e.loadedName}";`+` src: url(${t}); }\n`}setFont(e){const t=this.current,r=this.commonObjs.get(e[0]);let i=e[1];t.font=r,!this.embedFonts||r.missingFile||this.embeddedFonts[r.loadedName]||(this.addFontStyle(r),this.embeddedFonts[r.loadedName]=r),t.fontMatrix=r.fontMatrix||n.FONT_IDENTITY_MATRIX;let o="normal";r.black?o="900":r.bold&&(o="bold");const a=r.italic?"italic":"normal";i<0?(i=-i,t.fontDirection=-1):t.fontDirection=1,t.fontSize=i,t.fontFamily=r.loadedName,t.fontWeight=o,t.fontStyle=a,t.tspan=this.svgFactory.createElement("svg:tspan"),t.tspan.setAttributeNS(null,"y",s(-t.y)),t.xcoords=[],t.ycoords=[]}endText(){const e=this.current;e.textRenderingMode&n.TextRenderingMode.ADD_TO_PATH_FLAG&&e.txtElement&&e.txtElement.hasChildNodes()&&(e.element=e.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(e){e>0&&(this.current.lineWidth=e)}setLineCap(e){this.current.lineCap=c[e]}setLineJoin(e){this.current.lineJoin=u[e]}setMiterLimit(e){this.current.miterLimit=e}setStrokeAlpha(e){this.current.strokeAlpha=e}setStrokeRGBColor(e,t,r){this.current.strokeColor=n.Util.makeHexColor(e,t,r)}setFillAlpha(e){this.current.fillAlpha=e}setFillRGBColor(e,t,r){this.current.fillColor=n.Util.makeHexColor(e,t,r),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(e){this.current.strokeColor=this._makeColorN_Pattern(e)}setFillColorN(e){this.current.fillColor=this._makeColorN_Pattern(e)}shadingFill(e){const t=this.viewport.width,r=this.viewport.height,i=n.Util.inverseTransform(this.transformMatrix),o=n.Util.applyTransform([0,0],i),s=n.Util.applyTransform([0,r],i),a=n.Util.applyTransform([t,0],i),l=n.Util.applyTransform([t,r],i),c=Math.min(o[0],s[0],a[0],l[0]),u=Math.min(o[1],s[1],a[1],l[1]),d=Math.max(o[0],s[0],a[0],l[0]),h=Math.max(o[1],s[1],a[1],l[1]),p=this.svgFactory.createElement("svg:rect");p.setAttributeNS(null,"x",c),p.setAttributeNS(null,"y",u),p.setAttributeNS(null,"width",d-c),p.setAttributeNS(null,"height",h-u),p.setAttributeNS(null,"fill",this._makeShadingPattern(e)),this.current.fillAlpha<1&&p.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().appendChild(p)}_makeColorN_Pattern(e){return"TilingPattern"===e[0]?this._makeTilingPattern(e):this._makeShadingPattern(e)}_makeTilingPattern(e){const t=e[1],r=e[2],i=e[3]||n.IDENTITY_MATRIX,[o,s,a,l]=e[4],c=e[5],u=e[6],d=e[7],h=`shading${m++}`,[p,f]=n.Util.applyTransform([o,s],i),[g,b]=n.Util.applyTransform([a,l],i),[y,v]=n.Util.singularValueDecompose2dScale(i),S=c*y,C=u*v,x=this.svgFactory.createElement("svg:pattern");x.setAttributeNS(null,"id",h),x.setAttributeNS(null,"patternUnits","userSpaceOnUse"),x.setAttributeNS(null,"width",S),x.setAttributeNS(null,"height",C),x.setAttributeNS(null,"x",`${p}`),x.setAttributeNS(null,"y",`${f}`);const A=this.svg,w=this.transformMatrix,_=this.current.fillColor,N=this.current.strokeColor,E=this.svgFactory.create(g-p,b-f);if(this.svg=E,this.transformMatrix=i,2===d){const e=n.Util.makeHexColor(...t);this.current.fillColor=e,this.current.strokeColor=e}return this.executeOpTree(this.convertOpList(r)),this.svg=A,this.transformMatrix=w,this.current.fillColor=_,this.current.strokeColor=N,x.appendChild(E.childNodes[0]),this.defs.appendChild(x),`url(#${h})`}_makeShadingPattern(e){switch(e[0]){case"RadialAxial":const t=`shading${m++}`,r=e[3];let i;switch(e[1]){case"axial":const n=e[4],r=e[5];(i=this.svgFactory.createElement("svg:linearGradient")).setAttributeNS(null,"id",t),i.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),i.setAttributeNS(null,"x1",n[0]),i.setAttributeNS(null,"y1",n[1]),i.setAttributeNS(null,"x2",r[0]),i.setAttributeNS(null,"y2",r[1]);break;case"radial":const o=e[4],s=e[5],a=e[6],l=e[7];(i=this.svgFactory.createElement("svg:radialGradient")).setAttributeNS(null,"id",t),i.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),i.setAttributeNS(null,"cx",s[0]),i.setAttributeNS(null,"cy",s[1]),i.setAttributeNS(null,"r",l),i.setAttributeNS(null,"fx",o[0]),i.setAttributeNS(null,"fy",o[1]),i.setAttributeNS(null,"fr",a);break;default:throw new Error(`Unknown RadialAxial type: ${e[1]}`)}for(const e of r){const t=this.svgFactory.createElement("svg:stop");t.setAttributeNS(null,"offset",e[0]),t.setAttributeNS(null,"stop-color",e[1]),i.appendChild(t)}return this.defs.appendChild(i),`url(#${t})`;case"Mesh":return(0,n.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${e[0]}`)}}setDash(e,t){this.current.dashArray=e,this.current.dashPhase=t}constructPath(e,t){const r=this.current;let i=r.x,o=r.y,a=[],l=0;for(const r of e)switch(0|r){case n.OPS.rectangle:i=t[l++],o=t[l++];const e=t[l++],c=t[l++],u=i+e,d=o+c;a.push("M",s(i),s(o),"L",s(u),s(o),"L",s(u),s(d),"L",s(i),s(d),"Z");break;case n.OPS.moveTo:i=t[l++],o=t[l++],a.push("M",s(i),s(o));break;case n.OPS.lineTo:i=t[l++],o=t[l++],a.push("L",s(i),s(o));break;case n.OPS.curveTo:i=t[l+4],o=t[l+5],a.push("C",s(t[l]),s(t[l+1]),s(t[l+2]),s(t[l+3]),s(i),s(o)),l+=6;break;case n.OPS.curveTo2:a.push("C",s(i),s(o),s(t[l]),s(t[l+1]),s(t[l+2]),s(t[l+3])),i=t[l+2],o=t[l+3],l+=4;break;case n.OPS.curveTo3:i=t[l+2],o=t[l+3],a.push("C",s(t[l]),s(t[l+1]),s(i),s(o),s(i),s(o)),l+=4;break;case n.OPS.closePath:a.push("Z")}a=a.join(" "),r.path&&e.length>0&&e[0]!==n.OPS.rectangle&&e[0]!==n.OPS.moveTo?a=r.path.getAttributeNS(null,"d")+a:(r.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().appendChild(r.path)),r.path.setAttributeNS(null,"d",a),r.path.setAttributeNS(null,"fill","none"),r.element=r.path,r.setCurrentPoint(i,o)}endPath(){const e=this.current;if(e.path=null,!this.pendingClip)return;if(!e.element)return void(this.pendingClip=null);const t=`clippath${p++}`,n=this.svgFactory.createElement("svg:clipPath");n.setAttributeNS(null,"id",t),n.setAttributeNS(null,"transform",a(this.transformMatrix));const r=e.element.cloneNode(!0);"evenodd"===this.pendingClip?r.setAttributeNS(null,"clip-rule","evenodd"):r.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,n.appendChild(r),this.defs.appendChild(n),e.activeClipUrl&&(e.clipGroup=null,this.extraStack.forEach(function(e){e.clipGroup=null}),n.setAttributeNS(null,"clip-path",e.activeClipUrl)),e.activeClipUrl=`url(#${t})`,this.tgrp=null}clip(e){this.pendingClip=e}closePath(){const e=this.current;if(e.path){const t=`${e.path.getAttributeNS(null,"d")}Z`;e.path.setAttributeNS(null,"d",t)}}setLeading(e){this.current.leading=-e}setTextRise(e){this.current.textRise=e}setTextRenderingMode(e){this.current.textRenderingMode=e}setHScale(e){this.current.textHScale=e/100}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,r]of e)switch(t){case"LW":this.setLineWidth(r);break;case"LC":this.setLineCap(r);break;case"LJ":this.setLineJoin(r);break;case"ML":this.setMiterLimit(r);break;case"D":this.setDash(r[0],r[1]);break;case"RI":this.setRenderingIntent(r);break;case"FL":this.setFlatness(r);break;case"Font":this.setFont(r);break;case"CA":this.setStrokeAlpha(r);break;case"ca":this.setFillAlpha(r);break;default:(0,n.warn)(`Unimplemented graphic state operator ${t}`)}}fill(){const e=this.current;e.element&&(e.element.setAttributeNS(null,"fill",e.fillColor),e.element.setAttributeNS(null,"fill-opacity",e.fillAlpha),this.endPath())}stroke(){const e=this.current;e.element&&(this._setStrokeAttributes(e.element),e.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(e,t=1){const n=this.current;let r=n.dashArray;1!==t&&r.length>0&&(r=r.map(function(e){return t*e})),e.setAttributeNS(null,"stroke",n.strokeColor),e.setAttributeNS(null,"stroke-opacity",n.strokeAlpha),e.setAttributeNS(null,"stroke-miterlimit",s(n.miterLimit)),e.setAttributeNS(null,"stroke-linecap",n.lineCap),e.setAttributeNS(null,"stroke-linejoin",n.lineJoin),e.setAttributeNS(null,"stroke-width",s(t*n.lineWidth)+"px"),e.setAttributeNS(null,"stroke-dasharray",r.map(s).join(" ")),e.setAttributeNS(null,"stroke-dashoffset",s(t*n.dashPhase)+"px")}eoFill(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const e=this.svgFactory.createElement("svg:rect");e.setAttributeNS(null,"x","0"),e.setAttributeNS(null,"y","0"),e.setAttributeNS(null,"width","1px"),e.setAttributeNS(null,"height","1px"),e.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().appendChild(e)}paintImageXObject(e){const t=e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e);t?this.paintInlineImageXObject(t):(0,n.warn)(`Dependent image with object ID ${e} is not ready yet`)}paintInlineImageXObject(e,t){const n=e.width,r=e.height,i=d(e,this.forceDataSchema,!!t),o=this.svgFactory.createElement("svg:rect");o.setAttributeNS(null,"x","0"),o.setAttributeNS(null,"y","0"),o.setAttributeNS(null,"width",s(n)),o.setAttributeNS(null,"height",s(r)),this.current.element=o,this.clip("nonzero");const a=this.svgFactory.createElement("svg:image");a.setAttributeNS(l,"xlink:href",i),a.setAttributeNS(null,"x","0"),a.setAttributeNS(null,"y",s(-r)),a.setAttributeNS(null,"width",s(n)+"px"),a.setAttributeNS(null,"height",s(r)+"px"),a.setAttributeNS(null,"transform",`scale(${s(1/n)} ${s(-1/r)})`),t?t.appendChild(a):this._ensureTransformGroup().appendChild(a)}paintImageMaskXObject(e){const t=this.current,n=e.width,r=e.height,i=t.fillColor;t.maskId=`mask${f++}`;const o=this.svgFactory.createElement("svg:mask");o.setAttributeNS(null,"id",t.maskId);const a=this.svgFactory.createElement("svg:rect");a.setAttributeNS(null,"x","0"),a.setAttributeNS(null,"y","0"),a.setAttributeNS(null,"width",s(n)),a.setAttributeNS(null,"height",s(r)),a.setAttributeNS(null,"fill",i),a.setAttributeNS(null,"mask",`url(#${t.maskId})`),this.defs.appendChild(o),this._ensureTransformGroup().appendChild(a),this.paintInlineImageXObject(e,o)}paintFormXObjectBegin(e,t){if(Array.isArray(e)&&6===e.length&&this.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t){const e=t[2]-t[0],n=t[3]-t[1],r=this.svgFactory.createElement("svg:rect");r.setAttributeNS(null,"x",t[0]),r.setAttributeNS(null,"y",t[1]),r.setAttributeNS(null,"width",s(e)),r.setAttributeNS(null,"height",s(n)),this.current.element=r,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(e){const t=this.svgFactory.create(e.width,e.height),n=this.svgFactory.createElement("svg:defs");t.appendChild(n),this.defs=n;const r=this.svgFactory.createElement("svg:g");return r.setAttributeNS(null,"transform",a(e.transform)),t.appendChild(r),this.svg=r,t}_ensureClipGroup(){if(!this.current.clipGroup){const e=this.svgFactory.createElement("svg:g");e.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.appendChild(e),this.current.clipGroup=e}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",a(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().appendChild(this.tgrp):this.svg.appendChild(this.tgrp)),this.tgrp}}}},(e,exports,t)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.PDFNodeStream=void 0;var n=t(2),r=t(24);const i=require("fs"),o=require("http"),s=require("https"),a=require("url"),l=/^file:\/\/\/[a-zA-Z]:\//;exports.PDFNodeStream=class{constructor(e){this.source=e,this.url=function(e){const t=a.parse(e);if("file:"===t.protocol||t.host)return t;if(/^[a-z]:[/\\]/i.test(e))return a.parse(`file:///${e}`);t.host||(t.protocol="file:");return t}(e.url),this.isHttp="http:"===this.url.protocol||"https:"===this.url.protocol,this.isFsUrl="file:"===this.url.protocol,this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader&&this._fullRequestReader._loaded||0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new f(this):new h(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=this.isFsUrl?new m(this,e,t):new p(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader&&this._fullRequestReader.cancel(e);const t=this._rangeRequestReaders.slice(0);t.forEach(function(t){t.cancel(e)})}};class c{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=(0,n.createPromiseCapability)(),this._headersCapability=(0,n.createPromiseCapability)()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();if(null===e)return this._readCapability=(0,n.createPromiseCapability)(),this.read();this._loaded+=e.length,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength});const t=new Uint8Array(e).buffer;return{value:t,done:!1}}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new n.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class u{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=(0,n.createPromiseCapability)();const t=e.source;this._isStreamingSupported=!t.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();if(null===e)return this._readCapability=(0,n.createPromiseCapability)(),this.read();this._loaded+=e.length,this.onProgress&&this.onProgress({loaded:this._loaded});const t=new Uint8Array(e).buffer;return{value:t,done:!1}}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function d(e,t){return{protocol:e.protocol,auth:e.auth,host:e.hostname,port:e.port,path:e.path,method:"GET",headers:t}}class h extends c{constructor(e){super(e);const t=t=>{if(404===t.statusCode){const e=new n.MissingPDFException(`Missing PDF "${this._url}".`);return this._storedError=e,void this._headersCapability.reject(e)}this._headersCapability.resolve(),this._setReadableStream(t);const i=e=>this._readableStream.headers[e.toLowerCase()],{allowRangeRequests:o,suggestedLength:s}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:i,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=s||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(i)};this._request=null,"http:"===this._url.protocol?this._request=o.request(d(this._url,e.httpHeaders),t):this._request=s.request(d(this._url,e.httpHeaders),t),this._request.on("error",e=>{this._storedError=e,this._headersCapability.reject(e)}),this._request.end()}}class p extends u{constructor(e,t,r){super(e),this._httpHeaders={};for(const t in e.httpHeaders){const n=e.httpHeaders[t];void 0!==n&&(this._httpHeaders[t]=n)}this._httpHeaders.Range=`bytes=${t}-${r-1}`;const i=e=>{if(404!==e.statusCode)this._setReadableStream(e);else{const e=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=e}};this._request=null,"http:"===this._url.protocol?this._request=o.request(d(this._url,this._httpHeaders),i):this._request=s.request(d(this._url,this._httpHeaders),i),this._request.on("error",e=>{this._storedError=e}),this._request.end()}}class f extends c{constructor(e){super(e);let t=decodeURIComponent(this._url.path);l.test(this._url.href)&&(t=t.replace(/^\//,"")),i.lstat(t,(e,r)=>{if(e)return"ENOENT"===e.code&&(e=new n.MissingPDFException(`Missing PDF "${t}".`)),this._storedError=e,void this._headersCapability.reject(e);this._contentLength=r.size,this._setReadableStream(i.createReadStream(t)),this._headersCapability.resolve()})}}class m extends u{constructor(e,t,n){super(e);let r=decodeURIComponent(this._url.path);l.test(this._url.href)&&(r=r.replace(/^\//,"")),this._setReadableStream(i.createReadStream(r,{start:t,end:n-1}))}}},(e,exports,t)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.createResponseStatusError=function(e,t){if(404===e||0===e&&t.startsWith("file:"))return new n.MissingPDFException('Missing PDF "'+t+'".');return new n.UnexpectedResponseException("Unexpected server response ("+e+') while retrieving PDF "'+t+'".',e)},exports.extractFilenameFromHeader=function(e){const t=e("Content-Disposition");if(t){let e=(0,r.getFilenameFromContentDispositionHeader)(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch(e){}if(/\.pdf$/i.test(e))return e}return null},exports.validateRangeRequestCapabilities=function({getResponseHeader:e,isHttp:t,rangeChunkSize:r,disableRange:i}){(0,n.assert)(r>0,"Range chunk size must be larger than zero");const o={allowRangeRequests:!1,suggestedLength:void 0},s=parseInt(e("Content-Length"),10);if(!Number.isInteger(s))return o;if(o.suggestedLength=s,s<=2*r)return o;if(i||!t)return o;if("bytes"!==e("Accept-Ranges"))return o;if("identity"!==(e("Content-Encoding")||"identity"))return o;return o.allowRangeRequests=!0,o},exports.validateResponseStatus=function(e){return 200===e||206===e};var n=t(2),r=t(25)},(e,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.getFilenameFromContentDispositionHeader=function(e){let t=!0,n=r("filename\\*","i").exec(e);if(n){let e=s(n=n[1]);return o(e=l(e=a(e=unescape(e))))}if(n=function(e){const t=[];let n;const i=r("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;null!==(n=i.exec(e));){let[,e,r,i]=n;if((e=parseInt(e,10))in t){if(0===e)break}else t[e]=[r,i]}const o=[];for(let e=0;e<t.length&&e in t;++e){let[n,r]=t[e];r=s(r),n&&(r=unescape(r),0===e&&(r=a(r))),o.push(r)}return o.join("")}(e)){const e=l(n);return o(e)}if(n=r("filename","i").exec(e)){let e=s(n=n[1]);return o(e=l(e))}function r(e,t){return new RegExp("(?:^|;)\\s*"+e+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',t)}function i(e,n){if(e){if(!/^[\x00-\xFF]+$/.test(n))return n;try{const r=new TextDecoder(e,{fatal:!0}),i=Array.from(n,function(e){return 255&e.charCodeAt(0)});n=r.decode(new Uint8Array(i)),t=!1}catch(r){if(/^utf-?8$/i.test(e))try{n=decodeURIComponent(escape(n)),t=!1}catch(e){}}}return n}function o(e){return t&&/[\x80-\xff]/.test(e)&&(e=i("utf-8",e),t&&(e=i("iso-8859-1",e))),e}function s(e){if(e.startsWith('"')){const t=e.slice(1).split('\\"');for(let e=0;e<t.length;++e){const n=t[e].indexOf('"');-1!==n&&(t[e]=t[e].slice(0,n),t.length=e+1),t[e]=t[e].replace(/\\(.)/g,"$1")}e=t.join('"')}return e}function a(e){const t=e.indexOf("'");if(-1===t)return e;const n=e.slice(0,t),r=e.slice(t+1),o=r.replace(/^[^']*'/,"");return i(n,o)}function l(e){return!e.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(e)?e:e.replace(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(e,t,n,r){if("q"===n||"Q"===n)return r=(r=r.replace(/_/g," ")).replace(/=([0-9a-fA-F]{2})/g,function(e,t){return String.fromCharCode(parseInt(t,16))}),i(t,r);try{r=atob(r)}catch(e){}return i(t,r)})}return""}},(e,exports,t)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.PDFNetworkStream=void 0;var n=t(2),r=t(24);const i=200,o=206;class s{constructor(e,t){this.url=e,t=t||{},this.isHttp=/^https?:/i.test(e),this.httpHeaders=this.isHttp&&t.httpHeaders||{},this.withCredentials=t.withCredentials||!1,this.getXhr=t.getXhr||function(){return new XMLHttpRequest},this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(e,t,n){const r={begin:e,end:t};for(const e in n)r[e]=n[e];return this.request(r)}requestFull(e){return this.request(e)}request(e){const t=this.getXhr(),n=this.currXhrId++,r=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const e in this.httpHeaders){const n=this.httpHeaders[e];void 0!==n&&t.setRequestHeader(e,n)}return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),r.expectedStatus=o):r.expectedStatus=i,t.responseType="arraybuffer",e.onError&&(t.onerror=function(n){e.onError(t.status)}),t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),r.onHeadersReceived=e.onHeadersReceived,r.onDone=e.onDone,r.onError=e.onError,r.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){const n=this.pendingRequests[e];n&&n.onProgress&&n.onProgress(t)}onStateChange(e,t){const r=this.pendingRequests[e];if(!r)return;const s=r.xhr;if(s.readyState>=2&&r.onHeadersReceived&&(r.onHeadersReceived(),delete r.onHeadersReceived),4!==s.readyState)return;if(!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],0===s.status&&this.isHttp)return void(r.onError&&r.onError(s.status));const a=s.status||i,l=a===i&&r.expectedStatus===o;if(!l&&a!==r.expectedStatus)return void(r.onError&&r.onError(s.status));const c=function(e){const t=e.response;if("string"!=typeof t)return t;return(0,n.stringToBytes)(t).buffer}(s);if(a===o){const e=s.getResponseHeader("Content-Range"),t=/bytes (\d+)-(\d+)\/(\d+)/.exec(e);r.onDone({begin:parseInt(t[1],10),chunk:c})}else c?r.onDone({begin:0,chunk:c}):r.onError&&r.onError(s.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}exports.PDFNetworkStream=class{constructor(e){this._source=e,this._manager=new s(e.url,{httpHeaders:e.httpHeaders,withCredentials:e.withCredentials}),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new a(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const n=new l(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader&&this._fullRequestReader.cancel(e);const t=this._rangeRequestReaders.slice(0);t.forEach(function(t){t.cancel(e)})}};class a{constructor(e,t){this._manager=e;const r={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=t.url,this._fullRequestId=e.requestFull(r),this._headersReceivedCapability=(0,n.createPromiseCapability)(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e),n=e=>t.getResponseHeader(e),{allowRangeRequests:i,suggestedLength:o}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:n,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});i&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(n),this._isRangeSupported&&this._manager.abortRequest(e),this._headersReceivedCapability.resolve()}_onDone(e){if(e)if(this._requests.length>0){const t=this._requests.shift();t.resolve({value:e.chunk,done:!1})}else this._cachedChunks.push(e.chunk);this._done=!0,this._cachedChunks.length>0||(this._requests.forEach(function(e){e.resolve({value:void 0,done:!0})}),this._requests=[])}_onError(e){const t=this._url,n=(0,r.createResponseStatusError)(e,t);this._storedError=n,this._headersReceivedCapability.reject(n),this._requests.forEach(function(e){e.reject(n)}),this._requests=[],this._cachedChunks=[]}_onProgress(e){this.onProgress&&this.onProgress({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0){const e=this._cachedChunks.shift();return{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const e=(0,n.createPromiseCapability)();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersReceivedCapability.reject(e),this._requests.forEach(function(e){e.resolve({value:void 0,done:!0})}),this._requests=[],this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class l{constructor(e,t,n){this._manager=e;const r={onDone:this._onDone.bind(this),onProgress:this._onProgress.bind(this)};this._requestId=e.requestRange(t,n,r),this._requests=[],this._queuedChunk=null,this._done=!1,this.onProgress=null,this.onClosed=null}_close(){this.onClosed&&this.onClosed(this)}_onDone(e){const t=e.chunk;if(this._requests.length>0){const e=this._requests.shift();e.resolve({value:t,done:!1})}else this._queuedChunk=t;this._done=!0,this._requests.forEach(function(e){e.resolve({value:void 0,done:!0})}),this._requests=[],this._close()}_onProgress(e){!this.isStreamingSupported&&this.onProgress&&this.onProgress({loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(null!==this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const e=(0,n.createPromiseCapability)();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._requests.forEach(function(e){e.resolve({value:void 0,done:!0})}),this._requests=[],this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(e,exports,t)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.PDFFetchStream=void 0;var n=t(2),r=t(24);function i(e,t,n){return{method:"GET",headers:e,signal:n&&n.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function o(e){const t=new Headers;for(const n in e){const r=e[n];void 0!==r&&t.append(n,r)}return t}exports.PDFFetchStream=class{constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader&&this._fullRequestReader._loaded||0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new s(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new a(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader&&this._fullRequestReader.cancel(e);const t=this._rangeRequestReaders.slice(0);t.forEach(function(t){t.cancel(e)})}};class s{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=(0,n.createPromiseCapability)(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),"undefined"!=typeof AbortController&&(this._abortController=new AbortController),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._headers=o(this._stream.httpHeaders);const s=t.url;fetch(s,i(this._headers,this._withCredentials,this._abortController)).then(e=>{if(!(0,r.validateResponseStatus)(e.status))throw(0,r.createResponseStatusError)(e.status,s);this._reader=e.body.getReader(),this._headersCapability.resolve();const t=t=>e.headers.get(t),{allowRangeRequests:i,suggestedLength:o}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:t,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=i,this._contentLength=o||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(t),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new n.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();if(t)return{value:e,done:t};this._loaded+=e.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength});const n=new Uint8Array(e).buffer;return{value:n,done:!1}}cancel(e){this._reader&&this._reader.cancel(e),this._abortController&&this._abortController.abort()}}class a{constructor(e,t,s){this._stream=e,this._reader=null,this._loaded=0;const a=e.source;this._withCredentials=a.withCredentials||!1,this._readCapability=(0,n.createPromiseCapability)(),this._isStreamingSupported=!a.disableStream,"undefined"!=typeof AbortController&&(this._abortController=new AbortController),this._headers=o(this._stream.httpHeaders),this._headers.append("Range",`bytes=${t}-${s-1}`);const l=a.url;fetch(l,i(this._headers,this._withCredentials,this._abortController)).then(e=>{if(!(0,r.validateResponseStatus)(e.status))throw(0,r.createResponseStatusError)(e.status,l);this._readCapability.resolve(),this._reader=e.body.getReader()}).catch(e=>{if(!e||"AbortError"!==e.name)throw e}),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();if(t)return{value:e,done:t};this._loaded+=e.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded});const n=new Uint8Array(e).buffer;return{value:n,done:!1}}cancel(e){this._reader&&this._reader.cancel(e),this._abortController&&this._abortController.abort()}}}],__webpack_module_cache__={};function __w_pdfjs_require__(e){if(__webpack_module_cache__[e])return __webpack_module_cache__[e].exports;var module=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](module,module.exports,__w_pdfjs_require__),module.exports}return __w_pdfjs_require__(0)})()}),define("skylark-pdfjs-display/main",["./display"],function(e){return e}),define("skylark-pdfjs-display",["skylark-pdfjs-display/main"],function(e){return e}),define("skylark-viewerjs/ui_utils",["./viewerjs"],function(e){"use strict";var t=function(){var e=["ms","Moz","Webkit","O"],t={};function n(){}return n.getProp=function(n,r){if(1===arguments.length&&"string"==typeof t[n])return t[n];var i,o,s=(r=r||document.documentElement).style;if("string"==typeof s[n])return t[n]=n;o=n.charAt(0).toUpperCase()+n.slice(1);for(var a=0,l=e.length;a<l;a++)if("string"==typeof s[i=e[a]+o])return t[n]=i;return t[n]="undefined"},n.setProp=function(e,t,n){var r=this.getProp(e);"undefined"!==r&&(t.style[r]=n)},n}();function n(e,t){var n=0,r=e.length-1;if(0===e.length||!t(e[r]))return e.length;if(t(e[n]))return n;for(;n<r;){var i=n+r>>1,o=e[i];t(o)?r=i:n=i+1}return n}var r=function(){function e(e,t){this.visible=!0,this.div=document.querySelector(e+" .progress"),this.bar=this.div.parentNode,this.height=t.height||100,this.width=t.width||100,this.units=t.units||"%",this.div.style.height=this.height+this.units,this.percent=0}return e.prototype={updateBar:function(){if(this._indeterminate)return this.div.classList.add("indeterminate"),void(this.div.style.width=this.width+this.units);this.div.classList.remove("indeterminate");var e=this.width*this._percent/100;this.div.style.width=e+this.units},get percent(){return this._percent},set percent(e){var t,n,r;this._indeterminate=isNaN(e),this._percent=(t=e,n=0,r=100,Math.min(Math.max(t,n),r)),this.updateBar()},setWidth:function(e){if(e){var t=e.parentNode,n=t.offsetWidth-e.offsetWidth;n>0&&this.bar.setAttribute("style","width: calc(100% - "+n+"px);")}},hide:function(){this.visible&&(this.visible=!1,this.bar.classList.add("hidden"),document.body.classList.remove("loadingInProgress"))},show:function(){this.visible||(this.visible=!0,document.body.classList.add("loadingInProgress"),this.bar.classList.remove("hidden"))}},e}();return e.uiutils={CustomStyle:t,getFileName:function(e){var t=e.indexOf("#"),n=e.indexOf("?"),r=Math.min(t>0?t:e.length,n>0?n:e.length);return e.substring(e.lastIndexOf("/",r)+1,r)},getOutputScale:function(e){var t=window.devicePixelRatio||1,n=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,r=t/n;return{sx:r,sy:r,scaled:1!==r}},scrollIntoView:function(e,t){var n=e.offsetParent,r=e.offsetTop+e.clientTop,i=e.offsetLeft+e.clientLeft;if(!n)return void console.error("offsetParent is not set -- cannot scroll");for(;n.clientHeight===n.scrollHeight;)if(n.dataset._scaleY&&(r/=n.dataset._scaleY,i/=n.dataset._scaleX),r+=n.offsetTop,i+=n.offsetLeft,!(n=n.offsetParent))return;t&&(void 0!==t.top&&(r+=t.top),void 0!==t.left&&(i+=t.left,n.scrollLeft=i));n.scrollTop=r},watchScroll:function(e,t){var n=function(n){i||(i=window.requestAnimationFrame(function(){i=null;var n=e.scrollTop,o=r.lastY;n!==o&&(r.down=n>o),r.lastY=n,t(r)}))},r={down:!0,lastY:e.scrollTop,_eventHandler:n},i=null;return e.addEventListener("scroll",n,!0),r},binarySearchFirstItem:n,getVisibleElements:function(e,t,r){var i=e.scrollTop,o=i+e.clientHeight,s=e.scrollLeft,a=s+e.clientWidth;for(var l,c,u,d,h,p,f,m,g=[],b=0===t.length?0:n(t,function(e){var t=e.div;return t.offsetTop+t.clientTop+t.clientHeight>i}),y=t.length;b<y&&(l=t[b],c=l.div,u=c.offsetTop+c.clientTop,d=c.clientHeight,!(u>o));b++)f=c.offsetLeft+c.clientLeft,m=c.clientWidth,f+m<s||f>a||(h=Math.max(0,i-u)+Math.max(0,u+d-o),p=100*(d-h)/d|0,g.push({id:l.id,x:f,y:u,view:l,percent:p}));var v=g[0],S=g[g.length-1];r&&g.sort(function(e,t){var n=e.percent-t.percent;return Math.abs(n)>.001?-n:e.id-t.id});return{first:v,last:S,views:g}},getPDFFileNameFromURL:function(e){var t=/[^\/?#=]+\.pdf\b(?!.*\.pdf\b)/i,n=/^(?:([^:]+:)?\/\/[^\/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/.exec(e),r=t.exec(n[1])||t.exec(n[2])||t.exec(n[3]);if(r&&-1!==(r=r[0]).indexOf("%"))try{r=t.exec(decodeURIComponent(r))[0]}catch(e){}return r||"document.pdf"},ProgressBar:r}}),define("skylark-viewerjs/text_layer_builder",["skylark-pdfjs-display","./viewerjs","./ui_utils"],function(e,t,n){"use strict";var r=/\S/;function i(e){this.textLayerDiv=e.textLayerDiv,this.renderingDone=!1,this.divContentDone=!1,this.pageIdx=e.pageIndex,this.pageNumber=this.pageIdx+1,this.matches=[],this.viewport=e.viewport,this.textDivs=[],this.findController=e.findController||null}function o(){}return i.prototype={_finishRendering:function(){this.renderingDone=!0;var e=document.createEvent("CustomEvent");e.initCustomEvent("textlayerrendered",!0,!0,{pageNumber:this.pageNumber}),this.textLayerDiv.dispatchEvent(e)},renderLayer:function(){var e=document.createDocumentFragment(),t=this.textDivs,r=t.length,i=document.createElement("canvas"),o=i.getContext("2d");if(r>1e5)this._finishRendering();else{for(var s,a,l=0;l<r;l++){var c=t[l];if(void 0===c.dataset.isWhitespace){var u=c.style.fontSize,d=c.style.fontFamily;u===s&&d===a||(o.font=u+" "+d,s=u,a=d);var h=o.measureText(c.textContent).width;if(h>0){var p;if(e.appendChild(c),void 0!==c.dataset.canvasWidth){var f=c.dataset.canvasWidth/h;p="scaleX("+f+")"}else p="";var m=c.dataset.angle;m&&(p="rotate("+m+"deg) "+p),p&&n.CustomStyle.setProp("transform",c,p)}}}this.textLayerDiv.appendChild(e),this._finishRendering(),this.updateMatches()}},render:function(e){if(this.divContentDone&&!this.renderingDone)if(this.renderTimer&&(clearTimeout(this.renderTimer),this.renderTimer=null),e){var t=this;this.renderTimer=setTimeout(function(){t.renderLayer(),t.renderTimer=null},e)}else this.renderLayer()},appendText:function(t,n){var i=n[t.fontName],o=document.createElement("div");if(this.textDivs.push(o),s=t.str,r.test(s)){var s,a=e.Util.transform(this.viewport.transform,t.transform),l=Math.atan2(a[1],a[0]);i.vertical&&(l+=Math.PI/2);var c,u,d=Math.sqrt(a[2]*a[2]+a[3]*a[3]),h=d;i.ascent?h=i.ascent*h:i.descent&&(h=(1+i.descent)*h),0===l?(c=a[4],u=a[5]-h):(c=a[4]+h*Math.sin(l),u=a[5]-h*Math.cos(l)),o.style.left=c+"px",o.style.top=u+"px",o.style.fontSize=d+"px",o.style.fontFamily=i.fontFamily,o.textContent=t.str,e.pdfBug&&(o.dataset.fontName=t.fontName),0!==l&&(o.dataset.angle=l*(180/Math.PI)),o.textContent.length>1&&(i.vertical?o.dataset.canvasWidth=t.height*this.viewport.scale:o.dataset.canvasWidth=t.width*this.viewport.scale)}else o.dataset.isWhitespace=!0},setTextContent:function(e){this.textContent=e;for(var t=e.items,n=0,r=t.length;n<r;n++)this.appendText(t[n],e.styles);this.divContentDone=!0},convertMatches:function(e){for(var t=0,n=0,r=this.textContent.items,i=r.length-1,o=null===this.findController?0:this.findController.state.query.length,s=[],a=0,l=e.length;a<l;a++){for(var c=e[a];t!==i&&c>=n+r[t].str.length;)n+=r[t].str.length,t++;t===r.length&&console.error("Could not find a matching mapping");var u={begin:{divIdx:t,offset:c-n}};for(c+=o;t!==i&&c>n+r[t].str.length;)n+=r[t].str.length,t++;u.end={divIdx:t,offset:c-n},s.push(u)}return s},renderMatches:function(e){if(0!==e.length){var t=this.textContent.items,n=this.textDivs,r=null,i=this.pageIdx,o=null!==this.findController&&i===this.findController.selected.pageIdx,s=null===this.findController?-1:this.findController.selected.matchIdx,a=null!==this.findController&&this.findController.state.highlightAll,l={divIdx:-1,offset:void 0},c=s,u=c+1;if(a)c=0,u=e.length;else if(!o)return;for(var d=c;d<u;d++){var h=e[d],p=h.begin,f=h.end,m=o&&d===s,g=m?" selected":"";if(this.findController&&this.findController.updateMatchPosition(i,d,n,p.divIdx,f.divIdx),r&&p.divIdx===r.divIdx?S(r.divIdx,r.offset,p.offset):(null!==r&&S(r.divIdx,r.offset,l.offset),v(p)),p.divIdx===f.divIdx)S(p.divIdx,p.offset,f.offset,"highlight"+g);else{S(p.divIdx,p.offset,l.offset,"highlight begin"+g);for(var b=p.divIdx+1,y=f.divIdx;b<y;b++)n[b].className="highlight middle"+g;v(f,"highlight end"+g)}r=f}r&&S(r.divIdx,r.offset,l.offset)}function v(e,t){var r=e.divIdx;n[r].textContent="",S(r,0,e.offset,t)}function S(e,r,i,o){var s=n[e],a=t[e].str.substring(r,i),l=document.createTextNode(a);if(o){var c=document.createElement("span");return c.className=o,c.appendChild(l),void s.appendChild(c)}s.appendChild(l)}},updateMatches:function(){if(this.renderingDone){for(var e=this.matches,t=this.textDivs,n=this.textContent.items,r=-1,i=0,o=e.length;i<o;i++){for(var s=e[i],a=Math.max(r,s.begin.divIdx),l=a,c=s.end.divIdx;l<=c;l++){var u=t[l];u.textContent=n[l].str,u.className=""}r=s.end.divIdx+1}null!==this.findController&&this.findController.active&&(this.matches=this.convertMatches(null===this.findController?[]:this.findController.pageMatches[this.pageIdx]||[]),this.renderMatches(this.matches))}}},o.prototype={createTextLayerBuilder:function(e,t,n){return new i({textLayerDiv:e,pageIndex:t,viewport:n})}},i.DefaultTextLayerFactory=o,t.TextLayerBuilder=i}),define("skylark-viewerjs/PDFViewerPlugin",["skylark-pdfjs-display","./viewerjs","./ui_utils","./text_layer_builder"],function(e,t,n,r){return t.PDFViewerPlugin=function(){"use strict";var t=this,i=[],o=[],s=[],a=[],l={BLANK:0,RUNNING:1,FINISHED:2,RUNNINGOUTDATED:3},c=200,u=null,d=null,h=!0,p=1,f=1,m=0,g=0,b=0;function y(e){if("none"===e.style.display)return!1;var t=u.scrollTop,n=t+u.clientHeight,r=e.offsetTop,i=r+e.clientHeight;return r>=t&&r<n||i>=t&&i<n||r<t&&i>=n}function v(e){return o[e.pageNumber-1]}function S(e){return a[e.pageNumber-1]}function C(e,t){a[e.pageNumber-1]=t}function x(e,t,r){var i=v(e),o=i.getElementsByTagName("canvas")[0],s=i.getElementsByTagName("div")[0],a="scale("+p+", "+p+")";i.style.width=t+"px",i.style.height=r+"px",o.width=t,o.height=r,o.style.width=t+"px",o.style.height=r+"px",s.style.width=t+"px",s.style.height=r+"px",n.CustomStyle.setProp("transform",s,a),n.CustomStyle.setProp("transformOrigin",s,"0% 0%"),S(e)===l.RUNNING?C(e,l.RUNNINGOUTDATED):C(e,l.BLANK)}function A(e){var t,n,r;S(e)===l.BLANK&&(C(e,l.RUNNING),t=v(e),n=function(e){return s[e.pageNumber-1]}(e),r=t.getElementsByTagName("canvas")[0],e.render({canvasContext:r.getContext("2d"),textLayer:n,viewport:e.getViewport({scale:p})}).promise.then(function(){}))}function w(e){var n,f,y,v,S,C,A;n=e.pageNumber,C=e.getViewport({scale:p}),(S=document.createElement("div")).id="pageContainer"+n,S.className="page",S.style.display="none",(v=document.createElement("canvas")).id="canvas"+n,(f=document.createElement("div")).className="textLayer",f.id="textLayer"+n,S.appendChild(v),S.appendChild(f),i[e.pageNumber-1]=e,o[e.pageNumber-1]=S,a[e.pageNumber-1]=l.BLANK,x(e,C.width,C.height),m<C.width&&(m=C.width),g<C.height&&(g=C.height),C.width<C.height&&(h=!1),y=new r({textLayerDiv:f,viewport:C,pageIndex:n-1}),e.getTextContent().then(function(e){y.setTextContent(e),y.render(c)}),s[e.pageNumber-1]=y,(b+=1)===d.numPages&&(A=!t.isSlideshow(),o.forEach(function(e){A&&(e.style.display="block"),u.appendChild(e)}),t.onLoad(),t.showPage(1))}this.initialize=function(t,n){var r;(function(){e.GlobalWorkerOptions.workerSrc="./skylark-pdfjs-worker-all.js",e.getDocument(n).promise.then(function(e){for(d=e,u=t,r=0;r<d.numPages;r+=1)d.getPage(r+1).then(w)})})()},this.isSlideshow=function(){return h},this.onLoad=function(){},this.getPages=function(){return o},this.fitToWidth=function(e){var n;m!==e&&(n=e/m,t.setZoomLevel(n))},this.fitToHeight=function(e){var n;g!==e&&(n=e/g,t.setZoomLevel(n))},this.fitToPage=function(e,n){var r=e/m;n/g<r&&(r=n/g),t.setZoomLevel(r)},this.fitSmart=function(e,n){var r=e/m;n&&n/g<r&&(r=n/g),r=Math.min(1,r),t.setZoomLevel(r)},this.setZoomLevel=function(e){var t,n;if(p!==e)for(p=e,t=0;t<i.length;t+=1)n=i[t].getViewport({scale:p}),x(i[t],n.width,n.height)},this.getZoomLevel=function(){return p},this.onScroll=function(){var e;for(e=0;e<o.length;e+=1)y(o[e])&&A(i[e])},this.getPageInView=function(){var e;if(t.isSlideshow())return f;for(e=0;e<o.length;e+=1)if(y(o[e]))return e+1},this.showPage=function(e){var n;t.isSlideshow()?(o[f-1].style.display="none",f=e,A(i[e-1]),o[e-1].style.display="block"):(n=o[e-1]).parentNode.scrollTop=n.offsetTop},this.getPluginName=function(){return"PDF.js"},this.getPluginVersion=function(){var e="undefined"!==String(typeof pdfjs_version)?pdfjs_version:"From Source";return e},this.getPluginURL=function(){return"https://github.com/mozilla/pdf.js/"}}}),define("skylark-viewerjs/plugin_registry",["./viewerjs","./ODFViewerPlugin","./PDFViewerPlugin"],function(e,t,n){var r,i,o=[(r=["application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.text-flat-xml","application/vnd.oasis.opendocument.text-template","application/vnd.oasis.opendocument.presentation","application/vnd.oasis.opendocument.presentation-flat-xml","application/vnd.oasis.opendocument.presentation-template","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.spreadsheet-flat-xml","application/vnd.oasis.opendocument.spreadsheet-template"],i=["odt","fodt","ott","odp","fodp","otp","ods","fods","ots"],{supportsMimetype:function(e){return-1!==r.indexOf(e)},supportsFileExtension:function(e){return-1!==i.indexOf(e)},path:"./ODFViewerPlugin",getClass:function(){return t}}),{supportsMimetype:function(e){return"application/pdf"===e},supportsFileExtension:function(e){return"pdf"===e},path:"./PDFViewerPlugin",getClass:function(){return n}}];return e.pluginRegistry=o}),define("skylark-viewerjs/init",["./viewerjs","./viewer","./plugin_registry"],function(e,t,n){function r(e){var t;return n.some(function(n){return!!n.supportsFileExtension(e)&&(t=n,!0)}),t}return e.init=function(){window.onload=function(){var e,i=document.location.hash.substring(1),o=function(e){var t={};return(e.search||"?").substr(1).split("&").forEach(function(e){if(e){var n=e.split("=",2);t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}}),t}(document.location);i?(o.title||(o.title=i.replace(/^.*[\\\/]/,"")),o.documentUrl=i,function(e,t){var r=new XMLHttpRequest;r.onreadystatechange=function(){var e,i;4===r.readyState&&((r.status>=200&&r.status<300||0===r.status)&&(e=r.getResponseHeader("content-type"))&&n.some(function(t){return!!t.supportsMimetype(e)&&(i=t,console.log("Found plugin by mimetype and xhr head: "+e),!0)}),t(i))},r.open("HEAD",e,!0),r.send()}(i,function(n){n||(n=o.type?function(e){var t=r(e);t&&console.log("Found plugin by parameter type: "+e);return t}(o.type):function(e){var t=e.split("?")[0].split(".").pop(),n=r(t);n&&console.log("Found plugin by file extension from path: "+t);return n}(i)),n?"undefined"!==String(typeof loadPlugin)?loadPlugin(n.path,function(){e=n.getClass(),new t(new e,o)}):(e=n.getClass(),new t(new e,o)):new t})):new t}}}),define("skylark-viewerjs/main",["./viewerjs","./viewer","./ODFViewerPlugin","./PDFViewerPlugin","./plugin_registry","./text_layer_builder","./ui_utils","./init"],function(e){return e}),define("skylark-viewerjs",["skylark-viewerjs/main"],function(e){return e})}(define,require),!isAmd){var skylarkjs=require("skylark-langx-ns");isCmd?module.exports=skylarkjs:globals.skylarkjs=skylarkjs}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-viewerjs-all.js.map
