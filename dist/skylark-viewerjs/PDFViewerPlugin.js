/**
 * skylark-viewerjs - A version of viewerjs that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-pdfjs-display","./viewerjs","./ui_utils","./text_layer_builder"],function(e,t,n,i){return t.PDFViewerPlugin=function(){"use strict";var t=this,o=[],r=[],s=[],a=[],l={BLANK:0,RUNNING:1,FINISHED:2,RUNNINGOUTDATED:3},u=200,h=null,g=null,c=!0,f=1,p=1,d=0,m=0,N=0;function v(e){if("none"===e.style.display)return!1;var t=h.scrollTop,n=t+h.clientHeight,i=e.offsetTop,o=i+e.clientHeight;return i>=t&&i<n||o>=t&&o<n||i<t&&o>=n}function y(e){return r[e.pageNumber-1]}function w(e){return a[e.pageNumber-1]}function L(e,t){a[e.pageNumber-1]=t}function x(e,t,i){var o=y(e),r=o.getElementsByTagName("canvas")[0],s=o.getElementsByTagName("div")[0],a="scale("+f+", "+f+")";o.style.width=t+"px",o.style.height=i+"px",r.width=t,r.height=i,r.style.width=t+"px",r.style.height=i+"px",s.style.width=t+"px",s.style.height=i+"px",n.CustomStyle.setProp("transform",s,a),n.CustomStyle.setProp("transformOrigin",s,"0% 0%"),w(e)===l.RUNNING?L(e,l.RUNNINGOUTDATED):L(e,l.BLANK)}function P(e){var t,n,i;w(e)===l.BLANK&&(L(e,l.RUNNING),t=y(e),n=function(e){return s[e.pageNumber-1]}(e),i=t.getElementsByTagName("canvas")[0],e.render({canvasContext:i.getContext("2d"),textLayer:n,viewport:e.getViewport({scale:f})}).promise.then(function(){}))}function T(e){var n,p,v,y,w,L,P;n=e.pageNumber,L=e.getViewport({scale:f}),(w=document.createElement("div")).id="pageContainer"+n,w.className="page",w.style.display="none",(y=document.createElement("canvas")).id="canvas"+n,(p=document.createElement("div")).className="textLayer",p.id="textLayer"+n,w.appendChild(y),w.appendChild(p),o[e.pageNumber-1]=e,r[e.pageNumber-1]=w,a[e.pageNumber-1]=l.BLANK,x(e,L.width,L.height),d<L.width&&(d=L.width),m<L.height&&(m=L.height),L.width<L.height&&(c=!1),v=new i({textLayerDiv:p,viewport:L,pageIndex:n-1}),e.getTextContent().then(function(e){v.setTextContent(e),v.render(u)}),s[e.pageNumber-1]=v,(N+=1)===g.numPages&&(P=!t.isSlideshow(),r.forEach(function(e){P&&(e.style.display="block"),h.appendChild(e)}),t.onLoad(),t.showPage(1))}this.initialize=function(t,n){var i;e.GlobalWorkerOptions.workerSrc="./skylark-pdfjs-worker-all.js",e.getDocument(n).promise.then(function(e){for(g=e,h=t,i=0;i<g.numPages;i+=1)g.getPage(i+1).then(T)})},this.isSlideshow=function(){return c},this.onLoad=function(){},this.getPages=function(){return r},this.fitToWidth=function(e){var n;d!==e&&(n=e/d,t.setZoomLevel(n))},this.fitToHeight=function(e){var n;m!==e&&(n=e/m,t.setZoomLevel(n))},this.fitToPage=function(e,n){var i=e/d;n/m<i&&(i=n/m),t.setZoomLevel(i)},this.fitSmart=function(e,n){var i=e/d;n&&n/m<i&&(i=n/m),i=Math.min(1,i),t.setZoomLevel(i)},this.setZoomLevel=function(e){var t,n;if(f!==e)for(f=e,t=0;t<o.length;t+=1)n=o[t].getViewport({scale:f}),x(o[t],n.width,n.height)},this.getZoomLevel=function(){return f},this.onScroll=function(){var e;for(e=0;e<r.length;e+=1)v(r[e])&&P(o[e])},this.getPageInView=function(){var e;if(t.isSlideshow())return p;for(e=0;e<r.length;e+=1)if(v(r[e]))return e+1},this.showPage=function(e){var n;t.isSlideshow()?(r[p-1].style.display="none",p=e,P(o[e-1]),r[e-1].style.display="block"):(n=r[e-1]).parentNode.scrollTop=n.offsetTop},this.getPluginName=function(){return"PDF.js"},this.getPluginVersion=function(){return"undefined"!==String(typeof pdfjs_version)?pdfjs_version:"From Source"},this.getPluginURL=function(){return"https://github.com/mozilla/pdf.js/"}}});
//# sourceMappingURL=sourcemaps/PDFViewerPlugin.js.map
